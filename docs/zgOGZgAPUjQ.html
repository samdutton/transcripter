<!DOCTYPE html>

<! — 
Copyright 2018 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
 — >

<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="//google.com">
<meta name="description" content="Chrome Dev Summit">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>zgOGZgAPUjQ</title>
<link rel="stylesheet" href="css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/zgOGZgAPUjQ?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<span data-start="0.5" data-end="3.776">[MUSIC PLAYING]</span> </section>

<section><span data-start="6.45" data-end="7.95"><span class="speaker">Thomas Nattestad</span>: My name is Thomas,</span> <span data-start="7.95" data-end="9.784">and I'm the product manager for WebAssembly.</span> </section>

<section><span data-start="9.784" data-end="12.158"><span class="speaker">Alex Danilo</span>: My name is Alex, and I'm a software engineer</span> <span data-start="12.158" data-end="12.99">on Chrome OS.</span> </section>

<section><span data-start="12.99" data-end="13.44"><span class="speaker">Thomas Nattestad</span>: And today we're</span> <span data-start="13.44" data-end="15.064">going to talk to you about WebAssembly.</span> <span data-start="15.064" data-end="17.1">We're going to start off by briefly</span> <span data-start="17.1" data-end="19.867">describing what WebAssembly is and what you can use it for.</span> <span data-start="19.867" data-end="22.2">Then I want to show off some of the amazing new features</span> <span data-start="22.2" data-end="24.99">that the WebAssembly team has been working on to deliver</span> <span data-start="24.99" data-end="26.73">to you in this last year.</span> <span data-start="26.73" data-end="29.517">Then I'll showcase some of the amazing applications</span> <span data-start="29.517" data-end="31.35">that have managed to build with WebAssembly,</span> <span data-start="31.35" data-end="33.791">and our shipping and production.</span> <span data-start="33.791" data-end="34.29">All right.</span> <span data-start="34.29" data-end="37.83">So first off, what is WebAssembly, actually?</span> <span data-start="37.83" data-end="40.68">WebAssembly is a new language for the web,</span> <span data-start="40.68" data-end="43.56">and offers an alternative to JavaScript for expressing logic</span> <span data-start="43.56" data-end="45.03">on the web platform.</span> <span data-start="45.03" data-end="48.96">It's important to note, though, that WebAssembly is in no way</span> <span data-start="48.96" data-end="51.03">a replacement for JavaScript.</span> <span data-start="51.03" data-end="54.72">Rather, it's designed to fill the gaps that</span> <span data-start="54.72" data-end="56.52">exist in JavaScript today.</span> <span data-start="56.52" data-end="59.79">Specifically, WebAssembly is designed as a compilation</span> <span data-start="59.79" data-end="62.52">target, meaning that you write in higher level languages,</span> <span data-start="62.52" data-end="66.72">such as C++, and then compile into WebAssembly.</span> <span data-start="66.72" data-end="69.01">WebAssembly is also designed to deliver</span> <span data-start="69.01" data-end="71.4">reliable and maximized performance, which</span> <span data-start="71.4" data-end="73.5">is something that can be difficult to get out</span> <span data-start="73.5" data-end="75.784">of JavaScript.</span> <span data-start="75.784" data-end="77.2">Most exciting, though, is the fact</span> <span data-start="77.2" data-end="80.26">that WebAssembly is now shipping in all four major browsers,</span> <span data-start="80.26" data-end="83.14">making it the first new language to be fully supported</span> <span data-start="83.14" data-end="85.24">in every major browser since JavaScript was</span> <span data-start="85.24" data-end="88.16">created more than 20 years ago.</span> <span data-start="88.16" data-end="88.66">All right.</span> <span data-start="88.66" data-end="90.243">So what can you actually do with this?</span> <span data-start="90.243" data-end="92.68">Well, as I already mentioned, because WebAssembly offers</span> <span data-start="92.68" data-end="94.81">maximized and reliable performance,</span> <span data-start="94.81" data-end="96.52">you can now expand the set of things</span> <span data-start="96.52" data-end="98.53">that you can feasibly do in the browser.</span> <span data-start="98.53" data-end="102.37">Things like video editing, complex application, codecs,</span> <span data-start="102.37" data-end="104.62">digital signal processing, and many, many more</span> <span data-start="104.62" data-end="107.32">performance-demanding use cases can now</span> <span data-start="107.32" data-end="109.8">be supported on the web.</span> <span data-start="109.8" data-end="112.74">Secondly, WebAssembly offers amazing portability.</span> <span data-start="112.74" data-end="114.69">Because you can compile from other languages,</span> <span data-start="114.69" data-end="117.69">you can port not only your own applications and libraries</span> <span data-start="117.69" data-end="121.2">but also the wealth of open-source C++ libraries</span> <span data-start="121.2" data-end="124.29">and applications that have been written.</span> <span data-start="124.29" data-end="126.6">Lastly, and potentially most exciting to many of you,</span> <span data-start="126.6" data-end="128.43">is the promise for more flexibility</span> <span data-start="128.43" data-end="129.87">when writing for the web.</span> <span data-start="129.87" data-end="131.79">Since the web's inception, JavaScript</span> <span data-start="131.79" data-end="135.45">has been the only fully supported way</span> <span data-start="135.45" data-end="138.15">to execute code on the web, and now with WebAssembly you</span> <span data-start="138.15" data-end="140.619">have more choice.</span> <span data-start="140.619" data-end="142.91">All right, so now that we all know what WebAssembly is,</span> <span data-start="142.91" data-end="145.201">I want to jump in and show off some of the new features</span> <span data-start="145.201" data-end="147.35">that we've been adding in just the last year.</span> <span data-start="147.35" data-end="149.4">First off is source maps.</span> <span data-start="149.4" data-end="151.867">You likely all know how important source maps are</span> <span data-start="151.867" data-end="153.95">when you're working with something like TypeScript</span> <span data-start="153.95" data-end="156.23">or Babel, but it's even more important</span> <span data-start="156.23" data-end="158.96">when you're trying to debug your WebAssembly code.</span> <span data-start="158.96" data-end="160.82">Source maps let you turn something</span> <span data-start="160.82" data-end="163.88">that looks like this into something just slightly more</span> <span data-start="163.88" data-end="166.04">friendly, like this.</span> <span data-start="166.04" data-end="168.71">With source maps you can see the specific line of code</span> <span data-start="168.71" data-end="170.9">where an error has occurred and you can also</span> <span data-start="170.9" data-end="173.39">set breakpoints and have the program actually pause</span> <span data-start="173.39" data-end="176.15">at the appropriate moment.</span> <span data-start="176.15" data-end="178.88">One of the big feature requests that we've heard from users</span> <span data-start="178.88" data-end="182.15">is for better performance when you're starting up</span> <span data-start="182.15" data-end="184.4">your application so that your module can actually</span> <span data-start="184.4" data-end="185.6">get going faster.</span> <span data-start="185.6" data-end="188.48">And for that we've created streaming compilation.</span> <span data-start="188.48" data-end="190.52">In the past, when you wanted to compile a module</span> <span data-start="190.52" data-end="192.061">you had to wait for the entire module</span> <span data-start="192.061" data-end="194.45">to be loaded off of the network, and only then could</span> <span data-start="194.45" data-end="196.85">you move on and actually compile it.</span> <span data-start="196.85" data-end="198.47">Now with streaming compilation, you</span> <span data-start="198.47" data-end="200.93">can start compiling each piece of your module</span> <span data-start="200.93" data-end="202.97">immediately, even before the other parts have</span> <span data-start="202.97" data-end="205.39">finished downloading.</span> <span data-start="205.39" data-end="207.14">To show you what that actually looks like,</span> <span data-start="207.14" data-end="210.51">here's a simple example where we called a fetch function — </span> <span data-start="210.51" data-end="213.94">or fetch for a WebAssembly Fibonacci module,</span> <span data-start="213.94" data-end="216.43">and then we just passed that fetch promise directly</span> <span data-start="216.43" data-end="219.1">into WebAssembly.inst antiateStreaming,</span> <span data-start="219.1" data-end="222.34">and it takes care of all of this underlying bits</span> <span data-start="222.34" data-end="226.44">and pieces for you to deliver this experience.</span> <span data-start="226.44" data-end="229.02">We did some profiling at different network speeds</span> <span data-start="229.02" data-end="230.76">to see the impact of this.</span> <span data-start="230.76" data-end="233.16">We found that all the way up until 50 megabits</span> <span data-start="233.16" data-end="235.29">per second network speed, the network</span> <span data-start="235.29" data-end="237.21">was actually the primary bottleneck,</span> <span data-start="237.21" data-end="240.03">and that the compilation was done as soon as the module was</span> <span data-start="240.03" data-end="240.99">loaded.</span> <span data-start="240.99" data-end="244.08">It wasn't until you hit the 100 megabits per second speeds</span> <span data-start="244.08" data-end="246.75">that you actually needed additional time past the time</span> <span data-start="246.75" data-end="248.76">it took to download the module in order to fully</span> <span data-start="248.76" data-end="251.51">compile and get it going.</span> <span data-start="251.51" data-end="253.47">To make startup time even faster,</span> <span data-start="253.47" data-end="256.519">the team built and launched an entire new compiler</span> <span data-start="256.519" data-end="259.16">that we called the Liftoff compiler.</span> <span data-start="259.16" data-end="262.31">This Liftoff compiler takes the WebAssembly byte code</span> <span data-start="262.31" data-end="265.37">that comes down off of the wire and then starts executing it</span> <span data-start="265.37" data-end="266.66">immediately.</span> <span data-start="266.66" data-end="269.75">The WebAssembly module is then taken off the main thread</span> <span data-start="269.75" data-end="273.56">and optimized further by the TurboFan optimizing compiler.</span> <span data-start="273.56" data-end="276.35">When TurboFan is done optimizing the WebAssembly code,</span> <span data-start="276.35" data-end="277.91">it's then hot swapped in directly</span> <span data-start="277.91" data-end="282.26">without any need for explicit developer action.</span> <span data-start="282.26" data-end="286.28">Unity did some benchmarking on the effects that Liftoff had.</span> <span data-start="286.28" data-end="289.2">On a benchmark where they tried to load a very large game,</span> <span data-start="289.2" data-end="292.34">they found that it went from taking seven seconds to load</span> <span data-start="292.34" data-end="294.23">the game to less than one second, which</span> <span data-start="294.23" data-end="296.24">makes all of the difference when you're waiting</span> <span data-start="296.24" data-end="298.977">to get into a game experience.</span> <span data-start="298.977" data-end="300.81">Probably the biggest feature that the team's</span> <span data-start="300.81" data-end="303.62">been working on this year is WebAssembly threads.</span> <span data-start="303.62" data-end="307.22">WebAssembly threads lets you run fast, highly paralyzed code</span> <span data-start="307.22" data-end="309.65">for the first time across multiple browsers.</span> <span data-start="309.65" data-end="312.68">It also lets you bring existing libraries and applications</span> <span data-start="312.68" data-end="316.127">that use threaded code such as Pthreads to the web.</span> <span data-start="316.127" data-end="317.96">This is such a big feature that I'm actually</span> <span data-start="317.96" data-end="322.244">going to leave most of the explanation to Alex later on.</span> <span data-start="322.244" data-end="323.66">But before I get into that, I want</span> <span data-start="323.66" data-end="325.877">to show off some of the cool new applications</span> <span data-start="325.877" data-end="328.46">that have already been building and launching with WebAssembly</span> <span data-start="328.46" data-end="330.32">this last year.</span> <span data-start="330.32" data-end="332.36">First off is SketchUp.</span> <span data-start="332.36" data-end="334.31">SketchUp is a 3D modeling software</span> <span data-start="334.31" data-end="336.71">that you can learn and start using really quickly.</span> <span data-start="336.71" data-end="338.66">Unlike traditional computer-aided design,</span> <span data-start="338.66" data-end="341.78">most people can learn SketchUp almost right away.</span> <span data-start="341.78" data-end="343.97">SketchUp lets people draw in perspective and then</span> <span data-start="343.97" data-end="346.31">push-pull things into 3D.</span> <span data-start="346.31" data-end="348.89">In no time, people can draw and redesign a living room,</span> <span data-start="348.89" data-end="350.66">plan out a do-it-yourself project,</span> <span data-start="350.66" data-end="353.326">or create and export a model for 3D printing.</span> <span data-start="353.326" data-end="355.7">This app is a lot of fun and you should all check it out,</span> <span data-start="355.7" data-end="357.77">which you can do right now instantly, just</span> <span data-start="357.77" data-end="360.39">by going to app.sketchup.com.</span> <span data-start="360.39" data-end="362.75">SketchUp has been around for a desktop application,</span> <span data-start="362.75" data-end="364.52">but the team's strategy has always</span> <span data-start="364.52" data-end="366.71">been to expand and broaden the market</span> <span data-start="366.71" data-end="368.6">of people who can use 3D modeling,</span> <span data-start="368.6" data-end="371.12">and by making it simple and easy to use</span> <span data-start="371.12" data-end="373.9">and accessible to everyone.</span> <span data-start="373.9" data-end="376.51">Delivering the app over the web was a critical step</span> <span data-start="376.51" data-end="378.569">in that strategy, and the team knew</span> <span data-start="378.569" data-end="380.11">that they wanted to use the same code</span> <span data-start="380.11" data-end="382.81">base as their desktop applications,</span> <span data-start="382.81" data-end="385.27">because rewriting their entire application in JavaScript</span> <span data-start="385.27" data-end="387.4">was just simply not an option.</span> <span data-start="387.4" data-end="391.63">The team's approach was to use the WebAssembly and Emscripten</span> <span data-start="391.63" data-end="394.99">compiler to compile their core 3D modeler</span> <span data-start="394.99" data-end="397.06">and bring it to the web.</span> <span data-start="397.06" data-end="400.27">The initial port took two engineers only three months</span> <span data-start="400.27" data-end="403.12">to bring to the web, which is pretty phenomenal when</span> <span data-start="403.12" data-end="405.1">you realize just how drastically it expanded</span> <span data-start="405.1" data-end="408.096">the reach of their application.</span> <span data-start="408.096" data-end="409.72">The early focus for SketchUp has always</span> <span data-start="409.72" data-end="412.18">been on the next generation of 3D modelers,</span> <span data-start="412.18" data-end="413.56">and today SketchUp is already one</span> <span data-start="413.56" data-end="416.02">of the most popular apps on the G Suite for education</span> <span data-start="416.02" data-end="417.121">marketplace.</span> <span data-start="417.121" data-end="419.62">At the same time, the app has opened up a subscription model</span> <span data-start="419.62" data-end="421.94">for SketchUp, and in just over six months,</span> <span data-start="421.94" data-end="425.32">the team has increased its paying customer base by 10%.</span> <span data-start="425.32" data-end="427.27">SketchUp has also seen consistent growth</span> <span data-start="427.27" data-end="429.67">in session time, returning visitor percentage,</span> <span data-start="429.67" data-end="432.62">and active users.</span> <span data-start="432.62" data-end="435.17">Moving on, the next application that I want to mention</span> <span data-start="435.17" data-end="436.316">is Google Earth.</span> <span data-start="436.316" data-end="438.44">I'm happy to say that Google Earth has successfully</span> <span data-start="438.44" data-end="442.16">gotten their application ported to WebAssembly, including</span> <span data-start="442.16" data-end="444.722">the newly added support for WebAssembly threads.</span> <span data-start="444.722" data-end="446.18">The best part is that they actually</span> <span data-start="446.18" data-end="449.66">got this threaded build working in both Chrome and Firefox,</span> <span data-start="449.66" data-end="452.18">making Google Earth the first WebAssembly</span> <span data-start="452.18" data-end="456.97">multi-threaded application to be running in multiple browsers.</span> <span data-start="456.97" data-end="458.5">Google Earth did some benchmarking,</span> <span data-start="458.5" data-end="460.51">comparing their single threaded version</span> <span data-start="460.51" data-end="462.4">to their multi-threaded version.</span> <span data-start="462.4" data-end="464.35">They found that the frame rate almost</span> <span data-start="464.35" data-end="466.63">doubled when they went to their threaded version,</span> <span data-start="466.63" data-end="473.25">and the amount of jank/dropped also reduced by more than half.</span> <span data-start="473.25" data-end="475.32">All right, so the last big company</span> <span data-start="475.32" data-end="478.5">and launch that I want to mention is Soundation.</span> <span data-start="478.5" data-end="480.39">Soundation is a web-based music studio</span> <span data-start="480.39" data-end="482.07">that enables anyone to make music</span> <span data-start="482.07" data-end="485.79">online with a wide selection of instruments, loops, samples,</span> <span data-start="485.79" data-end="487.05">and effects.</span> <span data-start="487.05" data-end="489.66">No additional hardware or installation or storage</span> <span data-start="489.66" data-end="490.53">is required.</span> <span data-start="490.53" data-end="493.56">Everything is accessible instantly and everywhere.</span> <span data-start="493.56" data-end="496.71">Soundation's mission is to facilitate musical creativity</span> <span data-start="496.71" data-end="499.38">in the world, and they do this by offering</span> <span data-start="499.38" data-end="501.99">a powerful, accessible, and affordable service</span> <span data-start="501.99" data-end="504.87">to the growing demographic of casual producers.</span> <span data-start="504.87" data-end="507.03">As an online web app, Soundation streamlines</span> <span data-start="507.03" data-end="509.76">the ability for producers to connect with peers,</span> <span data-start="509.76" data-end="511.95">get feedback, enter competitions, and even get</span> <span data-start="511.95" data-end="514.11">record deals.</span> <span data-start="514.11" data-end="516.9">Soundation is using a wide variety</span> <span data-start="516.9" data-end="520.45">of advanced web features to deliver this smooth experience.</span> <span data-start="520.45" data-end="522.86">And the first of these is audio worklets.</span> <span data-start="522.86" data-end="525.45">Launched in Chrome 66, the audio worklet</span> <span data-start="525.45" data-end="528.45">brings fast performance and extensible audio processing</span> <span data-start="528.45" data-end="529.862">to the web platform.</span> <span data-start="529.862" data-end="532.32">It could be used in conjunction with other cutting edge web</span> <span data-start="532.32" data-end="536.81">technologies such as WebAssembly and SharedArrayBuffer.</span> <span data-start="536.81" data-end="539.15">Soundation is also one of the world's first adopters</span> <span data-start="539.15" data-end="541.55">of WebAssembly threads, and they use these threads</span> <span data-start="541.55" data-end="545.06">to achieve fast parellelized processing to seamlessly mix</span> <span data-start="545.06" data-end="546.661">songs.</span> <span data-start="546.661" data-end="548.41">So let's have a look at their architecture</span> <span data-start="548.41" data-end="550.06">and see if we can learn anything.</span> <span data-start="550.06" data-end="551.56">On the JavaScript side of the world,</span> <span data-start="551.56" data-end="553.42">they have their application UI.</span> <span data-start="553.42" data-end="557.68">That application UI then talks to an audio mixing engine.</span> <span data-start="557.68" data-end="559.6">This audio mixing engine then spawns off</span> <span data-start="559.6" data-end="562.12">multiple different worker threads in WebAssembly,</span> <span data-start="562.12" data-end="563.62">and each of these worker threads can</span> <span data-start="563.62" data-end="566.53">talk to the same piece of SharedArrayBuffer memory.</span> <span data-start="566.53" data-end="568.36">This SharedArrayBuffer memory is then</span> <span data-start="568.36" data-end="571.18">passed on to the mixing threads, which further passes it</span> <span data-start="571.18" data-end="575.23">to the audio worklet, which produces the final result.</span> <span data-start="575.23" data-end="578.1">Here's a visualization showing the performance improvements</span> <span data-start="578.1" data-end="580.83">on rendering a song as they added multiple threads.</span> <span data-start="580.83" data-end="583.164">Adding just a single additional thread doubled</span> <span data-start="583.164" data-end="584.58">their performance, and by the time</span> <span data-start="584.58" data-end="586.496">they've added five threads, they had more than</span> <span data-start="586.496" data-end="590.29">tripled the performance of their application.</span> <span data-start="590.29" data-end="593.34">So that's a great visualization showing the performance</span> <span data-start="593.34" data-end="594.81">improvements that thread can bring,</span> <span data-start="594.81" data-end="597.143">but since this is Soundation, I thought we would instead</span> <span data-start="597.143" data-end="598.36">try and listen to it.</span> <span data-start="598.36" data-end="601.38">So here is us trying to render a song in Soundation</span> <span data-start="601.38" data-end="603.53">in the single threaded version of WebAssembly.</span> <span data-start="603.53" data-end="605.31">And fair warning, this is not going</span> <span data-start="605.31" data-end="607.197">to be an entirely pleasant experience.</span> <span data-start="607.197" data-end="610.536">[STATICY MUSIC]</span> <span data-start="611.97" data-end="614.39">So as you can imagine, this is not the experience</span> <span data-start="614.39" data-end="617.09">that you want when you're trying to create beautiful music.</span> <span data-start="617.09" data-end="620.36">But luckily Soundation succeeded in launching with WebAssembly</span> <span data-start="620.36" data-end="622.34">threads, and now they're able to deliver</span> <span data-start="622.34" data-end="626.642">an experience that sounds just a little bit better.</span> <span data-start="626.642" data-end="630.05">[SMOOTH MUSIC]</span> <span data-start="630.05" data-end="632.48">So as you can see, not only is this a much more</span> <span data-start="632.48" data-end="635.21">pleasant experience, but the CPU also</span> <span data-start="635.21" data-end="636.8">has additional cycle for other work.</span> <span data-start="639.3" data-end="641.8">All right, so I want to close off my segment by just talking</span> <span data-start="641.8" data-end="643.63">about some of the amazing community</span> <span data-start="643.63" data-end="647.125">projects that we've seen people working on out there.</span> <span data-start="647.125" data-end="649">And the first of these that I want to mention</span> <span data-start="649" data-end="651.125">is the awesome work that's been done by the Mozilla</span> <span data-start="651.125" data-end="654.07">team and the Rust community to bring Rust to the web</span> <span data-start="654.07" data-end="655.51">through WebAssembly.</span> <span data-start="655.51" data-end="657.82">They have an awesome set of tools and materials</span> <span data-start="657.82" data-end="660.04">to help you get started, and you can check those out</span> <span data-start="660.04" data-end="663.286">at rustwasm.github.io.</span> <span data-start="663.286" data-end="664.66">Speaking of languages, we've also</span> <span data-start="664.66" data-end="666.83">seen more than 30 different projects</span> <span data-start="666.83" data-end="670.27">trying to bring other languages to the web through WebAssembly.</span> <span data-start="670.27" data-end="673.21">These languages include ones like Perl, Python, Ruby,</span> <span data-start="673.21" data-end="677.9">Kotlin, OCaml, Go, PHP, and the .NET framework.</span> <span data-start="677.9" data-end="680.117">Many of these languages require garbage collection,</span> <span data-start="680.117" data-end="681.7">which isn't currently something that's</span> <span data-start="681.7" data-end="684.79">supported in WebAssembly, though we are working on it.</span> <span data-start="684.79" data-end="687.04">These languages come to the web by actually taking</span> <span data-start="687.04" data-end="689.59">their garbage collection system and other runtime bits</span> <span data-start="689.59" data-end="692.41">and compiling that itself down to WebAssembly,</span> <span data-start="692.41" data-end="696.007">and then shipping everything down to the application page.</span> <span data-start="696.007" data-end="697.84">This is a great strategy for getting started</span> <span data-start="697.84" data-end="700.27">and experimenting with some of these languages on the web,</span> <span data-start="700.27" data-end="702.395">but because of some of their performance and memory</span> <span data-start="702.395" data-end="704.56">characteristics, these aren't currently suited</span> <span data-start="704.56" data-end="706.48">for production applications.</span> <span data-start="706.48" data-end="710.11">The fully supported languages today are C, C++, and Rust,</span> <span data-start="710.11" data-end="713.78">but everything else should still be considered experimental.</span> <span data-start="713.78" data-end="716.3">And there are so many more amazing community projects</span> <span data-start="716.3" data-end="718.2">that I don't have time to do justice.</span> <span data-start="718.2" data-end="721.43">We've seen people porting Gameboy emulators, GNU</span> <span data-start="721.43" data-end="724.4">libraries, digital signal processing, and even</span> <span data-start="724.4" data-end="728.72">entire operating system like Microsoft Windows 2000 now</span> <span data-start="728.72" data-end="730.52">available in a browser tab, which</span> <span data-start="730.52" data-end="734.18">is, if not a exactly pleasant experience,</span> <span data-start="734.18" data-end="735.56">definitely interesting.</span> <span data-start="735.56" data-end="737.12">You can check out all of these demos</span> <span data-start="737.12" data-end="740.66">and much more at the forum where we have multiple demos</span> <span data-start="740.66" data-end="742.47">set up for you to check out.</span> <span data-start="742.47" data-end="744.846">And with that, I want to hand it back off to Alex</span> <span data-start="744.846" data-end="746.72">to talk to you more about WebAssembly threads</span> <span data-start="746.72" data-end="749.004">and how to use some of these features.</span> <span data-start="749.004" data-end="753.35">[APPLAUSE]</span> </section>

<section><span data-start="753.35" data-end="754.77"><span class="speaker">Alex Danilo</span>: Thank you, Thomas.</span> <span data-start="754.77" data-end="756.889">One of the kind of big things at the conference</span> <span data-start="756.889" data-end="758.43">here, when we talk about the browser,</span> <span data-start="758.43" data-end="760.23">we talk about using the platform.</span> <span data-start="760.23" data-end="763.38">And quite often people think of the platform as the software</span> <span data-start="763.38" data-end="765.54">stack that's inside the browser, but I</span> <span data-start="765.54" data-end="767.52">like to think of it a little bit different.</span> <span data-start="767.52" data-end="769.811">I like to think about the hardware, the platform that's</span> <span data-start="769.811" data-end="771.55">actually in your machine.</span> <span data-start="771.55" data-end="774.72">So here is an artist's rendition of the inside</span> <span data-start="774.72" data-end="776.3">of a desktop microprocessor.</span> <span data-start="776.3" data-end="777.69">This is what you see today if you</span> <span data-start="777.69" data-end="779.02">take the plastic off the top.</span> <span data-start="779.02" data-end="780.78">So at the top, we have the green bit,</span> <span data-start="780.78" data-end="783.21">which interfaces to the PCI bus, used</span> <span data-start="783.21" data-end="784.74">to be called the northbridge.</span> <span data-start="784.74" data-end="786.87">The left and right, you have memory interfaces.</span> <span data-start="786.87" data-end="790.1">These little yellow boxes are integrated memory controllers.</span> <span data-start="790.1" data-end="792.07">And you see all these blue tiles here.</span> <span data-start="792.07" data-end="794.79">And what they are is cores.</span> <span data-start="794.79" data-end="797.549">So each of those is a CPU core in its own right.</span> <span data-start="797.549" data-end="799.59">So this may be a desktop microprocessor, but even</span> <span data-start="799.59" data-end="802.44">in your pocket, if you have an iPhone or an advanced Android</span> <span data-start="802.44" data-end="804.151">phone, you'll have something like six</span> <span data-start="804.151" data-end="805.65">to eight cores in there, ready to be</span> <span data-start="805.65" data-end="808.2">used to do good computing work.</span> <span data-start="808.2" data-end="810.46">So when you write a normal web application,</span> <span data-start="810.46" data-end="812.572">you're looking at something like this.</span> <span data-start="812.572" data-end="814.28">You have one core running and so you have</span> <span data-start="814.28" data-end="815.571">all this silicon doing nothing.</span> <span data-start="815.571" data-end="817.649">So you're not really using the platform.</span> <span data-start="817.649" data-end="819.69">Now we've seen people come along and do something</span> <span data-start="819.69" data-end="822.15">like spawn a web worker to do the hard work,</span> <span data-start="822.15" data-end="823.86">and have the main thread for UI.</span> <span data-start="823.86" data-end="826.94">In that case, you're running a double threaded application.</span> <span data-start="826.94" data-end="829.38">And so you're using the platform a bit better,</span> <span data-start="829.38" data-end="832.2">but you're not really doing everything you could.</span> <span data-start="832.2" data-end="834.63">Now since we have introduced WebAssembly threads,</span> <span data-start="834.63" data-end="835.99">you can do stuff like this.</span> <span data-start="835.99" data-end="839.29">You could actually use many cores for your application.</span> <span data-start="839.29" data-end="841.03">And as we saw with the Soundation demo,</span> <span data-start="841.03" data-end="844.21">there's visible improvement in the user experience.</span> <span data-start="844.21" data-end="846.21">So I'd really like you to start thinking</span> <span data-start="846.21" data-end="848.03">about how you can adapt your application</span> <span data-start="848.03" data-end="850.9">to use all these cores.</span> <span data-start="850.9" data-end="852.37">Now when you create a web worker,</span> <span data-start="852.37" data-end="854.82">you have to understand that that is a threading primitive</span> <span data-start="854.82" data-end="855.93">and they run concurrently.</span> <span data-start="855.93" data-end="858.38">So you can do compute in parallel.</span> <span data-start="858.38" data-end="861.14">And this is a primitive that we all know pretty well.</span> <span data-start="861.14" data-end="863.41">But one of the things about when we do something</span> <span data-start="863.41" data-end="865.37">like this, if we have an app, on the left,</span> <span data-start="865.37" data-end="867.22">we have what we call the main thread — </span> <span data-start="867.22" data-end="868.96">we're all familiar with the main thread — </span> <span data-start="868.96" data-end="872.29">that interacts and talks to the DOM.</span> <span data-start="872.29" data-end="874.22">The worker that we generate is what</span> <span data-start="874.22" data-end="875.47">we call the background thread.</span> <span data-start="875.47" data-end="877.6">So it's running in parallel but it doesn't actually</span> <span data-start="877.6" data-end="879.49">have the ability to call web APIs</span> <span data-start="879.49" data-end="882.56">and interact with the DOM and stuff like that.</span> <span data-start="882.56" data-end="885.4">But when you create workers, and you create them</span> <span data-start="885.4" data-end="889.9">normally with a JavaScript thing, it creates an instance.</span> <span data-start="889.9" data-end="893.26">So these instances kind of sit on their own on the side,</span> <span data-start="893.26" data-end="895.154">they're running parallel, they don't get</span> <span data-start="895.154" data-end="896.32">to do anything with the DOM.</span> <span data-start="896.32" data-end="897.82">So they kind of run on the side.</span> <span data-start="897.82" data-end="901.42">So if you create one, you get V8 hanging off</span> <span data-start="901.42" data-end="904.18">the top of your main thread, and you get an instance hanging off</span> <span data-start="904.18" data-end="905.14">your worker.</span> <span data-start="905.14" data-end="907.48">So then if you go and create a bunch of workers,</span> <span data-start="907.48" data-end="910.15">you get a bunch more V8 instances.</span> <span data-start="910.15" data-end="913.152">Now each of these instances consumes memory.</span> <span data-start="913.152" data-end="915.61">So that means that if you start spawning lots of JavaScript</span> <span data-start="915.61" data-end="919.525">workers to make your application do stuff more complex,</span> <span data-start="919.525" data-end="921.4">it will actually consume more and more memory</span> <span data-start="921.4" data-end="924.35">and you might run out on a phone, or something like that.</span> <span data-start="924.35" data-end="926.86">But I'll let you in on a little secret.</span> <span data-start="926.86" data-end="929.42">They don't talk to each other.</span> <span data-start="929.42" data-end="931.21">So you've got separate bits of JavaScript</span> <span data-start="931.21" data-end="933.07">running in all these parallel threads,</span> <span data-start="933.07" data-end="934.42">but they don't communicate.</span> <span data-start="934.42" data-end="936.04">They don't have any shared state.</span> <span data-start="936.04" data-end="939.367">They're literally another copy of V8 sitting in memory.</span> <span data-start="939.367" data-end="941.2">The way these things can talk to each other,</span> <span data-start="941.2" data-end="942.592">though, is with postMessage.</span> <span data-start="942.592" data-end="945.05">And postMessage is kind of like sending a paper plane over.</span> <span data-start="945.05" data-end="947.26">I'll send it from this worker to that one,</span> <span data-start="947.26" data-end="949.09">I'll sit around and wait for it to arrive,</span> <span data-start="949.09" data-end="950.756">and there's no predictability about when</span> <span data-start="950.756" data-end="952.03">that will be delivered.</span> <span data-start="952.03" data-end="954.37">So it's not a great experience for a true multi-threaded</span> <span data-start="954.37" data-end="956.426">application.</span> <span data-start="956.426" data-end="958.3">Now, when the team built WebAssembly threads,</span> <span data-start="958.3" data-end="961.62">they implemented something that looks a lot more like this.</span> <span data-start="961.62" data-end="963.79">So what happens is, this is an example of, say,</span> <span data-start="963.79" data-end="965.38">having three threads.</span> <span data-start="965.38" data-end="969.31">So under the hood, we actually spin up the three web workers</span> <span data-start="969.31" data-end="972.31">but the difference here is that the WebAssembly module</span> <span data-start="972.31" data-end="973.7">is shared between the workers.</span> <span data-start="973.7" data-end="975.31">So there is one copy of the code,</span> <span data-start="975.31" data-end="977.65">so you're not consuming nearly as much memory.</span> <span data-start="977.65" data-end="979.562">But more importantly, they share state,</span> <span data-start="979.562" data-end="981.52">and the way they share state is through a thing</span> <span data-start="981.52" data-end="983.282">called SharedArrayBuffer.</span> <span data-start="983.282" data-end="984.74">So if you're a JavaScript engineer,</span> <span data-start="984.74" data-end="987.281">you probably know what a typed array is, because you use them</span> <span data-start="987.281" data-end="988.03">day to day.</span> <span data-start="988.03" data-end="990.83">So SharedArrayBuffer is basically the exact same thing,</span> <span data-start="990.83" data-end="993.25">except that it can be shared across workers.</span> <span data-start="993.25" data-end="995.71">And so what that means is the state</span> <span data-start="995.71" data-end="998.53">of the execution of the application is visible to any</span> <span data-start="998.53" data-end="1000.91">of the workers in parallel.</span> <span data-start="1000.91" data-end="1003.89">Now if you farm off something into a pool of workers</span> <span data-start="1003.89" data-end="1005.64">and you have it hanging off your main app,</span> <span data-start="1005.64" data-end="1007.112">it will look something like this.</span> <span data-start="1007.112" data-end="1009.57">You'll have your main thread for your main application that</span> <span data-start="1009.57" data-end="1012.72">can talk to the DOM, it can use all the web APIs,</span> <span data-start="1012.72" data-end="1014.67">and it can see the SharedArrayBuffer,</span> <span data-start="1014.67" data-end="1016.59">and that SharedArrayBuffer is being</span> <span data-start="1016.59" data-end="1019.29">manipulated by all the parallel threads in the WebAssembly</span> <span data-start="1019.29" data-end="1021.71">module.</span> <span data-start="1021.71" data-end="1024.39">OK, but by now you're probably thinking,</span> <span data-start="1024.39" data-end="1026.04">this is all well and good, but how</span> <span data-start="1026.04" data-end="1028.27">do I use this stuff in my actual application?</span> <span data-start="1028.27" data-end="1030.48">So I'll start with a very simple example.</span> <span data-start="1030.48" data-end="1033.839">We'll do an example which is just a little Fibonacci program</span> <span data-start="1033.839" data-end="1035.069">that runs in two threads.</span> <span data-start="1035.069" data-end="1036.78">So it will look a bit like this.</span> <span data-start="1036.78" data-end="1038.952">There'll be the main thread, the background thread,</span> <span data-start="1038.952" data-end="1040.41">the WebAssembly module, all talking</span> <span data-start="1040.41" data-end="1041.609">to the SharedArrayBuffer.</span> <span data-start="1041.609" data-end="1043.504">So we just take some source code,</span> <span data-start="1043.504" data-end="1044.92">which will be something like this,</span> <span data-start="1044.92" data-end="1046.545">which is just a bit of C code.</span> <span data-start="1046.545" data-end="1047.92">And what we want to do is we want</span> <span data-start="1047.92" data-end="1052.29">to compile that into a form that we can use in parallel threads.</span> <span data-start="1052.29" data-end="1055.26">And the way we do that is with the Emscripten tool chain.</span> <span data-start="1055.26" data-end="1057.529">So it has a compiler called EMCC,</span> <span data-start="1057.529" data-end="1059.07">and there are a couple of flags here,</span> <span data-start="1059.07" data-end="1060.49">though, I want to point out.</span> <span data-start="1060.49" data-end="1063.93">The first one is -s USE_PTHREADS=1.</span> <span data-start="1063.93" data-end="1066.87">What that does is turn on the multi-threading support</span> <span data-start="1066.87" data-end="1069.54">when you're compiling your WebAssembly module.</span> <span data-start="1069.54" data-end="1071.55">The second flag that's interesting is -s</span> <span data-start="1071.55" data-end="1073.71">PTHREAD_POOL_SIZE=2.</span> <span data-start="1073.71" data-end="1075.51">What this does is tells the compiler</span> <span data-start="1075.51" data-end="1078.96">that I want to pre-allocate two threads for my application.</span> <span data-start="1078.96" data-end="1081.66">So when I actually start the WebAssembly module</span> <span data-start="1081.66" data-end="1085.44">it will pre-create two threads and get going with that.</span> <span data-start="1085.44" data-end="1087.3">Now this is kind of visualization</span> <span data-start="1087.3" data-end="1088.05">what would happen.</span> <span data-start="1088.05" data-end="1090.21">If you set PTHREAD pool size to two,</span> <span data-start="1090.21" data-end="1093.12">you get the picture on the left, you get two workers,</span> <span data-start="1093.12" data-end="1095.22">and if you set it to eight you get eight workers.</span> <span data-start="1095.22" data-end="1098.28">And that happens at startup time of your web app.</span> <span data-start="1098.28" data-end="1100.65">Now you may be wondering why you care about the number.</span> <span data-start="1100.65" data-end="1104.1">Well, the thing is that you should really try and set it</span> <span data-start="1104.1" data-end="1105.93">to the maximum number of threads.</span> <span data-start="1105.93" data-end="1107.7">If you say I only want two threads,</span> <span data-start="1107.7" data-end="1109.366">and then suddenly your application needs</span> <span data-start="1109.366" data-end="1111.31">three or four, it's a bit of a problem.</span> <span data-start="1111.31" data-end="1113.67">So what happens is that the WebAssembly module</span> <span data-start="1113.67" data-end="1115.56">has to yield to the main thread before it</span> <span data-start="1115.56" data-end="1116.65">can create that worker.</span> <span data-start="1116.65" data-end="1119.04">So if you're relying on all the threads being</span> <span data-start="1119.04" data-end="1121.882">there at the startup, you need to set the number high enough.</span> <span data-start="1121.882" data-end="1123.84">But of course, if you set that number too high,</span> <span data-start="1123.84" data-end="1124.756">you're wasting memory.</span> <span data-start="1124.756" data-end="1126.19">So this is something to tune.</span> <span data-start="1126.19" data-end="1128.494">So in Soundation's case they used five threads</span> <span data-start="1128.494" data-end="1129.91">and it works really well for them.</span> <span data-start="1129.91" data-end="1133.364">So when you're tuning your apps you need to think about it.</span> <span data-start="1133.364" data-end="1135.53">OK, so if you want to get out there and actually try</span> <span data-start="1135.53" data-end="1137.071">this stuff, which I'm sure you're all</span> <span data-start="1137.071" data-end="1139.76">dying to, if you fire up Chrome 70</span> <span data-start="1139.76" data-end="1142.7">and navigate to Chrome flags and search for WebAssembly thread</span> <span data-start="1142.7" data-end="1145.88">support, change the setting here from default</span> <span data-start="1145.88" data-end="1147.68">to enabled, and at that point, you'll</span> <span data-start="1147.68" data-end="1149.02">have to restart your browser.</span> <span data-start="1149.02" data-end="1152.57">And then you can start building stuff and testing it locally.</span> <span data-start="1152.57" data-end="1155.269">Now once you've built a working WebAssembly thread app,</span> <span data-start="1155.269" data-end="1157.31">you probably want to deploy it out to the public.</span> <span data-start="1157.31" data-end="1160.98">And the way you do that is by getting an origin trial token.</span> <span data-start="1160.98" data-end="1163.46">So an origin trial token is tied to your domain</span> <span data-start="1163.46" data-end="1164.884">and you get it from us.</span> <span data-start="1164.884" data-end="1166.55">And you basically —  it's just a meta tag</span> <span data-start="1166.55" data-end="1167.591">that you put on the page.</span> <span data-start="1167.591" data-end="1169.85">And that tells the browser, hey, these people</span> <span data-start="1169.85" data-end="1172.156">are trying WebAssembly threads and let's use it.</span> <span data-start="1172.156" data-end="1173.78">So if you want to go ahead and do that,</span> <span data-start="1173.78" data-end="1176.881">and I encourage you all to do so, just go to this short link,</span> <span data-start="1176.881" data-end="1178.505">and there's a form you can fill in, put</span> <span data-start="1178.505" data-end="1182.09">in your URL, the reason you want to use this stuff,</span> <span data-start="1182.09" data-end="1185.93">and go start building something really cool.</span> <span data-start="1185.93" data-end="1189.1">Now of course, as developers, we spend most of our times</span> <span data-start="1189.1" data-end="1192.46">in DevTools trying to debug things, which is how it is.</span> <span data-start="1192.46" data-end="1195.64">So in Chrome 70 at the moment, which is released to stable,</span> <span data-start="1195.64" data-end="1197.406">you can single step instructions.</span> <span data-start="1197.406" data-end="1199.03">And that is a WebAssembly instructions.</span> <span data-start="1199.03" data-end="1200.95">So it looks a little bit like this,</span> <span data-start="1200.95" data-end="1203.56">like not friendly, as Thomas pointed out.</span> <span data-start="1203.56" data-end="1205.376">So you can see this little box up here,</span> <span data-start="1205.376" data-end="1206.75">which is showing you the threads.</span> <span data-start="1206.75" data-end="1209.65">So this is a two thread application running.</span> <span data-start="1209.65" data-end="1213.01">And this box is the actual WebAssembly disassembled code.</span> <span data-start="1213.01" data-end="1216.34">So it's not the binary, it's a text form of the instructions</span> <span data-start="1216.34" data-end="1217.621">that are in the module.</span> <span data-start="1217.621" data-end="1219.37">And you can single step those and it's all</span> <span data-start="1219.37" data-end="1222.55">very well and good, but realistically, we don't really</span> <span data-start="1222.55" data-end="1224.38">like that debugging experience.</span> <span data-start="1224.38" data-end="1226.9">So Chrome 71 brings source map support,</span> <span data-start="1226.9" data-end="1228.68">as Thomas mentioned earlier.</span> <span data-start="1228.68" data-end="1231.52">So source maps lets you change what you saw before</span> <span data-start="1231.52" data-end="1233.95">into something —  oop, next slide — </span> <span data-start="1233.95" data-end="1236.06">something that looks like this.</span> <span data-start="1236.06" data-end="1241.09">So this is the source code of the Fibonacci function sitting</span> <span data-start="1241.09" data-end="1244.27">in Dev Tools, and you can single step over instructions,</span> <span data-start="1244.27" data-end="1247.91">you can set breakpoints, you can do all stuff like that.</span> <span data-start="1247.91" data-end="1250.03">Now, if you want to actually do this yourself</span> <span data-start="1250.03" data-end="1251.77">and you want to generate the source map,</span> <span data-start="1251.77" data-end="1255.34">you just need to set two flags on the EMCC compiler command</span> <span data-start="1255.34" data-end="1255.88">line.</span> <span data-start="1255.88" data-end="1259.29">The first is -g, which says generate debug symbols,</span> <span data-start="1259.29" data-end="1261.95">and the second is  — source-map-base,</span> <span data-start="1261.95" data-end="1264.58">and that points to a URL where it will actually</span> <span data-start="1264.58" data-end="1266.302">find the source map file.</span> <span data-start="1266.302" data-end="1267.76">In this case, I'm using local host,</span> <span data-start="1267.76" data-end="1272.09">so I'll be using it on my own workstation.</span> <span data-start="1272.09" data-end="1274.6">OK, so I'll just recap on what we've talked about today,</span> <span data-start="1274.6" data-end="1276.94">just so you can remember what we talked about.</span> <span data-start="1276.94" data-end="1278.86">The first thing is it's streaming compilation,</span> <span data-start="1278.86" data-end="1281.17">which lets the browser compile the WebAssembly</span> <span data-start="1281.17" data-end="1283.69">module as it comes over the wire, which is launched now.</span> <span data-start="1283.69" data-end="1286.45">It's in Chrome 70, which speeds things up.</span> <span data-start="1286.45" data-end="1289.01">The second is Liftoff, which is the tiered compiler,</span> <span data-start="1289.01" data-end="1291.97">so you get the first compile really fast so your app starts,</span> <span data-start="1291.97" data-end="1295.19">and then hot swaps in the better code a bit later on.</span> <span data-start="1295.19" data-end="1297.52">Then we have, of course, WebAssembly threads shipping</span> <span data-start="1297.52" data-end="1300.73">now in Chrome 70, and you can use it with an origin trial,</span> <span data-start="1300.73" data-end="1302.23">so you can ship it to your customers</span> <span data-start="1302.23" data-end="1304.57">and they can use it and play with it.</span> <span data-start="1304.57" data-end="1307.09">And of course, Chrome 71, which will be out really soon,</span> <span data-start="1307.09" data-end="1309.04">contains source maps, which means</span> <span data-start="1309.04" data-end="1311.29">that it's a lot easier to debug your code.</span> <span data-start="1311.29" data-end="1312.88">And so I'd encourage all of you people</span> <span data-start="1312.88" data-end="1316.037">out there to start writing using WebAssembly threads,</span> <span data-start="1316.037" data-end="1318.37">because it unlocks the power of the supercomputer that's</span> <span data-start="1318.37" data-end="1321.04">sitting in your pocket right now.</span> <span data-start="1321.04" data-end="1322.12">Thank you.</span> <span data-start="1322.12" data-end="1325.47">[MUSIC PLAYING]</span> </section>

</div>

<img alt="The End" id="fin" src="images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="js/main.js"></script>

</body>

</html>
