<!DOCTYPE html>

<!--
Copyright 2018 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="author" content="//google.com">
  <meta name="description" content="Chrome Dev Summit">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>7-ALJiZCI6w</title>
  <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/7-ALJiZCI6w?enablejsapi=1"></iframe>

<div id="container">

<div id="options">
  <div id="google-translate"></div>
  <div>
    <input type="checkbox" id="videoSticky" checked>
    <label for="videoSticky">Video position sticky</label>
  </div>
  <div>
    <input type="checkbox" id="captionScroll" checked>
    <label for="captionScroll">Keep current caption visible</label>
  </div>
</div>

<section>
<p><span data-start="0" data-end="4.865">[MUSIC PLAYING]</span> </p>
</section>

<section>
<p><span data-start="4.865" data-end="6.49"><span class="speaker">Simeon Vincent</span>: As you probably guessed</span> <span data-start="6.49" data-end="8.53">from the very creative title of this talk,</span> <span data-start="8.53" data-end="11.403">I am going to be talking about Chrome extensions.</span> <span data-start="11.403" data-end="12.82">And there's a lot I want to cover,</span> <span data-start="12.82" data-end="14.653">and our time together is relatively limited.</span> <span data-start="14.653" data-end="16.58">So before we get into everything,</span> <span data-start="16.58" data-end="18.58">I just want to make sure we're on the same page.</span> <span data-start="18.58" data-end="21.45">We're going to take a quick look at an itinerary of events.</span> <span data-start="21.45" data-end="23.95">So first, we're gong to talk about how extensions are great,</span> <span data-start="23.95" data-end="25.21">and how they're amazing.</span> </p>
<p><span data-start="25.21" data-end="28.03">Then we're going to talk about some</span> <span data-start="28.03" data-end="31.6">of the anatomy of the existing ecosystem.</span> <span data-start="31.6" data-end="33.79">We're going to talk about some of the challenges</span> <span data-start="33.79" data-end="36.76">the extension ecosystem is facing.</span> </p>
<p><span data-start="36.76" data-end="39.898">We'll start to talk about a fundamental shift in how</span> <span data-start="39.898" data-end="42.19">the Chrome team is thinking about the Chrome Extensions</span> <span data-start="42.19" data-end="43.87">platform.</span> <span data-start="43.87" data-end="45.67">We'll go over some details of how</span> <span data-start="45.67" data-end="49.03">to actually migrate an extension and adopt this new system.</span> <span data-start="49.03" data-end="52">And then I'll try to tie it all together</span> <span data-start="52" data-end="54.49">and say something cool, we'll see.</span> <span data-start="54.49" data-end="57.38">So without further ado, let's do it.</span> <span data-start="57.38" data-end="59.025">First off, extensions are great.</span> <span data-start="59.025" data-end="60.4">There are a lot of different ways</span> <span data-start="60.4" data-end="62.692">that we could talk about extensions, like how many have</span> <span data-start="62.692" data-end="66.1">been published, or how many the average user has installed,</span> <span data-start="66.1" data-end="68.84">or user satisfaction ratings, or whatever.</span> </p>
<p><span data-start="68.84" data-end="71.68">But personally, when I think about extensions,</span> <span data-start="71.68" data-end="74.77">the thing I keep coming back to is the fact</span> <span data-start="74.77" data-end="80.53">that Chrome extensions are how users make Chrome theirs.</span> <span data-start="80.53" data-end="83.42">It's not just another feature of the web browser.</span> <span data-start="83.42" data-end="86.74">This is the way that you customize the browser</span> <span data-start="86.74" data-end="91.21">experience and make the web into something that you personally</span> <span data-start="91.21" data-end="93.46">experience.</span> <span data-start="93.46" data-end="97.75">And users have consistently told us</span> <span data-start="97.75" data-end="101.98">that they love using extensions, that extensions are a core part</span> <span data-start="101.98" data-end="103.79">of how they browse the web.</span> </p>
<p><span data-start="103.79" data-end="107.56">And I think there's a pretty simple reason why.</span> <span data-start="107.56" data-end="109.57">They make it your web browser.</span> <span data-start="112.18" data-end="115.23">You can use extensions to make all kinds of crazy things.</span> <span data-start="115.23" data-end="117.93">Like you can, I don't know, get some motivation every time</span> <span data-start="117.93" data-end="121">you open a new tab or automate parts of your workflow.</span> <span data-start="121" data-end="123.39">You can change your theme and make</span> <span data-start="123.39" data-end="126.55">Chrome feel more like home.</span> <span data-start="126.55" data-end="128.543">You can remove ads on the sites you visit.</span> <span data-start="128.543" data-end="130.71">You can automatically donate to the content creators</span> <span data-start="130.71" data-end="133.24">that you love.</span> <span data-start="133.24" data-end="135.49">Or you can take some inspiration from XKCD</span> <span data-start="135.49" data-end="137.23">and replace a word here and there</span> <span data-start="137.23" data-end="139.99">to spice up your day-to-day browsing experience.</span> <span data-start="139.99" data-end="144.77">But the point is, extensions put you front and center.</span> <span data-start="144.77" data-end="147.595">You customize your web browser to your tastes.</span> </p>
<p><span data-start="150.305" data-end="151.93">And if you can't find an extension that</span> <span data-start="151.93" data-end="155.852">does what you want, you could probably build your own.</span> <span data-start="155.852" data-end="157.81">Those of you comfortable with web development — </span> <span data-start="157.81" data-end="160.48">I'm going to assume that's a decent number of you here — </span> <span data-start="160.48" data-end="163.33">are already most of the way to building your own Chrome</span> <span data-start="163.33" data-end="164.08">extension.</span> </p>
<p><span data-start="164.08" data-end="166.39">See, the Chrome Extensions platform</span> <span data-start="166.39" data-end="169.87">is itself an extension of the web platform.</span> <span data-start="169.87" data-end="172.15">Chrome extensions use the same standard technologies — </span> <span data-start="172.15" data-end="176.06">JavaScript, HTML, CSS —  that you,</span> <span data-start="176.06" data-end="178.25">web developers use to make — </span> <span data-start="178.25" data-end="180.69">I don't know, I said you, web developers, that's weird — </span> <span data-start="180.69" data-end="185.09">web developers use to make websites and the experiences</span> <span data-start="185.09" data-end="187.37">that we all enjoy every day.</span> <span data-start="187.37" data-end="190.28">This webby design is a core feature</span> <span data-start="190.28" data-end="192.643">of our browser extension model.</span> </p>
<p><span data-start="192.643" data-end="194.06">And to show you what I mean, let's</span> <span data-start="194.06" data-end="198.99">take a quick look at an example extension to see how it works.</span> <span data-start="198.99" data-end="201.2">Here, I have a very real extension</span> <span data-start="201.2" data-end="202.82">that definitely exists.</span> <span data-start="202.82" data-end="205.38">And it does two main things.</span> <span data-start="205.38" data-end="210.56">It allows me to block websites that I spend too much time on.</span> <span data-start="210.56" data-end="213.05">And it allows me to log my work so I</span> <span data-start="213.05" data-end="214.71">can hold myself accountable.</span> <span data-start="214.71" data-end="217.82">So if we download this extension and open it up,</span> <span data-start="217.82" data-end="219.52">we'll see something like this.</span> <span data-start="219.52" data-end="221.93">Here, this is the CRX file that I've</span> <span data-start="221.93" data-end="223.59">downloaded from the web store.</span> <span data-start="223.59" data-end="226.85">And as you can see, this command line utility I'm using</span> <span data-start="226.85" data-end="229.73">shows that the extension is basically just a directory that</span> <span data-start="229.73" data-end="232.883">contains standard webby files.</span> </p>
</section>

<section>
<p><span data-start="232.883" data-end="233.8"><span class="speaker">Audience</span>: [INAUDIBLE].</span> </p>
</section>

<section>
<p><span data-start="233.8" data-end="234.93"><span class="speaker">Simeon Vincent</span>: Oh, my, I don't know why</span> <span data-start="234.93" data-end="236.138">I was going to give you that.</span> <span data-start="239.82" data-end="241.55">So it's basically just a directory</span> <span data-start="241.55" data-end="244.01">that contains a bunch of files that you're typically</span> <span data-start="244.01" data-end="245.91">used to working on the web.</span> <span data-start="245.91" data-end="249.02">And I want to quickly call out manifest.json here.</span> <span data-start="249.02" data-end="251.72">This file is important because it's the primary entry point</span> <span data-start="251.72" data-end="253.29">to enter your extension.</span> <span data-start="253.29" data-end="256.55">So if we pop this open, we can see that the manifest.json</span> <span data-start="256.55" data-end="259.16">contains everything that the extension needs</span> <span data-start="259.16" data-end="263.27">in order for Chrome to load it and run it.</span> <span data-start="263.27" data-end="265.13">And I specifically want to point out here</span> <span data-start="265.13" data-end="268.49">that we're looking at a Manifest version 2 extension.</span> <span data-start="268.49" data-end="270.74">The 2 means that we're working with the second version</span> <span data-start="270.74" data-end="272.138">of the platform.</span> </p>
<p><span data-start="272.138" data-end="274.43">Later, we'll be talking more about some of the features</span> <span data-start="274.43" data-end="277.85">specific to Chrome extensions from the Manifest version 3</span> <span data-start="277.85" data-end="279.78">platform.</span> <span data-start="279.78" data-end="281.87">So here we have the background property.</span> <span data-start="281.87" data-end="287.63">This is the —  oh, no, what am I saying?</span> <span data-start="287.63" data-end="290.387">The background pop property specifies</span> <span data-start="290.387" data-end="292.22">what code will be running in the background.</span> </p>
<p><span data-start="292.22" data-end="294.98">Typically, your background is used to set up event listeners</span> <span data-start="294.98" data-end="298.77">and coordinate between different parts of your extension.</span> <span data-start="298.77" data-end="300.52">content_scripts here are injected</span> <span data-start="300.52" data-end="304.94">onto specific web pages that you want to load custom script on.</span> <span data-start="304.94" data-end="307.91">Here, I'm using a special pattern</span> <span data-start="307.91" data-end="311.87">called all_urls, which, as you might guess, matches all URLs.</span> <span data-start="314.67" data-end="316.41">And finally, the permissions section</span> <span data-start="316.41" data-end="318.39">currently defines two things — </span> <span data-start="318.39" data-end="320.64">first, the URLs that I'm going to be interacting with,</span> <span data-start="320.64" data-end="323.49">the hosts that I'm going to interact with,</span> <span data-start="323.49" data-end="326.505">and the permissions that the extension requires.</span> </p>
<p><span data-start="326.505" data-end="328.38">My extension is pretty simple since it's only</span> <span data-start="328.38" data-end="331.2">basically blocking sites and saving data locally.</span> <span data-start="331.2" data-end="334.48">It doesn't need many permissions.</span> <span data-start="334.48" data-end="336.57">Now, there's a lot more that Manifest can do.</span> <span data-start="336.57" data-end="338.79">But these are the core pieces that we'll</span> <span data-start="338.79" data-end="340.09">be looking at later on.</span> <span data-start="340.09" data-end="343.35">So let's take a look at some of the issues</span> <span data-start="343.35" data-end="346.11">that we have with the current ecosystem.</span> <span data-start="346.11" data-end="349.68">While users love the platform, and good actors put them</span> <span data-start="349.68" data-end="354">to wonderful use, we are also facing some very real</span> <span data-start="354" data-end="356.44">challenges.</span> <span data-start="356.44" data-end="358.29">These are the issues that we're facing.</span> </p>
<p><span data-start="358.29" data-end="360.18">We're going to go over each in turn.</span> <span data-start="360.18" data-end="362.25">And while some of them are closely related,</span> <span data-start="362.25" data-end="363.9">they're distinct enough that we're</span> <span data-start="363.9" data-end="366.91">going to need to explain each.</span> <span data-start="366.91" data-end="369.3">So first, usability —  simply put,</span> <span data-start="369.3" data-end="371.94">when we first created the extensions platform,</span> <span data-start="371.94" data-end="376.65">we made some assumptions about how users would interact</span> <span data-start="376.65" data-end="379.44">with the installation flow, and how well they understood</span> <span data-start="379.44" data-end="382.2">the install prompts, and how well they understood</span> <span data-start="382.2" data-end="384.45">the trade-offs being requested.</span> </p>
<p><span data-start="384.45" data-end="386.37">And unfortunately, over time, I think,</span> <span data-start="386.37" data-end="388.89">we've come to see that these don't</span> <span data-start="388.89" data-end="393.62">hold as well for the average user as we would have liked to.</span> <span data-start="393.62" data-end="396.07">On the flip side, powerful APIs are often</span> <span data-start="396.07" data-end="397.67">a developer's only option.</span> <span data-start="397.67" data-end="401.15">For example, if you want to block ads on a web today,</span> <span data-start="401.15" data-end="403.04">you have to give the ad blocker broad access</span> <span data-start="403.04" data-end="404.54">to your network request.</span> <span data-start="404.54" data-end="406.16">This means you're also implicitly</span> <span data-start="406.16" data-end="409.73">granting it the ability to see literally everything you do.</span> <span data-start="409.73" data-end="414.69">And understandably, this gives a good number of users a pause.</span> <span data-start="414.69" data-end="417.78">And speaking of powerful permissions, all_urls</span> <span data-start="417.78" data-end="419.58">is kind of a special case that needs</span> <span data-start="419.58" data-end="421.09">some of that extra attention.</span> <span data-start="421.09" data-end="425.48">See, it is extremely common in today's ecosystem.</span> <span data-start="425.48" data-end="427.73">It's almost impossible to install an extension that</span> <span data-start="427.73" data-end="430.34">doesn't say, this extension can read and modify</span> <span data-start="430.34" data-end="431.63">all your site data.</span> </p>
<p><span data-start="431.63" data-end="438.66">And what that also means is that end users aren't necessarily — </span> <span data-start="438.66" data-end="439.97">they're kind of desensitized.</span> <span data-start="439.97" data-end="443.33">They're not giving enough credence to the danger</span> <span data-start="443.33" data-end="446.24">that this poses.</span> <span data-start="446.24" data-end="448.43">This should be a relatively scary permission.</span> <span data-start="448.43" data-end="451.25">But it is kind of core to how the current extension</span> <span data-start="451.25" data-end="453.06">ecosystem works.</span> <span data-start="453.06" data-end="455.78">It also makes it much harder for us to closely scrutinize</span> <span data-start="455.78" data-end="457.7">the content of the extension in order</span> <span data-start="457.7" data-end="461.72">to make sure that anomalous use or potentially dangerous use</span> <span data-start="461.72" data-end="462.775">isn't occurring.</span> </p>
<p><span data-start="465.51" data-end="468.12">And while we're on the topic of frightening capabilities,</span> <span data-start="468.12" data-end="470.25">in the current version of the extension ecosystem,</span> <span data-start="470.25" data-end="474.21">it's possible for an extension to load and execute code</span> <span data-start="474.21" data-end="479.15">from a remote server or from an arbitrary string.</span> <span data-start="479.15" data-end="480.96">The term that we tend to use for this</span> <span data-start="480.96" data-end="484.44">is remotely loaded code or remotely hosted code.</span> <span data-start="484.44" data-end="486.87">And essentially, we just mean any code</span> <span data-start="486.87" data-end="489.42">that isn't in the extension's bundle.</span> <span data-start="489.42" data-end="492.01">And while this capability is used to good effect,</span> <span data-start="492.01" data-end="494.19">it's also a major attack vector.</span> <span data-start="494.19" data-end="495.96">After all, if an extension can change</span> <span data-start="495.96" data-end="500.22">what it does at runtime without review, then essentially,</span> <span data-start="500.22" data-end="501.562">all bets are off.</span> </p>
<p><span data-start="501.562" data-end="503.52">And to put it lightly, that's not the situation</span> <span data-start="503.52" data-end="506.7">we're exactly excited about.</span> <span data-start="506.7" data-end="510.12">Another major challenge of the current extensions platform</span> <span data-start="510.12" data-end="515.94">is that extensions can pretty easily tank performance,</span> <span data-start="515.94" data-end="518.159">either for specific pages or for Chrome.</span> <span data-start="518.159" data-end="521.13">For specific pages, the user can just close the page</span> <span data-start="521.13" data-end="521.919">and move on.</span> </p>
<p><span data-start="521.919" data-end="524.01">But when it starts to drag down Chrome,</span> <span data-start="524.01" data-end="525.51">then everything suffers.</span> <span data-start="525.51" data-end="529.27">The web suffers, from the user's point of view.</span> <span data-start="529.27" data-end="531.84">And due to the asynchronous architecture of the extensions</span> <span data-start="531.84" data-end="534.48">platform, there's no obvious signal to the end user</span> <span data-start="534.48" data-end="536.05">when this is happening.</span> </p>
<p><span data-start="536.05" data-end="538.32">So if a page were to similarly slow down,</span> <span data-start="538.32" data-end="540.03">you would start to see scroll junk,</span> <span data-start="540.03" data-end="542.28">or there would be clear signals that there's issues.</span> <span data-start="542.28" data-end="548.13">But basically, the computer just very slowly degrades.</span> </p>
<p><span data-start="548.13" data-end="550.99">And even if a user knew that an extension was at fault,</span> <span data-start="550.99" data-end="553.32">there's not a great way for them to take action,</span> <span data-start="553.32" data-end="554.79">to reclaim those resources.</span> <span data-start="558.25" data-end="561.51">And finally, users simply don't have enough control</span> <span data-start="561.51" data-end="562.92">in today's ecosystem.</span> <span data-start="565.5" data-end="568.62">They don't have enough control over the experience</span> <span data-start="568.62" data-end="570.15">of using an extension.</span> </p>
<p><span data-start="570.15" data-end="573.78">Historically, if an extension said that it needed broad host</span> <span data-start="573.78" data-end="576.03">permissions, that it needed all_urls,</span> <span data-start="576.03" data-end="578.55">they would just include that pattern</span> <span data-start="578.55" data-end="580.05">in their permissions list.</span> <span data-start="580.05" data-end="582.84">And then the user is forced to either choose to grant them</span> <span data-start="582.84" data-end="586.29">the set of capabilities that the extension's requesting</span> <span data-start="586.29" data-end="587.94">or to bail out entirely.</span> <span data-start="587.94" data-end="591.3">And needless to say, this isn't good for users or developers.</span> <span data-start="591.3" data-end="594.15">It also assumes that the user actually</span> <span data-start="594.15" data-end="596.11">understands these permissions.</span> <span data-start="596.11" data-end="599.34">So if a user didn't understand "read and change all your site</span> <span data-start="599.34" data-end="604.14">data," they might say yes, even though they don't</span> <span data-start="604.14" data-end="605.62">understand the consequences.</span> </p>
<p><span data-start="605.62" data-end="609">And there's no remediation until you uninstall the extension</span> <span data-start="609" data-end="611.57">entirely.</span> <span data-start="611.57" data-end="614.9">So that brings us to this paradigm shift.</span> <span data-start="614.9" data-end="617.75">As we think about how to improve the extensions platform</span> <span data-start="617.75" data-end="622.22">and where we want it to go, we're</span> <span data-start="622.22" data-end="624.5">making some changes to the base assumptions</span> <span data-start="624.5" data-end="630.02">about how extensions are built. And unfortunately,</span> <span data-start="630.02" data-end="631.67">all of the issues we just went through</span> <span data-start="631.67" data-end="635.09">present a fundamental conflict with the current extensions</span> <span data-start="635.09" data-end="635.7">platform.</span> </p>
<p><span data-start="635.7" data-end="641.18">We can't make those changes without some rather substantial</span> <span data-start="641.18" data-end="643.68">breaking changes to the platform itself.</span> <span data-start="643.68" data-end="646.86">So we're going to make some substantial changes</span> <span data-start="646.86" data-end="648.8">and break the Manifest version, which</span> <span data-start="648.8" data-end="650.27">is why we're going from 2 to 3.</span> </p>
<p><span data-start="650.27" data-end="652.3">That way, we have a new ecosystem to work in.</span> <span data-start="655.68" data-end="659.37">So if I had to give the current ecosystem kind</span> <span data-start="659.37" data-end="661.92">of a tag line or a motto, it would be something like,</span> <span data-start="661.92" data-end="666.1">"empower developers to create amazing end user experiences."</span> </p>
<p><span data-start="666.1" data-end="667.74">But as we look to the future of how</span> <span data-start="667.74" data-end="670.32">we want to evolve the platform, we</span> <span data-start="670.32" data-end="674.13">want to shift it to something more like,</span> <span data-start="674.13" data-end="676.17">"empower users to customize Chrome</span> <span data-start="676.17" data-end="678.21">with amazing extensions."</span> </p>
<p><span data-start="678.21" data-end="680.49">The privacy and security of the user</span> <span data-start="680.49" data-end="683.43">should be the primary focus for both Chrome and for extension</span> <span data-start="683.43" data-end="684.49">developers.</span> <span data-start="684.49" data-end="687.15">And of course, we're still striving to provide developers</span> <span data-start="687.15" data-end="691.02">with a powerful, capable platform</span> <span data-start="691.02" data-end="694.15">that they can use to enable and delight users.</span> <span data-start="694.15" data-end="696.09">But that respect for the user should be</span> <span data-start="696.09" data-end="700.92">a core principle for everyone.</span> <span data-start="700.92" data-end="702.93">With this user-centered philosophy in mind,</span> <span data-start="702.93" data-end="705.24">we're aiming to improve three main areas of the Chrome</span> <span data-start="705.24" data-end="710.67">Extensions platform —  privacy, security, and performance.</span> <span data-start="710.67" data-end="713.94">In order to improve the privacy of the extension ecosystem,</span> <span data-start="713.94" data-end="715.65">we're trying to give users more control</span> <span data-start="715.65" data-end="719.83">over when an extension will run and what data it can access.</span> <span data-start="719.83" data-end="722.1">We're also trying to encourage extension developers</span> <span data-start="722.1" data-end="724.92">to give users more in-context permission</span> <span data-start="724.92" data-end="727.98">requests and temporary permission grants.</span> </p>
<p><span data-start="727.98" data-end="733.11">In-context requests improve the end users comprehension</span> <span data-start="733.11" data-end="735.63">of a permission being requested.</span> <span data-start="735.63" data-end="739.29">And temporary grants keep the user in control of their data.</span> <span data-start="739.29" data-end="740.84">For more about temporary grants, I'd</span> <span data-start="740.84" data-end="743.57">encourage you to check out documentation on activeTab.</span> <span data-start="746.43" data-end="748.795">We're also looking to improve the security guarantees</span> <span data-start="748.795" data-end="750.57">of the extensions platform.</span> </p>
<p><span data-start="750.57" data-end="759.24">That is, we want to be able to say to the user with confidence</span> <span data-start="759.24" data-end="762.33">that it is significantly harder or even impossible</span> <span data-start="762.33" data-end="765.81">for an extension to gain control of this privileged execution</span> <span data-start="765.81" data-end="766.68">environment.</span> <span data-start="766.68" data-end="770.71">And by extension, we want to increase —  huh, by extension — </span> <span data-start="770.71" data-end="774.69">we want to increase the end user trust in what they install,</span> <span data-start="774.69" data-end="777.81">and that it won't cause any long-term harm</span> <span data-start="777.81" data-end="780.837">or won't do anything without their direct involvement.</span> <span data-start="783.52" data-end="786.051">Oh, right, I have to press a button.</span> <span data-start="786.051" data-end="787.8">[LAUGHTER]</span> </p>
<p><span data-start="787.8" data-end="790.02">We're also aiming to make the extension platform more</span> <span data-start="790.02" data-end="792.39">performant by default. We want developers</span> <span data-start="792.39" data-end="794.55">to fall into a pit of success, where</span> <span data-start="794.55" data-end="798.06">even if they make a mistake or adopt an anti-pattern,</span> <span data-start="798.06" data-end="799.56">things will, for the most part, just</span> <span data-start="799.56" data-end="803.35">work out for them and, by extension, the end user.</span> <span data-start="803.35" data-end="806.34">So one of the goals here is to reduce</span> <span data-start="806.34" data-end="808.44">the amount of resources that are being consumed</span> <span data-start="808.44" data-end="812.085">over the extension's lifetime.</span> <span data-start="812.085" data-end="814.132">I have too many things.</span> <span data-start="814.132" data-end="816.09">OK, let's start to get into some of the details</span> <span data-start="816.09" data-end="817.98">about how extension developers will migrate</span> <span data-start="817.98" data-end="819.48">from the current extensions platform</span> <span data-start="819.48" data-end="821.16">to the new version, Manifest V3.</span> </p>
<p><span data-start="826.02" data-end="827.77">There are four main things that developers</span> <span data-start="827.77" data-end="829.93">are going to need to adapt to in this transition.</span> <span data-start="829.93" data-end="832.78">First, we're migrating from a background page</span> <span data-start="832.78" data-end="834.85">to a background service worker.</span> <span data-start="834.85" data-end="841">We're going to change how the extension gets and uses</span> <span data-start="841" data-end="843.19">host permissions.</span> <span data-start="843.19" data-end="845.742">We're introducing a new requirement for extensions</span> <span data-start="845.742" data-end="848.2">to bundle all the source code that they're going to execute</span> <span data-start="848.2" data-end="850.19">into the extension itself.</span> </p>
<p><span data-start="850.19" data-end="852.76">And finally, we're changing how network requests</span> <span data-start="852.76" data-end="855.06">are modified at runtime.</span> <span data-start="855.06" data-end="857.01">Each of these has its own set of challenges</span> <span data-start="857.01" data-end="859.47">and will require a different set of adaptations.</span> <span data-start="859.47" data-end="864.87">So we're going to step through them and see how it goes.</span> <span data-start="864.87" data-end="867.89">First up, background context changes — </span> <span data-start="867.89" data-end="871.34">the first and perhaps broadest set of changes</span> <span data-start="871.34" data-end="874.13">is the transition from a background page to a background</span> <span data-start="874.13" data-end="875.3">service worker.</span> </p>
<p><span data-start="875.3" data-end="877.46">There are two types of background pages today — </span> <span data-start="877.46" data-end="880.79">persistent background pages and event pages.</span> <span data-start="880.79" data-end="883.73">Persistent background pages, as you may guess,</span> <span data-start="883.73" data-end="886.58">are long-lived page environments that constantly</span> <span data-start="886.58" data-end="888.05">run in the background.</span> </p>
<p><span data-start="888.05" data-end="891.2">Event pages, on the other hand, are temporary environments</span> <span data-start="891.2" data-end="892.985">that are started in response to an event</span> <span data-start="892.985" data-end="894.86">and terminated when they're no longer needed.</span> <span data-start="897.72" data-end="900.65">We want to move from background pages</span> <span data-start="900.65" data-end="905.28">to service workers for three general reasons.</span> <span data-start="905.28" data-end="907.11">First, better overall performance — </span> <span data-start="907.11" data-end="910.46">we want to reduce the number of concurrent processes running,</span> <span data-start="910.46" data-end="913.97">the amount of memory consumed, and the total resource usage</span> <span data-start="913.97" data-end="915.8">overall of extensions.</span> <span data-start="915.8" data-end="918.74">Second, extensions are built on top of the web.</span> <span data-start="918.74" data-end="921.41">Where possible, we much prefer to use the web's primitives</span> <span data-start="921.41" data-end="924.96">rather than custom extension's specific solutions.</span> <span data-start="924.96" data-end="927.32">And finally, maintenance cost — </span> <span data-start="927.32" data-end="929">upkeep has a very real cost.</span> </p>
<p><span data-start="929" data-end="931.94">If we have a bunch of redundant features</span> <span data-start="931.94" data-end="935.24">that are both supported by the web platform and the extension</span> <span data-start="935.24" data-end="937.73">platform, that means we have to do twice the work.</span> <span data-start="937.73" data-end="940.31">Like Chrome has to do twice the work in order</span> <span data-start="940.31" data-end="945.71">to make any change because of knock-on effects.</span> <span data-start="945.71" data-end="947.54">One change here can cause consequences</span> <span data-start="947.54" data-end="951.09">in other places you didn't expect.</span> <span data-start="951.09" data-end="953.99">So as developers look to migrate to service workers,</span> <span data-start="953.99" data-end="958.67">there are two categories of issues that we're</span> <span data-start="958.67" data-end="960.74">going to need to face.</span> </p>
<p><span data-start="960.74" data-end="964.97">First is this transition from a persistent page</span> <span data-start="964.97" data-end="967.07">to an ephemeral environment.</span> <span data-start="967.07" data-end="972.63">And the other is moving from a headless page to a worker.</span> <span data-start="972.63" data-end="976.04">So first up, ephemerality — </span> <span data-start="976.04" data-end="978.56">extension listeners need to be registered</span> <span data-start="978.56" data-end="981.35">in the root context of an extension</span> <span data-start="981.35" data-end="983.78">rather than in asynchronous registration</span> <span data-start="983.78" data-end="985.31">and some kind of callback.</span> </p>
<p><span data-start="985.31" data-end="989.69">For example, you can imagine requesting some config</span> <span data-start="989.69" data-end="991.94">from Aroma server and then, once you've</span> <span data-start="991.94" data-end="994.01">received the response, registering the callback</span> <span data-start="994.01" data-end="995.14">handler.</span> <span data-start="995.14" data-end="996.89">And this is a little bit off in the weeds,</span> <span data-start="996.89" data-end="998.3">but I think it's cool.</span> <span data-start="998.3" data-end="1000.61">So I'm going to share it with you.</span> <span data-start="1000.61" data-end="1002.84">In order for Chrome to properly dispatch events,</span> <span data-start="1002.84" data-end="1007.15">it needs the events to be registered as soon as possible,</span> <span data-start="1007.15" data-end="1009.34">preferably, in the first turn of the event loop.</span> <span data-start="1009.34" data-end="1011.59">If they're not, then it's possible</span> <span data-start="1011.59" data-end="1014.08">that you would perform your asynchronous network request.</span> <span data-start="1014.08" data-end="1016.42">You'd come back.</span> </p>
<p><span data-start="1016.42" data-end="1018.79">Before the response is received, Chrome</span> <span data-start="1018.79" data-end="1020.41">would try to dispatch the event.</span> <span data-start="1020.41" data-end="1023.63">It wouldn't be handled because there's no handlers registered.</span> <span data-start="1023.63" data-end="1026.29">And then you receive the response,</span> <span data-start="1026.29" data-end="1027.272">register your listener.</span> </p>
<p><span data-start="1027.272" data-end="1029.314">And now you're like, wait, where did my event go?</span> <span data-start="1029.314" data-end="1031.689">Like I dropped it on the floor because you weren't there.</span> <span data-start="1035.16" data-end="1037.819">All right, second, you can't rely on global state.</span> <span data-start="1037.819" data-end="1040.069">Since service workers are event-based,</span> <span data-start="1040.069" data-end="1041.78">the global context with a service worker</span> <span data-start="1041.78" data-end="1045.47">is tossed every time the service worker is torn down.</span> </p>
<p><span data-start="1045.47" data-end="1049.49">So you probably need to adapt by moving from global state</span> <span data-start="1049.49" data-end="1054.74">to chrome.storage APIs or IndexedDB.</span> <span data-start="1054.74" data-end="1059.55">I should also call out here that extension service workers — </span> <span data-start="1059.55" data-end="1061.07">well, I guess, all service workers — </span> <span data-start="1061.07" data-end="1062.75">are asynchronous by design.</span> <span data-start="1062.75" data-end="1067.32">So you can't rely on synchronous APIs like local storage.</span> <span data-start="1067.32" data-end="1071.09">So if you're currently using local storage</span> <span data-start="1071.09" data-end="1075.22">to store your state, you'll need to work out a migration plan.</span> <span data-start="1079.05" data-end="1083.11">All right, the other major challenge with background pages</span> <span data-start="1083.11" data-end="1085.99">is that they don't have DOM —  or I'm sorry,</span> <span data-start="1085.99" data-end="1089.96">background service workers pages have DOM because they're pages.</span> <span data-start="1089.96" data-end="1094.15">So no worker —  web worker, or service worker,</span> <span data-start="1094.15" data-end="1096.58">or animation worklet — </span> <span data-start="1096.58" data-end="1098.11">none of them have access to DOM.</span> <span data-start="1098.11" data-end="1103.21">By design, workers are meant to be a stripped down environment.</span> </p>
<p><span data-start="1103.21" data-end="1106.03">But that also means you can't do things that you're</span> <span data-start="1106.03" data-end="1107.59">used to using DOM for.</span> <span data-start="1107.59" data-end="1110.44">You can't parse XML or HTML, or you</span> <span data-start="1110.44" data-end="1113.62">can't traverse a document tree because there's no document.</span> <span data-start="1113.62" data-end="1117.35">You can't dispatch events because there are no elements</span> <span data-start="1117.35" data-end="1119.98">to dispatch events on.</span> <span data-start="1119.98" data-end="1121.78">You can't play audio or video.</span> <span data-start="1121.78" data-end="1124.45">You can't render to a canvas element</span> <span data-start="1124.45" data-end="1126.83">because there's no element.</span> <span data-start="1126.83" data-end="1130.42">So each of these is going to require its own specific ways</span> <span data-start="1130.42" data-end="1131.23">to handle.</span> </p>
<p><span data-start="1131.23" data-end="1134.65">For parsing documents, traversing trees, dispatching</span> <span data-start="1134.65" data-end="1140.95">events, a library like JSDOM or Undom can fill that use case.</span> <span data-start="1140.95" data-end="1143.86">For playing audio or video, you'll</span> <span data-start="1143.86" data-end="1146.11">probably want to reuse an existing DOM context</span> <span data-start="1146.11" data-end="1147.29">or create a new one.</span> <span data-start="1147.29" data-end="1149.35">So open a new tab or window.</span> <span data-start="1149.35" data-end="1151.66">And for rendering to canvases, that's</span> <span data-start="1151.66" data-end="1154">what OffscreenCanvas is for explicitly, by design.</span> <span data-start="1156.82" data-end="1158.74">And while this isn't our preferred pattern,</span> <span data-start="1158.74" data-end="1160.66">in some cases, you may absolutely</span> <span data-start="1160.66" data-end="1164.35">need a long-lived, persistent page environment.</span> <span data-start="1164.35" data-end="1167.53">In those cases, I'd recommend using</span> <span data-start="1167.53" data-end="1169.42">a new tab or a new window.</span> <span data-start="1169.42" data-end="1171.04">And that may sound odd that we're</span> <span data-start="1171.04" data-end="1173.83">moving from a headless page to a worker,</span> <span data-start="1173.83" data-end="1176.2">and the solution is to open a new page.</span> </p>
<p><span data-start="1176.2" data-end="1178.38">And the answer is, yes.</span> <span data-start="1178.38" data-end="1181.21">The rationale here is that this gives the user control.</span> <span data-start="1181.21" data-end="1184.57">If they are able to control whether or not a page is open,</span> <span data-start="1184.57" data-end="1188.32">a tab is present, then they can decide whether or not</span> <span data-start="1188.32" data-end="1190.36">they want your page to be around,</span> <span data-start="1190.36" data-end="1192.892">or if they want to reclaim those resources.</span> <span data-start="1192.892" data-end="1195.1">For additional guidance on adopting service workers — </span> <span data-start="1195.1" data-end="1198.02">there are other issues to be aware of here as well — </span> <span data-start="1198.02" data-end="1199.27">check out the Migration Guide.</span> <span data-start="1199.27" data-end="1202.33">I'll have a link at the end of the talk.</span> <span data-start="1202.33" data-end="1203.51">All right, too many words.</span> <span data-start="1203.51" data-end="1210.41">Code —  assuming that you already have your background script</span> <span data-start="1210.41" data-end="1212.81">in a state that can be transitioned directly</span> <span data-start="1212.81" data-end="1215.41">to a service worker — </span> <span data-start="1215.41" data-end="1217.78">and for reference, a decent number of event pages</span> <span data-start="1217.78" data-end="1219.43">already fit this bill — </span> <span data-start="1219.43" data-end="1224.2">you can simply change the background scripts here</span> <span data-start="1224.2" data-end="1226.75">into a service worker.</span> </p>
<p><span data-start="1226.75" data-end="1227.38">That's it.</span> <span data-start="1227.38" data-end="1229.047">It's a one-line change in your manifest.</span> <span data-start="1231.57" data-end="1234.71">But that makes a decent number of assumptions.</span> <span data-start="1234.71" data-end="1236.87">All right, host permissions — </span> <span data-start="1236.87" data-end="1239.63">one of the fundamental changes in how</span> <span data-start="1239.63" data-end="1241.85">the new version of the extensions platform</span> <span data-start="1241.85" data-end="1246.29">is rethinking the way extensions work</span> <span data-start="1246.29" data-end="1250.507">is this shift towards a more user-centric interaction model.</span> </p>
<p><span data-start="1250.507" data-end="1252.59">In the past, if an extension wanted to access data</span> <span data-start="1252.59" data-end="1254.52">on every website, as I mentioned before,</span> <span data-start="1254.52" data-end="1257.06">they just add all_urls to their permissions list.</span> <span data-start="1257.06" data-end="1260.15">And then if the user didn't understand or just agreed</span> <span data-start="1260.15" data-end="1264.92">to it, the extension would have that capability</span> <span data-start="1264.92" data-end="1269.37">until it was uninstalled.</span> <span data-start="1269.37" data-end="1273.77">Given the risks associated with this persistent permission,</span> <span data-start="1273.77" data-end="1276.3">the extensions team wanted to change</span> <span data-start="1276.3" data-end="1279.51">how capability grants like this work in order to give users</span> <span data-start="1279.51" data-end="1282.06">more control over their data.</span> </p>
<p><span data-start="1282.06" data-end="1285.54">With the release of Chrome 70 in October of last year,</span> <span data-start="1285.54" data-end="1287.13">end users gained a lot more control</span> <span data-start="1287.13" data-end="1290.2">with the introduction of this feature.</span> <span data-start="1290.2" data-end="1293.46">Here, if you right-click an extension in the toolbar,</span> <span data-start="1293.46" data-end="1295.83">you can go to the "This can change and read site data"</span> <span data-start="1295.83" data-end="1299.55">option, where you can restrict the extension's access</span> <span data-start="1299.55" data-end="1305.37">to either a specific site or even to only run on click.</span> <span data-start="1305.37" data-end="1308.67">Looking to the future, we're exploring additional changes</span> <span data-start="1308.67" data-end="1311.25">to the installation flow, so that "When</span> <span data-start="1311.25" data-end="1315.22">you click the extension" option in here is the new default.</span> <span data-start="1315.22" data-end="1317.88">Users can still opt into granting</span> <span data-start="1317.88" data-end="1321.93">broader persistent permissions if they wish to do so.</span> <span data-start="1321.93" data-end="1325.02">But that should be the user's choice, not the developer's.</span> <span data-start="1325.02" data-end="1327.96">Rather extension should provide a complete compelling</span> <span data-start="1327.96" data-end="1332.31">experience out-of-the-box without having to ask the user</span> <span data-start="1332.31" data-end="1335.01">to give away the sun, the moon, and the stars.</span> </p>
<p><span data-start="1335.01" data-end="1339.18">The intent here is more direct user control</span> <span data-start="1339.18" data-end="1341.88">over when and where extensions will access their data.</span> <span data-start="1344.44" data-end="1347.2">Today, many of extensions are designed</span> <span data-start="1347.2" data-end="1350.36">around this pervasive data access pattern.</span> <span data-start="1350.36" data-end="1353.53">And there are a whole host of ways that good actors put this</span> <span data-start="1353.53" data-end="1355.51">to positive effect.</span> </p>
<p><span data-start="1355.51" data-end="1359.47">But it also comes at a cost that a lot of developers and users</span> <span data-start="1359.47" data-end="1360.85">may not have considered.</span> <span data-start="1360.85" data-end="1365.59">And that cost is compromising user security and privacy.</span> <span data-start="1365.59" data-end="1369.37">To that end, I'd strongly encourage developers</span> <span data-start="1369.37" data-end="1372.88">to look into ways to embrace this new paradigm,</span> <span data-start="1372.88" data-end="1374.17">this new mindset.</span> <span data-start="1374.17" data-end="1379.24">And try to design your basic interactions</span> <span data-start="1379.24" data-end="1381.64">for your extension around temporary host permissions</span> <span data-start="1381.64" data-end="1384.28">rather than persistent host permissions.</span> <span data-start="1384.28" data-end="1388.06">Where possible, treat in-page interaction and host</span> <span data-start="1388.06" data-end="1390.43">permissions as a progressive enhancement.</span> <span data-start="1390.43" data-end="1392.29">If the user likes what you're delivering,</span> <span data-start="1392.29" data-end="1394.96">then they can choose to grant your extension</span> <span data-start="1394.96" data-end="1396.498">additional capabilities.</span> </p>
<p><span data-start="1399.43" data-end="1401.17">Before we move off permissions, I</span> <span data-start="1401.17" data-end="1404.86">would want to make a quick note about API changes.</span> <span data-start="1404.86" data-end="1410.62">Earlier I mentioned that Manifest version 2 specify</span> <span data-start="1410.62" data-end="1413.38">hosts in the permissions field.</span> <span data-start="1413.38" data-end="1415.54">In Manifest version 3, we're changing</span> <span data-start="1415.54" data-end="1421.36">this to have a dedicated field host.permissions, where you</span> <span data-start="1421.36" data-end="1424.48">define your host permissions.</span> <span data-start="1424.48" data-end="1426.31">While this is a small change, the intent</span> <span data-start="1426.31" data-end="1430.24">is to better reflect how the Chrome</span> <span data-start="1430.24" data-end="1433.79">platform is thinking about and using host permissions.</span> <span data-start="1433.79" data-end="1437.98">These aren't capabilities that will be required of the user.</span> <span data-start="1437.98" data-end="1441.3">These are things that may enhance your extension.</span> <span data-start="1444.3" data-end="1446.747">All right, remotely hosted code restrictions — </span> <span data-start="1446.747" data-end="1448.33">a few moments ago, I talked about some</span> <span data-start="1448.33" data-end="1451.93">of the challenges related to remotely loading code.</span> </p>
<p><span data-start="1451.93" data-end="1454.75">And in order to address these issues, in the future,</span> <span data-start="1454.75" data-end="1457.3">extensions will only be able to execute code that</span> <span data-start="1457.3" data-end="1459.28">is in the extension's bundle.</span> <span data-start="1459.28" data-end="1462.46">And by code, I specifically mean JavaScript, CSS,</span> <span data-start="1462.46" data-end="1463.66">and WebAssembly.</span> <span data-start="1463.66" data-end="1466.19">Now, CSS may seem like a bit of an outlier here.</span> <span data-start="1466.19" data-end="1468.25">But unfortunately, through clever use of CSS,</span> <span data-start="1468.25" data-end="1470.5">it's possible to leak data about the page</span> <span data-start="1470.5" data-end="1472.24">that the CSS is injected into.</span> <span data-start="1472.24" data-end="1476.2">So unfortunately, we have to guard against that.</span> <span data-start="1476.2" data-end="1479.26">I should also call out that remote data is fine.</span> <span data-start="1479.26" data-end="1480.82">You'll still be able to load JSON.</span> </p>
<p><span data-start="1480.82" data-end="1482.83">You'll still be able to request media assets.</span> <span data-start="1482.83" data-end="1485.93">You can still make remote procedure calls or API calls.</span> <span data-start="1485.93" data-end="1487.84">You can still do that webby stuff.</span> <span data-start="1487.84" data-end="1490.51">The intent, though, is, in this privileged execution</span> <span data-start="1490.51" data-end="1493.537">environment, we need to be able to see</span> <span data-start="1493.537" data-end="1494.62">the code that will be run.</span> <span data-start="1497.75" data-end="1501.5">We plan to accomplish this through a combination</span> <span data-start="1501.5" data-end="1503.88">of platform and policy changes.</span> <span data-start="1503.88" data-end="1507.11">For example, if you attempt to change the default content</span> <span data-start="1507.11" data-end="1508.97">security policy on an extension, in order</span> <span data-start="1508.97" data-end="1511.25">to grant unsafe eval, as in the case</span> <span data-start="1511.25" data-end="1516.83">here, or grant a remote domain, you simply</span> <span data-start="1516.83" data-end="1521.42">will fail to load the extension at install time.</span> <span data-start="1521.42" data-end="1527.27">I tend to be a big fan of "error loudly and clearly,</span> <span data-start="1527.27" data-end="1528.66">as soon as possible."</span> </p>
<p><span data-start="1528.66" data-end="1530.84">And this is definitely that.</span> <span data-start="1530.84" data-end="1532.64">In order to adapt to this change,</span> <span data-start="1532.64" data-end="1534.8">I'd strongly recommend developers move</span> <span data-start="1534.8" data-end="1537.225">towards a config-driven architecture.</span> <span data-start="1537.225" data-end="1538.85">Bundle all the code that your extension</span> <span data-start="1538.85" data-end="1540.71">may execute at runtime.</span> <span data-start="1540.71" data-end="1543.53">And then use remotely loaded configuration — </span> <span data-start="1543.53" data-end="1545.81">for example, JSON —  in order to choose</span> <span data-start="1545.81" data-end="1550.16">which files you actually inject and which code parts you</span> <span data-start="1550.16" data-end="1551.39">execute.</span> <span data-start="1551.39" data-end="1553.19">I'd also encourage extension developers</span> <span data-start="1553.19" data-end="1555.74">to consider adding feature switches to their extensions</span> <span data-start="1555.74" data-end="1558.32">and possibly some messaging support</span> <span data-start="1558.32" data-end="1561.29">in order to minimize unexpected behaviors</span> <span data-start="1561.29" data-end="1563.72">and to communicate those unexpected behaviors</span> <span data-start="1563.72" data-end="1566.93">and disabling of certain features to end users.</span> </p>
<p><span data-start="1570.68" data-end="1574">One major area changing in Manifest V3</span> <span data-start="1574" data-end="1577.6">is how we handle modifying network requests.</span> <span data-start="1577.6" data-end="1580.3">Currently, extensions use the blocking version</span> <span data-start="1580.3" data-end="1585.28">of the Web Request API in order to, well, block web requests.</span> <span data-start="1585.28" data-end="1588.73">This API effectively places the extension between the browser</span> <span data-start="1588.73" data-end="1591.23">and the network.</span> <span data-start="1591.23" data-end="1594.46">Here's a simplified version of the web request flow.</span> <span data-start="1594.46" data-end="1598.21">First, the extension registers event listeners with Chrome</span> <span data-start="1598.21" data-end="1600.97">in order to get callbacks when a net request lifecycle</span> <span data-start="1600.97" data-end="1603.18">event is fired.</span> <span data-start="1603.18" data-end="1606.28">Next, when the event is triggered,</span> <span data-start="1606.28" data-end="1610.72">Chrome passes a request object to the extension.</span> <span data-start="1610.72" data-end="1613.3">And finally, the extension chooses</span> <span data-start="1613.3" data-end="1616.06">whether to allow the request, to modify it,</span> <span data-start="1616.06" data-end="1619.03">or to cancel it entirely.</span> <span data-start="1619.03" data-end="1623.29">While this API is very capable, it has a couple of major issues</span> <span data-start="1623.29" data-end="1625.96">that we want to address in this attempt</span> <span data-start="1625.96" data-end="1628.36">to move to a more privacy-preserving and secure</span> <span data-start="1628.36" data-end="1629.95">extension platform.</span> </p>
<p><span data-start="1629.95" data-end="1631.81">First, it requires host permissions</span> <span data-start="1631.81" data-end="1633.34">for the extension to work.</span> <span data-start="1633.34" data-end="1636.82">As we just talked about, we're trying to go away from them</span> <span data-start="1636.82" data-end="1639.61">or discourage their persistent use, which</span> <span data-start="1639.61" data-end="1644.11">means that in the current world, an extension wouldn't</span> <span data-start="1644.11" data-end="1648.06">be able to observe or modify the request.</span> <span data-start="1648.06" data-end="1650.56">In other words, at install time, the extension wouldn't work</span> <span data-start="1650.56" data-end="1651.32">out-of-the-box.</span> <span data-start="1651.32" data-end="1653.93">That's a pretty bad experience for the end user.</span> <span data-start="1653.93" data-end="1656.71">So it's something that we want to address.</span> <span data-start="1656.71" data-end="1660.58">Second, this exposes too much data to the extension</span> <span data-start="1660.58" data-end="1661.75">passively.</span> <span data-start="1661.75" data-end="1664.06">The request object that I mentioned in step 2</span> <span data-start="1664.06" data-end="1666.56">here contains detailed information,</span> <span data-start="1666.56" data-end="1668.35">such as the URL, the cookies used,</span> <span data-start="1668.35" data-end="1670.48">the request body, et cetera.</span> </p>
<p><span data-start="1670.48" data-end="1673.895">And this pervasive passive data access</span> <span data-start="1673.895" data-end="1675.52">is exactly the type of thing that we're</span> <span data-start="1675.52" data-end="1678.1">trying to adjust in Manifest version 3.</span> <span data-start="1678.1" data-end="1681.85">And third, and finally, this API was</span> <span data-start="1681.85" data-end="1686.62">designed for a world with persistent background pages.</span> <span data-start="1686.62" data-end="1688.48">To put it another way, it's not a great fit</span> <span data-start="1688.48" data-end="1690.67">for moving to service workers.</span> <span data-start="1690.67" data-end="1692.65">Service workers have a startup cost.</span> <span data-start="1692.65" data-end="1695.32">And all requests are blocked until that startup</span> <span data-start="1695.32" data-end="1697.03">cost is paid.</span> </p>
<p><span data-start="1697.03" data-end="1701.08">Without getting too deep into the internals of Chrome,</span> <span data-start="1701.08" data-end="1705.1">the web requests model involves a decent amount</span> <span data-start="1705.1" data-end="1707.68">of extra work for Chrome.</span> <span data-start="1707.68" data-end="1712.15">For every lifecycle event that is fired for every request,</span> <span data-start="1712.15" data-end="1713.68">every extension that's interested</span> <span data-start="1713.68" data-end="1716.56">in it needs data to be serialized and passed</span> <span data-start="1716.56" data-end="1718.21">across multiple different process hops.</span> <span data-start="1722.05" data-end="1724.23">The extension use of the service worker</span> <span data-start="1724.23" data-end="1726.73">is also a bit different than on the open web,</span> <span data-start="1726.73" data-end="1729.22">where service workers cash offline content</span> <span data-start="1729.22" data-end="1732.07">and enable better offline experiences.</span> </p>
<p><span data-start="1732.07" data-end="1736.18">In our case, though, the service worker would be a blocking — </span> <span data-start="1738.73" data-end="1741.84">network request would block on the extension service worker</span> <span data-start="1741.84" data-end="1744.76">until the extension service worker to start it up.</span> <span data-start="1744.76" data-end="1747.5">And that has a very real cost to end users.</span> <span data-start="1747.5" data-end="1751.51">So in order to continue to serve the Web Request use</span> <span data-start="1751.51" data-end="1754.19">case and the wonderful things that it does,</span> <span data-start="1754.19" data-end="1758.8">we're trying to take a think on redesigning some</span> <span data-start="1758.8" data-end="1760.86">of the basics of this model.</span> <span data-start="1760.86" data-end="1762.61">To show you what I mean, let's take a look</span> <span data-start="1762.61" data-end="1768.39">at how a new API that we're introducing is going to work.</span> <span data-start="1768.39" data-end="1769.45">Oh, I lied.</span> <span data-start="1769.45" data-end="1771.48">I have to say that in order to continue</span> <span data-start="1771.48" data-end="1772.95">to serve the basic use cases — </span> <span data-start="1772.95" data-end="1773.95">oh, no, I said all that.</span> <span data-start="1773.95" data-end="1777.047">Not that it matters.</span> <span data-start="1777.047" data-end="1779.13">We're introducing a new API called Declarative Net</span> </p>
<p><span data-start="1779.13" data-end="1781.66">Request that takes a completely different approach.</span> <span data-start="1781.66" data-end="1783.48">So rather than the extension sitting</span> <span data-start="1783.48" data-end="1785.4">between the browser and the network,</span> <span data-start="1785.4" data-end="1788.17">the extension at install time says,</span> <span data-start="1788.17" data-end="1790.56">hey, Chrome, here's a list of rules</span> <span data-start="1790.56" data-end="1793.23">that I want you to enforce.</span> </p>
<p><span data-start="1793.23" data-end="1795.76">And then Chrome is responsible for enforcing them.</span> <span data-start="1798.47" data-end="1801.8">This declarative model drastically</span> <span data-start="1801.8" data-end="1805.61">limits how much data is exposed to the extension, while still</span> <span data-start="1805.61" data-end="1810.89">enabling extensions to modify requests and block</span> <span data-start="1810.89" data-end="1812.58">ads and stuff.</span> </p>
<p><span data-start="1812.58" data-end="1815.96">So let's see some code to actually compare the two.</span> <span data-start="1815.96" data-end="1819.98">First, in Manifest version 2, I have a set of permissions</span> <span data-start="1819.98" data-end="1820.67">that I request.</span> <span data-start="1820.67" data-end="1822.32">I have to request both webRequest and</span> <span data-start="1822.32" data-end="1825.59">webRequestBlocking because that's a separate thing.</span> <span data-start="1825.59" data-end="1830.71">I also have to request all the hosts that I want to intercept.</span> <span data-start="1830.71" data-end="1833.77">And then I match requests that are</span> <span data-start="1833.77" data-end="1838.69">sent to the main_frame on Twitter, and I cancel them.</span> <span data-start="1838.69" data-end="1840.58">So all of this is happening running</span> <span data-start="1840.58" data-end="1843.67">in a JavaScript environment.</span> <span data-start="1843.67" data-end="1847.91">Instead in Manifest version 3, my permissions list now</span> <span data-start="1847.91" data-end="1849.23">is only declarativeNetRequest.</span> </p>
<p><span data-start="1849.23" data-end="1852.3">No host permissions required.</span> <span data-start="1852.3" data-end="1855.5">I have a new property called declarative_net_request,</span> <span data-start="1855.5" data-end="1859.52">where I define a set of static rules.</span> <span data-start="1859.52" data-end="1863.64">And each of these rules will match</span> <span data-start="1863.64" data-end="1870.06">the main_frame and the URL and then block that request.</span> <span data-start="1870.06" data-end="1873.03">I should also call out that in response of developer feedback,</span> <span data-start="1873.03" data-end="1876.24">we've also added a — </span> <span data-start="1876.24" data-end="1881.22">what's it called —  Runtime API in order to add dynamic rules.</span> <span data-start="1881.22" data-end="1883.77">But this still allows Chrome to remain</span> <span data-start="1883.77" data-end="1887.91">in control of what requests are allowed</span> <span data-start="1887.91" data-end="1891">and limit the amount of data exposed to the extension.</span> </p>
<p><span data-start="1891" data-end="1892.69">If you're interested in learning more,</span> <span data-start="1892.69" data-end="1894.148">please check out our documentation.</span> <span data-start="1894.148" data-end="1896.2">Again, link at the end of the talk.</span> <span data-start="1896.2" data-end="1898.567">But we are very interested in trying</span> <span data-start="1898.567" data-end="1900.15">to work with the development community</span> <span data-start="1900.15" data-end="1903.31">in order to find a good solution for this.</span> </p>
<p><span data-start="1903.31" data-end="1905.17">All right, wrap it up.</span> <span data-start="1905.17" data-end="1907.67">We talked about a lot of stuff, moving from background pages</span> <span data-start="1907.67" data-end="1909.02">to service workers, host permissions,</span> <span data-start="1909.02" data-end="1910.578">remotely hosted code, restrictions,</span> <span data-start="1910.578" data-end="1911.62">net request modification.</span> <span data-start="1911.62" data-end="1914.21">And all of that was too fast to even hear what I just said.</span> <span data-start="1914.21" data-end="1916.7">But before our time together is over,</span> <span data-start="1916.7" data-end="1919.7">I want to touch on another important thing, what</span> <span data-start="1919.7" data-end="1921.26">we're keeping the same.</span> <span data-start="1921.26" data-end="1923.75">Extensions are an amazing feature of Chrome.</span> </p>
<p><span data-start="1923.75" data-end="1926.45">Time and time again, we've heard that extension</span> <span data-start="1926.45" data-end="1929.69">cited as a key feature of how users browse the web.</span> <span data-start="1929.69" data-end="1932.6">Extensions give users a way to customize Chrome and truly</span> <span data-start="1932.6" data-end="1934.87">make it their own.</span> <span data-start="1934.87" data-end="1936.73">As we refine the platform to give users</span> <span data-start="1936.73" data-end="1940.37">more control over their browsing experience,</span> <span data-start="1940.37" data-end="1944.45">we're also striving to maintain the eclectic, feature-rich,</span> <span data-start="1944.45" data-end="1947.92">vibrant ecosystem of extensions that we have today.</span> <span data-start="1947.92" data-end="1949.69">We want to get to a world where we</span> <span data-start="1949.69" data-end="1954.22">can satisfy all of these use cases that empower users</span> <span data-start="1954.22" data-end="1957.22">and make Chrome their web browser, while also feeling</span> <span data-start="1957.22" data-end="1960.88">safe, and in charge, and secure.</span> <span data-start="1960.88" data-end="1963.855">That's the reason that we're pursuing Manifest version 3.</span> <span data-start="1963.855" data-end="1965.23">And we're committed to continuing</span> <span data-start="1965.23" data-end="1966.813">to work with the development community</span> <span data-start="1966.813" data-end="1969.58">throughout this transition.</span> </p>
<p><span data-start="1969.58" data-end="1973.09">Before I go, though, I'd like to encourage you all</span> <span data-start="1973.09" data-end="1975.7">to start experimenting with the new version of the Chrome</span> <span data-start="1975.7" data-end="1976.93">Extensions platform.</span> <span data-start="1976.93" data-end="1979.45">We have a developer preview in Chrome Canary today.</span> <span data-start="1979.45" data-end="1983.03">Well, actually, we released it on Halloween.</span> <span data-start="1983.03" data-end="1984.1">But it's out there.</span> <span data-start="1984.1" data-end="1986.47">You can start experimenting and trying these out.</span> <span data-start="1986.47" data-end="1988.72">Try migrating extensions and also give us</span> <span data-start="1988.72" data-end="1991.275">feedback on what you can and can't do.</span> <span data-start="1991.275" data-end="1992.65">And please let us know if you run</span> <span data-start="1992.65" data-end="1996.25">into any issues on the Chromium Extensions Google group.</span> </p>
<p><span data-start="1996.25" data-end="1997.43">Again, thank you very much.</span> <span data-start="1997.43" data-end="1998.27">I appreciate it.</span> <span data-start="1998.27" data-end="1998.97">Have a good one.</span> <span data-start="1998.97" data-end="1999.47">[APPLAUSE]</span> <span data-start="1999.47" data-end="2002.82">[MUSIC PLAYING]</span> </p>
</section>

<!-- div#container ends -->
</div>

<img alt="The End" id="fin" src="../images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="../js/main.js"></script>

</body>

</html>
