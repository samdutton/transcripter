<section>
<p><span data-start="0" data-end="1.434">[MUSIC PLAYING]</span> </p>
</section>

<section>
<p><span data-start="6.482" data-end="8.065"><span class="speaker">Katie Hempenius</span>: Today, Houssein and I</span> <span data-start="8.065" data-end="9.564">are going to talk with you about how</span> <span data-start="9.564" data-end="11.06">you can make your site fast.</span> <span data-start="11.06" data-end="15.2">We're going to focus on three things, images,</span> <span data-start="15.2" data-end="18.55">web fonts, and JavaScript.</span> <span data-start="18.55" data-end="20.56">We've chosen to focus on these three things</span> <span data-start="20.56" data-end="22.15">because they are the three largest</span> <span data-start="22.15" data-end="25.54">components of most websites.</span> <span data-start="25.54" data-end="28.9">In addition, they're likely to be the three largest components</span> <span data-start="28.9" data-end="30.09">of your performance budget.</span> <span data-start="32.98" data-end="34.7">We hope that after this presentation,</span> <span data-start="34.7" data-end="37.31">you'll go home and make changes to your website.</span> <span data-start="37.31" data-end="38.86">Know that during this process, you</span> <span data-start="38.86" data-end="41.26">can lean on both Lighthouse and web.dev</span> <span data-start="41.26" data-end="43.09">for additional resources.</span> </p>
<p><span data-start="43.09" data-end="46.36">Almost everything we cover today can be audited by Lighthouse.</span> <span data-start="46.36" data-end="50.65">In addition, at web.dev can find guides, code samples, and demos</span> <span data-start="50.65" data-end="53.85">of everything we cover today.</span> <span data-start="53.85" data-end="56.8">So let's start by talking about images.</span> <span data-start="56.8" data-end="59.07">Images are taking over the web.</span> <span data-start="59.07" data-end="61.75">On many sites, images alone would consume</span> <span data-start="61.75" data-end="64.72">the entire performance budget.</span> <span data-start="64.72" data-end="68.2">On some sites, it would far exceed that.</span> <span data-start="68.2" data-end="70.45">I think the reason why these numbers are so bad</span> <span data-start="70.45" data-end="72.67">lies in the fact that performant images are</span> <span data-start="72.67" data-end="75.61">the result of many steps and optimizations.</span> <span data-start="75.61" data-end="80.15">As a result, they're not going to happen accidentally.</span> <span data-start="80.15" data-end="83.81">A performant image is the appropriate format,</span> <span data-start="83.81" data-end="89.2">is appropriately compressed, is appropriate for the display,</span> <span data-start="89.2" data-end="92.65">and is loaded only when necessary.</span> </p>
<p><span data-start="92.65" data-end="94.45">To be successful with images, it's</span> <span data-start="94.45" data-end="98.27">imperative that you automate and systematize these things.</span> <span data-start="98.27" data-end="100.03">Not only is this going to save you time,</span> <span data-start="100.03" data-end="104.31">but it's going to ensure that these things actually get done.</span> <span data-start="104.31" data-end="107.24">There's much more to images than meets the eye.</span> <span data-start="107.24" data-end="109.01">At a bits and bytes level, an image</span> <span data-start="109.01" data-end="111.32">is as much a byproduct of its image format</span> <span data-start="111.32" data-end="115.25">and its compression as its visual subject matter.</span> <span data-start="115.25" data-end="116.84">You can think about image formats</span> <span data-start="116.84" data-end="119.439">as choosing the right tool for the job.</span> </p>
<p><span data-start="119.439" data-end="120.98">The image format that you choose will</span> <span data-start="120.98" data-end="123.54">determine what features and image has, for instance,</span> <span data-start="123.54" data-end="126.29">whether it supports transparency or animation,</span> <span data-start="126.29" data-end="129.77">as well as how it can be compressed.</span> <span data-start="129.77" data-end="132.29">The first image format that I want to talk about today</span> <span data-start="132.29" data-end="134.21">is the animated GIF.</span> <span data-start="134.21" data-end="137.2">You should not be fooled by their crappy image quality.</span> <span data-start="137.2" data-end="140.7">They're actually huge in file size.</span> <span data-start="140.7" data-end="145.97">This 1 and 1/2 second clip is 6.8 mgs as a GIF.</span> <span data-start="145.97" data-end="152.66">As a video, however, is 16 times smaller, at 420 megabytes.</span> <span data-start="152.66" data-end="154.22">This is not uncommon.</span> <span data-start="154.22" data-end="157.28">Animated GIFs can be anywhere from five to 20 times</span> <span data-start="157.28" data-end="162.28">larger than the same content served as a video.</span> </p>
<p><span data-start="162.28" data-end="164.61">This is why if you've ever inspected your Twitter feed,</span> <span data-start="164.61" data-end="166.59">you may have noticed that the content labeled</span> <span data-start="166.59" data-end="169.2">as GIF is not actually a GIF.</span> <span data-start="169.2" data-end="171.12">Twitter does not serve animated GIFs.</span> <span data-start="171.12" data-end="173.37">If you upload an animated GIF, they will automatically</span> <span data-start="173.37" data-end="175.93">convert it to video.</span> <span data-start="175.93" data-end="177.49">The reason for the drastic difference</span> <span data-start="177.49" data-end="180.22">in file sizes between videos and animated GIFs</span> <span data-start="180.22" data-end="183.1">lies in the differences between their compression algorithms.</span> </p>
<p><span data-start="183.1" data-end="186.04">Video compression algorithms are far more sophisticated.</span> <span data-start="186.04" data-end="188.35">Not only do they compress the contents of each frame,</span> <span data-start="188.35" data-end="190.644">what they do what is known as inner frame compression.</span> <span data-start="190.644" data-end="192.31">And you can think of this as compression</span> <span data-start="192.31" data-end="194.476">that looks at the difs between the different frames.</span> <span data-start="197.01" data-end="199.89">The first step in switching from animated GIFs to video</span> <span data-start="199.89" data-end="201.51">is to convert your content.</span> <span data-start="201.51" data-end="205.98">You can use the ffmpeg command line tool for this.</span> </p>
<p><span data-start="205.98" data-end="207.87">Next, you'll need to update your HTML,</span> <span data-start="207.87" data-end="210.3">and replace image tags with video tags.</span> <span data-start="210.3" data-end="213.16">The code I have up on the screen is technically correct,</span> <span data-start="213.16" data-end="215.727">but it's probably not what you want to use.</span> <span data-start="215.727" data-end="218.31">Instead, you want to make sure to add the four attributes I've</span> <span data-start="218.31" data-end="220.11">highlighted up on the screen.</span> <span data-start="220.11" data-end="222.45">That's going to give your video that GIF look</span> <span data-start="222.45" data-end="224.175">and feel even though it's not a GIF.</span> <span data-start="228.83" data-end="231.62">Now, we'll switch gears and talk about a much more modern image</span> <span data-start="231.62" data-end="235.06">format, and that, of course, is WebP.</span> </p>
<p><span data-start="235.06" data-end="238.97">WebP is no longer a Chrome only technology.</span> <span data-start="238.97" data-end="243.23">Last month, Microsoft Edge shipped support for WebP.</span> <span data-start="243.23" data-end="246.23">In addition, Mozilla Firefox announced their intent</span> <span data-start="246.23" data-end="248.6">to ship WebP.</span> <span data-start="248.6" data-end="255.41">Currently, 72% of global web users have support for WebP.</span> <span data-start="255.41" data-end="256.91">And given these recent developments,</span> <span data-start="256.91" data-end="258.785">you can expect this number to only increase.</span> <span data-start="263.47" data-end="265.49">This is a big deal because WebP images</span> <span data-start="265.49" data-end="270.57">are 25% to 35% smaller than the equivalent JPEG or PNG.</span> <span data-start="270.57" data-end="273.59">And this translates into some really awesome improvements</span> <span data-start="273.59" data-end="275.03">in page speed.</span> </p>
<p><span data-start="275.03" data-end="276.86">When the Trib united support for WebP,</span> <span data-start="276.86" data-end="280.52">they found there was a 30% improvement in page load times</span> <span data-start="280.52" data-end="281.795">on WebP supported browsers.</span> <span data-start="285.32" data-end="288.35">By far the biggest hesitation I see around adopting WebP</span> <span data-start="288.35" data-end="291.2">is a fear that you can't both serve WebP and support</span> <span data-start="291.2" data-end="292.37">non-WebP browsers.</span> <span data-start="292.37" data-end="294.17">And this is not true.</span> <span data-start="294.17" data-end="296.13">The picture and the source tags make it</span> <span data-start="296.13" data-end="298.4">possible to do precisely this.</span> </p>
<p><span data-start="298.4" data-end="301.43">You can think of the picture tag as a container for the source</span> <span data-start="301.43" data-end="304.01">and image tags that it contains.</span> <span data-start="304.01" data-end="307.34">The source tag is used to specify multiple image</span> <span data-start="307.34" data-end="309.14">formats of the same image.</span> <span data-start="309.14" data-end="312.2">The browser will download the first, and only the first,</span> <span data-start="312.2" data-end="314.66">image that is in a format that it supports.</span> <span data-start="314.66" data-end="316.52">So in this example I have up on the screen,</span> <span data-start="316.52" data-end="319.22">the Chrome browser would download the WebP version,</span> <span data-start="319.22" data-end="322.97">a Safari browser would download the JPEG version.</span> <span data-start="322.97" data-end="324.92">The great thing about this is that even</span> <span data-start="324.92" data-end="328.67">though all major browsers have supported picture and source</span> <span data-start="328.67" data-end="332.56">tag since 2015, however, if say, a 2014 browser were</span> <span data-start="332.56" data-end="334.31">to encounter this, it would still work,</span> <span data-start="334.31" data-end="335.684">because those browsers would just</span> <span data-start="335.684" data-end="337.73">download the image specified by the image tag.</span> </p>
<p><span data-start="339.815" data-end="341.19">If you haven't noticed, I've been</span> <span data-start="341.19" data-end="342.379">talking about image formats.</span> <span data-start="342.379" data-end="343.92">But I want to kind of go on a tangent</span> <span data-start="343.92" data-end="347.007">and squeeze in a mention of the AV1 video format.</span> <span data-start="347.007" data-end="348.84">And the reason why I wanted to squeeze it in</span> <span data-start="348.84" data-end="353.01">is that it is the future of video on the web.</span> <span data-start="353.01" data-end="355.29">The reason why it's the future of video on the web</span> <span data-start="355.29" data-end="359.76">is that it compresses video 45% to 50% better than what</span> <span data-start="359.76" data-end="362.64">is currently typically used on the web.</span> <span data-start="362.64" data-end="365.67">It is still fairly new, so it's not really practical</span> <span data-start="365.67" data-end="367.84">for you to be implementing it on your site yet.</span> <span data-start="367.84" data-end="370.17">However, I encourage you to attend Francois and Angie's</span> <span data-start="370.17" data-end="371.73">talk at 3:30 today, where they're</span> <span data-start="371.73" data-end="373.635">going to be diving into AV1 in more detail.</span> <span data-start="376.61" data-end="378.17">Image compression is a topic that's</span> <span data-start="378.17" data-end="380.42">tightly coupled to image formats.</span> </p>
<p><span data-start="380.42" data-end="383.46">Image compression algorithms are specific to the image format</span> <span data-start="383.46" data-end="385.96">that they compress.</span> <span data-start="385.96" data-end="387.85">However, all image compression algorithms</span> <span data-start="387.85" data-end="391.57">can be broken down into lossless and lossy compression.</span> <span data-start="391.57" data-end="394.495">Lossless compression results no loss of data.</span> <span data-start="394.495" data-end="397.16">Lossy compression does result in loss of data,</span> <span data-start="397.16" data-end="400.69">however can achieve greater file size savings.</span> <span data-start="400.69" data-end="403.84">At a minimum, all sites should be using lossless compression,</span> <span data-start="403.84" data-end="405.2">no questions asked.</span> </p>
<p><span data-start="405.2" data-end="406.837">However, for most people, it's going</span> <span data-start="406.837" data-end="408.67">to make sense to be slightly more aggressive</span> <span data-start="408.67" data-end="412.11">and use lossy compression instead.</span> <span data-start="412.11" data-end="413.61">The trick with lossy compression is</span> <span data-start="413.61" data-end="416.31">finding that sweet spot between file size savings</span> <span data-start="416.31" data-end="420.18">and image quality for your particular use case.</span> <span data-start="420.18" data-end="423.81">Many lossy compression tools use the scale of zero to 100</span> <span data-start="423.81" data-end="426.75">to represent the image quality of the compressed image,</span> <span data-start="426.75" data-end="430.047">with zero being the worst, and 100 being the best.</span> </p>
<p><span data-start="430.047" data-end="432.63">If you're looking for a place to start with lossy compression,</span> <span data-start="432.63" data-end="436.71">we recommend trying out a quality level of 80 to 85.</span> <span data-start="436.71" data-end="440.19">This typically reduces file size by 30% to 40%,</span> <span data-start="440.19" data-end="442.205">while having a minimal effect on image quality.</span> <span data-start="445.29" data-end="447.75">By far, the most popular tool for image compression</span> <span data-start="447.75" data-end="452.46">is Imagemin, and it can be used with just about everything.</span> <span data-start="452.46" data-end="455.724">Imagemin is used in conjunction with various Imagemin plugins.</span> <span data-start="455.724" data-end="457.14">And you can think of these plugins</span> <span data-start="457.14" data-end="460.59">as implementations of different image compression algorithms.</span> <span data-start="460.59" data-end="463.56">Up on the screen, I've put the most popular Imagemin plugins</span> <span data-start="463.56" data-end="465.12">for various use cases.</span> </p>
<p><span data-start="465.12" data-end="467.52">However, these are by no means the only Imagemin plugins</span> <span data-start="467.52" data-end="470.89">available.</span> <span data-start="470.89" data-end="473.08">Image sizing is something I think many sites could</span> <span data-start="473.08" data-end="475.03">be doing a much better job at.</span> <span data-start="475.03" data-end="477.13">We have so many types of devices,</span> <span data-start="477.13" data-end="479.32">and specifically sizes of devices that access</span> <span data-start="479.32" data-end="480.57">the web these days.</span> <span data-start="480.57" data-end="483.235">However, we insist on serving them all the exact same size</span> <span data-start="483.235" data-end="484.999">of image.</span> <span data-start="484.999" data-end="486.79">Not only does this have transmission costs,</span> <span data-start="486.79" data-end="491.492">but it also creates additional work for the CPU.</span> </p>
<p><span data-start="491.492" data-end="493.16">A solution, of course, is to serve</span> <span data-start="493.16" data-end="495.03">multiple sizes of an image.</span> <span data-start="495.03" data-end="496.79">Most sites find success serving anywhere</span> <span data-start="496.79" data-end="499.19">from three to five sizes of an image.</span> <span data-start="499.19" data-end="503.82">And in fact, this is exactly what Instagram does.</span> <span data-start="503.82" data-end="506.26">Instagram uses this technique throughout their site.</span> <span data-start="506.26" data-end="509.19">However, one use case where they were able to measure its impact</span> <span data-start="509.19" data-end="511.11">was with their Instagram embeds.</span> <span data-start="511.11" data-end="514.11">For context, Instagram embeds allow third-party sites</span> <span data-start="514.11" data-end="517.169">to display Instagram content on their own site.</span> <span data-start="517.169" data-end="519.36">As a result of serving multiple image sizes,</span> <span data-start="519.36" data-end="521.52">Instagram was able to reduce image transfer</span> <span data-start="521.52" data-end="523.95">size by 20% for their Instagram embeds.</span> </p>
<p><span data-start="528.91" data-end="532.697">Two popular tools for imagery resizing are Sharp and Jimp.</span> <span data-start="532.697" data-end="534.28">The biggest difference between the two</span> <span data-start="534.28" data-end="536.84">is that Sharp is faster, and when I say faster,</span> <span data-start="536.84" data-end="538.94">I mean faster at image processing.</span> <span data-start="538.94" data-end="542.39">However, it requires that you compile C and C++ to install</span> <span data-start="542.39" data-end="542.89">it.</span> </p>
<p><span data-start="545.82" data-end="548.55">In addition to creating multiple sizes of your images,</span> <span data-start="548.55" data-end="551.34">you'll need to update your HTML.</span> <span data-start="551.34" data-end="554.73">You'll want to add the source set and sizes attributes.</span> <span data-start="554.73" data-end="556.53">The source set attribute allows you</span> <span data-start="556.53" data-end="559.23">to list multiple versions of the same image.</span> <span data-start="559.23" data-end="561.21">In addition to including the file path,</span> <span data-start="561.21" data-end="563.737">you'll also want to include the width of the image.</span> <span data-start="563.737" data-end="566.07">This saves the browser from having to download the image</span> <span data-start="566.07" data-end="568.89">to figure out how large it is.</span> <span data-start="568.89" data-end="571.22">The size attribute tells the browser the width</span> <span data-start="571.22" data-end="573.15">that the image will be displayed at.</span> <span data-start="573.15" data-end="575.56">By using the information contained in the source set</span> <span data-start="575.56" data-end="577.95">and sizes attribute, the browser can then figure out</span> <span data-start="577.95" data-end="579.285">which image to download.</span> </p>
<p><span data-start="584.24" data-end="586.02">Lazy loading is the last image technique</span> <span data-start="586.02" data-end="588.03">that I'll be talking about today.</span> <span data-start="588.03" data-end="590.37">Lazy loading is a strategy of waiting to download</span> <span data-start="590.37" data-end="592.51">a resource until it is needed.</span> <span data-start="592.51" data-end="595.11">In addition to images, it can be applied to resource types</span> <span data-start="595.11" data-end="597.06">like JavaScript.</span> <span data-start="597.06" data-end="598.87">Image lazy loading helps performance</span> <span data-start="598.87" data-end="601.95">by using that bottleneck that occurs on initial page load.</span> <span data-start="601.95" data-end="604.47">In addition, it saves user data by not downloading</span> <span data-start="604.47" data-end="606.84">images that may never be used.</span> </p>
<p><span data-start="606.84" data-end="608.73">Spotify is an example of a website</span> <span data-start="608.73" data-end="610.92">that uses this technique very effectively.</span> <span data-start="610.92" data-end="612.889">On this particular page that I pulled up,</span> <span data-start="612.889" data-end="614.43">image lazy loading was the difference</span> <span data-start="614.43" data-end="617.4">between loading a mg of images on initial page load</span> <span data-start="617.4" data-end="620.1">and 18 mgs of an image on initial page load.</span> <span data-start="620.1" data-end="624.05">That's a huge difference.</span> <span data-start="624.05" data-end="626.66">Two tools to look into for image lazy loading</span> <span data-start="626.66" data-end="628.49">are lazysizes and lozad.</span> <span data-start="628.49" data-end="631.7">And you implement them both more or less the same way.</span> <span data-start="631.7" data-end="633.29">Add the script your site, and then</span> <span data-start="633.29" data-end="636.41">indicate which images should be lazy loaded.</span> </p>
<p><span data-start="636.41" data-end="640.01">However, just because this is a fairly simple to use technique</span> <span data-start="640.01" data-end="642.71">does not mean that's not important.</span> <span data-start="642.71" data-end="646.58">In fact, it is so important that native lazy loading</span> <span data-start="646.58" data-end="648.161">is coming to Chrome.</span> <span data-start="648.161" data-end="649.103">[APPLAUSE]</span> <span data-start="654.599" data-end="656.14">Native lazy loading means that you'll</span> <span data-start="656.14" data-end="657.88">be able to take advantage of lazy loading</span> <span data-start="657.88" data-end="660.25">without having to add third-party scripts</span> <span data-start="660.25" data-end="661.6">on your site.</span> </p>
<p><span data-start="661.6" data-end="663.34">It'll be available for both images</span> <span data-start="663.34" data-end="666.52">and cross origin I-frames.</span> <span data-start="666.52" data-end="669.79">And you can truly be lazy when it comes to implementing it.</span> <span data-start="669.79" data-end="671.68">If you make no changes to your HTML,</span> <span data-start="671.68" data-end="673.84">the browser will simply decide which resources</span> <span data-start="673.84" data-end="675.22">should be lazy loaded.</span> <span data-start="675.22" data-end="678.28">If you do care, however, you can use the lazy load attribute</span> <span data-start="678.28" data-end="680.83">to specify which attributes should or should not</span> <span data-start="680.83" data-end="681.66">be lazy loaded.</span> <span data-start="685.33" data-end="686.994">Fonts can cause performance problems</span> <span data-start="686.994" data-end="689.41">because they are typically large files that are downloaded</span> <span data-start="689.41" data-end="691.09">from third-party sites.</span> </p>
<p><span data-start="691.09" data-end="694.294">As a result, they can take a while to load.</span> <span data-start="694.294" data-end="695.71">This leads to the phenomenon known</span> <span data-start="695.71" data-end="697.69">as the flash of invisible text.</span> <span data-start="697.69" data-end="700.63">And shockingly, this affects two out of every five mobile sites.</span> </p>
<p><span data-start="703.19" data-end="705.11">Flash of invisible text looks like this.</span> <span data-start="705.11" data-end="707.53">Instead of a user being greeted with text on your site,</span> <span data-start="707.53" data-end="710.36">they're greater with invisibleness.</span> <span data-start="710.36" data-end="713.294">Not only is this frustrating, but it also looks bad.</span> <span data-start="713.294" data-end="714.71">What you want to encourage instead</span> <span data-start="714.71" data-end="717.24">is the flash of unstyled text.</span> <span data-start="717.24" data-end="719.42">And this is when the browser initially displays</span> <span data-start="719.42" data-end="722.21">text using a system font and then</span> <span data-start="722.21" data-end="725.54">swaps it out for the custom font once it has arrived.</span> </p>
<p><span data-start="725.54" data-end="729.05">The good news here is that this fix is literally a one-liner.</span> <span data-start="729.05" data-end="731.72">Everywhere in your CSS where you declare a font face,</span> <span data-start="731.72" data-end="733.94">add the line font display swap.</span> <span data-start="733.94" data-end="736.25">This tells the browser to use that swapping behavior</span> <span data-start="736.25" data-end="739.924">that I just talked about in the previous slide.</span> <span data-start="739.924" data-end="741.34">Now I'm going to hand the mic over</span> <span data-start="741.34" data-end="743.65">to Houssein who's going to talk with you about techniques</span> <span data-start="743.65" data-end="745.025">you can use with your JavaScript.</span> <span data-start="745.025" data-end="745.782">[MUSIC PLAYING]</span> </p>
</section>

<section>
<p><span data-start="753.825" data-end="755.2"><span class="speaker">Houssein Djirdeh</span>: So Katie showed</span> <span data-start="755.2" data-end="756.575">a number of techniques that could</span> <span data-start="756.575" data-end="759.93">be quite useful for the images and web fonts in your site,</span> <span data-start="759.93" data-end="763.57">as well the few exciting things coming to the Chrome platform</span> <span data-start="763.57" data-end="767.024">in the near future, like native lazy loading.</span> <span data-start="767.024" data-end="768.69">For the rest of this talk, we'll go over</span> <span data-start="768.69" data-end="770.273">some other important things you should</span> <span data-start="770.273" data-end="774.232">be doing before the JavaScript that makes up your application.</span> </p>
<p><span data-start="777.54" data-end="779.01">Earlier in this session, we saw how</span> <span data-start="779.01" data-end="782.34">images can make up the majority of a site with regards</span> <span data-start="782.34" data-end="784.75">to number of bytes sent.</span> <span data-start="784.75" data-end="786.9">However, we also send a significant amount</span> <span data-start="786.9" data-end="790.04">of JavaScript to browsers.</span> <span data-start="790.04" data-end="792.13">If we take a look at HTTP archive data</span> <span data-start="792.13" data-end="796.06">once again, as of last month, the median amount</span> <span data-start="796.06" data-end="799.27">of JavaScript that we shipped to mobile web pages</span> <span data-start="799.27" data-end="803.17">was about 370 kilobytes.</span> <span data-start="803.17" data-end="807.91">For desktop, the number was about 420.</span> <span data-start="807.91" data-end="811.78">Now JavaScript code still needs to be uncompressed, parsed,</span> <span data-start="811.78" data-end="814.34">and executed by the browser.</span> <span data-start="814.34" data-end="817.03">So in reality, we're looking at about a megabyte</span> <span data-start="817.03" data-end="820.22">of uncompressed code that needs to be sent — </span> <span data-start="820.22" data-end="823.12">that needs to be for an application of this size.</span> </p>
<p><span data-start="823.12" data-end="826.78">Users who try to access this with low-end mobile devices</span> <span data-start="826.78" data-end="829.855">will notice a much poorer performance.</span> <span data-start="832.83" data-end="835.5">But why are we, as developers, shipping way more</span> <span data-start="835.5" data-end="838.93">JavaScript code than we've ever done before?</span> <span data-start="838.93" data-end="840.4">There are a number of reasons.</span> <span data-start="840.4" data-end="842.91">One of them being the amount of dependencies</span> <span data-start="842.91" data-end="844.77">that we pull into our applications</span> <span data-start="844.77" data-end="848.88">and how easy that process has become.</span> <span data-start="848.88" data-end="851.94">Front-end tooling has come a long way in the past decade,</span> <span data-start="851.94" data-end="853.68">but there has been some cost.</span> <span data-start="857.14" data-end="859.78">So what can we do to continue to try and build</span> <span data-start="859.78" data-end="862.3">robust and fully fledged applications,</span> <span data-start="862.3" data-end="866.05">but not at the expense of user experience?</span> </p>
<p><span data-start="866.05" data-end="869.41">The very first thing we can and should consider doing is</span> <span data-start="869.41" data-end="871.51">splitting our bundle .</span> <span data-start="871.51" data-end="873.19">The idea behind code splitting is</span> <span data-start="873.19" data-end="876.19">instead of sending all the JavaScript code to your users</span> <span data-start="876.19" data-end="879.71">as soon as they load the very first page of your application,</span> <span data-start="879.71" data-end="883.25">is to only send them what they need for their initial state.</span> </p>
<p><span data-start="883.25" data-end="885.79">And then allow them to fetch future chunks on demand.</span> <span data-start="889.13" data-end="891.62">The easiest way to get started with code splitting</span> <span data-start="891.62" data-end="894.33">is by using dynamic imports.</span> <span data-start="894.33" data-end="896.18">Now dynamic imports has been supported</span> <span data-start="896.18" data-end="898.6">in Webpack for quite some time.</span> <span data-start="898.6" data-end="901.6">And it allows you to import a module asynchronously</span> <span data-start="901.6" data-end="904.4">where a promise gets returned.</span> <span data-start="904.4" data-end="906.98">Once that promise finishes resolving,</span> <span data-start="906.98" data-end="911.56">you can do what you need to do with that piece of code.</span> <span data-start="911.56" data-end="913.45">The idea behind dynamic imports is</span> <span data-start="913.45" data-end="916.21">you want to make sure that it fires on certain user</span> <span data-start="916.21" data-end="917.53">interactions.</span> </p>
<p><span data-start="917.53" data-end="920.98">And you want to do this to make sure that you only fetch code</span> <span data-start="920.98" data-end="923.89">when it's actually needed.</span> <span data-start="923.89" data-end="926.56">If you happen to be using another module bundler,</span> <span data-start="926.56" data-end="929.47">like parcel or roll up, you can still</span> <span data-start="929.47" data-end="932.84">use dynamic import to code split where you see fit.</span> <span data-start="936.51" data-end="938.99">Now, a number of JavaScript libraries and frameworks</span> <span data-start="938.99" data-end="942.44">have provided abstractions on top of dynamic imports</span> <span data-start="942.44" data-end="944.09">to make the process of code splitting</span> <span data-start="944.09" data-end="947.45">easier with your current tooling.</span> <span data-start="947.45" data-end="951.26">With view, for example, you can define async components.</span> <span data-start="951.26" data-end="953.96">And they're just functions that return a promise that</span> <span data-start="953.96" data-end="956.9">resolve to the set components.</span> <span data-start="956.9" data-end="958.97">By using that with dynamic imports,</span> <span data-start="958.97" data-end="961.16">you can attach async opponents into</span> <span data-start="961.16" data-end="963.23">your routing configurations.</span> </p>
<p><span data-start="963.23" data-end="965.51">So that only when a certain route is reached,</span> <span data-start="965.51" data-end="968.54">only then will the code and lives in that component</span> <span data-start="968.54" data-end="969.21">be fetched.</span> <span data-start="972.01" data-end="974.92">Angular has a very similar pattern.</span> <span data-start="974.92" data-end="977.8">In its router, you can use the load children attribute</span> <span data-start="977.8" data-end="979.48">and you can use it to connect a feature</span> <span data-start="979.48" data-end="983.05">module to a specific route.</span> <span data-start="983.05" data-end="986.41">With load children, you can define a dynamic import</span> <span data-start="986.41" data-end="987.28">with Ivy.</span> </p>
<p><span data-start="987.28" data-end="989.83">And Ivy's a new rendering engine that the Angular team</span> <span data-start="989.83" data-end="991.9">is working on.</span> <span data-start="991.9" data-end="995.26">When you do this approach, all the code, all the components,</span> <span data-start="995.26" data-end="997.72">all the services that live in the feature module</span> <span data-start="997.72" data-end="1000.81">will only get loaded when that route is reached.</span> <span data-start="1000.81" data-end="1003.09">In the meantime, you can use load children,</span> <span data-start="1003.09" data-end="1004.8">but you just need to use a relative file</span> <span data-start="1004.8" data-end="1006.39">path to the feature module.</span> <span data-start="1009.28" data-end="1012.07">With React, libraries like React Loadable</span> <span data-start="1012.07" data-end="1014.08">and loadable components have allowed</span> <span data-start="1014.08" data-end="1016.504">us to code split on the component level</span> <span data-start="1016.504" data-end="1017.92">while taking care of other things,</span> <span data-start="1017.92" data-end="1021.22">like showing a loading indicator, or an error state,</span> <span data-start="1021.22" data-end="1023.14">where applicable.</span> <span data-start="1023.14" data-end="1028.5">However, with React 16.6, the lazy method was introduced.</span> <span data-start="1028.5" data-end="1032.54">And this allows you to code split while using suspense.</span> </p>
<p><span data-start="1032.54" data-end="1035.26">Now suspense is a feature that the react team has been</span> <span data-start="1035.26" data-end="1037.46">working on for quite some time.</span> <span data-start="1037.46" data-end="1040.66">And it allows you to suspend how certain component trees update</span> <span data-start="1040.66" data-end="1043.119">your state or update the DOM, depending</span> <span data-start="1043.119" data-end="1045.241">on how all of its children components</span> <span data-start="1045.241" data-end="1046.24">have fetched their data.</span> </p>
<p><span data-start="1050.89" data-end="1053.637">Another very useful technique that ties in well to code</span> <span data-start="1053.637" data-end="1057.96">splitting your bundle is by using preload.</span> <span data-start="1057.96" data-end="1059.85">Preload allows us to tell the browser</span> <span data-start="1059.85" data-end="1062.82">that if we have a late discovered resource</span> <span data-start="1062.82" data-end="1066.48">or a resource that's fetched late in the request chain</span> <span data-start="1066.48" data-end="1070.77">that we'd like to download it sooner because it's important.</span> </p>
<p><span data-start="1070.77" data-end="1073.28">So by doing this, we're telling the browser to prioritize.</span> <span data-start="1076.41" data-end="1079.06">To use preload, you only need to add a link element</span> <span data-start="1079.06" data-end="1081.56">to the head of your HTML document</span> <span data-start="1081.56" data-end="1083.53">and you need to have a rel attribute</span> <span data-start="1083.53" data-end="1085.53">with a value of preload.</span> </p>
<p><span data-start="1085.53" data-end="1089.23">The as attribute is used to define what type of file</span> <span data-start="1089.23" data-end="1090.05">you'd like to load.</span> <span data-start="1094.05" data-end="1096.68">Now as developers, it's also important to make sure</span> <span data-start="1096.68" data-end="1099.02">that the code that we write works well</span> <span data-start="1099.02" data-end="1103.46">in all the browsers people use to access our site.</span> <span data-start="1103.46" data-end="1109.28">So if we happen to include ES 2015, 2016, or later syntax,</span> <span data-start="1109.28" data-end="1112.25">we also want to include backwards compatible formats</span> <span data-start="1112.25" data-end="1116.61">so all the browsers can still understand them.</span> <span data-start="1116.61" data-end="1119.61">This usually involves adding transforms for any newer syntax</span> <span data-start="1119.61" data-end="1124.33">that we use and polyfills for any newer features.</span> <span data-start="1124.33" data-end="1126.21">Now because transpiling means we're</span> <span data-start="1126.21" data-end="1128.51">adding code on top of our bundle,</span> <span data-start="1128.51" data-end="1130.199">or application ends up being larger</span> <span data-start="1130.199" data-end="1131.49">than it was originally written.</span> <span data-start="1135.32" data-end="1137.96">One way to make sure that we only transpile the code</span> <span data-start="1137.96" data-end="1142.52">that's actually needed is by using babel/preset-EMV.</span> </p>
<p><span data-start="1142.52" data-end="1145.1">This preset takes the hassle out of us</span> <span data-start="1145.1" data-end="1148.85">trying to micromanage which plugins and polyfills</span> <span data-start="1148.85" data-end="1150.33">we need to add.</span> <span data-start="1150.33" data-end="1152.75">And it does this by allowing us to specify</span> <span data-start="1152.75" data-end="1158.56">a target list of browsers and letting babel handle the rest.</span> <span data-start="1158.56" data-end="1161.25">You can add this preset into your list of presets</span> <span data-start="1161.25" data-end="1164.32">in your babel configuration, and you</span> <span data-start="1164.32" data-end="1167.92">can use the target's attributes to define that set of browsers</span> <span data-start="1167.92" data-end="1169.93">that you'd like to reach.</span> </p>
<p><span data-start="1169.93" data-end="1172.7">Now this is a browser list query.</span> <span data-start="1172.7" data-end="1175.36">So if you use tools like order auto prefix or before,</span> <span data-start="1175.36" data-end="1178.63">you may already be familiar with it.</span> <span data-start="1178.63" data-end="1181.39">Using a percentage, like here, is one type of query</span> <span data-start="1181.39" data-end="1182.44">you can use.</span> <span data-start="1182.44" data-end="1184.99">And it allows you to target browsers that cross</span> <span data-start="1184.99" data-end="1186.45">a certain global market share.</span> <span data-start="1189.45" data-end="1192.52">The use built-in attribute allows us to tell babel</span> <span data-start="1192.52" data-end="1195.58">how to handle adding polyfills.</span> <span data-start="1195.58" data-end="1198.93">The usage value means that babel only automatically</span> <span data-start="1198.93" data-end="1201.9">include polyfills to files when it's actually</span> <span data-start="1201.9" data-end="1205.82">needed for features that need to be transpiled.</span> </p>
<p><span data-start="1205.82" data-end="1210.419">Now this is the behavior we all want, to only transpile code</span> <span data-start="1210.419" data-end="1211.21">when it's required.</span> <span data-start="1216.93" data-end="1220.05">So although babel/preset-EMV means that we can limit</span> <span data-start="1220.05" data-end="1223.2">the amount of transpiled code that we have to make sure that</span> <span data-start="1223.2" data-end="1226.65">we only include what's necessary for all the browsers we plan</span> <span data-start="1226.65" data-end="1230.58">to target, what if there was a way to differentially serve two</span> <span data-start="1230.58" data-end="1232.6">different types of bundles?</span> <span data-start="1232.6" data-end="1235.11">One, that's largely un-transpiled,</span> <span data-start="1235.11" data-end="1239.1">for newer browsers that don't need nearly as many polyfills,</span> <span data-start="1239.1" data-end="1242.37">and another legacy bundle, that contains more polyfills,</span> <span data-start="1242.37" data-end="1247.06">is a bit larger, but is needed for older browsers.</span> <span data-start="1247.06" data-end="1250.78">We can do this by using JavaScript modules.</span> <span data-start="1250.78" data-end="1253.41">Now JavaScript modules or ES modules</span> <span data-start="1253.41" data-end="1256.59">allow us to write blocks of code that import and export</span> <span data-start="1256.59" data-end="1258.42">from other modules.</span> </p>
<p><span data-start="1258.42" data-end="1260.7">But the amazing thing about using modules with</span> <span data-start="1260.7" data-end="1264.69">babel/present-EMV is that we can have it as a target,</span> <span data-start="1264.69" data-end="1269.35">instead of a specific browser query.</span> <span data-start="1269.35" data-end="1273.46">One site that's actually using this module approach today</span> <span data-start="1273.46" data-end="1275.219">is "The New York Times."</span> <span data-start="1275.219" data-end="1277.51">And they're using it for one of their flagship articles</span> <span data-start="1277.51" data-end="1282.99">of the year, piling in real time for the 2018 midterm elections.</span> <span data-start="1282.99" data-end="1285.9">They're using Sapper as their client-side framework, which</span> <span data-start="1285.9" data-end="1288.78">contains a number of progressive enhancements baked in,</span> <span data-start="1288.78" data-end="1290.85">like automatic code splitting.</span> <span data-start="1290.85" data-end="1295.82">But they're also using roll up to emit module chunks as well.</span> <span data-start="1295.82" data-end="1297.68">They're using a fairly simple heuristic</span> <span data-start="1297.68" data-end="1301.61">to make sure that users who have older browsers download</span> <span data-start="1301.61" data-end="1304.55">a larger more polyfilled bundle, but users who</span> <span data-start="1304.55" data-end="1306.74">are using newer browsers can only download</span> <span data-start="1306.74" data-end="1308.75">smaller and slimmer module.</span> </p>
<p><span data-start="1313.11" data-end="1316.16">A very simple way to make sure that users</span> <span data-start="1316.16" data-end="1319.37">who access your app only download one or the other</span> <span data-start="1319.37" data-end="1323.68">is by using the module, no module technique.</span> <span data-start="1323.68" data-end="1326.89">When you define a script element with type module,</span> <span data-start="1326.89" data-end="1331.02">browsers that understand modules will download that normally.</span> <span data-start="1331.02" data-end="1333.7">But they'll know to ignore any script element that</span> <span data-start="1333.7" data-end="1336.98">has the no module attribute.</span> </p>
<p><span data-start="1336.98" data-end="1340.7">Similarly, browsers that don't understand modules</span> <span data-start="1340.7" data-end="1344.57">will ignore any script elements that have type module.</span> <span data-start="1344.57" data-end="1347.48">But since they can't identify what no module means,</span> <span data-start="1347.48" data-end="1350.34">they'll download that bundle as well.</span> <span data-start="1350.34" data-end="1352.64">So here, we can get the best of both worlds.</span> <span data-start="1352.64" data-end="1354.96">Shipping the right bundle to our users,</span> <span data-start="1354.96" data-end="1356.99">depending on what browser they use.</span> <span data-start="1361.29" data-end="1363.68">If you happen to have critical modules that you'd</span> <span data-start="1363.68" data-end="1365.94">like to download sooner, you could do that</span> <span data-start="1365.94" data-end="1368.93">by also preloading them as well.</span> </p>
<p><span data-start="1368.93" data-end="1372.03">And you just need to specify a module preload value</span> <span data-start="1372.03" data-end="1373.468">to the rel attribute.</span> <span data-start="1376.574" data-end="1377.99">So we've talked about a few things</span> <span data-start="1377.99" data-end="1382.37">you can do to improve the code that you ship to your users,</span> <span data-start="1382.37" data-end="1385.28">but if you're thinking of adding any of these optimizations,</span> <span data-start="1385.28" data-end="1388.519">it could be useful to try and keep an eye on things.</span> <span data-start="1388.519" data-end="1390.56">And there are tools out there that could actually</span> <span data-start="1390.56" data-end="1392.81">make this easier.</span> <span data-start="1392.81" data-end="1395.99">The code coverage tab within Chrome DevTools</span> <span data-start="1395.99" data-end="1398.9">allows you to see the size of all your bundles,</span> <span data-start="1398.9" data-end="1403.06">as well as how much of it is actually being used.</span> <span data-start="1403.06" data-end="1405.55">You can access it by opening the Command menu</span> <span data-start="1405.55" data-end="1407.606">and just typing in coverage.</span> <span data-start="1410.87" data-end="1413.87">If you're using Webpack, Webpack bundle analyzer</span> <span data-start="1413.87" data-end="1416.28">can be a very handy tool.</span> <span data-start="1416.28" data-end="1418.88">And it gives you a nice heat map visualization</span> <span data-start="1418.88" data-end="1420.47">of your entire bundle.</span> </p>
<p><span data-start="1420.47" data-end="1423.68">You can zoom in, see which parts of your bundle are larger</span> <span data-start="1423.68" data-end="1425.54">and which parts of your bundle are smaller.</span> <span data-start="1429.89" data-end="1431.33">And if you've ever wanted to find</span> <span data-start="1431.33" data-end="1435.8">the cost of a specific library, you can use bundle phobia.</span> <span data-start="1435.8" data-end="1438.11">You could type the name of a package</span> <span data-start="1438.11" data-end="1441.71">and see how large it is, as well as how much of an impact</span> <span data-start="1441.71" data-end="1446.18">it can make to your application in terms of download time.</span> <span data-start="1446.18" data-end="1449">You can also scan your packages on file</span> <span data-start="1449" data-end="1451.97">to see how much of an impact all your packages make.</span> <span data-start="1456.76" data-end="1460.18">Now as useful as it is to use tools to manually keep</span> <span data-start="1460.18" data-end="1463.18">an eye on how things are doing with your bundle size,</span> <span data-start="1463.18" data-end="1466.51">it can be especially useful to also include checks into your</span> <span data-start="1466.51" data-end="1468.46">build workflow.</span> <span data-start="1468.46" data-end="1470.14">One tool that could actually help here,</span> <span data-start="1470.14" data-end="1472.77">that can allow you to set performance budgets,</span> <span data-start="1472.77" data-end="1474.92">is the Lighthouse CI.</span> </p>
<p><span data-start="1474.92" data-end="1478.36">So instead of only running a Lighthouse in the Chrome audits</span> <span data-start="1478.36" data-end="1481.12">panel, or as a Chrome extension, you</span> <span data-start="1481.12" data-end="1484.18">can also run Lighthouse in CI and have</span> <span data-start="1484.18" data-end="1488.03">it included as a status check into your workflow.</span> <span data-start="1488.03" data-end="1491.05">You could specify certain Lighthouse categories and set</span> <span data-start="1491.05" data-end="1494.92">scores for them so that merges and pull requests only</span> <span data-start="1494.92" data-end="1497.44">get included if those scores are met.</span> <span data-start="1501.94" data-end="1503.76">Now a site that's actually taking steps</span> <span data-start="1503.76" data-end="1507.25">to add a number of these optimizations is UniQlo.</span> <span data-start="1507.25" data-end="1509.62">They're a clothing retailer base out of Japan.</span> <span data-start="1509.62" data-end="1512.25">And they're taking steps to improve their entire web</span> <span data-start="1512.25" data-end="1516.6">architecture, beginning with their Canadian site.</span> <span data-start="1516.6" data-end="1519.45">They've identified a number of critical resources</span> <span data-start="1519.45" data-end="1522.42">and decided to try and download them sooner,</span> <span data-start="1522.42" data-end="1524.73">and they're doing this by preloading them.</span> <span data-start="1524.73" data-end="1526.2">They've done this with some images,</span> <span data-start="1526.2" data-end="1531.26">some core fonts, as well as a number of cross origin fetches.</span> </p>
<p><span data-start="1531.26" data-end="1532.94">They then also identified that they</span> <span data-start="1532.94" data-end="1537.81">can code split and try to get some wins that way as well.</span> <span data-start="1537.81" data-end="1540.32">They took the correct first step of code splitting</span> <span data-start="1540.32" data-end="1541.79">at the route level.</span> <span data-start="1541.79" data-end="1543.64">And just by doing that alone, they</span> <span data-start="1543.64" data-end="1548.39">noticed an almost half size reduction in their bundle size.</span> <span data-start="1548.39" data-end="1551.6">They also moved on to code split their localization package.</span> <span data-start="1551.6" data-end="1553.79">And noticed that they can get their bundle size down</span> <span data-start="1553.79" data-end="1556.11">to 200 kilobytes.</span> <span data-start="1556.11" data-end="1558.9">After this, they even added more optimizations,</span> <span data-start="1558.9" data-end="1560.88">such as using a pre-act compatibility</span> <span data-start="1560.88" data-end="1563.97">layer for the react bindings, to get their bundle size</span> <span data-start="1563.97" data-end="1566.117">to about 170 kilobytes.</span> </p>
<p><span data-start="1569.664" data-end="1571.08">While doing all of this, they made</span> <span data-start="1571.08" data-end="1574.02">sure to also set budgets so their whole team can</span> <span data-start="1574.02" data-end="1575.48">stay in sync.</span> <span data-start="1575.48" data-end="1577.82">And they're using another open source tool to help here,</span> <span data-start="1577.82" data-end="1580.02">called Bundle Size.</span> <span data-start="1580.02" data-end="1583.54">They've set 80 kilobyte budgets for each one of the chunks,</span> <span data-start="1583.54" data-end="1586.92">and then allowed them to stay under a 200 kilobyte total</span> <span data-start="1586.92" data-end="1588.48">for all of their scripts.</span> <span data-start="1593.566" data-end="1594.94">While adding these optimizations,</span> <span data-start="1594.94" data-end="1598.45">they noticed a two-second time to interactive reduction</span> <span data-start="1598.45" data-end="1601.21">for users that use low-end mobile devices</span> <span data-start="1601.21" data-end="1603.28">and have weak connections.</span> </p>
<p><span data-start="1603.28" data-end="1606.56">Now you might think two seconds is not that much.</span> <span data-start="1606.56" data-end="1611.09">But it can make an impact for your customers.</span> <span data-start="1611.09" data-end="1612.86">After these optimizations were added,</span> <span data-start="1612.86" data-end="1616.79">they notice a 14% reduction in bounce rate,</span> <span data-start="1616.79" data-end="1620.39">a 31% increase in average duration,</span> <span data-start="1620.39" data-end="1624.98">and a 25% increase in pages viewed per session.</span> <span data-start="1624.98" data-end="1626.66">Now there were other things also being</span> <span data-start="1626.66" data-end="1629.09">added to the site at the same time,</span> <span data-start="1629.09" data-end="1632.3">but they know that performance played a very huge factor here.</span> <span data-start="1638.07" data-end="1639.84">So we've talked about quite a few things</span> <span data-start="1639.84" data-end="1644.32">that you can do today to improve how your site performs.</span> <span data-start="1644.32" data-end="1648.45">But what can Chrome do as a browser as well?</span> <span data-start="1648.45" data-end="1651.87">For users that opt in to Data Saver mode,</span> </p>
<p><span data-start="1651.87" data-end="1655.26">Chrome will try show a lightweight version of the page</span> <span data-start="1655.26" data-end="1656.73">where possible.</span> <span data-start="1656.73" data-end="1659.46">And it does this by minimizing data used</span> <span data-start="1659.46" data-end="1663.74">as well as showing cache content whenever it can.</span> <span data-start="1663.74" data-end="1667.31">Now as developers, you can also tap into this as well.</span> <span data-start="1667.31" data-end="1672.18">And you could do this by using the network information API.</span> <span data-start="1672.18" data-end="1674.49">If you look at the navigator connection save data</span> <span data-start="1674.49" data-end="1677.88">attribute you can identify whether your users actually</span> <span data-start="1677.88" data-end="1679.58">have data saver enabled.</span> <span data-start="1679.58" data-end="1682.32">And you could try and serve a slightly different experience</span> <span data-start="1682.32" data-end="1686.82">to make sure things are fast for them as well.</span> <span data-start="1686.82" data-end="1689.99">You can also use the effective type attribute,</span> <span data-start="1689.99" data-end="1693.65">and use that to actually be able to serve different assets</span> <span data-start="1693.65" data-end="1697.58">conditionally depending on what connection your user is having.</span> </p>
<p><span data-start="1701.81" data-end="1703.82">The very last thing that I do want to mention</span> <span data-start="1703.82" data-end="1705.68">is although me and Katie have talked</span> <span data-start="1705.68" data-end="1707.1">about a lot of the things that you</span> <span data-start="1707.1" data-end="1710.97">can do to improve your site, every application</span> <span data-start="1710.97" data-end="1712.66">is built differently.</span> <span data-start="1712.66" data-end="1714.29">Every team is different.</span> <span data-start="1714.29" data-end="1716.112">Every tool chain is different.</span> <span data-start="1716.112" data-end="1717.82">So this isn't something you need to start</span> <span data-start="1717.82" data-end="1721.48">doing wholesale and including everything at once.</span> <span data-start="1721.48" data-end="1724.28">By setting budgets and keeping an eye on your bundle size</span> <span data-start="1724.28" data-end="1727.42">from the very beginning, you can include performance</span> <span data-start="1727.42" data-end="1730.6">enhancements as a step by step procedure</span> <span data-start="1730.6" data-end="1733.06">and make sure your site never regresses.</span> </p>
<p><span data-start="1733.06" data-end="1736.007">Performance doesn't need to be an afterthought.</span> <span data-start="1739.21" data-end="1742.66">Almost everything we've talked about is in web.dev,</span> <span data-start="1742.66" data-end="1746.32">so I highly suggest you take a look if you haven't already.</span> <span data-start="1746.32" data-end="1749.11">We hope you enjoyed this talk as much as we enjoyed giving it.</span> <span data-start="1749.11" data-end="1749.92">Thank you.</span> <span data-start="1749.92" data-end="1752.07">[MUSIC PLAYING]</span> </p>
</section>