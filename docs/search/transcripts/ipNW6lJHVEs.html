<section>
<p><span data-start="0" data-end="2.465">[MUSIC PLAYING]</span> </p>
</section>

<section>
<p><span data-start="6.42" data-end="9.84"><span class="speaker">Mariko Kosaka</span>: Let's go back to February 1993</span> <span data-start="9.84" data-end="13.68">on www-talk mailing list.</span> </p>
</section>

<section>
<p><span data-start="13.68" data-end="15.84"><span class="speaker">Jake Archibald</span>: This man, Marc Andreessen,</span> <span data-start="15.84" data-end="19.5">he's the creator of Mosaic, one of the earliest web browsers.</span> <span data-start="19.5" data-end="21.36">He wrote this.</span> <span data-start="21.36" data-end="26.02">"I'd like to propose a new optional HTML tag, IMG."</span> </p>
</section>

<section>
<p><span data-start="29.98" data-end="32.53"><span class="speaker">Mariko Kosaka</span>: And this man replied, Sir Tim Berners-Lee,</span> <span data-start="32.53" data-end="44.44">he wrote, "Or how about ENTITY, ICON6, SYSTEM, URL, &ICON6."</span> <span data-start="44.44" data-end="46.15">[CHUCKLES]</span> </p>
</section>

<section>
<p><span data-start="46.15" data-end="50.06"><span class="speaker">Jake Archibald</span>: And Marc replied, "Quick, Tim, look over</span> <span data-start="50.06" data-end="50.56">there."</span> <span data-start="50.56" data-end="52.91">And two months later, Mosaic shipped with the IMG tag.</span> <span data-start="52.91" data-end="53.537">[LAUGHTER]</span> </p>
</section>

<section>
<p><span data-start="53.537" data-end="55.12"><span class="speaker">Mariko Kosaka</span>: It's really fair to say</span> <span data-start="55.12" data-end="58.69">that IMG has been pretty popular on the web for the past 25</span> <span data-start="58.69" data-end="59.367">years, right?</span> </p>
</section>

<section>
<p><span data-start="59.367" data-end="60.2"><span class="speaker">Jake Archibald</span>: Yes.</span> </p>
</section>

<section>
<p><span data-start="60.2" data-end="62.283"><span class="speaker">Mariko Kosaka</span>: In fact, according to HTTP Archive,</span> <span data-start="62.283" data-end="67">the average web page loads 650 kilobytes of images.</span> <span data-start="67" data-end="69.615">That means it's 52% of page content.</span> </p>
</section>

<section>
<p><span data-start="69.615" data-end="70.49"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="70.49" data-end="72.07">And images are less blocking compared</span> <span data-start="72.07" data-end="73.75">to things like CSS and scripts.</span> <span data-start="73.75" data-end="76.72">But they can take bandwidth away from more important things.</span> <span data-start="76.72" data-end="79.33">And of course, if the image is your primary content,</span> <span data-start="79.33" data-end="81.1">loading it quickly is very important.</span> </p>
</section>

<section>
<p><span data-start="81.1" data-end="81.933"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="81.933" data-end="84.19">Unfortunately, websites throw those bytes away</span> <span data-start="84.19" data-end="87.07">by using really inefficient codec like the one that</span> <span data-start="87.07" data-end="88.142">comes with Photoshop.</span> </p>
</section>

<section>
<p><span data-start="88.142" data-end="90.35"><span class="speaker">Jake Archibald</span>: And there are better options as well.</span> <span data-start="90.35" data-end="93.25">So this is mozjpeg from Mozilla.</span> <span data-start="93.25" data-end="96.019">But there is also WebP, which is probably</span> <span data-start="96.019" data-end="97.81">supported by the majority of your visitors.</span> <span data-start="97.81" data-end="100.544">As you can see, that WebP has beaten mozjpeg.</span> <span data-start="100.544" data-end="102.46">But both of them have done really, really well</span> <span data-start="102.46" data-end="105.097">compared to Photoshop's JPEG encoder.</span> </p>
</section>

<section>
<p><span data-start="105.097" data-end="105.93"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="105.93" data-end="111">But except you can't really see it.</span> <span data-start="111" data-end="113.05">All you can see is some text and numbers.</span> <span data-start="113.05" data-end="116.41">And these [? come-online ?] tools are great for batch</span> <span data-start="116.41" data-end="119.11">processing and automating your build process and everything.</span> <span data-start="119.11" data-end="121.39">But when you are trying to build a site</span> <span data-start="121.39" data-end="122.95">and trying to choose something, it's</span> <span data-start="122.95" data-end="126.4">really not a good experience to change the option.</span> <span data-start="126.4" data-end="129.4">Because you can't really see the effects of the image while</span> <span data-start="129.4" data-end="130.66">you are doing it.</span> </p>
<p><span data-start="130.66" data-end="134.38">So a lot of innovative, small compressions</span> <span data-start="134.38" data-end="136.355">are hidden behind these texts.</span> </p>
</section>

<section>
<p><span data-start="136.355" data-end="137.23"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="137.23" data-end="139.21">And this winds me up every time I see a new image</span> <span data-start="139.21" data-end="139.93">format come out.</span> <span data-start="139.93" data-end="141.43">Because you get these really bold</span> <span data-start="141.43" data-end="143.38">claims in a few sample images.</span> </p>
<p><span data-start="143.38" data-end="146.09">And I'm left feeling, I don't believe you.</span> <span data-start="146.09" data-end="147.97">I don't believe you unless I can try it</span> <span data-start="147.97" data-end="149.77">in an easy way using my own images, not</span> <span data-start="149.77" data-end="151">cherry-picked examples.</span> <span data-start="151" data-end="153.37">So we thought, let's make image compression easy</span> <span data-start="153.37" data-end="155.897">using the world's most accessible GUI, the web.</span> </p>
</section>

<section>
<p><span data-start="155.897" data-end="156.73"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="156.73" data-end="158.4">So that's what we did.</span> <span data-start="158.4" data-end="160.65">I'm really excited for this slide.</span> <span data-start="160.65" data-end="163.56">Because I get to do this announcements of the product</span> <span data-start="163.56" data-end="164.17">thing.</span> </p>
<p><span data-start="164.17" data-end="165.28">Well, here we go.</span> <span data-start="165.28" data-end="169.9">Today, we are excited to announce new progressive web</span> <span data-start="169.9" data-end="171.45">app, Squoosh.</span> </p>
</section>

<section>
<p><span data-start="171.45" data-end="172.48"><span class="speaker">Jake Archibald</span>: Yay.</span> <span data-start="172.48" data-end="173.57">OK, fair enough.</span> </p>
</section>

<section>
<p><span data-start="173.57" data-end="174.3"><span class="speaker">Mariko Kosaka</span>: Did you like that animation?</span> </p>
</section>

<section>
<p><span data-start="174.3" data-end="175.72"><span class="speaker">Jake Archibald</span>: It was a beautiful animation.</span> <span data-start="175.72" data-end="176.28">Well done.</span> </p>
</section>

<section>
<p><span data-start="176.28" data-end="176.62"><span class="speaker">Mariko Kosaka</span>: Thank you.</span> </p>
</section>

<section>
<p><span data-start="176.62" data-end="178.578"><span class="speaker">Jake Archibald</span>: So now the most terrifying part</span> <span data-start="178.578" data-end="181.93">of any presentation, we are going to give a live demo a go.</span> <span data-start="181.93" data-end="184.91">And with the big web quiz failing earlier,</span> <span data-start="184.91" data-end="186.16">luck isn't on our side.</span> <span data-start="186.16" data-end="189.04">Actually, so with the big web quiz stuff,</span> <span data-start="189.04" data-end="191.2">I had noticed some of the answers changing</span> <span data-start="191.2" data-end="194.47">from underneath me as I was correcting them and editing</span> <span data-start="194.47" data-end="195.34">them yesterday.</span> </p>
<p><span data-start="195.34" data-end="198.1">And when that happened, I thought, well,</span> <span data-start="198.1" data-end="199.72">what could have happened here?</span> <span data-start="199.72" data-end="201.97">Could Surma have coded it wrong?</span> <span data-start="201.97" data-end="204.78">Or am I so jet lagged I don't really know what's going on?</span> <span data-start="204.78" data-end="205.94">And I went for that one.</span> </p>
<p><span data-start="205.94" data-end="207.94">I just didn't believe Surma could have done it wrong.</span> <span data-start="207.94" data-end="208.84">OK, are you ready to go?</span> </p>
</section>

<section>
<p><span data-start="208.84" data-end="209.673"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> </p>
</section>

<section>
<p><span data-start="209.673" data-end="211.404"><span class="speaker">Jake Archibald</span>: OK.</span> <span data-start="211.404" data-end="212.32">It's going to be fine.</span> <span data-start="212.32" data-end="213.53">So this is Squoosh.</span> <span data-start="213.53" data-end="214.6">This is squoosh.app.</span> <span data-start="214.6" data-end="216.94">So all we need now is an image to compress.</span> <span data-start="216.94" data-end="220.3">And there are some example ones along the bottom here.</span> <span data-start="220.3" data-end="222.52">But let's pick a real-world example.</span> </p>
<p><span data-start="222.52" data-end="224.319">I'm going to go to the Google I/O website.</span> <span data-start="224.319" data-end="225.61">This is the one from this year.</span> <span data-start="225.61" data-end="230.94">Now that header image there is a massive 1.7 megabytes.</span> <span data-start="230.94" data-end="233.68">And that is a large portion of the page weight here.</span> <span data-start="233.68" data-end="235.72">So I'm going to save that image, and we're</span> <span data-start="235.72" data-end="237.4">going to drag it into Squoosh.</span> <span data-start="237.4" data-end="239.39">With Squoosh, it supports the file picker.</span> <span data-start="239.39" data-end="241.474">It supports copy and paste.</span> <span data-start="241.474" data-end="243.64">In this case, we're just going to use drag and drop.</span> <span data-start="243.64" data-end="244.481">There we go.</span> <span data-start="244.481" data-end="245.98">So on the left-hand side here, we've</span> <span data-start="245.98" data-end="247.82">got the original 1.7 megabyte image.</span> <span data-start="247.82" data-end="250.76">And on the right-hand side, we've got mozjpeg.</span> <span data-start="250.76" data-end="252.52">As you can see straight away, mozjpeg</span> <span data-start="252.52" data-end="256.089">has taken it from 1.7 megabytes to 500k.</span> </p>
<p><span data-start="256.089" data-end="257.279">That's huge.</span> <span data-start="257.279" data-end="259.269">And to my eyes, I can't really see</span> <span data-start="259.269" data-end="261.85">a difference between the two.</span> <span data-start="261.85" data-end="265">If we zoom right in to the folks on the screen here,</span> <span data-start="265" data-end="267.37">we can start to see the difference.</span> <span data-start="267.37" data-end="268.87">If we drag from side to side —  there</span> <span data-start="268.87" data-end="270.694">you go —  slight difference.</span> <span data-start="270.694" data-end="272.11">But it's not going to be displayed</span> <span data-start="272.11" data-end="273.151">like this on the website.</span> <span data-start="273.151" data-end="275.65">It's displayed zoomed out, and you can't see a difference.</span> <span data-start="275.65" data-end="277.35">All this is a —  this kind of interface,</span> <span data-start="277.35" data-end="280.492">this works with touch events and stuff as well.</span> </p>
<p><span data-start="280.492" data-end="281.95">You can touch the screen and do it.</span> <span data-start="281.95" data-end="283.57">So it works great on a Chromebook.</span> <span data-start="283.57" data-end="286.61">I was paid to say that, but it is, nonetheless, true.</span> <span data-start="286.61" data-end="288.9">[LAUGHTER]</span> <span data-start="288.9" data-end="290.5">But because it's displayed for these — </span> <span data-start="290.5" data-end="292.66">it's optimized for high-resolution screens,</span> <span data-start="292.66" data-end="295.09">this big image, well, we can tweak the settings</span> <span data-start="295.09" data-end="295.76">based on that.</span> <span data-start="295.76" data-end="299.92">So we're going to bring the quality down to 44, obviously,</span> <span data-start="299.92" data-end="302.104">one that we rehearsed.</span> <span data-start="302.104" data-end="303.52">And that's just because it's going</span> <span data-start="303.52" data-end="305.68">to be resize down like that.</span> <span data-start="305.68" data-end="307.54">And we can't really go lower than 44,</span> <span data-start="307.54" data-end="310.16">because it starts picking up banding issues, especially</span> <span data-start="310.16" data-end="311.77">around the sky bit there.</span> <span data-start="311.77" data-end="313.62">But we've really dropped the file size.</span> </p>
<p><span data-start="313.62" data-end="315.85">It's almost another 200k gone.</span> <span data-start="315.85" data-end="318.49">Now, lossy formats, they work by removing data</span> <span data-start="318.49" data-end="320.95">that humans aren't very good at seeing anyway.</span> <span data-start="320.95" data-end="324.1">So for instance, we're more sensitive to changes</span> <span data-start="324.1" data-end="326.12">in brightness than changes in color.</span> <span data-start="326.12" data-end="328.63">So these lossy formats, they'll store color data</span> <span data-start="328.63" data-end="332.069">at a lower resolution than the brightness data.</span> <span data-start="332.069" data-end="334.36">But again, since this is aimed at high-density screens,</span> <span data-start="334.36" data-end="335.69">we can go even lower.</span> <span data-start="335.69" data-end="338.56">So we're going to dive into these advanced settings here.</span> <span data-start="338.56" data-end="342.82">We tried to expose everything that these codecs can do.</span> <span data-start="342.82" data-end="346.55">So there are some scary things here like trellis multipass.</span> <span data-start="346.55" data-end="347.6">What does that do?</span> <span data-start="347.6" data-end="349.12">Well, I have absolutely no idea.</span> <span data-start="349.12" data-end="350.17">But I can check this.</span> <span data-start="350.17" data-end="351.782">I can see the impact of it.</span> </p>
<p><span data-start="351.782" data-end="353.24">It's really cheap for me to try it.</span> <span data-start="353.24" data-end="353.8">I'm not breaking anything.</span> </p>
</section>

<section>
<p><span data-start="353.8" data-end="353.95"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="353.95" data-end="355.75">The great thing about having UI is that you</span> <span data-start="355.75" data-end="357.315">can see it right here, right?</span> <span data-start="357.315" data-end="359.19">And you can figure that out, like, toggle it.</span> </p>
</section>

<section>
<p><span data-start="359.19" data-end="359.3"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="359.3" data-end="359.85">You can start to learn what they do.</span> </p>
</section>

<section>
<p><span data-start="359.85" data-end="360.7"><span class="speaker">Mariko Kosaka</span>: And if it's [? a come-online ?] tool,</span> <span data-start="360.7" data-end="363.53">you can't really see until you're finished, right?</span> </p>
</section>

<section>
<p><span data-start="363.53" data-end="364.21"><span class="speaker">Jake Archibald</span>: Absolutely, and one</span> <span data-start="364.21" data-end="365.2">of the options we are going to look at</span> <span data-start="365.2" data-end="366.66">is the auto-subsample chroma.</span> <span data-start="366.66" data-end="368.66">This is the thing that's changing the resolution</span> <span data-start="368.66" data-end="369.94">of the color data.</span> <span data-start="369.94" data-end="372.84">By default, it halves it, but we're going to quarter it.</span> <span data-start="372.84" data-end="374.87">And that's another 20k gone as well.</span> <span data-start="374.87" data-end="379.45">So we've now reduced it by 83% of the original that</span> <span data-start="379.45" data-end="381.52">is on the I/O website.</span> <span data-start="381.52" data-end="385.24">If we zoom right in, it's looking like a bit of a mess.</span> <span data-start="385.24" data-end="386.99">You can really see the difference there.</span> </p>
<p><span data-start="386.99" data-end="390.31">But again, zoomed out, which is how it's displayed on the site,</span> <span data-start="390.31" data-end="391.46">it's really different.</span> <span data-start="391.46" data-end="394.81">It's really difficult to tell the difference.</span> <span data-start="394.81" data-end="397.39">Mozilla have done an amazing job at getting the most out</span> <span data-start="397.39" data-end="399.34">of an old image format like JPEG.</span> <span data-start="399.34" data-end="400.61">But let's compare it to WebP.</span> <span data-start="400.61" data-end="403.78">So on the left-hand side, we're going to switch to WebP.</span> <span data-start="403.78" data-end="406.98">And we'll drop the quality down to 20.</span> <span data-start="406.98" data-end="409.18">WebP is a much more modern image format.</span> <span data-start="409.18" data-end="411.42">It's based on the VP8 video codec.</span> </p>
<p><span data-start="411.42" data-end="412.84">It's supported in Chrome.</span> <span data-start="412.84" data-end="416.23">It's coming to Edge 18, Firefox 65.</span> <span data-start="416.23" data-end="417.537">But straight off now, we'll — </span> <span data-start="417.537" data-end="418.87">we're going to be around about — </span> </p>
</section>

<section>
<p><span data-start="418.87" data-end="419.285"><span class="speaker">Mariko Kosaka</span>: Sorry.</span> <span data-start="419.285" data-end="419.7">Sorry.</span> <span data-start="419.7" data-end="420.12">[INAUDIBLE]</span> <span data-start="420.12" data-end="420.29">Yes.</span> </p>
</section>

<section>
<p><span data-start="420.29" data-end="421.498"><span class="speaker">Jake Archibald</span>: There we go — </span> <span data-start="421.498" data-end="424.07">about another 100k less than the JPEG.</span> <span data-start="424.07" data-end="427">That's 1/10 of the size of the original.</span> <span data-start="427" data-end="429.267">If we zoom into those people on the screen again,</span> <span data-start="429.267" data-end="431.35">we can start to see the difference between the two</span> <span data-start="431.35" data-end="432.47">codecs.</span> </p>
<p><span data-start="432.47" data-end="436">JPEG goes for a very blocky look, whereas WebP loses</span> <span data-start="436" data-end="438.09">details through smoothing.</span> <span data-start="438.09" data-end="440.02">In fact, the WebP, at this size, kind of</span> <span data-start="440.02" data-end="442.749">looks in some ways worse than the JPEG.</span> <span data-start="442.749" data-end="443.29">I don't know.</span> <span data-start="443.29" data-end="444.064">It's subjective.</span> <span data-start="444.064" data-end="445.48">But that's also because we've been</span> <span data-start="445.48" data-end="447.07">able to drop the quality of the WebP</span> <span data-start="447.07" data-end="449.41">a lot more because it doesn't suffer from those banding</span> <span data-start="449.41" data-end="451.48">issues that we get with JPEG.</span> </p>
<p><span data-start="451.48" data-end="454.931">And again zoomed out, there's barely a difference.</span> <span data-start="454.931" data-end="457.18">So now we've done that, we can download the two images</span> <span data-start="457.18" data-end="459.94">and hopefully send them to the people who on the I/O site</span> <span data-start="459.94" data-end="463.54">because that's 1.4 megabytes saved for every visitor that</span> <span data-start="463.54" data-end="466.72">supports WebP, 1.3 megabytes saved for people</span> <span data-start="466.72" data-end="469.03">who like to support JPEG.</span> </p>
<p><span data-start="469.03" data-end="471.25">So that's lossy compression.</span> <span data-start="471.25" data-end="474.18">But we support lossless compression as well.</span> <span data-start="474.18" data-end="477.13">The Squoosh logo here, this is an SVG.</span> <span data-start="477.13" data-end="478.81">Vector formats are great because they're</span> <span data-start="478.81" data-end="483.307">maximum resolution on any device density, any size.</span> </p>
<p><span data-start="483.307" data-end="485.14">But it's worth looking at how this comes out</span> <span data-start="485.14" data-end="487.57">in a nonvector format.</span> <span data-start="487.57" data-end="488.62">This looks a bit broken.</span> <span data-start="488.62" data-end="490.3">This is because we're using JPEG, which</span> <span data-start="490.3" data-end="491.77">doesn't support transparency.</span> </p>
<p><span data-start="491.77" data-end="493.97">So we'll change to another format.</span> <span data-start="493.97" data-end="499.52">We'll change to OptiPNG, which is an optimized PNG format.</span> <span data-start="499.52" data-end="501.52">Once we do that, it's bigger.</span> <span data-start="501.52" data-end="503.86">It's over twice the size, which is not great.</span> <span data-start="503.86" data-end="506.809">But we can optimize for these kind of codecs.</span> <span data-start="506.809" data-end="508.35">So we're going to reduce the palette.</span> <span data-start="508.35" data-end="512.71">We're going to bring it down to, I don't know, 70 colors.</span> <span data-start="512.71" data-end="515.36">And we can turn off differing because we're happy with just</span> <span data-start="515.36" data-end="516.96">a flat color there.</span> <span data-start="516.96" data-end="519.94">And once we do that, we are now smaller</span> <span data-start="519.94" data-end="522.419">with the PNG versus the SVG.</span> </p>
<p><span data-start="522.419" data-end="524.59">It's just a few K. If we zoom right</span> <span data-start="524.59" data-end="529.33">in, we can start to see, I don't know, very subtle differences.</span> <span data-start="529.33" data-end="533.48">But zoomed out, it's not a big deal at all.</span> <span data-start="533.48" data-end="535.37">But let's throw this at WebP's lossless mode.</span> <span data-start="535.37" data-end="536.828">So we're going to copy the settings</span> <span data-start="536.828" data-end="540.11">from one site to the other so we keep the reduced palette data,</span> <span data-start="540.11" data-end="543.59">switch to WebP, and put it in lossless mode.</span> </p>
<p><span data-start="543.59" data-end="546.5">So WebP's lossless codec, it's kind</span> <span data-start="546.5" data-end="548.079">of like a completely different codec.</span> <span data-start="548.079" data-end="550.37">They should have probably called it something different</span> <span data-start="550.37" data-end="552.574">because it's much more similar to PNG.</span> <span data-start="552.574" data-end="554.99">But now you can see we've cut even more off the file size.</span> <span data-start="554.99" data-end="559.34">We're 34% smaller than what we were with the PNG,</span> <span data-start="559.34" data-end="561.26">with the SVG even.</span> </p>
<p><span data-start="561.26" data-end="564.95">But this is yet another cherry-picked demo.</span> <span data-start="564.95" data-end="568.65">Like, we have scripted this to look good on stage, right?</span> <span data-start="568.65" data-end="570.17">What I am saying to you right now</span> <span data-start="570.17" data-end="574.22">is literally written on this screen, including that,</span> <span data-start="574.22" data-end="578.72">and that, and that, and this.</span> </p>
</section>

<section>
<p><span data-start="578.72" data-end="579.95"><span class="speaker">Mariko Kosaka</span>: Excuse me.</span> <span data-start="579.95" data-end="581.7">[LAUGHTER]</span> <span data-start="581.7" data-end="583.55">Yeah, well, but all we are saying</span> <span data-start="583.55" data-end="585.14">is that, just don't trust our demo.</span> </p>
<p><span data-start="585.14" data-end="588.86">Just go to our app, throw your own image, and try it out.</span> <span data-start="588.86" data-end="592.07">And see how many bytes you can shave off the image</span> <span data-start="592.07" data-end="594.891">by keeping acceptable quality.</span> <span data-start="594.891" data-end="596.39">So we can go back to the slides now.</span> </p>
</section>

<section>
<p><span data-start="601.604" data-end="602.395"><span class="speaker">Jake Archibald</span>: OK.</span> <span data-start="602.395" data-end="604.36">So that's the good parts.</span> <span data-start="604.36" data-end="606.24">But Squoosh is still in beta.</span> <span data-start="606.24" data-end="607.3">It isn't finished yet.</span> <span data-start="607.3" data-end="609.81">There are —  there's a few rough edges.</span> <span data-start="609.81" data-end="611.5">And we do want to be honest about that.</span> <span data-start="611.5" data-end="615.34">For instance, right now, if you open it in Firefox,</span> <span data-start="615.34" data-end="616.389">you get this.</span> <span data-start="616.389" data-end="618.43">We're a little bit behind on our browser support.</span> <span data-start="618.43" data-end="619.156">[LAUGHTER]</span> <span data-start="619.156" data-end="619.844">Oh, come on.</span> </p>
<p><span data-start="619.844" data-end="621.01">Look, we've run out of time.</span> <span data-start="621.01" data-end="622.3">We are hoping to fix this.</span> </p>
</section>

<section>
<p><span data-start="622.3" data-end="622.38"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="622.38" data-end="624.05">We had the big web quiz to build and everything.</span> </p>
</section>

<section>
<p><span data-start="624.05" data-end="626.14"><span class="speaker">Jake Archibald</span>: We had other things to build.</span> <span data-start="626.14" data-end="627.3">We are joking of course.</span> </p>
</section>

<section>
<p><span data-start="627.3" data-end="628.216"><span class="speaker">Mariko Kosaka</span>: Joking.</span> </p>
</section>

<section>
<p><span data-start="628.216" data-end="629.61"><span class="speaker">Jake Archibald</span>: Come on, right?</span> </p>
</section>

<section>
<p><span data-start="629.61" data-end="630.443"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="630.443" data-end="633.61">As well as being a useful tool —  which we hope that you find it</span> <span data-start="633.61" data-end="634.75">useful too — </span> <span data-start="634.75" data-end="636.79">we wanted to practice what we preach.</span> <span data-start="636.79" data-end="640.36">So we wanted to make the Squoosh to be a great PWA.</span> <span data-start="640.36" data-end="646.06">So Squoosh works in latest version of all modern browsers.</span> <span data-start="646.06" data-end="648.992">[APPLAUSE]</span> <span data-start="648.992" data-end="649.95">Well, this is kind of — </span> </p>
</section>

<section>
<p><span data-start="649.95" data-end="652.09"><span class="speaker">Jake Archibald</span>: Only Googlers can get a round of applause</span> <span data-start="652.09" data-end="653.78">for just making things work with other browsers.</span> </p>
</section>

<section>
<p><span data-start="653.78" data-end="654.571"><span class="speaker">Mariko Kosaka</span>: Yes.</span> <span data-start="654.571" data-end="657.047">This is kind of sad that we got applause for this.</span> </p>
</section>

<section>
<p><span data-start="657.047" data-end="657.88"><span class="speaker">Jake Archibald</span>: Yes.</span> <span data-start="657.88" data-end="660.88">In fact, what you're seeing here is Firefox 63 opening</span> <span data-start="660.88" data-end="663.26">a WebP of my stupid cats.</span> <span data-start="663.26" data-end="666.88">And this is in Firefox 63, which does not support WebP.</span> <span data-start="666.88" data-end="669.077">WebP support doesn't land until Firefox 65.</span> </p>
</section>

<section>
<p><span data-start="669.077" data-end="669.91"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="669.91" data-end="672.56">But we didn't want the key features to be missing.</span> <span data-start="672.56" data-end="676.3">So we needed to make sure the Squoosh could lead and create</span> <span data-start="676.3" data-end="680.31">images in all modern browsers using those codecs, which</span> <span data-start="680.31" data-end="681.49">brings onto — </span> <span data-start="681.49" data-end="683.33">let's talk about how we built Squoosh.</span> </p>
</section>

<section>
<p><span data-start="683.33" data-end="685.24"><span class="speaker">Jake Archibald</span>: Yeah, and this is</span> <span data-start="685.24" data-end="686.99">an idea I had around about five years ago.</span> <span data-start="686.99" data-end="688.698">It's something I'd been wanting to build.</span> <span data-start="688.698" data-end="690.454">And I tried to build it five years ago,</span> <span data-start="690.454" data-end="692.12">but browsers weren't quite smart enough.</span> <span data-start="692.12" data-end="695.05">But more importantly, I wasn't quite smart enough.</span> <span data-start="695.05" data-end="698.08">So Squoosh is a real team effort with contributions</span> <span data-start="698.08" data-end="701.548">from all of these talented engineers and Paul Kinlin.</span> </p>
</section>

<section>
<p><span data-start="701.548" data-end="703.214"><span class="speaker">Mariko Kosaka</span>: The key thing that made — </span> <span data-start="703.214" data-end="705.634">[LAUGHTER]</span> <span data-start="705.634" data-end="707.93">Are you glad that joke landed really well?</span> </p>
</section>

<section>
<p><span data-start="707.93" data-end="709.215"><span class="speaker">Jake Archibald</span>: Thank you.</span> </p>
</section>

<section>
<p><span data-start="709.215" data-end="710.59"><span class="speaker">Mariko Kosaka</span>: The key thing that</span> <span data-start="710.59" data-end="713.32">made Squoosh possible is WebAssembly,</span> <span data-start="713.32" data-end="717.38">which is supported in all modern browsers for over a year now.</span> <span data-start="717.38" data-end="719.74">I know we have WebAssembly sessions later</span> <span data-start="719.74" data-end="720.86">in this conference.</span> <span data-start="720.86" data-end="724.63">But as a little primer, Wasm, or WebAssembly,</span> <span data-start="724.63" data-end="727.18">is a compile target for the web.</span> <span data-start="727.18" data-end="732.88">So you have your code written in C, Rascal, or whatever choice.</span> <span data-start="732.88" data-end="736.57">You would usually compile it to run it on different OS</span> <span data-start="736.57" data-end="737.41">as the app.</span> <span data-start="737.41" data-end="740.05">But using WebAssembly, the technology,</span> <span data-start="740.05" data-end="744.67">you can compile the same code and run it in browser.</span> </p>
<p><span data-start="744.67" data-end="748.6">So for Squoosh, the mozjpeg, the web WebP, the OptiPNG,</span> <span data-start="748.6" data-end="750.76">all of those codecs are written in C.</span> <span data-start="750.76" data-end="754.08">So we used a tool called Emscripten to compile the C</span> <span data-start="754.08" data-end="759.165">code into a WebAssembly so that we can run it in browser.</span> </p>
</section>

<section>
<p><span data-start="759.165" data-end="760.04"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="760.04" data-end="761.89">And this was really, really essential for the project</span> <span data-start="761.89" data-end="763.39">because browsers do actually ship</span> <span data-start="763.39" data-end="766.6">with imaging coders like JPEG and PNG,</span> <span data-start="766.6" data-end="769.34">which you can access via the Canvas API like this.</span> <span data-start="769.34" data-end="770.71">But they suck.</span> <span data-start="770.71" data-end="772.355">They are really, really bad.</span> <span data-start="772.355" data-end="773.98">We have made them available in Squoosh.</span> </p>
<p><span data-start="773.98" data-end="775.27">So you can use them if you want.</span> <span data-start="775.27" data-end="776.35">They are actually quite fast.</span> <span data-start="776.35" data-end="778.42">That's the one thing they've got going for them.</span> <span data-start="778.42" data-end="779.56">We thought, why not?</span> <span data-start="779.56" data-end="781.6">But you only get this one quality option.</span> <span data-start="781.6" data-end="783.43">And ugh, they're just rubbish.</span> <span data-start="783.43" data-end="787.529">This is Chrome's JPEG encoder on the left compared to mozjpeg.</span> </p>
<p><span data-start="787.529" data-end="789.82">And it's ugh, the Chrome version is just a lot rougher.</span> <span data-start="789.82" data-end="790.382">It's blah.</span> <span data-start="790.382" data-end="791.29">It's horrible.</span> <span data-start="791.29" data-end="793.662">It's actually way worse in Firefox.</span> </p>
</section>

<section>
<p><span data-start="793.662" data-end="794.62"><span class="speaker">Mariko Kosaka</span>: Firefox.</span> </p>
</section>

<section>
<p><span data-start="794.62" data-end="797.02"><span class="speaker">Jake Archibald</span>: The JPEG encoder in Mozilla's browser</span> <span data-start="797.02" data-end="800.151">is terrible compared to Mozilla's JPEG encoder.</span> <span data-start="800.151" data-end="802.717">[LAUGHTER]</span> </p>
</section>

<section>
<p><span data-start="802.717" data-end="803.55"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="803.55" data-end="805.56">We see the same thing for PNG too.</span> <span data-start="805.56" data-end="808.53">So that Squoosh logo that we looked at in the demo,</span> <span data-start="808.53" data-end="812.4">if you use a browser's native compressor,</span> <span data-start="812.4" data-end="814.71">then those are the numbers you get.</span> <span data-start="814.71" data-end="819.57">The Firefox are significantly better than other browsers.</span> <span data-start="819.57" data-end="825.72">But it's still not good compared to OptiPNG, which Squoosh uses.</span> </p>
<p><span data-start="825.72" data-end="830.01">And this is for exactly the same image, pixel-by-pixel, just</span> <span data-start="830.01" data-end="831.57">compression, different numbers.</span> </p>
</section>

<section>
<p><span data-start="831.57" data-end="831.99"><span class="speaker">Jake Archibald</span>: Exactly.</span> <span data-start="831.99" data-end="834.18">And Wasm let's us bypass the browser's encoders</span> <span data-start="834.18" data-end="835.32">and use much better ones.</span> <span data-start="835.32" data-end="838.11">It also let us bring in the WebP decoder</span> <span data-start="838.11" data-end="840.69">to use in browsers that don't have native WebP support.</span> </p>
<p><span data-start="840.69" data-end="844.5">Now, I know almost nothing about C. So that part of the project</span> <span data-start="844.5" data-end="846.75">was really down to this man.</span> <span data-start="846.75" data-end="848.4">So please, welcome to the stage — </span> <span data-start="848.4" data-end="850.29">so good, we named him once — </span> <span data-start="850.29" data-end="851.19">it's Surma.</span> <span data-start="851.19" data-end="853.07">[MUSIC PLAYING]</span> <span data-start="853.07" data-end="854.48">[APPLAUSE]</span> </p>
</section>

<section>
<p><span data-start="858.71" data-end="863.99"><span class="speaker">Mariko Kosaka</span>: So you made most of the WebAssembly stuff work.</span> </p>
</section>

<section>
<p><span data-start="863.99" data-end="865.136"><span class="speaker">Surma</span>: Yeah.</span> <span data-start="865.136" data-end="867.63">[LAUGHTER]</span> </p>
</section>

<section>
<p><span data-start="867.63" data-end="868.77"><span class="speaker">Jake Archibald</span>: How was it?</span> </p>
</section>

<section>
<p><span data-start="868.77" data-end="870.065"><span class="speaker">Surma</span>: It was good.</span> </p>
</section>

<section>
<p><span data-start="870.065" data-end="870.94"><span class="speaker">Jake Archibald</span>: Cool.</span> </p>
</section>

<section>
<p><span data-start="870.94" data-end="872.987"><span class="speaker">Surma</span>: Cool.</span> </p>
</section>

<section>
<p><span data-start="872.987" data-end="874.82"><span class="speaker">Jake Archibald</span>: Surma, ladies and gentlemen.</span> <span data-start="874.82" data-end="875.764">[MUSIC PLAYING]</span> <span data-start="875.764" data-end="878.457">[APPLAUSE]</span> </p>
</section>

<section>
<p><span data-start="878.457" data-end="879.29"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="879.29" data-end="882.08">Well, thankfully Surma wrote an article about it.</span> <span data-start="882.08" data-end="883.845">So we have some things to share.</span> </p>
</section>

<section>
<p><span data-start="883.845" data-end="884.72"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="884.72" data-end="887.34">Compiling a codec to Wasm, that involved writing a little bit</span> <span data-start="887.34" data-end="890.8">of C++, which included the codec and some of the Emscripten</span> <span data-start="890.8" data-end="891.402">stuff.</span> <span data-start="891.402" data-end="892.61">And then we wrote a function.</span> <span data-start="892.61" data-end="895.12">This is the function we want to expose to JavaScript.</span> <span data-start="895.12" data-end="898.21">It takes our image data, takes it as a string</span> <span data-start="898.21" data-end="901.36">because that's how Emscripten represents binary data in C++.</span> <span data-start="901.36" data-end="904.45">So on the JavaScript side, we're passing in a Uint8array.</span> <span data-start="904.45" data-end="906.79">And it ends up in C++ as a string.</span> <span data-start="906.79" data-end="909.16">And we also have our other arguments, width and height,</span> <span data-start="909.16" data-end="910.48">and the codec settings.</span> </p>
<p><span data-start="910.48" data-end="913.22">In this example, I'm just using quality.</span> <span data-start="913.22" data-end="916.06">And then we call out to the actual encoder under the hood,</span> <span data-start="916.06" data-end="918.4">passing in all the settings, getting the output,</span> <span data-start="918.4" data-end="919.45">and then we return it.</span> <span data-start="919.45" data-end="921.76">And this vowel and type memory view stuff,</span> <span data-start="921.76" data-end="923.68">this is annotation to tell Emscripten</span> <span data-start="923.68" data-end="927.13">to treat the return value as a Uint8array back in JavaScript</span> <span data-start="927.13" data-end="927.78">land.</span> </p>
<p><span data-start="927.78" data-end="930.11">And then all we needed to do is tell Emscripten</span> <span data-start="930.11" data-end="931.55">which methods to expose.</span> <span data-start="931.55" data-end="933.43">That's it.</span> </p>
</section>

<section>
<p><span data-start="933.43" data-end="934.9"><span class="speaker">Mariko Kosaka</span>: I'm a web developer.</span> <span data-start="934.9" data-end="936.69">You completely lost me.</span> <span data-start="936.69" data-end="938.3">Do you get any of this?</span> </p>
</section>

<section>
<p><span data-start="938.3" data-end="939.57"><span class="speaker">Jake Archibald</span>: No, I don't understand it either.</span> <span data-start="939.57" data-end="941.44">But I copied the patterns from Surma's article.</span> <span data-start="941.44" data-end="942.28">And hey, it just works.</span> </p>
<p><span data-start="942.28" data-end="942.64">It's great.</span> </p>
</section>

<section>
<p><span data-start="942.64" data-end="943.18"><span class="speaker">Mariko Kosaka</span>: Great.</span> </p>
</section>

<section>
<p><span data-start="943.18" data-end="944.35"><span class="speaker">Jake Archibald</span>: I was able to take those patterns</span> <span data-start="944.35" data-end="946.3">and use them for different kinds of C projects as well,</span> <span data-start="946.3" data-end="947.674">like text compressions and stuff.</span> <span data-start="947.674" data-end="949.91">It's —  yeah, it's pretty good, pretty good.</span> </p>
</section>

<section>
<p><span data-start="949.91" data-end="950.743"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="950.743" data-end="953.23">So compiling that code with Emscripten</span> <span data-start="953.23" data-end="956.68">gives a JavaScript file in Wasm binary.</span> <span data-start="956.68" data-end="959.08">So now you can include that script</span> <span data-start="959.08" data-end="962.11">onto your page, which also loads that Wasm binary.</span> <span data-start="962.11" data-end="964.18">And once all of the script is ready,</span> <span data-start="964.18" data-end="966.22">you can just call that encoding function</span> <span data-start="966.22" data-end="967.565">as if you're calling JavaScript.</span> </p>
</section>

<section>
<p><span data-start="967.565" data-end="968.44"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="968.44" data-end="971.65">Using Emscripten, it feels a little bit rough and ready.</span> <span data-start="971.65" data-end="973.09">But the docs are really good.</span> <span data-start="973.09" data-end="975.85">And Surma's article is good enough to get you started.</span> </p>
</section>

<section>
<p><span data-start="975.85" data-end="976.99"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="976.99" data-end="981.04">But in this case, we are dealing with a large C project here.</span> <span data-start="981.04" data-end="984.4">And those are really CPU intensive.</span> <span data-start="984.4" data-end="987.23">So that brings us to performance,</span> <span data-start="987.23" data-end="990.309">which we were kind of worried about in the beginning</span> <span data-start="990.309" data-end="992.1">of the project because we knew that's going</span> <span data-start="992.1" data-end="993.785">to be a thing that we need to take care.</span> </p>
</section>

<section>
<p><span data-start="993.785" data-end="994.66"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="994.66" data-end="996.52">We're halfway through the talk, so we're actually finally</span> <span data-start="996.52" data-end="997.94">starting to get to the point.</span> </p>
</section>

<section>
<p><span data-start="997.94" data-end="998.773"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="998.773" data-end="1002.28">So we used PREACT to orchestrate the DOM</span> <span data-start="1002.28" data-end="1004.016">and webpack to bundle it all together.</span> </p>
</section>

<section>
<p><span data-start="1004.016" data-end="1004.89"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1004.89" data-end="1006.348">We used PREACT because it does what</span> <span data-start="1006.348" data-end="1008.1">it does in 3k, which is kind of amazing.</span> <span data-start="1008.1" data-end="1009.63">We also had Jason on the project —  that's probably — </span> </p>
</section>

<section>
<p><span data-start="1009.63" data-end="1009.954"><span class="speaker">Mariko Kosaka</span>: That's true.</span> <span data-start="1009.954" data-end="1010.35">Clear it off the [INAUDIBLE].</span> </p>
</section>

<section>
<p><span data-start="1010.35" data-end="1010.91"><span class="speaker">Jake Archibald</span>:  — another reason.</span> <span data-start="1010.91" data-end="1012.21">We wouldn't want to upset him.</span> <span data-start="1012.21" data-end="1014.501">And we used webpack because there isn't really anything</span> <span data-start="1014.501" data-end="1016.71">else that does what webpack does, certainly, not</span> <span data-start="1016.71" data-end="1017.918">in the way we wanted it done.</span> <span data-start="1017.918" data-end="1019.86">We wanted a lot of control over it.</span> <span data-start="1019.86" data-end="1021.797">And it was really only webpack.</span> </p>
</section>

<section>
<p><span data-start="1021.797" data-end="1022.63"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1022.63" data-end="1028.65">So as a result, our app is 400 Kilobyte gzipped,</span> <span data-start="1028.65" data-end="1031.29">all in all, everything.</span> <span data-start="1031.29" data-end="1034.02">But this is well below the median</span> <span data-start="1034.02" data-end="1038.02">from HTTP Archive, which is 1.5 megabytes.</span> <span data-start="1038.02" data-end="1039.655">So we're quite happy about that.</span> </p>
</section>

<section>
<p><span data-start="1039.655" data-end="1040.53"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1040.53" data-end="1040.8">We're winning.</span> <span data-start="1040.8" data-end="1041.383">We're winning.</span> <span data-start="1041.383" data-end="1043.88">We're happy with that.</span> <span data-start="1043.88" data-end="1045.579">So the vast majority of that size</span> <span data-start="1045.579" data-end="1047.53">is the codecs and the processes, like,</span> <span data-start="1047.53" data-end="1049.249">the stuff we brought in from C land.</span> <span data-start="1049.249" data-end="1050.04">And that's —  yeah — </span> <span data-start="1050.04" data-end="1051.78">300 kilobytes of that stuff.</span> </p>
<p><span data-start="1051.78" data-end="1054.28">And I'm pretty sure there's some waste and duplication here.</span> <span data-start="1054.28" data-end="1057.13">But like I said, Emscripten's a little bit rough and ready.</span> <span data-start="1057.13" data-end="1058.85">And cosharing between Wasm modules,</span> <span data-start="1058.85" data-end="1060.97">it doesn't seem all that easy right now.</span> </p>
<p><span data-start="1060.97" data-end="1062.36">It's something we'll look into.</span> <span data-start="1062.36" data-end="1065.14">But we were able to limit that damage by lazy-loading</span> <span data-start="1065.14" data-end="1066.51">these using workers.</span> </p>
</section>

<section>
<p><span data-start="1066.51" data-end="1067.343"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1067.343" data-end="1070.69">As we've already seen, compressor is CPU intensive.</span> <span data-start="1070.69" data-end="1073">So depending on settings, encoding</span> <span data-start="1073" data-end="1076.45">can take 30 seconds to sometimes minutes.</span> <span data-start="1076.45" data-end="1079.71">And when that thing is happening and occupying CPU,</span> <span data-start="1079.71" data-end="1081.85">we don't want that UI to be frozen.</span> <span data-start="1081.85" data-end="1083.71">We want users to be pinch zooming,</span> <span data-start="1083.71" data-end="1086.44">and moving around, and testing, and possibly changing</span> <span data-start="1086.44" data-end="1088.771">the options too.</span> </p>
<p><span data-start="1088.771" data-end="1089.27">So — </span> </p>
</section>

<section>
<p><span data-start="1089.27" data-end="1089.57"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1089.57" data-end="1091.194">Workers give us this lazy loading stuff</span> <span data-start="1091.194" data-end="1092.33">for free, which is great.</span> <span data-start="1092.33" data-end="1094.39">But the main benefit is concurrency.</span> <span data-start="1094.39" data-end="1096.437">We create up to two workers.</span> <span data-start="1096.437" data-end="1098.02">And both of those are just going to be</span> <span data-start="1098.02" data-end="1099.186">pointing at the same script.</span> <span data-start="1099.186" data-end="1101.17">That's one for the left-hand side of the image</span> <span data-start="1101.17" data-end="1103.13">and one for the right-hand side of the image.</span> <span data-start="1103.13" data-end="1106.54">This means the left-hand side can be encoding a JPEG.</span> <span data-start="1106.54" data-end="1108.91">And the right-hand side can be optimizing PNG.</span> <span data-start="1108.91" data-end="1111.299">And all the while, the main thread stays responsive.</span> <span data-start="1111.299" data-end="1113.59">And that was really all the concurrency that we needed.</span> </p>
</section>

<section>
<p><span data-start="1113.59" data-end="1114.423"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1114.423" data-end="1117.552">But it came with another benefit too.</span> <span data-start="1117.552" data-end="1119.51">So the left-hand side —  let's say [INAUDIBLE].</span> <span data-start="1119.51" data-end="1122.5">left-hand side worker is compressing an image, right?</span> <span data-start="1122.5" data-end="1124.72">But what if a user changes the setting?</span> <span data-start="1124.72" data-end="1126.91">The current job is out of date.</span> <span data-start="1126.91" data-end="1128.51">We need to update it.</span> <span data-start="1128.51" data-end="1132.722">But those compression encoders are</span> <span data-start="1132.722" data-end="1133.93">written in a synchronous way.</span> <span data-start="1133.93" data-end="1135.33">So there is no abort API.</span> <span data-start="1135.33" data-end="1136.54">There is no way to kill it.</span> <span data-start="1136.54" data-end="1139.69">However, we put it into worker.</span> <span data-start="1139.69" data-end="1142.76">So in this case, we just terminate the worker,</span> <span data-start="1142.76" data-end="1145.74">and then click new workers, put the new job in, and then start</span> <span data-start="1145.74" data-end="1146.705">it back up again.</span> </p>
</section>

<section>
<p><span data-start="1146.705" data-end="1147.58"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1147.58" data-end="1151.392">And the implementation for this is pretty simple.</span> <span data-start="1151.392" data-end="1152.35">So it's just like this.</span> </p>
</section>

<section>
<p><span data-start="1152.35" data-end="1152.69"><span class="speaker">Mariko Kosaka</span>: Ooh.</span> </p>
</section>

<section>
<p><span data-start="1152.69" data-end="1153.481"><span class="speaker">Jake Archibald</span>: Oh.</span> <span data-start="1153.481" data-end="1155.087">Oh, go on, you click.</span> <span data-start="1155.087" data-end="1155.92">This is the problem.</span> <span data-start="1155.92" data-end="1157.24">We've got two slide clickers.</span> <span data-start="1157.24" data-end="1159.04">And we needed to rehearse who was doing</span> <span data-start="1159.04" data-end="1160.91">the changing for each slide.</span> <span data-start="1160.91" data-end="1163">So what you saw there was us messing it up.</span> <span data-start="1163" data-end="1165.4">[LAUGHTER]</span> <span data-start="1165.4" data-end="1167.42">Implementation is roughly like this — </span> <span data-start="1167.42" data-end="1169.48">if busy, terminate, and restart.</span> <span data-start="1169.48" data-end="1172.35">But also, we only spin up one of these workers when we need it,</span> <span data-start="1172.35" data-end="1173.44">like, just in time.</span> <span data-start="1173.44" data-end="1175.51">So if you're doing something kind of like what we were doing</span> <span data-start="1175.51" data-end="1177.676">in the demo —  we had the original image on one side,</span> <span data-start="1177.676" data-end="1178.51">JPEG on the other.</span> </p>
<p><span data-start="1178.51" data-end="1180.384">We only spin up one worker because we're only</span> <span data-start="1180.384" data-end="1182.81">having one side doing compression at the time.</span> <span data-start="1182.81" data-end="1186.34">And also, if one of those workers is idle for 10 seconds,</span> <span data-start="1186.34" data-end="1187.31">we kill it as well.</span> </p>
<p><span data-start="1187.31" data-end="1189.73">And that is really just to be kind to the user's device</span> <span data-start="1189.73" data-end="1191.05">to bring the memory footprint down.</span> </p>
</section>

<section>
<p><span data-start="1191.05" data-end="1191.883"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1191.883" data-end="1194.75">That worker is almost empty when it started.</span> <span data-start="1194.75" data-end="1198.04">Heavy stuff is imported when it's needed.</span> <span data-start="1198.04" data-end="1200.56">This keeps the worker startup time down.</span> <span data-start="1200.56" data-end="1204.16">And also, you don't really need to download and parse and wait</span> <span data-start="1204.16" data-end="1206.89">for the OptiPNG and mozjpeg stuff</span> <span data-start="1206.89" data-end="1209.135">if user is just encoding WebP.</span> </p>
</section>

<section>
<p><span data-start="1209.135" data-end="1210.01"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1210.01" data-end="1212.38">And using a wait import like this,</span> <span data-start="1212.38" data-end="1213.92">this is part of the platform.</span> <span data-start="1213.92" data-end="1215.77">It's supported behind a flag in Chrome.</span> <span data-start="1215.77" data-end="1218.237">But it isn't supported and stable or in other browsers.</span> <span data-start="1218.237" data-end="1220.57">Thankfully, it's something that webpack can just handle.</span> <span data-start="1220.57" data-end="1222.99">It polyfills it, and it just works.</span> <span data-start="1222.99" data-end="1224.95">Now, the final piece of this puzzle</span> <span data-start="1224.95" data-end="1226.727">is how we actually talk to the workers.</span> </p>
</section>

<section>
<p><span data-start="1226.727" data-end="1227.56"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1227.56" data-end="1230.81">So request and response communication with workers — </span> <span data-start="1230.81" data-end="1232.43">eh, a little tricky.</span> <span data-start="1232.43" data-end="1236.35">So the way worker works is that you send the worker some job.</span> <span data-start="1236.35" data-end="1239.78">And at some point, they come back with the results.</span> <span data-start="1239.78" data-end="1242.36">But you need to associate those requests and response.</span> <span data-start="1242.36" data-end="1245.8">So in this code example, we just give a unique ID.</span> <span data-start="1245.8" data-end="1248.27">And when worker is done with that job,</span> <span data-start="1248.27" data-end="1249.61">then it gives back the ID.</span> <span data-start="1249.61" data-end="1253.24">But you have to write your own logic for this.</span> <span data-start="1253.24" data-end="1255.062">And it's like, eh, eh, eh.</span> </p>
</section>

<section>
<p><span data-start="1255.062" data-end="1256.27"><span class="speaker">Jake Archibald</span>: It's rubbish.</span> <span data-start="1256.27" data-end="1257.02">I really don't like it.</span> <span data-start="1257.02" data-end="1259.272">It's one of the things that puts me off putting stuff</span> <span data-start="1259.272" data-end="1260.23">into the —  of a thread.</span> <span data-start="1260.23" data-end="1262.33">It goes ah, I'm going to have to do the post method thing.</span> <span data-start="1262.33" data-end="1262.71">I don't like it.</span> </p>
</section>

<section>
<p><span data-start="1262.71" data-end="1262.9"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1262.9" data-end="1264.84">That's a layer to worry about when</span> <span data-start="1264.84" data-end="1266.17">you're writing application.</span> </p>
</section>

<section>
<p><span data-start="1266.17" data-end="1269.14"><span class="speaker">Jake Archibald</span>: But again, to the rescue, it's Surma.</span> <span data-start="1269.14" data-end="1270.31">[LAUGHTER]</span> <span data-start="1270.31" data-end="1272.83">He built Comlink, a little library that you can use,</span> <span data-start="1272.83" data-end="1274.42">you can get from mPm to use it.</span> <span data-start="1274.42" data-end="1275.26">It's just like this.</span> <span data-start="1275.26" data-end="1277.18">You create a worker as you usually would.</span> <span data-start="1277.18" data-end="1278.62">And then you tell Comlink all of the things</span> <span data-start="1278.62" data-end="1279.7">that you want to expose.</span> <span data-start="1279.7" data-end="1281.59">These can be classes, values.</span> <span data-start="1281.59" data-end="1283.23">But we were just using functions.</span> <span data-start="1283.23" data-end="1286.36">And then over in your page, you just hook the Comlink up</span> <span data-start="1286.36" data-end="1287.14">to the worker.</span> </p>
<p><span data-start="1287.14" data-end="1289.27">And now you can call those functions just as</span> <span data-start="1289.27" data-end="1290.487">if they're part of your page.</span> <span data-start="1290.487" data-end="1293.07">Comlink takes care of all of the bookkeeping, the post message</span> <span data-start="1293.07" data-end="1294.88">stuff, all of that mess.</span> </p>
</section>

<section>
<p><span data-start="1294.88" data-end="1297.46"><span class="speaker">Mariko Kosaka</span>: So once we've split up that codecs,</span> <span data-start="1297.46" data-end="1301.34">our app came down to 35 kilobyte.</span> <span data-start="1301.34" data-end="1302.35">Yeah.</span> <span data-start="1302.35" data-end="1304.66">But I want to make sure that a user will still</span> <span data-start="1304.66" data-end="1307.9">have to download those 300 kilobytes if they</span> <span data-start="1307.9" data-end="1309.43">want to use all of the codecs.</span> <span data-start="1309.43" data-end="1314.01">But they don't need to load those upfront.</span> <span data-start="1314.01" data-end="1319.95">But 35 kilobytes, it still contains the pinch zoom logic,</span> <span data-start="1319.95" data-end="1323.485">the options panel, the fancy slider, then this thing,</span> <span data-start="1323.485" data-end="1327.27">and that thing, this thing, this thing, ooh, that thing too.</span> <span data-start="1327.27" data-end="1333.21">And what these have in common is that it's not</span> <span data-start="1333.21" data-end="1336.085">here, our first page.</span> </p>
</section>

<section>
<p><span data-start="1336.085" data-end="1336.96"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1336.96" data-end="1339.9">Imagine going to a restaurant and asking to see the menu.</span> <span data-start="1339.9" data-end="1342.75">And 10 minutes later, you still haven't been given it.</span> <span data-start="1342.75" data-end="1345.63">So you're going to ask, excuse me, where's the menu?</span> <span data-start="1345.63" data-end="1348.24">And they say, oh, well, we're busy preparing</span> <span data-start="1348.24" data-end="1350.19">every single dish we do.</span> <span data-start="1350.19" data-end="1352.38">And then we'll give you the menu,</span> <span data-start="1352.38" data-end="1353.96">so when you pick something —  bam — </span> <span data-start="1353.96" data-end="1355.57">we will give you that straight away.</span> <span data-start="1355.57" data-end="1356.66">It's ready.</span> <span data-start="1356.66" data-end="1357.42">[LAUGHTER]</span> </p>
</section>

<section>
<p><span data-start="1357.42" data-end="1358.253"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1358.253" data-end="1362.25">You laugh but much of the web is built this way, especially</span> <span data-start="1362.25" data-end="1363.36">JavaScript-heavy apps.</span> </p>
</section>

<section>
<p><span data-start="1363.36" data-end="1363.54"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1363.54" data-end="1365.456">Because you might look at the menu and decide,</span> <span data-start="1365.456" data-end="1367.59">oh, I don't want any of this stuff.</span> <span data-start="1367.59" data-end="1369.12">Or you might want something simple.</span> <span data-start="1369.12" data-end="1371.19">You're certainly unlikely to want everything.</span> <span data-start="1371.19" data-end="1374.04">So why should getting the menu and making a choice be blocked</span> <span data-start="1374.04" data-end="1375.93">on them preparing all of their most</span> <span data-start="1375.93" data-end="1377.677">complex, time-consuming dishes?</span> </p>
</section>

<section>
<p><span data-start="1377.677" data-end="1378.51"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1378.51" data-end="1379.68">Same for JavaScript apps.</span> <span data-start="1379.68" data-end="1383.82">They prepare everything up front before doing anything.</span> <span data-start="1383.82" data-end="1385.8">So the user really shouldn't have</span> <span data-start="1385.8" data-end="1389.19">to wait for all of these things to download, parse,</span> <span data-start="1389.19" data-end="1390.69">and execute.</span> <span data-start="1390.69" data-end="1392.445">They just need to get to this page.</span> </p>
</section>

<section>
<p><span data-start="1392.445" data-end="1394.82"><span class="speaker">Jake Archibald</span>: And like most web apps —  like most apps — </span> <span data-start="1394.82" data-end="1397.58">Squoosh has a limited set of first interactions.</span> <span data-start="1397.58" data-end="1400.02">[INAUDIBLE] it's dropping an image onto the page,</span> <span data-start="1400.02" data-end="1402.09">selecting one file by the file picker,</span> <span data-start="1402.09" data-end="1404.05">or selecting one of the demo images.</span> <span data-start="1404.05" data-end="1406.29">So we split all of that out.</span> <span data-start="1406.29" data-end="1408.33">This is roughly how things looked at the start.</span> <span data-start="1408.33" data-end="1409.05">We had our intro.</span> <span data-start="1409.05" data-end="1410.85">And we had our compression UI.</span> <span data-start="1410.85" data-end="1412.997">If no file had been selected, we show the intro.</span> <span data-start="1412.997" data-end="1415.08">Otherwise, we send that file to the compression UI</span> <span data-start="1415.08" data-end="1416.58">and display that.</span> </p>
<p><span data-start="1416.58" data-end="1419.34">We changed this so the whole compression API part,</span> <span data-start="1419.34" data-end="1420.9">that was loaded asynchronously.</span> <span data-start="1420.9" data-end="1422.692">And the tool chain actually made that</span> <span data-start="1422.692" data-end="1423.9">a lot easier than I expected.</span> </p>
</section>

<section>
<p><span data-start="1423.9" data-end="1424.733"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1424.733" data-end="1427.59">So first up, we removed the URL import</span> <span data-start="1427.59" data-end="1429.72">and instead, dynamically imported</span> <span data-start="1429.72" data-end="1432.95">that in the constructor and set that as a state.</span> <span data-start="1432.95" data-end="1437.16">So dynamic imports are supported natively in Chrome and Safari.</span> <span data-start="1437.16" data-end="1440.19">But using webpack provides similar functionality</span> <span data-start="1440.19" data-end="1441.66">to all of the browsers.</span> </p>
</section>

<section>
<p><span data-start="1441.66" data-end="1441.87"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1441.87" data-end="1444.09">So the compression UI is going to start downloading</span> <span data-start="1444.09" data-end="1445.95">as soon as the intro loads.</span> <span data-start="1445.95" data-end="1447.72">But there is a small chance that the user</span> <span data-start="1447.72" data-end="1450.88">is going to be able to select a file before it's ready.</span> <span data-start="1450.88" data-end="1452.7">So in which case, we just show a spinner.</span> <span data-start="1452.7" data-end="1454.741">Very unlikely that the user is going to see that,</span> <span data-start="1454.741" data-end="1456.507">but we put that in just in case.</span> </p>
</section>

<section>
<p><span data-start="1456.507" data-end="1457.34"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1457.34" data-end="1460.64">So remember with codec, speed it up.</span> <span data-start="1460.64" data-end="1462.55">We chopped that 300 kilobytes off.</span> <span data-start="1462.55" data-end="1469.33">But with the code splitting, we made that into 15 kilobytes.</span> <span data-start="1469.33" data-end="1473.23">And this is despite our app being JavaScript-driven,</span> <span data-start="1473.23" data-end="1474.7">using frameworks.</span> <span data-start="1474.7" data-end="1478">And 15 kilobyte gzipped is even with empty cache</span> <span data-start="1478" data-end="1478.93">on the user's device.</span> </p>
</section>

<section>
<p><span data-start="1478.93" data-end="1479.93"><span class="speaker">Jake Archibald</span>: Exactly.</span> <span data-start="1479.93" data-end="1482.26">And that means on a slow 3G connection,</span> <span data-start="1482.26" data-end="1484.96">the user gets the first interaction in 3.3 seconds.</span> <span data-start="1484.96" data-end="1488.06">And that's a slow connection on a slow phone,</span> <span data-start="1488.06" data-end="1491.11">but it's not the worst conditions.</span> <span data-start="1491.11" data-end="1493.99">Even on 2G, we are still interactive</span> <span data-start="1493.99" data-end="1495.679">in less than 5 seconds.</span> <span data-start="1495.679" data-end="1497.47">Now, I don't think many people in this room</span> <span data-start="1497.47" data-end="1498.64">spend a lot of time on 2G.</span> </p>
<p><span data-start="1498.64" data-end="1499.714">I know I don't.</span> <span data-start="1499.714" data-end="1501.13">But this kind of performance means</span> <span data-start="1501.13" data-end="1504.16">the app is really usable even in emerging markets.</span> <span data-start="1504.16" data-end="1505.78">And this is why I'm a huge fan of</span> <span data-start="1505.78" data-end="1507.44">these microframeworks, like PREACT,</span> <span data-start="1507.44" data-end="1510.82">but also Lit-html, hyperHTML, Svelte.</span> <span data-start="1510.82" data-end="1513.34">We couldn't have actually hit these numbers with React</span> <span data-start="1513.34" data-end="1515.77">because that's 30, 40 kilobytes out the door.</span> </p>
<p><span data-start="1515.77" data-end="1518.31">We couldn't do it with Vue, because that's 20 kilobytes.</span> <span data-start="1518.31" data-end="1519.22">Angular is 60.</span> <span data-start="1519.22" data-end="1520.36">Ember is bigger still.</span> <span data-start="1520.36" data-end="1522.99">But let's not get carried away.</span> <span data-start="1522.99" data-end="1526.3">15 kilobytes, 8 of which is JavaScript,</span> <span data-start="1526.3" data-end="1529.99">is actually a lot of JavaScript for these couple</span> <span data-start="1529.99" data-end="1530.687">of interactions.</span> </p>
</section>

<section>
<p><span data-start="1530.687" data-end="1531.52"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1531.52" data-end="1533.65">So for instance, let's look at how</span> <span data-start="1533.65" data-end="1537.76">we might build this user interface with just Vanilla</span> <span data-start="1537.76" data-end="1539.11">JavaScript.</span> <span data-start="1539.11" data-end="1541.33">So here's a minimal implementation</span> <span data-start="1541.33" data-end="1543.94">of drag and drop, just a few lines.</span> <span data-start="1543.94" data-end="1546.54">And then add that to that drag and drop</span> <span data-start="1546.54" data-end="1549.64">is the self-selecting of file code.</span> </p>
<p><span data-start="1549.64" data-end="1551.14">That's not that much.</span> <span data-start="1551.14" data-end="1553.87">And then this is for selecting one of the demos,</span> <span data-start="1553.87" data-end="1555.29">clicking, and loading the image.</span> <span data-start="1555.29" data-end="1560.02">So these, all of that code, minified and gzipped,</span> <span data-start="1560.02" data-end="1562.502">it's only 550 bytes.</span> </p>
</section>

<section>
<p><span data-start="1562.502" data-end="1563.71"><span class="speaker">Jake Archibald</span>: Or 350 bytes.</span> </p>
</section>

<section>
<p><span data-start="1563.71" data-end="1564.02"><span class="speaker">Mariko Kosaka</span>: Ooh.</span> </p>
</section>

<section>
<p><span data-start="1564.02" data-end="1564.79"><span class="speaker">Jake Archibald</span>: But whatever.</span> <span data-start="1564.79" data-end="1565.9">I'll go with the number on the screen.</span> </p>
</section>

<section>
<p><span data-start="1565.9" data-end="1567.4"><span class="speaker">Mariko Kosaka</span>: Can't see the number.</span> <span data-start="1567.4" data-end="1569.987">Yes, 350 bytes.</span> </p>
</section>

<section>
<p><span data-start="1569.987" data-end="1571.82"><span class="speaker">Jake Archibald</span>: And that's why I get really,</span> <span data-start="1571.82" data-end="1575.32">really grumpy when I see sites like with this 600k or more</span> <span data-start="1575.32" data-end="1576.29">JavaScript bundle.</span> <span data-start="1576.29" data-end="1577.859">And that's for first interaction.</span> <span data-start="1577.859" data-end="1579.4">I have friends who build native apps.</span> </p>
<p><span data-start="1579.4" data-end="1581.858">And when they talk about their two megabyte Android Instant</span> <span data-start="1581.858" data-end="1584.41">Apps, I love being able to go, instant, 2 megabytes.</span> <span data-start="1584.41" data-end="1584.92">Great.</span> <span data-start="1584.92" data-end="1586.158">15k.</span> <span data-start="1586.158" data-end="1587.115">[LAUGHTER]</span> </p>
<p><span data-start="1587.115" data-end="1587.74">But then they — </span> </p>
</section>

<section>
<p><span data-start="1587.74" data-end="1589.02"><span class="speaker">Mariko Kosaka</span>: With your smug face on.</span> </p>
</section>

<section>
<p><span data-start="1589.02" data-end="1589.894"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1589.894" data-end="1591.035">[CHUCKLE]</span> <span data-start="1591.035" data-end="1592.66">I think it's called a shit-eating grin.</span> <span data-start="1592.66" data-end="1593.16">Anyway.</span> <span data-start="1593.16" data-end="1594.04">[LAUGHTER]</span> <span data-start="1594.04" data-end="1595.96">But then they can point to large parts</span> <span data-start="1595.96" data-end="1599.92">of the web that have thrown this advantage away.</span> <span data-start="1599.92" data-end="1602.59">Parts of the website have taken on the worst of native</span> <span data-start="1602.59" data-end="1604.2">but none of the benefits.</span> </p>
</section>

<section>
<p><span data-start="1604.2" data-end="1605.033"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1605.033" data-end="1607.81">So if you take anything, anything out of this</span> <span data-start="1607.81" data-end="1611.44">talk, please, please, please, study your website or your web</span> <span data-start="1611.44" data-end="1614.71">apps, and find out what the first interaction is.</span> <span data-start="1614.71" data-end="1617.14">And shift the reasonable amount of code</span> <span data-start="1617.14" data-end="1618.74">for that first interaction.</span> <span data-start="1618.74" data-end="1620.21">Now, reasonable amount of code.</span> <span data-start="1620.21" data-end="1621.22">How do we find out?</span> <span data-start="1621.22" data-end="1622.55">We have a lot of tools.</span> <span data-start="1622.55" data-end="1623.05">Yeah.</span> <span data-start="1623.05" data-end="1626.38">Just experiment, and find out what is reasonable to you.</span> </p>
</section>

<section>
<p><span data-start="1628.562" data-end="1630.52"><span class="speaker">Jake Archibald</span>: So you also need to keep an eye</span> <span data-start="1630.52" data-end="1632.83">on the bundles between builds.</span> <span data-start="1632.83" data-end="1634.51">And with webpack —  and right now that,</span> <span data-start="1634.51" data-end="1637.012">unfortunately, means going and looking at minified code.</span> <span data-start="1637.012" data-end="1638.47">Because that's where it does things</span> <span data-start="1638.47" data-end="1640.09">like tree-shaking and dead-code removal.</span> <span data-start="1640.09" data-end="1641.19">It's part of the minification process.</span> </p>
</section>

<section>
<p><span data-start="1641.19" data-end="1641.35"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1641.35" data-end="1643.267">We ran into a few bugs because of that, right?</span> </p>
</section>

<section>
<p><span data-start="1643.267" data-end="1644.141"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1644.141" data-end="1646.53">We were still not quite sure if it was a bug in webpack</span> <span data-start="1646.53" data-end="1649.03">or if it was our expectations were different to what webpack</span> <span data-start="1649.03" data-end="1649.57">was doing.</span> <span data-start="1649.57" data-end="1651.945">But it was when we dived into the minified bundle, that's</span> <span data-start="1651.945" data-end="1653.17">when we found that stuff out.</span> <span data-start="1653.17" data-end="1656.12">Alternatives, like rollup are much better here.</span> <span data-start="1656.12" data-end="1658.64">They will show you the dead-code removal during development.</span> <span data-start="1658.64" data-end="1660.39">So it's easier to see when something's not</span> <span data-start="1660.39" data-end="1661.34">going as you expect.</span> <span data-start="1661.34" data-end="1663.76">But rollup doesn't have the kind of holistic asset graph</span> <span data-start="1663.76" data-end="1665.5">that we really needed for this project.</span> </p>
<p><span data-start="1665.5" data-end="1667.51">Anyway, my point is, there are huge gains</span> <span data-start="1667.51" data-end="1669.387">to be had by keeping an eye on this stuff.</span> </p>
</section>

<section>
<p><span data-start="1669.387" data-end="1670.22"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1670.22" data-end="1673.9">So like we said, we used PREACT to orchestrate the DOM</span> <span data-start="1673.9" data-end="1677.8">But we also used Web Components When</span> <span data-start="1677.8" data-end="1679.414">we were building this system, we were</span> <span data-start="1679.414" data-end="1680.83">talking to a lot of developers of,</span> <span data-start="1680.83" data-end="1682.78">yeah, we are building this cool app.</span> </p>
<p><span data-start="1682.78" data-end="1683.881">And we were using PREACT.</span> <span data-start="1683.881" data-end="1684.88">And you're going to be — </span> <span data-start="1684.88" data-end="1685.99">got Web Components.</span> <span data-start="1685.99" data-end="1688">And they were kind of surprised.</span> <span data-start="1688" data-end="1690.4">Because they were asking questions like, well, wait.</span> <span data-start="1690.4" data-end="1692.507">Isn't Web Components an alternative to frameworks?</span> </p>
</section>

<section>
<p><span data-start="1692.507" data-end="1694.09"><span class="speaker">Jake Archibald</span>: Yeah, but they're not.</span> <span data-start="1694.09" data-end="1695.41">I don't know why you would think that.</span> <span data-start="1695.41" data-end="1696.98">Well, actually, I don't know why you would think that,</span> <span data-start="1696.98" data-end="1698.355">and I think it's our fault. Well,</span> <span data-start="1698.355" data-end="1700.112">I think it's Google's fault. I think</span> <span data-start="1700.112" data-end="1702.07">our messaging suggested that Web Components are</span> <span data-start="1702.07" data-end="1703.75">the same thing as Polymer.</span> <span data-start="1703.75" data-end="1706.15">And Polymer is an alternative to the frameworks.</span> <span data-start="1706.15" data-end="1708.37">But web-components, they're not the same thing.</span> <span data-start="1708.37" data-end="1710.05">Web Components are the lower level</span> <span data-start="1710.05" data-end="1711.257">primitive that Polymer uses.</span> </p>
</section>

<section>
<p><span data-start="1711.257" data-end="1712.09"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1712.09" data-end="1716.07">We did use Polymer's custom element polyfill for Edge.</span> <span data-start="1716.07" data-end="1719.01">But for other browsers, we just shipped the Vanilla web</span> <span data-start="1719.01" data-end="1720.035">components</span> </p>
</section>

<section>
<p><span data-start="1720.035" data-end="1720.91"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1720.91" data-end="1723.201">We used custom elements for some of our leaf components</span> <span data-start="1723.201" data-end="1725.696">that contained the minimal amount of state.</span> <span data-start="1725.696" data-end="1727.57">For instance, this is the pinch-zoom element.</span> <span data-start="1727.57" data-end="1730.04">Just put stuff inside it; now you can pinch-zoom it.</span> <span data-start="1730.04" data-end="1731.57">And it has an API.</span> <span data-start="1731.57" data-end="1734.8">We also did this with our side-by-side slidy thing,</span> <span data-start="1734.8" data-end="1735.37">comparison.</span> </p>
</section>

<section>
<p><span data-start="1735.37" data-end="1736.24"><span class="speaker">Mariko Kosaka</span>: We call it two-up.</span> </p>
</section>

<section>
<p><span data-start="1736.24" data-end="1737.53"><span class="speaker">Jake Archibald</span>: We call it a two-up, yeah,</span> <span data-start="1737.53" data-end="1738.76">because we didn't know what else to call it.</span> <span data-start="1738.76" data-end="1740.56">A fancy range input, drop target — </span> <span data-start="1740.56" data-end="1742.78">we made components for all these bits and pieces.</span> </p>
</section>

<section>
<p><span data-start="1742.78" data-end="1743.613"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1743.613" data-end="1746.26">So we could have done all of this in PREACT component</span> <span data-start="1746.26" data-end="1747.7">because we were using PREACT.</span> <span data-start="1747.7" data-end="1750.97">But using Web Components, we can take that</span> <span data-start="1750.97" data-end="1753.22">and put it into some other project using</span> <span data-start="1753.22" data-end="1757.21">different frameworks or just use it as is in the project</span> <span data-start="1757.21" data-end="1758.95">that you don't really need framework.</span> </p>
</section>

<section>
<p><span data-start="1758.95" data-end="1759.13"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1759.13" data-end="1760.15">And if you're open sourcing client,</span> <span data-start="1760.15" data-end="1762.108">Web Components are the best way to share things</span> <span data-start="1762.108" data-end="1763.627">like this, so we did.</span> <span data-start="1763.627" data-end="1765.46">We have released a few of our Web Components</span> <span data-start="1765.46" data-end="1766.28">a separate project.</span> <span data-start="1766.28" data-end="1768.34">So we'll make more available as we extract them</span> <span data-start="1768.34" data-end="1769.539">from the main app.</span> <span data-start="1769.539" data-end="1770.83">We were hoping to release more.</span> <span data-start="1770.83" data-end="1772.121">But uh, we've run out of Time — </span> <span data-start="1772.121" data-end="1772.87">Whatever.</span> <span data-start="1772.87" data-end="1774.55">We used PREACT, but these things,</span> <span data-start="1774.55" data-end="1777.737">they can be used in Vue, Svelte, Angular, React, whatever.</span> </p>
</section>

<section>
<p><span data-start="1777.737" data-end="1778.57"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1778.57" data-end="1781.54">Most frameworks are fine with Web Component.</span> <span data-start="1781.54" data-end="1784.22">But some have a few rough edges.</span> <span data-start="1784.22" data-end="1787.735">So if you are curious, check out custom-elements-everywhere.com</span> <span data-start="1787.735" data-end="1791.63">to see how custom elements work with whatever the framework you</span> <span data-start="1791.63" data-end="1793.3">are using.</span> </p>
</section>

<section>
<p><span data-start="1793.3" data-end="1795.05"><span class="speaker">Jake Archibald</span>: We also released libraries</span> <span data-start="1795.05" data-end="1796.31">for some of the other things we built,</span> <span data-start="1796.31" data-end="1797.894">like a pointer event helper, thing,</span> <span data-start="1797.894" data-end="1800.06">and a webpack plugin for dealing with asset inlining</span> <span data-start="1800.06" data-end="1801.26">and optimization.</span> <span data-start="1801.26" data-end="1803.24">So it has been — </span> <span data-start="1803.24" data-end="1805.1">well, we're vastly running out of time — </span> <span data-start="1805.1" data-end="1809.45">20-odd minutes, and I haven't yet mentioned service workers.</span> </p>
</section>

<section>
<p><span data-start="1809.45" data-end="1811.91"><span class="speaker">Mariko Kosaka</span>: A new record at the very end, very end.</span> </p>
</section>

<section>
<p><span data-start="1811.91" data-end="1813.547"><span class="speaker">Jake Archibald</span>: New personal record.</span> <span data-start="1813.547" data-end="1814.88">Yes, the site does work offline.</span> <span data-start="1814.88" data-end="1816.89">Our service worker approach isn't particularly novel.</span> <span data-start="1816.89" data-end="1817.7">We catch the things.</span> <span data-start="1817.7" data-end="1818.45">We serve the things.</span> <span data-start="1818.45" data-end="1819.43">That means it works offline.</span> <span data-start="1819.43" data-end="1820.85">And we also let the user know when</span> <span data-start="1820.85" data-end="1822.42">there's an update available.</span> </p>
</section>

<section>
<p><span data-start="1822.42" data-end="1823.253"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1823.253" data-end="1827.9">But there's one unique thing about this Squoosh.</span> <span data-start="1827.9" data-end="1832.19">That is, when users first visit the site, we cache all of it</span> <span data-start="1832.19" data-end="1833.75">in the next interaction.</span> <span data-start="1833.75" data-end="1838.55">But we do not cache any of the codec, the 300 kilobyte bit,</span> <span data-start="1838.55" data-end="1841.4">until the user access will drop the image</span> <span data-start="1841.4" data-end="1842.82">and then get to this view.</span> </p>
</section>

<section>
<p><span data-start="1842.82" data-end="1842.96"><span class="speaker">Jake Archibald</span>: Yeah.</span> <span data-start="1842.96" data-end="1845">And this was just being kind to the user's bandwidth.</span> <span data-start="1845" data-end="1846.458">When the user just visits the site,</span> <span data-start="1846.458" data-end="1849.124">it feels rude to download the whole 400k app.</span> <span data-start="1849.124" data-end="1850.79">So we wait for some signal from the user</span> <span data-start="1850.79" data-end="1852.26">that they're actually interested.</span> <span data-start="1852.26" data-end="1854.21">And that's when we cache the chunkier parts.</span> </p>
</section>

<section>
<p><span data-start="1854.21" data-end="1855.043"><span class="speaker">Mariko Kosaka</span>: Yeah.</span> <span data-start="1855.043" data-end="1857.09">And this is what we love about the web, right?</span> <span data-start="1857.09" data-end="1859.4">Write it once, build it, and then put it</span> <span data-start="1859.4" data-end="1865.415">into phone, tablet, desktop, with the fraction of the size.</span> </p>
</section>

<section>
<p><span data-start="1865.415" data-end="1867.54"><span class="speaker">Jake Archibald</span>: Of the equivalent native app, yeah.</span> <span data-start="1867.54" data-end="1870.32">And those native apps are only targeting one operating system.</span> <span data-start="1870.32" data-end="1871.76">Whereas, we can hit loads of them.</span> <span data-start="1871.76" data-end="1873.71">And to share it, just copy the URL — </span> </p>
</section>

<section>
<p><span data-start="1873.71" data-end="1874.43"><span class="speaker">Mariko Kosaka</span>: That's the best part.</span> </p>
</section>

<section>
<p><span data-start="1874.43" data-end="1874.73"><span class="speaker">Jake Archibald</span>:  — and send it to someone.</span> </p>
</section>

<section>
<p><span data-start="1874.73" data-end="1875.72"><span class="speaker">Mariko Kosaka</span>: That's the best part of the web.</span> </p>
</section>

<section>
<p><span data-start="1875.72" data-end="1876.72"><span class="speaker">Jake Archibald</span>: Love it.</span> </p>
</section>

<section>
<p><span data-start="1876.72" data-end="1879.12"><span class="speaker">Mariko Kosaka</span>: So if you want to dig into the code,</span> <span data-start="1879.12" data-end="1880.61">it's all on GitHub.</span> <span data-start="1880.61" data-end="1883.1">There are lots of things we want to do.</span> <span data-start="1883.1" data-end="1886.61">There are bugs to fix, codecs we want to include.</span> <span data-start="1886.61" data-end="1890.02">And if you're interested, please come join us to build this up.</span> <span data-start="1890.02" data-end="1893.047">We really want this tool to be really useful to everyone.</span> </p>
</section>

<section>
<p><span data-start="1893.047" data-end="1894.38"><span class="speaker">Jake Archibald</span>: Yes, absolutely.</span> <span data-start="1894.38" data-end="1896.09">So thanks for listening.</span> <span data-start="1896.09" data-end="1898.469">Now go Squoosh some images.</span> </p>
</section>

<section>
<p><span data-start="1898.469" data-end="1900.26"><span class="speaker">Mariko Kosaka</span>: Please never say that again.</span> <span data-start="1900.26" data-end="1901.16">[APPLAUSE]</span> <span data-start="1901.16" data-end="1902.153">Thank you very much.</span> </p>
</section>

<section>
<p><span data-start="1902.153" data-end="1902.34"><span class="speaker">Jake Archibald</span>: I promise nothing.</span> <span data-start="1902.34" data-end="1903.53">Thank you very much.</span> <span data-start="1903.53" data-end="1905.68">[MUSIC PLAYING]</span> </p>
</section>