<!DOCTYPE html>

<! — 
Copyright 2018 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
 — >

<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="//google.com">
<meta name="description" content="Chrome Dev Summit">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>lK3OiJvwgSc</title>
<link rel="stylesheet" href="css/main.css">
</head>

<body>

<div id="video"></div>

<iframe id="youtube" src="https://www.youtube.com/embed/lK3OiJvwgSc?enablejsapi=1"></iframe>

<div id="container">

<div id="google-translate"></div>

<section>
<span data-start="0">[MUSIC PLAYING]</span> </section>

<section><span data-start="7010"><span class="speaker">Surma</span>: Hello, everybody.</span> <span data-start="8270">Yes, it's me again.</span> <span data-start="9140">Prepare for more bugs.</span> <span data-start="12225">I'm kind of excited to be here because we finally reached</span> <span data-start="14600">a point where, with Houdini, I can talk about actual APIs.</span> <span data-start="20960">Because they're starting to land, and that's</span> <span data-start="22910">kind of really exciting.</span> <span data-start="25160">But as with any talk, I have to start with what Houdini is.</span> <span data-start="29122">Because on my Twitter, I often see there's still confusion.</span> <span data-start="31580">Because it turns out there's a software called Houdini.</span> <span data-start="34190">There is apparently a magician that was called Houdini.</span> <span data-start="37590">So I want to clear up what Houdini really is about.</span> <span data-start="42270">So every browser has more or less four major stages</span> <span data-start="47117">in the rendering pipeline.</span> <span data-start="48200">It starts with styles, where the browser collects all the style</span> <span data-start="51110">sheets that are in the document and then figures</span> <span data-start="53120">out which element is affected by which of these styles.</span> <span data-start="57200">And now that we know the width, the height,</span> <span data-start="59750">and if it's Flexbox or Grid, which style is on which</span> <span data-start="64459">element, we can do layout.</span> <span data-start="65720">We can basically calculate how big an element is</span> <span data-start="68420">and align them on the page and get boxes on the page.</span> <span data-start="73040">They are still empty and transparent</span> <span data-start="74800">because in the next stage we can take that layout page</span> <span data-start="77900">and paint it, just draw it.</span> <span data-start="79962">And we can draw it all on the page.</span> <span data-start="81420">Sometimes elements get on their own piece of paper,</span> <span data-start="84300">which is called a layer.</span> <span data-start="86300">And once we are done painting, respecting</span> <span data-start="88160">things like background color and the text color and the border</span> <span data-start="90800">color, we can give all of that, all this pieces of paper</span> <span data-start="93920">to the compositor and put them together in the page</span> <span data-start="96770">that you will see on your screen.</span> <span data-start="98497">And if something was on its own layer,</span> <span data-start="100080">we can move the pieces of paper around.</span> <span data-start="101704">And that's how animations are made.</span> <span data-start="103255">It's obviously kind of a shortcut</span> <span data-start="104630">but you can see where I'm coming from.</span> <span data-start="107790">So bringing it back to the question,</span> <span data-start="109290">what really is Houdini?</span> <span data-start="110570">Well, Houdini is a standards effort in the CSS working</span> <span data-start="113990">group in the W3C to expose hooks into these major stages</span> <span data-start="118490">of the layout phase to the developer, to you.</span> <span data-start="121220">So you have more control not only over the visuals</span> <span data-start="123650">but to write better polyfills and have</span> <span data-start="125540">more control over how your page just appears to the user.</span> <span data-start="130970">It is hard because these four stages</span> <span data-start="133039">are different in every browser.</span> <span data-start="134330">Sometimes they're even parallel or not even</span> <span data-start="136820">that clearly separated.</span> <span data-start="138255">But we're working with all the browsers</span> <span data-start="139880">to make sure everybody can implement these APIs.</span> <span data-start="144170">Houdini can be super intimidating at first.</span> <span data-start="147320">Because under the Houdini umbrella,</span> <span data-start="148940">there's a lot of APIs.</span> <span data-start="150410">And you don't really immediately know what to do with what.</span> <span data-start="153470">But they actually kind of form a hierarchy.</span> <span data-start="156530">So you have four high-level APIs, four major APIs</span> <span data-start="161600">that basically represent those four major stages</span> <span data-start="164210">of the rendering pipeline.</span> <span data-start="165560">And then you have a couple of lower-level APIs that</span> <span data-start="167750">build the underpinning, the basis for Houdini</span> <span data-start="170300">and that make these higher-level APIs</span> <span data-start="172100">possible in the first place.</span> <span data-start="173720">And specifically, worklets are really interesting.</span> <span data-start="176970">Worklets are kind of the Swiss Army knife</span> <span data-start="180080">within Houdini for performance.</span> <span data-start="181780">And so I want to make sure I take a second</span> <span data-start="183530">to explain these because we're going to use them</span> <span data-start="185090">for the rest of the talk.</span> <span data-start="186350">And more importantly, I want to distinguish them from workers.</span> <span data-start="190252">Because lots of people confuse these two,</span> <span data-start="191960">and I can't blame them because they sound very similar.</span> <span data-start="194280">And in fact, they actually have a lot of overlap.</span> <span data-start="197460">But there is a couple of very important differences</span> <span data-start="199805">that I want explain to you.</span> <span data-start="200930">And for that, we have to talk about the event loop.</span> <span data-start="206250">This is an event loop.</span> <span data-start="207610">And if you don't know much about the event loop,</span> <span data-start="209610">that's absolutely fine.</span> <span data-start="210740">Everything that you need to know,</span> <span data-start="212114">I will explain to you today.</span> <span data-start="213360">But if you want to know more, I really</span> <span data-start="214943">recommend watching Jake's talk about the event loop, which</span> <span data-start="218239">you can probably find on YouTube if you just type</span> <span data-start="220280">in his name and event loop.</span> <span data-start="221720">And actually, I'm using a lot of his visuals in this talk.</span> <span data-start="226170">So this is an event loop.</span> <span data-start="228170">It's a loop, and it processes events.</span> <span data-start="230630">And it's called an event loop.</span> <span data-start="233510">Whenever an event happens, the JavaScript engine</span> <span data-start="235520">checks if there's a handler for this event in your code base</span> <span data-start="239180">and then takes the code for that handler and queues it up.</span> <span data-start="242480">And every turn, the event loop takes something out</span> <span data-start="244910">of the queue and runs it.</span> <span data-start="246069">And then, in the next turn, it takes the next thing out</span> <span data-start="248360">of the queue and runs it.</span> <span data-start="249800">And that's obviously super simplified,</span> <span data-start="252020">and there's much more nuance to this entire thing.</span> <span data-start="254630">But that's kind of how an event loop works.</span> <span data-start="257060">And in this world, a worker would look like this.</span> <span data-start="261267">It's a completely separate event loop.</span> <span data-start="262850">It's an isolated scope.</span> <span data-start="264020">It has its own handlers, its own events.</span> <span data-start="266450">And they have nothing to do with each other.</span> <span data-start="269310">They might be able to put a task into the other loop's</span> <span data-start="271940">queue with postMessage, but that's pretty much it.</span> <span data-start="276030">And there is considerable cost to spinning up and maintaining</span> <span data-start="279590">an event loop, and that's why you can't just</span> <span data-start="281750">spin up 1,000 workers and call it a day.</span> <span data-start="284450">Because that's actually quite costly.</span> <span data-start="287090">Worklets are different.</span> <span data-start="289180">They're also isolated JavaScript code with their own scope.</span> <span data-start="293450">But worklets don't have an event loop.</span> <span data-start="296210">Instead, they kind of attach to already existing event loops.</span> <span data-start="300590">And that makes them a lot cheaper to create and maintain.</span> <span data-start="304079">You can even attach multiple worklets</span> <span data-start="305620">to an already existing event loop.</span> <span data-start="307340">And because most worklets are specified to be stateless,</span> <span data-start="311750">we can even migrate them in the middle of their lifetime.</span> <span data-start="314925">So if it makes more sense for your code</span> <span data-start="316550">to run in sync with another event loop,</span> <span data-start="318174">we can just [POP] take it off and take it to the next event</span> <span data-start="321350">loop where it makes more sense.</span> <span data-start="323760">So this will come in really handy later on,</span> <span data-start="326210">but that's basically the big difference between those two.</span> <span data-start="328830">And now that we have worklets in our back pocket,</span> <span data-start="331490">we can finally talk about the very first Houdini API,</span> <span data-start="335450">which is for the paint worklet.</span> <span data-start="338240">So as I said — </span> <span data-start="340149">I'm not going to go through these in order, by the way,</span> <span data-start="342440">more like in order of [? availability ?]</span> <span data-start="344106">if that makes sense.</span> <span data-start="345410">But for the paint worklets, the API</span> <span data-start="347180">is called the CSS Paint API.</span> <span data-start="349510">And as I said, all elements have to be painted sooner or later</span> <span data-start="352370">to be able to appear onscreen.</span> <span data-start="354810">And so far, you have been able to use</span> <span data-start="357080">CSS to customize how your elements appear</span> <span data-start="359440">onscreen but only with those ways that CSS exposes.</span> <span data-start="364430">So for example, if you want to do rounded corners,</span> <span data-start="367850">you can reduce border radius.</span> <span data-start="369380">And you get this, and it's kind of great.</span> <span data-start="371804">But it also turns out that there's</span> <span data-start="373220">different ways to make a box seem</span> <span data-start="376220">like it has rounded corners.</span> <span data-start="377510">And if you want to use any of these other ways,</span> <span data-start="380137">you're kind of screwed nowadays.</span> <span data-start="381470">Because what do you do?</span> <span data-start="382670">So for example, there is a so-called squircle, which</span> <span data-start="385610">mathematically speaking, is closer</span> <span data-start="387320">to a circle than a square.</span> <span data-start="388970">And it doesn't change curvature abruptly at all.</span> <span data-start="391710">So it has a kind of different aesthetic look,</span> <span data-start="393710">which could be kind of nice.</span> <span data-start="395900">So if you wanted to have this thing on the web today,</span> <span data-start="399056">what do you do?</span> <span data-start="399680">You can maybe do an SVG background image,</span> <span data-start="402060">which is not really a border.</span> <span data-start="403670">You could maybe use a canvas or a 9-slice image — </span> <span data-start="408650">I don't know.</span> <span data-start="409310">But with Houdini, you can actually</span> <span data-start="410960">teach CSS how to draw the exact look that you</span> <span data-start="414380">want to have on your page.</span> <span data-start="416280">So how does this work?</span> <span data-start="417630">Step one with all worklets is that you</span> <span data-start="420170">have to load a JavaScript file into the worklet</span> <span data-start="423860">that the browser gives to you.</span> <span data-start="425640">So in this case, we have the CSS namespace,</span> <span data-start="427809">and all the worklets that Houdini brings to the browser</span> <span data-start="430100">are going to be in this CSS namespace sooner or later.</span> <span data-start="433009">So in this case, it's called Paint Worklet.</span> <span data-start="434800">And every worklet has an addModule call</span> <span data-start="436790">with which you can load a JavaScript</span> <span data-start="438290">file into that worklet.</span> <span data-start="439970">Let's take a look inside this file.</span> <span data-start="443260">In that file, we want to teach CSS</span> <span data-start="445960">how to paint something new with JavaScript.</span> <span data-start="448450">But first, it needs a name.</span> <span data-start="450080">So there is a registerPaint function, and it takes a class.</span> <span data-start="453760">And now, we want to basically associate</span> <span data-start="455800">a name with that class.</span> <span data-start="457120">And every paint class — </span> <span data-start="458500">in this case, I'm using my-paint — </span> <span data-start="460420">we need to define a paint call.</span> <span data-start="463000">And this paint call gets a context,</span> <span data-start="465040">which is almost identical to the canvas contact</span> <span data-start="467710">that you're hopefully familiar with;</span> <span data-start="469480">a geometry object, which tells you how much width and height</span> <span data-start="473170">the element has that you're supposed to paint;</span> <span data-start="475409">and a properties object, which allows</span> <span data-start="476950">you to read the styles of the object</span> <span data-start="478760">that you are painting —  so like, background color, text color,</span> <span data-start="480880">font size.</span> <span data-start="481450">All these things are in there for you to read.</span> <span data-start="484392">And now, what I'm doing here is basically</span> <span data-start="486100">I'm setting my fill style to hotpink.</span> <span data-start="487960">And just draw the biggest possible circle</span> <span data-start="489850">in the middle of the element — </span> <span data-start="491290">not very useful, but in the way useful for me to show you</span> <span data-start="493870">what is actually going on.</span> <span data-start="495790">So now that we have defined how to draw this appearance,</span> <span data-start="499150">how do we tell the browser to actually use</span> <span data-start="500980">this new appearance?</span> <span data-start="502480">So we do that in CSS.</span> <span data-start="503650">So in this case, I'm just adding a new style.</span> <span data-start="505540">And you can use paint worklets everywhere</span> <span data-start="507490">that CSS expects an image.</span> <span data-start="509390">So in this case, I'm setting the background image not to a URL</span> <span data-start="512320">but to a paint and use the name that I</span> <span data-start="514970">used in registerPaint in here.</span> <span data-start="516220">So here, I use paint(my-paint).</span> <span data-start="519760">And this is actually — </span> <span data-start="521940">if it works?</span> <span data-start="525110">No?</span> <span data-start="527850">This is not good.</span> <span data-start="531077">Told you, prepare for more bugs.</span> <span data-start="535730">No, the entire laptop froze.</span> <span data-start="538320">[LAUGHTER]</span> <span data-start="539131">No!</span> <span data-start="544220">OK, maybe it's coming back to life.</span> <span data-start="546120">I'm going to try something.</span> <span data-start="548162">[LAUGHTER]</span> <span data-start="551640">I achieved something today.</span> <span data-start="554260">All right, as I was saying, we load the file.</span> <span data-start="558240">We had that.</span> <span data-start="559200">We had this one.</span> <span data-start="560280">We draw a circle in the middle, and I</span> <span data-start="562390">want to do the big reveal where we use the paint</span> <span data-start="564390">function for the background image</span> <span data-start="565765">instead of just a normal SVG image.</span> <span data-start="568380">I'm going to press the button.</span> <span data-start="570764">[APPLAUSE]</span> <span data-start="575300">We have a pink circle.</span> <span data-start="577100">I'm so happy.</span> <span data-start="578090">By the way, everyone, thank you so much</span> <span data-start="579815">for the kind messages on Twitter and your support here</span> <span data-start="582065">in the room.</span> <span data-start="582440">It could have been so much worse.</span> <span data-start="583940">Thank you very much.</span> <span data-start="586532">All right, what I'm doing here is, as I said,</span> <span data-start="588530">I set the background image on a text area.</span> <span data-start="590460">So this is a text area where I'm animating width and height.</span> <span data-start="593030">Don't do this at home, kids.</span> <span data-start="594196">Never animate width and height.</span> <span data-start="595970">But you can see the circle is pink and in the middle.</span> <span data-start="600060">So you might be asking, what is the advantage of using</span> <span data-start="602700">Houdini's Paint API —  what this talk is about — </span> <span data-start="605750">over using a normal canvas?</span> <span data-start="606875">So there's a couple of things I want to talk about.</span> <span data-start="609000">The first one is auto-repaint, meaning</span> <span data-start="611060">that the browser can figure out when it actually</span> <span data-start="613250">needs to run your code to do these painting operations.</span> <span data-start="616154">I'm going to talk a bit about this more a little bit</span> <span data-start="618320">later in the talk.</span> <span data-start="620180">It is auto-sized.</span> <span data-start="621230">If you've ever worked with the HTML canvas,</span> <span data-start="623240">you know that the number of pixels on an HTML canvas</span> <span data-start="626240">is completely independent from the number of pixels</span> <span data-start="628880">a canvas has on the screen, which</span> <span data-start="630950">is super painful to work with.</span> <span data-start="632201">And in this case, you don't have to worry</span> <span data-start="633908">about it because it is automatically</span> <span data-start="635540">set to the correct size.</span> <span data-start="638060">It is off main thread, meaning the code</span> <span data-start="639800">that you write to do the paint operation doesn't</span> <span data-start="642140">run on the main thread.</span> <span data-start="644120">And that's a lie.</span> <span data-start="645170">Currently in Chrome, we do run it on the main thread.</span> <span data-start="647450">But as I said, the worklets can be migrated.</span> <span data-start="650310">So the second we have the infrastructure in place</span> <span data-start="652460">to run this kind of code somewhere else,</span> <span data-start="654530">it will just happen.</span> <span data-start="655830">And that means you don't use any of your main thread budget</span> <span data-start="659630">making sure your page is buttery smooth.</span> <span data-start="663320">No DOM overhead —  and this one is actually very underrated.</span> <span data-start="666500">Often, I see effects on the web that</span> <span data-start="668780">use a couple of DOM elements or any kind of assembly</span> <span data-start="672230">of different styles to achieve a certain visual effect.</span> <span data-start="675200">With this, you're just using a virtual canvas,</span> <span data-start="677590">so not even one DOM element to achieve this effect.</span> <span data-start="681110">And that can really add up on low-end phones.</span> <span data-start="683510">So for example, this is one of the — </span> <span data-start="685430">no.</span> <span data-start="686607">[LAUGHTER]</span> <span data-start="689810">No!</span> <span data-start="692300">Wait.</span> <span data-start="693350">For me, this just means I'm going to skip that slide.</span> <span data-start="697620">So what I'm going to do is I'm going to go out of fullscreen,</span> <span data-start="702220">and moving this to a different slide,</span> <span data-start="706320">going back into fullscreen.</span> <span data-start="709980">And we're going to go to this one.</span> <span data-start="714960">All right.</span> <span data-start="716180">[LAUGHTER]</span> <span data-start="719575">[APPLAUSE]</span> <span data-start="726860">Wow.</span> <span data-start="728330">All right, my point that I was trying to make was that we</span> <span data-start="735350">found that on low-end devices, implementing these kind</span> <span data-start="738290">of effects — </span> <span data-start="738860">like this wonderful effect that [? Una ?] implemented — </span> <span data-start="741650">is actually more efficient in the paint worklet</span> <span data-start="744920">than using a million DOM elements.</span> <span data-start="747251">So that's why this is actually a performance [? formative ?]</span> <span data-start="749750">to make your app run buttery smooth</span> <span data-start="751500">even on the low-end devices.</span> <span data-start="753200">So this is another effect that [? Una ?] wrote</span> <span data-start="755116">that I think is really nice.</span> <span data-start="756650">And this is kind of a nice example</span> <span data-start="759500">to show how the browser can decide when to paint and when</span> <span data-start="763580">not to paint.</span> <span data-start="764200">So in the paint class, you can declare your dependencies.</span> <span data-start="767750">You can say these are the CSS properties that I rely on.</span> <span data-start="771500">And so the browser knows only when</span> <span data-start="773180">any of these properties change will the code have to run.</span> <span data-start="776460">Otherwise, it won't.</span> <span data-start="778050">And so, in this case, you have a couple of custom properties</span> <span data-start="780560">saying, I want to have this number of stars and this hue</span> <span data-start="783710">and this different sizes kind of thing.</span> <span data-start="786590">And then in CSS, I just do a keyframe animation on the hue,</span> <span data-start="789410">and you end up with this effect.</span> <span data-start="791480">And it's actually efficient in the sense it doesn't run just</span> <span data-start="794420">[INAUDIBLE] every frame but only repaints when</span> <span data-start="796400">the animation actually tells you that it's necessary.</span> <span data-start="801700">This is another effect, a simple clock,</span> <span data-start="803790">that many people might write with SVG or with a canvas.</span> <span data-start="807661">Some people would, again, probably bend over backwards</span> <span data-start="809910">and try to make this happen with a DOM and just a couple of DOM</span> <span data-start="812850">elements.</span> <span data-start="813580">But if you look closely, you can see that the hand actually</span> <span data-start="816038">has a trail, and that suddenly makes it a lot harder</span> <span data-start="818580">to do with SVG or with the DOM.</span> <span data-start="820350">And maybe canvas would be more appropriate.</span> <span data-start="822780">The nice thing here is that you can have this module, a clock</span> <span data-start="825540">CSS Houdini module, and configure it</span> <span data-start="828270">with just a couple of custom properties.</span> <span data-start="830350">So you can animate the background color or the color</span> <span data-start="832800">of the hands, the thickness of the hands,</span> <span data-start="835290">the thickness of the circle at the end, or the length.</span> <span data-start="838170">You can show or not show the individual stops on the clock.</span> <span data-start="841242">You could do all of these things at once,</span> <span data-start="842950">but it gets really stressful to look at.</span> <span data-start="845480">So I wouldn't do that.</span> <span data-start="847230">But it's just a clock.</span> <span data-start="848190">And once again, this trail is just a CSS transition.</span> <span data-start="851350">So the browser knows, while the transition is going on,</span> <span data-start="854130">I need to repaint this every frame.</span> <span data-start="856140">But the second the trail is done, it stops repainting.</span> <span data-start="858732">It's a really easy performance win.</span> <span data-start="863190">So far, we've been using CSS Paint for background images.</span> <span data-start="866940">And we have gotten pretty far I think,</span> <span data-start="868920">if you still remember what I was talking about a couple of hours</span> <span data-start="872040">ago it feels like.</span> <span data-start="873820">But you can use it anywhere where CSS expects an image.</span> <span data-start="876589">So for example, you could also use it</span> <span data-start="878130">for a mask image or a border image.</span> <span data-start="880272">So in the land of border image, you</span> <span data-start="881730">could make this kind of organic look, where the border looks</span> <span data-start="886050">kind of hand-drawn.</span> <span data-start="886944">And if you want that kind of look,</span> <span data-start="888360">CSS Paint makes it really easy to achieve that effect.</span> <span data-start="892026">This is probably a very important</span> <span data-start="893400">progressive enhancement.</span> <span data-start="895230">You can detect support for Paint Worklet in both JavaScript</span> <span data-start="897920">and CSS.</span> <span data-start="899340">One note about the at syntax for @supports,</span> <span data-start="902760">it detects support for Paint Worklet,</span> <span data-start="904920">not for one specific Paint Worklet.</span> <span data-start="907240">So even if the name —  like in this case, something — </span> <span data-start="909600">doesn't actually exist as a Paint Worklet,</span> <span data-start="911460">it will still get evaluated, which is kind of handy.</span> <span data-start="915090">For this talk, I want to introduce</span> <span data-start="916980">the 3PigStability index, which is supposed</span> <span data-start="919260">to be a little notion of how stable an API is,</span> <span data-start="923100">based on the story of the three pigs</span> <span data-start="924780">and the wolf who tries to blow their house down.</span> <span data-start="927070">So in this case, in the CSS Paint API,</span> <span data-start="929910">the spec is a [INAUDIBLE] recommendation,</span> <span data-start="932530">which is basically W3C-speak for, it's stable.</span> <span data-start="936230">It's shipped to stable in Chrome.</span> <span data-start="938130">Safari announced that they have it in development right now.</span> <span data-start="941170">And with that, I will call it brick stability.</span> <span data-start="944454">That at the bottom, by the way, is</span> <span data-start="945870">supposed to be a brick emoji.</span> <span data-start="947132">But the brick emoji just got standardized</span> <span data-start="948840">in June of this year, so none of the fonts have it yet.</span> <span data-start="951131">But luckily, it still kind of looks like a brick.</span> <span data-start="955170">If you want to know more about this API,</span> <span data-start="957060">I'm going to shamelessly self-plug the article that I</span> <span data-start="959460">wrote, which you can find here.</span> <span data-start="962210">If you have any questions, hit me up any time.</span> <span data-start="964950">And with that out the way, we finally</span> <span data-start="967440">have talked about the first Houdini API.</span> <span data-start="969810">I'm going to go onto the next one</span> <span data-start="971370">and see if the browser will handle this.</span> <span data-start="973260">I just realized I — </span> <span data-start="975680">should I risk hiding the URL above?</span> <span data-start="977890">I will do it, good.</span> <span data-start="980970">The next one —  compositing.</span> <span data-start="982695">As I said, the compositor main job</span> <span data-start="984450">is to do animations with the papers that move around.</span> <span data-start="987270">So as such, the animation is called the Animation Worklet</span> <span data-start="991421">API.</span> <span data-start="991920">So let's talk about that a bit.</span> <span data-start="993575">If you currently think about animations on the web,</span> <span data-start="995700">you have three choices.</span> <span data-start="996995">It's more like 2 and 1/2 choices.</span> <span data-start="998370">You have CSS transitions, which allow</span> <span data-start="1000039">you to transition a CSS property from the current value</span> <span data-start="1002330">to a new value.</span> <span data-start="1003560">You have CSS keyframe animations,</span> <span data-start="1005060">which are a declarative timeline API, which is more powerful</span> <span data-start="1010190">and can do some kind of looping.</span> <span data-start="1012170">And you have Web Animations API, which</span> <span data-start="1014090">is the imperative version that allows</span> <span data-start="1016100">you to do nested timelines and all sorts of things.</span> <span data-start="1020100">But the problem is that it's really badly supported.</span> <span data-start="1022400">It's behind a flag in Safari.</span> <span data-start="1023990">Chrome has an implantation but it's missing a lot of features.</span> <span data-start="1027109">Edge doesn't have it at all.</span> <span data-start="1028410">So it really isn't usually a good choice.</span> <span data-start="1031730">But even if it was, there are often</span> <span data-start="1033560">scenarios where what Web Animations API offers</span> <span data-start="1036589">is not enough.</span> <span data-start="1038210">And this is where Animation Worklet API would come in.</span> <span data-start="1042180">So what you see here is a normal Web Animations API animation.</span> <span data-start="1048710">Usually Web Animations API is thought about in the .animate</span> <span data-start="1051560">call.</span> <span data-start="1052280">This is the same thing, just a little bit more elaborate.</span> <span data-start="1054655">It's also part of the API.</span> <span data-start="1056030">And a worklet animation is actually very, very similar.</span> <span data-start="1058440">So for example, I would just use a worklet animation</span> <span data-start="1061100">instead of an animation.</span> <span data-start="1062270">And because we are associating this animation with a worklet,</span> <span data-start="1065510">we need to, once again, provide a worklet name.</span> <span data-start="1068592">Other than that, it stays the same.</span> <span data-start="1070050">So we have the keyframe effect that we target an element with,</span> <span data-start="1072500">and we have two keyframes that we</span> <span data-start="1073970">want to use within two seconds.</span> <span data-start="1077350">Then now we have an animation worklet on this CSS namespace</span> <span data-start="1080140">and can call addModule.</span> <span data-start="1081610">And now, within our animation file, we can use JavaScripts.</span> <span data-start="1085915">We have an animate callback where</span> <span data-start="1087290">we get the current time and the effect of the animation.</span> <span data-start="1089770">And now it's our job to set the local time of the effect</span> <span data-start="1092870">depending on the current time.</span> <span data-start="1094862">If we do it like this, where we don't think about it,</span> <span data-start="1097070">it's literally a pass through.</span> <span data-start="1098320">And it will behave just like a normal web animation API.</span> <span data-start="1101920">But this is JavaScript, so you can basically</span> <span data-start="1104110">implement arbitrarily complex time mappings.</span> <span data-start="1107920">Now, what does this actually mean?</span> <span data-start="1109960">I'm not going to go into all the details of this API</span> <span data-start="1112180">but just going to give you a little taste of it.</span> <span data-start="1114180">So if you want to know more, I'm going</span> <span data-start="1115270">to shamelessly self-plug another article I</span> <span data-start="1117020">wrote, which you can find here.</span> <span data-start="1118842">And again, read it, and give me feedback.</span> <span data-start="1120550">I would very much welcome that.</span> <span data-start="1122890">But what do you use Animation Worklet for?</span> <span data-start="1125020">So for example, I think a year ago or two years ago,</span> <span data-start="1128110">Safari proposed the spring timing function.</span> <span data-start="1131799">And it's implemented in Safari.</span> <span data-start="1133090">I don't think any other browser has implemented it so far.</span> <span data-start="1137080">But what do you do if you want to use it?</span> <span data-start="1139070">Or what do you do if you have any other timing function that</span> <span data-start="1141570">doesn't exist and you want to use it?</span> <span data-start="1143174">This is where Animation Worklet would come in handy.</span> <span data-start="1145340">So in this case, we can, for example,</span> <span data-start="1146881">write a bounce animator.</span> <span data-start="1148060">Because if you think about it, if you animate an element</span> <span data-start="1150393">from A to B, you can either just move it from A to B,</span> <span data-start="1153280">but you could also move it from A to B and a little bit back</span> <span data-start="1155790">and a little less back, and it will</span> <span data-start="1156940">look kind of like a bounce.</span> <span data-start="1158350">And that's exactly what we're going to do.</span> <span data-start="1160274">So we have a constructor where we take some options.</span> <span data-start="1162440">In this case, there's going to be</span> <span data-start="1163330">an option, for example, for bounciness, which makes sense.</span> <span data-start="1165746">How bouncy is it supposed to look?</span> <span data-start="1167255">And in the animate call, we are going</span> <span data-start="1168796">to use this bounce function.</span> <span data-start="1170639">Depending on the bounciness and the current time,</span> <span data-start="1172680">we're going to determine where in between these two keyframes</span> <span data-start="1175221">we want to end up.</span> <span data-start="1177280">So the bounce function I use, I implemented with some really</span> <span data-start="1179950">dodgy and handwavy physics.</span> <span data-start="1181339">But in the end, you can just think about it</span> <span data-start="1183130">like implementing this kind of graph between two keyframes.</span> <span data-start="1186760">So if we do that, and we run that,</span> <span data-start="1188600">you can see that it's now actually a bounce.</span> <span data-start="1190600">And keep in mind that this is literally just two keyframes,</span> <span data-start="1193510">and we're just bending time, so to speak.</span> <span data-start="1196850">And this animation, because it's a worklet,</span> <span data-start="1199069">runs off the main thread.</span> <span data-start="1200110">It actually runs on the compositor thread.</span> <span data-start="1202060">Meaning that even if the main thread is super busy,</span> <span data-start="1204820">it will make sure that this animation runs exactly</span> <span data-start="1207040">at the device's frame rate, frame perfect, and make sure</span> <span data-start="1209830">that your animations look really, really smooth.</span> <span data-start="1214220">So so far, we have done this.</span> <span data-start="1216780">We have done animation.</span> <span data-start="1218100">But if you look at this, I explicitly</span> <span data-start="1219807">wrote out document timeline even though it's</span> <span data-start="1221640">an optional argument.</span> <span data-start="1224402">The point is that with Animation Worklet,</span> <span data-start="1226110">you could get time from somewhere else, not just</span> <span data-start="1228780">actual time.</span> <span data-start="1230091">You could, for example, think of something</span> <span data-start="1231840">like a scroll timeline.</span> <span data-start="1233676">Or you could even conceive of something</span> <span data-start="1235300">like an input timeline.</span> <span data-start="1236600">We are talking about input timeline,</span> <span data-start="1238100">but I have nothing to show here.</span> <span data-start="1239490">But I can show you scroll timeline.</span> <span data-start="1243190">So here, you see a Pac-Man that I've linked</span> <span data-start="1245730">to a scroller at the bottom.</span> <span data-start="1247600">So what you see, I can basically scroll the scroller</span> <span data-start="1250200">at the bottom, and the animation will jump to the position</span> <span data-start="1252900">where I am within the scroller.</span> <span data-start="1255110">And so it kind of gives this — </span> <span data-start="1256600">this gives you an animation scrubber.</span> <span data-start="1258870">And this is kind of fun but not that useful.</span> <span data-start="1261210">But you can conceive of more useful uses [INAUDIBLE]</span> <span data-start="1264390">scroll-linked effects, where I have</span> <span data-start="1266400">three independent animation.</span> <span data-start="1267570">The follow button, my name, and my avatar</span> <span data-start="1269700">are all scroll-linked effects that</span> <span data-start="1271440">can assume their position within the animation</span> <span data-start="1274020">depending on how far I scroll.</span> <span data-start="1275850">The parallax effect would be another very popular choice</span> <span data-start="1278370">to use with this.</span> <span data-start="1279480">And it's much easier to implement than it currently</span> <span data-start="1282030">is on the web.</span> <span data-start="1284280">Now, in combination with CSS Scroll Snap Points that we just</span> <span data-start="1289020">implemented in Chrome, you can now have a lot of synergy here,</span> <span data-start="1291884">where you have really smooth transitions</span> <span data-start="1293550">between different sections of your app.</span> <span data-start="1295650">And you see I have an indicator on top,</span> <span data-start="1297360">and the images kind of zoom into view.</span> <span data-start="1301050">And now, for me, the really interesting thing</span> <span data-start="1303180">is that Animation Worklet is the same thing as the Paint Worklet</span> <span data-start="1307140">was for rounded corners.</span> <span data-start="1308370">If you don't like how Scroll Snap Points work,</span> <span data-start="1311160">Animation Worklet is low-level enough</span> <span data-start="1312930">to allow you to implement your own version.</span> <span data-start="1316210">So it really future-proofs the web</span> <span data-start="1317790">for whatever people will come up with in the future.</span> <span data-start="1322064">Let's talk about the 3PigStability index</span> <span data-start="1323730">for this API, which — </span> <span data-start="1326070">we have gone through many, many iterations on Animation</span> <span data-start="1329010">Worklet, but always in collaboration with Apple,</span> <span data-start="1331620">with Microsoft, and with Mozilla.</span> <span data-start="1333660">And we are now at a point we feel fairly confident that all</span> <span data-start="1336510">the browsers are at least on-board on a conceptual level</span> <span data-start="1339510">with what we come up with.</span> <span data-start="1340650">So all in all, I would give this a wood stability.</span> <span data-start="1344400">As I said, we feel pretty confident about it.</span> <span data-start="1346450">But now it's really time for us to see what you feel about it.</span> <span data-start="1349890">So it is in Canary.</span> <span data-start="1351150">You can play with it now.</span> <span data-start="1352690">And we are going to an origin trial in Chrome 71.</span> <span data-start="1355440">So if you want to test out in production — </span> <span data-start="1357210">and we would love it if you do — </span> <span data-start="1358800">please sign up here.</span> <span data-start="1360470">As I said, the article should give you all the insight</span> <span data-start="1362720">that you need to get started.</span> <span data-start="1363820">And if not, please contact me.</span> <span data-start="1364950">I'm very eager to help out so that we</span> <span data-start="1366491">can get some real data on the benefits of Animation Worklet.</span> <span data-start="1370270">I have —  I don't know how much time I have left at this point.</span> <span data-start="1373110">I'm just going to go for it.</span> <span data-start="1374280">Because I can talk a little bit about Layout API.</span> <span data-start="1377280">So the Layout API, I'm going to start</span> <span data-start="1380460">with the 3PigStability index because it's complete straw.</span> <span data-start="1383400">We literally refactored this API two weeks ago at [? TPACK. ?]</span> <span data-start="1386520">So there is a half-finished implementation in Canary,</span> <span data-start="1390844">and you should play with it.</span> <span data-start="1392010">But don't expect the code to still run next week.</span> <span data-start="1395514">But there is so much potential in this [INAUDIBLE]..</span> <span data-start="1397680">I really want to give you a little insight into this.</span> <span data-start="1400560">So with the custom layout API or the Layout Worklet,</span> <span data-start="1403650">you can basically define your own display values.</span> <span data-start="1407349">So I'm just going to have a main element and a couple of divs</span> <span data-start="1409890">in there, and that's it.</span> <span data-start="1410889">Everything —  all the other magic will happen in the worklet.</span> <span data-start="1414912">So now we have a layout worklet on the CSS namespace.</span> <span data-start="1417120">I'm going to add the module.</span> <span data-start="1418800">And in there, we have a layout callback.</span> <span data-start="1420960">I'm not going to explain all the parameters because A,</span> <span data-start="1423620">I don't understand them all.</span> <span data-start="1425200">And B, layout is pretty complex.</span> <span data-start="1428329">But I'm going to keep this one simple</span> <span data-start="1429870">so we can get a feel for it.</span> <span data-start="1430960">So what I'm going to do is I'm just going to loop over</span> <span data-start="1432600">all the children, all my child nodes</span> <span data-start="1434700">that are on my custom layout element.</span> <span data-start="1438810">I'm going to lay them out in empty space, basically asking,</span> <span data-start="1442140">how big would you be if you had no constraints?</span> <span data-start="1445152">And then I'm just going to give them a random offset,</span> <span data-start="1447360">basically giving them a random position</span> <span data-start="1449610">within the rectangle that I occupy.</span> <span data-start="1451877">And then I return this list to the browser saying,</span> <span data-start="1453960">I did my layout.</span> <span data-start="1455050">Now, please go forth and paint me.</span> <span data-start="1457037">And that's exactly what the browser will do.</span> <span data-start="1458870">So if you look at this, you can see a couple of rectangles.</span> <span data-start="1461400">And every couple seconds, I add or remove a rectangle</span> <span data-start="1464820">to force a relayout.</span> <span data-start="1466260">And they get a truly random position,</span> <span data-start="1468220">which is also truly useless.</span> <span data-start="1470070">But you can see that this is actual the layout</span> <span data-start="1473040">phase of the browser.</span> <span data-start="1473930">This runs during the layout phase</span> <span data-start="1475260">of the browser, something that was</span> <span data-start="1476676">completely closed-off to developers so far.</span> <span data-start="1479087">And to give a little bit more of a useful example,</span> <span data-start="1481170">I also implemented a masonry layout.</span> <span data-start="1483390">So here, I'm just loading random images</span> <span data-start="1485190">from Unsplash with different aspect ratios.</span> <span data-start="1487860">And the masonry algorithm, if you will,</span> <span data-start="1491010">takes care of assembling these in three columns.</span> <span data-start="1493560">And the number of columns is, once again,</span> <span data-start="1495840">just a custom properties, which I can increase.</span> <span data-start="1498512">And it will kind of scale up and give you</span> <span data-start="1500220">this really nice masonry look, which so far, you would always</span> <span data-start="1504510">have to do with position absolute magic and main thread</span> <span data-start="1507990">JavaScript.</span> <span data-start="1508650">And this is just actual layout, which</span> <span data-start="1510466">I think is really exciting.</span> <span data-start="1514700">If you're into the code — </span> <span data-start="1516110">because I don't have an article for Layout Worklet yet,</span> <span data-start="1518900">mostly because by the time I would be done with an article,</span> <span data-start="1521675">it would be out of date again — </span> <span data-start="1523440">please go to this repository that I maintain,</span> <span data-start="1526220">where I have samples for all the worklets I talked about today.</span> <span data-start="1529350">And you can fork them and play around with them.</span> <span data-start="1531620">Or I would be so happy if you contributed to them.</span> <span data-start="1534440">I kind of want to build a collection of off the shelf</span> <span data-start="1536890">Houdini elements with popular effects,</span> <span data-start="1538910">which I think would be really useful.</span> <span data-start="1540860">If you want to keep up with the development of Houdini,</span> <span data-start="1544160">I made ishoudinireadyyet.com, where</span> <span data-start="1547220">you can see all the browsers, which Houdini</span> <span data-start="1550370">APIs they support, which ones are</span> <span data-start="1553010">in development, which ones they at least want</span> <span data-start="1556420">to implement in time.</span> <span data-start="1558200">There is links to the articles, to demos, to the specs.</span> <span data-start="1562100">Hopefully, I can make this the one-stop shop</span> <span data-start="1565070">that you need to keep up with Houdini.</span> <span data-start="1567260">And I can't believe that I made it to my last slide.</span> <span data-start="1572090">[APPLAUSE]</span> <span data-start="1579290">[MUSIC PLAYING]</span> </section>

</div>

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="js/main.js"></script>

</body>

</html>
