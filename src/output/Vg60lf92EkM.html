<!DOCTYPE html>

<! — 
Copyright 2018 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
 — >

<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="//google.com">
<meta name="description" content="Chrome Dev Summit">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vg60lf92EkM</title>
<link rel="stylesheet" href="css/main.css">
</head>

<body>

<div id="video"></div>

<iframe id="youtube" src="https://www.youtube.com/embed/Vg60lf92EkM?enablejsapi=1"></iframe>

<div id="container">

<div id="google-translate"></div>

<section>
<span data-start="0">[MUSIC PLAYING]</span> </section>

<section><span data-start="5700"><span class="speaker">Paul Lewis</span>: So I was on the way to the office this morning,</span> <span data-start="8610">and I realized it is very much like web dev, rush hour.</span> </section>

<section><span data-start="11760"><span class="speaker">Surma</span>: OK.</span> </section>

<section><span data-start="12360"><span class="speaker">Paul Lewis</span>: Rush hour is like all the traffic.</span> <span data-start="13860">Everyone is trying to get to the office at 9:00 AM, right?</span> <span data-start="16379">So all these people are in their cars, and on trains,</span> <span data-start="18635">and everything.</span> <span data-start="19260">Everyone's just rushing, and nobody</span> <span data-start="20718">can move for anybody else.</span> <span data-start="22540">And I think that's like web because — </span> </section>

<section><span data-start="25929"><span class="speaker">Surma</span>: Yes, please explain this a bit more?</span> </section>

<section><span data-start="27720"><span class="speaker">Paul Lewis</span>: Yes.</span> <span data-start="28260">Because you've got the main thread.</span> <span data-start="29700">You've got this one thread.</span> <span data-start="30750">And on that main thread, you've got all these work</span> <span data-start="32833">styles, JavaScript, layout, paint, composite,</span> <span data-start="35490">your framework.</span> <span data-start="36300">Everything is running, and everybody's</span> <span data-start="38430">competing for this one resource, the road or, in this case,</span> <span data-start="41064">the main thread.</span> </section>

<section><span data-start="41730"><span class="speaker">Surma</span>: Oh, so Mr. Framework has a car, Mr. Paint has a car,</span> <span data-start="45450">Mr. Business Logic has a car.</span> <span data-start="46802">And they all just want to go on the road,</span> <span data-start="48510">but it's already full.</span> </section>

<section><span data-start="49470"><span class="speaker">Paul Lewis</span>: Exactly.</span> <span data-start="50040">And everybody's in the same boat where</span> <span data-start="51660">everybody gets the angry tweets and sees all this performance</span> <span data-start="55430">advice.</span> <span data-start="55930">And nobody knows what to do because all this stuff is just</span> <span data-start="58346">constrained into this one place — </span> <span data-start="59910">rush hour.</span> <span data-start="60919">As we described in that video, that's</span> <span data-start="62460">kind of how we feel when we look at the web at large.</span> <span data-start="67470">We look at it, and we go, all this code should be here.</span> <span data-start="71190">But it just feels like the traffic is the problem.</span> <span data-start="74010">There's just too much going through the main thread.</span> </section>

<section><span data-start="77790"><span class="speaker">Surma</span>: And traditionally, the main thread is full.</span> <span data-start="81210">It's overworked and underpaid.</span> <span data-start="82650">You would say, cool, I'd use threads.</span> <span data-start="84390">On any other platform, you could do that.</span> <span data-start="85770">Just spin up a thread, put some code there, run it there,</span> <span data-start="87780">call a function.</span> <span data-start="88446">Hooray!</span> <span data-start="88950">Everyone's happy.</span> <span data-start="89960">But it turns out JavaScript and the web is special.</span> <span data-start="92730">And it is inherently single threaded, so you can't do that.</span> </section>

<section><span data-start="95985"><span class="speaker">Paul Lewis</span>: Right, exactly.</span> <span data-start="97110">Every thread is kind of its own little universe, isn't it?</span> <span data-start="100940">Like we heard, it's a [INAUDIBLE],, right?</span> <span data-start="103142">And so you can't just go, just call this on another thread,</span> <span data-start="105600">but you've got some shared stuff that you can work on.</span> <span data-start="108760">So that's a challenge.</span> <span data-start="110706">And then it gets more interesting</span> <span data-start="112080">because say, for example, you're trying to build — </span> <span data-start="114260">I don't know —  a chess game just for argument's sake.</span> <span data-start="117200">And you've got a chess engine.</span> <span data-start="118530">And the chess engine — </span> <span data-start="120060">it takes a few hundred milliseconds</span> <span data-start="121570">to calculate a move.</span> </section>

<section><span data-start="123840"><span class="speaker">Surma</span>: It gets exponentially difficult.</span> </section>

<section><span data-start="125707"><span class="speaker">Paul Lewis</span>: And you build it with DOM.</span> <span data-start="127290">And then some bright spark goes, do you know what we should do?</span> <span data-start="130889">3D.</span> <span data-start="132150">And you're, like, [LAUGHS] I was already</span> <span data-start="134377">behind on my [INAUDIBLE] budget.</span> <span data-start="135710">If you could just not do the 60-frames-a-second thing,</span> <span data-start="137959">that'll be great.</span> <span data-start="138790">And some even brighter spark says, how about VR?</span> </section>

<section><span data-start="142510"><span class="speaker">Surma</span>: Yeah.</span> <span data-start="143010">I want to stand on the chess board.</span> </section>

<section><span data-start="144469"><span class="speaker">Paul Lewis</span>: Yeah, I want to be, like, right in the game.</span> <span data-start="146801">And you're thinking, um, there was already rush hour.</span> </section>

<section><span data-start="149295"><span class="speaker">Surma</span>: Turns out frame rate —  quite important</span> <span data-start="151170">when it comes to VR.</span> </section>

<section><span data-start="152040"><span class="speaker">Paul Lewis</span>: Yeah, and it could be voice.</span> <span data-start="153706">There are so many things that it could be.</span> </section>

<section><span data-start="155640"><span class="speaker">Surma</span>: So this becomes increasingly unlikely for you</span> <span data-start="158000">to be able to do this successfully on the web</span> <span data-start="159630">currently.</span> </section>

<section><span data-start="160170"><span class="speaker">Paul Lewis</span>: Right.</span> <span data-start="161020">And so this is the question that we have been thinking through</span> <span data-start="165180">for the last little while.</span> <span data-start="166830">Is there anything we can do, anything we can suggest,</span> <span data-start="170640">think of to help?</span> </section>

<section><span data-start="173650"><span class="speaker">Surma</span>: We have two birds.</span> <span data-start="174790">We're looking for a stone.</span> </section>

<section><span data-start="175900"><span class="speaker">Paul Lewis</span>: Exactly.</span> <span data-start="176733">And — </span> <span data-start="177435">[LAUGHTER]</span> </section>

<section><span data-start="178620"><span class="speaker">Surma</span>: Ah, that went well.</span> </section>

<section><span data-start="182190"><span class="speaker">Paul Lewis</span>: OK.</span> <span data-start="185680">Wow, I really need to think of what I was going to say next.</span> <span data-start="188180">OK, this.</span> </section>

<section><span data-start="189000"><span class="speaker">Surma</span>: Actor model.</span> <span data-start="190595">So we kind of stumbled over this.</span> <span data-start="192200">The actor model is, as it says right here, about 45 years old.</span> <span data-start="195800">And it's been made popular by Erlang</span> <span data-start="199280">and then continued with Elixir and Pony.</span> <span data-start="201430">It's languages that use the actor model to this day</span> <span data-start="203600">and successfully so.</span> <span data-start="205210">And we realized that it's actually</span> <span data-start="207380">a really good fit for the web.</span> </section>

<section><span data-start="208892"><span class="speaker">Paul Lewis</span>: Yeah.</span> <span data-start="209600">Because what it does is it makes a feature</span> <span data-start="213080">of that single-threadedness of JavaScript.</span> <span data-start="215629">But we like to explain —  if you've come across it</span> <span data-start="217670">before, great.</span> <span data-start="218470">If you've not come across the actor model,</span> <span data-start="220220">we like to explain it in a very specific way.</span> <span data-start="222094">So check this one out.</span> </section>

<section><span data-start="223500"><span class="speaker">Surma</span>: So when we did Supercharge,</span> <span data-start="224930">you saw us on screen.</span> <span data-start="226430">But behind the cameras, we had an entire crew.</span> <span data-start="229610">And that means we had one person working the camera.</span> <span data-start="231830">We had one person worrying about if our audio was good.</span> <span data-start="234810">We had a director.</span> <span data-start="235970">And each of these people were solely responsible</span> <span data-start="238310">for that specific device.</span> </section>

<section><span data-start="240390"><span class="speaker">Paul Lewis</span>: And instead of going over and pressing one person's</span> <span data-start="243740">buttons or just messing with settings,</span> <span data-start="246124">those people actually have to communicate with one another</span> <span data-start="248540">to get the job done.</span> <span data-start="249373">It you like, there are actors in the system,</span> <span data-start="251310">but they've got to send messages to one another</span> <span data-start="253280">and communicate and collaborate in order</span> <span data-start="255110">to get the final thing working.</span> </section>

<section><span data-start="258380"><span class="speaker">Surma</span>: So that's kind of where — </span> <span data-start="260163">more video, more production value.</span> <span data-start="261579">It's good, right?</span> <span data-start="262610">So that's where we see a mentality that</span> <span data-start="265550">fits the web really well.</span> <span data-start="267000">And you start thinking about, where</span> <span data-start="268790">can you draw a line for individual pieces</span> <span data-start="271640">of responsibility in your app.</span> <span data-start="273690">And instead of thinking about classes and how</span> <span data-start="275720">you call the method on the other class,</span> <span data-start="277970">you can now think about these actors</span> <span data-start="279860">and how you can send the right message to request something</span> <span data-start="282380">to happen.</span> </section>

<section><span data-start="282990"><span class="speaker">Paul Lewis</span>: Right.</span> <span data-start="283160">There are these areas of ownership.</span> <span data-start="284820">So let's think about, how, at a conceptual level,</span> <span data-start="287600">how would you think this through?</span> <span data-start="289699">What would it look like a little bit?</span> <span data-start="291240">OK.</span> <span data-start="291740">So imagine you have an actor, and it's job</span> <span data-start="295630">is to run your user interface.</span> <span data-start="297602">That's its area of ownership.</span> <span data-start="298810">That's what it does.</span> <span data-start="299920">That's its job and only that.</span> <span data-start="302180">You might also have another actor</span> <span data-start="304420">whose job is to handle state for your application</span> <span data-start="307330">and yet another one who handles the storage.</span> <span data-start="310990">Now, imagine in your app a typical interaction</span> <span data-start="313630">would be something like favoriting an item.</span> <span data-start="316330">The user interface, when the user taps on it,</span> <span data-start="318280">it will send a message over to the state</span> <span data-start="320170">that says this was favorited.</span> <span data-start="322960">In turn, the actor handling the state</span> <span data-start="324874">will send a message to the storage</span> <span data-start="326290">to say we need to remember that they favorited this item.</span> <span data-start="329920">Now we could also, at this point,</span> <span data-start="331630">introduce a new actor into this story,</span> <span data-start="333999">something that could broadcast.</span> <span data-start="335290">Because when the state changes, typically, what we'd want to do</span> <span data-start="338689">is, we'd want to send that both to the user</span> <span data-start="340480">interface and the storage to be reflected in both, I suppose,</span> <span data-start="344750">really.</span> </section>

<section><span data-start="345250"><span class="speaker">Surma</span>: Yes.</span> <span data-start="346147">And you can kind of see here, that it really</span> <span data-start="347980">is a separation of concerns.</span> <span data-start="350906">Ah, the click, there you go.</span> <span data-start="354180">[INAUDIBLE] transition —  do recommend.</span> <span data-start="356540">It really helps you to think about your app</span> <span data-start="358595">in a different way, helping you to figure out</span> <span data-start="360470">where does new code go, which module can you switch out</span> <span data-start="363410">to fix a problem that you're having?</span> <span data-start="365510">It's a really good way to structure the app in this way.</span> </section>

<section><span data-start="368030"><span class="speaker">Paul Lewis</span>: Yeah, absolutely.</span> <span data-start="368510">And we use to separation of concerns</span> <span data-start="370100">when we talk about HTML, JavaScript, and CSS,</span> <span data-start="372500">or when we talk about components in a modern framework.</span> <span data-start="376110">So it's another version of that same story I suppose.</span> </section>

<section><span data-start="379539"><span class="speaker">Surma</span>: Another benefit that you get — </span> <span data-start="381080">and we have heard about this problem a couple of times,</span> <span data-start="383480">I think yesterday and today — </span> <span data-start="384860">is that we often see big chunks of monolithic</span> <span data-start="387290">JavaScript just run — </span> <span data-start="388760">frameworks updating the virtual DOM, and then</span> <span data-start="390650">the DOM, or something like that.</span> <span data-start="392240">And with this pattern, you introduce a natural breaking</span> <span data-start="395330">point where you give the browser a chance to ship a frame.</span> <span data-start="398250">Because every time you send a message,</span> <span data-start="399860">there is a point where you say, OK, browser</span> <span data-start="402410">can intervene and ship a frame if we are out of frame budget.</span> </section>

<section><span data-start="405260"><span class="speaker">Paul Lewis</span>: Exactly.</span> <span data-start="406730">Now, a little side effect a positive one of this</span> <span data-start="410690">is location independence.</span> <span data-start="412254">And we'll come back to this.</span> <span data-start="413420">This is a sort of repeating refrain</span> <span data-start="414950">that we're going to get into a little bit more.</span> <span data-start="416908">But think about actors as, they're not all the same.</span> <span data-start="420525">They have different requirements.</span> <span data-start="421900">Some actors will not need to have access to the main thread,</span> <span data-start="425270">for example, because of the kind of work they do.</span> <span data-start="428030">And as such, we might be able to run them</span> <span data-start="429980">in different locations, i.e., not on the main thread.</span> <span data-start="432354">As I say, we'll come back to that.</span> <span data-start="433770">But the idea here is maybe we just</span> <span data-start="435590">bought ourselves a little capacity for rush hour.</span> </section>

<section><span data-start="438117"><span class="speaker">Surma</span>: Because as long as the messages</span> <span data-start="439700">get delivered to the actor, the actor</span> <span data-start="441860">will then do the same work as it did before and will</span> <span data-start="444390">respond with the same message.</span> <span data-start="445640">So the entire app keeps behaving the same way,</span> <span data-start="447950">no matter where it runs.</span> <span data-start="449150">And because of that location independence,</span> <span data-start="453060">we can lower the likelihood of long work</span> <span data-start="456170">impacting the main thread and making your app janky.</span> </section>

<section><span data-start="458397"><span class="speaker">Paul Lewis</span>: Exactly.</span> <span data-start="459230">So conceptually, that is what it is.</span> <span data-start="461630">But I like seeing code.</span> <span data-start="465470">I think code helps.</span> <span data-start="467820">And so we're not launching a product.</span> <span data-start="471120">We're not launching a framework, or even a library.</span> <span data-start="474260">We just wanted to have a chat with you about architectures.</span> <span data-start="477180">And we've been using some actor-based stuff</span> <span data-start="480220">for the last little while with our colleague Tim.</span> <span data-start="482480">And the three of us have just been putting some code</span> <span data-start="484070">together.</span> <span data-start="484380">So what we're going to do is, we're just</span> <span data-start="485130">going to show you a little bit of the code</span> <span data-start="487160">that we've been using.</span> <span data-start="488090">We've been using it to build some of our apps.</span> </section>

<section><span data-start="490762"><span class="speaker">Surma</span>: And we'll share that at the end.</span> <span data-start="492387">You're very welcome to try it out.</span> <span data-start="493803">And you're also very welcome to write your own.</span> <span data-start="495930">We don't really care if we use our version or someone else's</span> <span data-start="498200">version.</span> <span data-start="498700">It's more about the concept, about the architecture.</span> </section>

<section><span data-start="500870"><span class="speaker">Paul Lewis</span>: Absolutely.</span> <span data-start="501702">But with this in mind, let's talk about a particular app,</span> <span data-start="504076">something like a stopwatch app, which you would start,</span> <span data-start="506585">it would count up in seconds — </span> <span data-start="508957">pause, play, that kind of thing.</span> <span data-start="510290">And then you might reset the time if you're done.</span> <span data-start="515740">So in our code, we have this Actor base class.</span> <span data-start="519570">And that top function up there, hookup, is the first thing</span> <span data-start="522659">that you'd need to know.</span> <span data-start="523659">And the job of hookup is to kind of register</span> <span data-start="526360">an actor in the system so that we can talk to it later,</span> <span data-start="528740">so we can send it messages later on.</span> <span data-start="531370">Because ultimately, we won't know where</span> <span data-start="533020">this actor is in the system.</span> <span data-start="534500">And so we just need almost like a registry, I suppose,</span> <span data-start="537940">where we can say, I'm going to tell you there's an actor,</span> <span data-start="540600">and it's found under this name.</span> </section>

<section><span data-start="542020"><span class="speaker">Surma</span>: It's basically the equivalent</span> <span data-start="543520">of what you might know from custom elements.</span> <span data-start="545320">There's custom elements that. define.</span> <span data-start="546861">And you say, this custom element is now known under this name.</span> <span data-start="550330">And this does the exact same thing but for actors.</span> </section>

<section><span data-start="553709"><span class="speaker">Paul Lewis</span>: So then we have our two actors, a Clock one</span> <span data-start="556000">and a UI one.</span> <span data-start="557590">And then in the bootstrap, we instantiate both our UI</span> <span data-start="560770">and hook it up, so it's available under UI</span> <span data-start="562960">as a string name.</span> <span data-start="564460">And then we do the same with the clock like so.</span> <span data-start="568552">So now, we can talk about how you might implement something</span> <span data-start="571010">like the clock itself.</span> <span data-start="573620">And in our case, when you've got something like this,</span> <span data-start="575900">it's almost like a pure data actor.</span> <span data-start="578600">It doesn't have any need to go near the DOM.</span> <span data-start="582050">It just wants to tick, and pause,</span> <span data-start="583700">and all those kinds of things.</span> </section>

<section><span data-start="584510"><span class="speaker">Surma</span>: I mean, what do you need, really.</span> <span data-start="586176">You need a set interval, and that's pretty much it.</span> </section>

<section><span data-start="588870"><span class="speaker">Paul Lewis</span>: So time out?</span> </section>

<section><span data-start="589890"><span class="speaker">Surma</span>: Sure.</span> </section>

<section><span data-start="590545"><span class="speaker">Paul Lewis</span>: I have a thing against set interval.</span> <span data-start="592310">It's a long story.</span> <span data-start="593062">Come find me after, and I'll explain why.</span> <span data-start="594770">Anyway, imagine this then.</span> <span data-start="596930">We're going to model this as a state machine.</span> <span data-start="602610">We start with a paused state.</span> <span data-start="603830">Our clock is paused.</span> <span data-start="605940">We can transition to a running state.</span> <span data-start="609020">Every second, we'll tick, and we'll go to the tick state.</span> <span data-start="611400">And that will take us back to the running state.</span> <span data-start="613400">And you can imagine being in this tick, running, tick,</span> <span data-start="615920">running state like in a clock.</span> </section>

<section><span data-start="617704"><span class="speaker">Surma</span>: Like ping-pong.</span> </section>

<section><span data-start="618620"><span class="speaker">Paul Lewis</span>: Like a clock, Indeed.</span> <span data-start="620600">We could pause, and we could reset.</span> <span data-start="622920">And when we reset, we go back to that.</span> </section>

<section><span data-start="624737"><span class="speaker">Surma</span>: And that's a really nice pattern here</span> <span data-start="626570">that plays along well with the message passing of the actor</span> <span data-start="629070">model.</span> <span data-start="629570">Because all of these triggers, as they</span> <span data-start="631400">are called, in the state machine world could just be a message.</span> <span data-start="634250">You send a message to this state machine, it's being ingested,</span> <span data-start="637220">and then a transition happens.</span> </section>

<section><span data-start="638930"><span class="speaker">Paul Lewis</span>: Absolutely.</span> </section>

<section><span data-start="640534"><span class="speaker">Surma</span>: So we found, actually, that there</span> <span data-start="642200">are a lot of implementations for state machines</span> <span data-start="644480">out there in the wild, and that's not very unexpected.</span> <span data-start="646850">And we have kind of been using xstate,</span> <span data-start="648590">which is written by David from Microsoft,</span> <span data-start="650502">and it's working really well.</span> <span data-start="651710">It allows you to declare your state machine as a JSON object.</span> <span data-start="654364">So you just declare your states and then</span> <span data-start="656030">what the transitions are.</span> <span data-start="657380">And then you just pass this to this machine constructor,</span> <span data-start="660680">and you get a state machine.</span> </section>

<section><span data-start="661940"><span class="speaker">Paul Lewis</span>: So our clock extends the Actor base class,</span> <span data-start="665870">and what we do is we instantiate our state Machine.</span> <span data-start="668157">We say, go to the initial state, which</span> <span data-start="669740">happens to that paused state.</span> <span data-start="672540">And then later on, imagine that we receive a message.</span> <span data-start="676350">And our Actor base class has this onMessage callback,</span> <span data-start="678960">which is, I got a message.</span> <span data-start="680460">What do I do?</span> <span data-start="682287">In this case, we would assume that the state</span> <span data-start="684120">would be changing inside of our state machine.</span> <span data-start="686250">So we use the state machine transition</span> <span data-start="688440">to get from wherever it was to wherever it needs to be.</span> <span data-start="691070">So the message is basically driving the clock.</span> <span data-start="694554">And we'll inspect what the new state value is.</span> <span data-start="696470">So if we find that our clock is running,</span> <span data-start="698340">we'll set a tick time out for one second.</span> <span data-start="702000">If we tick, we increment our tick count.</span> <span data-start="704220">And then the clock will send itself a message.</span> <span data-start="707710">Now, it could call its own functions.</span> <span data-start="710040">But we tend to be a little bit — </span> <span data-start="712680">we like it fair.</span> <span data-start="713857">And so what we do is we make sure the clock sends itself</span> <span data-start="716190">a message like every other actor would</span> <span data-start="717773">have to send it a message.</span> </section>

<section><span data-start="719030"><span class="speaker">Surma</span>: And you can add it like a message queue that</span> <span data-start="720180">buffers all the messages.</span> <span data-start="721221">And the actor goes through one message, processes,</span> <span data-start="723450">then it goes to the next message.</span> <span data-start="724830">And so if you just call your own function,</span> <span data-start="726750">it would kind of be cutting that line.</span> <span data-start="728470">So if you want to keep it fair, you</span> <span data-start="729600">would just queue your app message at the end</span> <span data-start="731520">and wait like a good human.</span> </section>

<section><span data-start="733020"><span class="speaker">Paul Lewis</span>: Exactly, or a computer.</span> </section>

<section><span data-start="734860"><span class="speaker">Surma</span>: Sure.</span> </section>

<section><span data-start="736760"><span class="speaker">Paul Lewis</span>: Cancel the tick if you're</span> <span data-start="738450">paused if there's one pending.</span> <span data-start="740310">When we reset, we'll reset the tick count.</span> <span data-start="742330">And again, the clock will send itself a message to pause.</span> <span data-start="747030">And now, let's talk about sending messages.</span> <span data-start="749670">That's next, yes.</span> <span data-start="750580">So the clock, is going to have to send a state</span> <span data-start="752635">update to the user interface so that it</span> <span data-start="754260">can reflect the time going up and so on, and so forth.</span> <span data-start="758380">And this is the opposite to the hookup.</span> <span data-start="760080">This is lookup, which is also in — </span> </section>

<section><span data-start="762410"><span class="speaker">Surma</span>: Hookup, lookup, hookup, lookup, hookup, lookup.</span> </section>

<section><span data-start="764660"><span class="speaker">Paul Lewis</span>: I lose him for hours at a time when he does this.</span> <span data-start="767310">OK, hookup and lookup.</span> <span data-start="768550">So we look up the UI, and then we can send it a message.</span> </section>

<section><span data-start="772384"><span class="speaker">Surma</span>: And that's very important to note here.</span> <span data-start="774300">The handle, this UI variable that we have there,</span> <span data-start="776790">it is not the actor instance.</span> <span data-start="778960">You can't go in and change a member variable of that class.</span> <span data-start="782400">It is just an object with a send method and only that method.</span> <span data-start="785544">Because that's the only way you're</span> <span data-start="786960">allowed to interact with any of the other actors.</span> </section>

<section><span data-start="789477"><span class="speaker">Paul Lewis</span>: Exactly.</span> <span data-start="790310">And so in this case, we're going to send the UI a message.</span> <span data-start="792930">And the message is going to say what</span> <span data-start="794430">the time is and whether or not the clock is running.</span> <span data-start="798030">We found that TypeScript is really helpful at this point,</span> <span data-start="800440">because those messages need to be well-formed,</span> <span data-start="802650">and well-understood.</span> <span data-start="803650">And there needs to be a data contract.</span> <span data-start="805233">And we've just found, from practical experience,</span> <span data-start="807330">that TypeScript is a really good way of saying,</span> <span data-start="808980">this object looks like this.</span> <span data-start="810310">This is a number.</span> <span data-start="811050">This is a string.</span> <span data-start="811822">This is another object, and so on and so forth.</span> <span data-start="813780">So just take that as what it is, really.</span> </section>

<section><span data-start="816970"><span class="speaker">Surma</span>: A recommendation.</span> </section>

<section><span data-start="817970"><span class="speaker">Paul Lewis</span>: Yeah, a recommendation.</span> <span data-start="818770">We found that useful.</span> <span data-start="820110">Let's talk about the UI a little bit.</span> <span data-start="822430">Interestingly, you can bring your own framework.</span> </section>

<section><span data-start="825401"><span class="speaker">Surma</span>: Yeah.</span> <span data-start="825900">In this model, we don't really care what kind of framework</span> <span data-start="828580">you use.</span> <span data-start="829080">You can use React, you can use Vue, you can use Lit,</span> <span data-start="831750">you can use Svelte —  whatever you feel comfortable with</span> <span data-start="835110">or whatever makes sense in your scenario.</span> <span data-start="837240">The interesting shift here is that the UI framework is not</span> <span data-start="841290">your base platform, not your entry point any more.</span> <span data-start="843390">The center of the universe has kind of moved.</span> </section>

<section><span data-start="845560"><span class="speaker">Paul Lewis</span>: It's that bootstrap that we showed</span> <span data-start="846880">[? at the top. ?]</span> </section>

<section><span data-start="847588"><span class="speaker">Surma</span>: UI is just one participant of many</span> <span data-start="849450">in the system of actors.</span> </section>

<section><span data-start="850477"><span class="speaker">Paul Lewis</span>: And if you find that it's not behaving well,</span> <span data-start="852810">for whatever reason, you can swap it out.</span> <span data-start="854779">The only thing it has to do is listen</span> <span data-start="856320">to messages of a particular type, which is kind of cool.</span> <span data-start="859827">In our case, then we're going to use Preact.</span> <span data-start="861660">It works just great.</span> <span data-start="863100">So we're going to import preact.</span> <span data-start="864765">Our UI extends the Actor class.</span> <span data-start="867150">And when it receives a message, we're</span> <span data-start="868830">going to have it render using Preact to, in this case,</span> <span data-start="872260">the document body.</span> </section>

<section><span data-start="874952"><span class="speaker">Surma</span>: Same again here.</span> <span data-start="875910">We need to send messages back.</span> </section>

<section><span data-start="877464"><span class="speaker">Paul Lewis</span>: Absolutely.</span> <span data-start="878422">And to do that, it is a case of, on the UI side,</span> <span data-start="882010">we find our clock actor, we do a lookup on it,</span> <span data-start="884437">and we will send it a message, in this case,</span> <span data-start="886270">for this particular example, sending it a message to start.</span> <span data-start="888880">There'll be one for stop, or reset, and so on.</span> <span data-start="892790">Now, we get to talk about that location</span> <span data-start="894570">independence a teeny bit more.</span> <span data-start="897240">Because one of the questions that Surma, Tim, and I ask</span> <span data-start="899940">ourselves when we're making our actors is,</span> <span data-start="901950">does this actor need access to the main thread?</span> <span data-start="906490">And this is kind of to do with the rush hour thing.</span> <span data-start="909839">Our general rule of thumb —  and there</span> <span data-start="911380">are some caveats we'll mention in a moment.</span> <span data-start="913270">But out general rule of thumb is that a UI actor is the one that</span> <span data-start="916210">really needs the DOM.</span> <span data-start="917237">And therefore, it's the one that ought</span> <span data-start="918820">to be on the main thread wherever possible.</span> <span data-start="922014">There is an exception.</span> <span data-start="922930">The exception here is that certain APIs — </span> <span data-start="924760">those for media security, device capabilities, and identity — </span> <span data-start="927430">are only available on the main thread today.</span> </section>

<section><span data-start="930280"><span class="speaker">Surma</span>: We think it's a bug.</span> <span data-start="931430">And we've been talking to some Chrome engineers</span> <span data-start="933388">about exposing these kind of APIs</span> <span data-start="934840">in a worker and somewhere else.</span> <span data-start="936422">But that's just not the world we live in today.</span> <span data-start="938380">So for now, that's a restriction.</span> </section>

<section><span data-start="941462"><span class="speaker">Paul Lewis</span>: Tools not rules — </span> <span data-start="942670">so you might be thinking, ah, I should move all my actors away</span> <span data-start="946420">from the main thread.</span> <span data-start="947500">We'll get to that.</span> <span data-start="948714">But the thing is, if you've got a really chatty actor that</span> <span data-start="951130">needs to talk to the UI actor, you</span> <span data-start="953050">might want to leave it alongside the UI actor on the method.</span> <span data-start="956530">Because as Jason and Shubhie were talking</span> <span data-start="958420">about earlier, that there's a cost to the thread hop,</span> <span data-start="961840">and that might be more expensive than just sending a message</span> <span data-start="966190">and just keeping the actor alongside the UI actor, OK?</span> </section>

<section><span data-start="970120"><span class="speaker">Surma</span>: So basically, if you want to do that, just measure</span> <span data-start="972550">and see what the impact is.</span> </section>

<section><span data-start="973600"><span class="speaker">Paul Lewis</span>: Exactly.</span> <span data-start="974433">So the location independence —  for all that notwithstanding,</span> <span data-start="977950">imagine we were back here where we</span> <span data-start="979720">started with our four actors.</span> <span data-start="982492">And they're all on the main thread, which is probably</span> <span data-start="984700">where we put them by default. We're sort of saying,</span> <span data-start="987730">you might want to look at it more like this.</span> <span data-start="990360">And you might be thinking, why do they say, not main thread?</span> <span data-start="993970">Surely, they just meant Web Workers.</span> <span data-start="996670">And we kind of did because, in most cases, when</span> <span data-start="1000570">we build these apps, web workers do feature heavily.</span> <span data-start="1002910">We do move quite a lot of our actors to web workers,</span> <span data-start="1006420">especially if they're non-chatty.</span> </section>

<section><span data-start="1008940"><span class="speaker">Surma</span>: But not quite.</span> <span data-start="1011280">So we actually think, or have tried,</span> <span data-start="1013140">that it's sometimes very, very useful to run an actor,</span> <span data-start="1015750">for example, on the server side.</span> <span data-start="1017785">And this is kind of an interesting jump</span> <span data-start="1019410">to make because it allows you to incorporate</span> <span data-start="1022590">your back end into the architecture</span> <span data-start="1024300">of your entire app.</span> <span data-start="1025800">It is just another actor in the system.</span> <span data-start="1027724">And as a matter of fact, the game</span> <span data-start="1029099">that you've been playing all day — </span> <span data-start="1030290">and it totally had no bugs at all</span> <span data-start="1031680">whatsoever —  is actually written in this model.</span> <span data-start="1034650">So every player that is playing is an actor.</span> <span data-start="1037079">The admin panel that the MCs use to control the app is an actor.</span> <span data-start="1041260">The presentation view —  just another actor.</span> <span data-start="1043569">And then the Firebase Storage — </span> <span data-start="1045180">a shared actor that's running on the server side.</span> </section>

<section><span data-start="1047367"><span class="speaker">Paul Lewis</span>: Now interestingly, the mechanism</span> <span data-start="1049200">by which they chat using the hookup and lookup</span> <span data-start="1051834">can be anything.</span> <span data-start="1052500">It could be Fetch.</span> <span data-start="1053249">It could be a WebSocket.</span> <span data-start="1054470">And it really doesn't matter.</span> </section>

<section><span data-start="1055830"><span class="speaker">Surma</span>: Your Firebase database.</span> </section>

<section><span data-start="1056760"><span class="speaker">Paul Lewis</span>: Yeah.</span> <span data-start="1057468">So long as talk, these actors can talk,</span> <span data-start="1059250">and they've got a way of sending messages to one another,</span> <span data-start="1062100">you're all set.</span> <span data-start="1063310">So back to our original question.</span> <span data-start="1066150">Did we actually help with rush hour?</span> <span data-start="1068670">Would this actually help?</span> <span data-start="1070350">Well, let's review.</span> </section>

<section><span data-start="1071347"><span class="speaker">Surma</span>: So one thing that we definitely</span> <span data-start="1072930">did achieve is that we are making it less likely to have</span> <span data-start="1076920">big chunks of uninterruptable JavaScript and more</span> <span data-start="1080220">little chunks where the browser can stop it in between</span> <span data-start="1082920">and ship a frame.</span> <span data-start="1083980">So that's definitely one advantage that we have.</span> </section>

<section><span data-start="1086280"><span class="speaker">Paul Lewis</span>: The location independence,</span> <span data-start="1087870">hopefully, some of our actors can be run successfully away</span> <span data-start="1091375">from the main thread.</span> <span data-start="1092250">Hopefully, it's like fewer cars on the road at rush hour.</span> <span data-start="1095190">That's good for everybody typically.</span> </section>

<section><span data-start="1097860"><span class="speaker">Surma</span>: And as a result, a lot of work</span> <span data-start="1099930">that can happen in an unexpected way,</span> <span data-start="1101670">if you're processing a big API response to something,</span> <span data-start="1104550">that can happen in the worker and not affect your main thread</span> <span data-start="1107130">from going into jank mode.</span> </section>

<section><span data-start="1109382"><span class="speaker">Paul Lewis</span>: There are some other benefits</span> <span data-start="1111090">that Surma, Tim, and I have noticed as well working</span> <span data-start="1113926">in this particular pattern.</span> <span data-start="1115050">One is better testing.</span> <span data-start="1117540">With that kind of area of ownership,</span> <span data-start="1122280">it's easier to look at an actor and go,</span> <span data-start="1124722">oh, well I know what you should do.</span> <span data-start="1126180">And you've got an onMessage that I can call,</span> <span data-start="1128489">and I can make sure that you do the right things.</span> <span data-start="1130530">So the testing seems to become a little bit easier.</span> </section>

<section><span data-start="1132760"><span class="speaker">Surma</span>: Yeah.</span> <span data-start="1133260">Off on the other side, you can mock another actor</span> <span data-start="1135510">by just implementing the messages that that actor needs</span> <span data-start="1137970">to receive and not do the actual work,</span> <span data-start="1139680">but just send prerecorded messages back.</span> </section>

<section><span data-start="1142165"><span class="speaker">Paul Lewis</span>: You have a clear separation</span> <span data-start="1143790">of concerns, which again, it helps you</span> <span data-start="1148380">in terms of maybe dividing the work with your teammates</span> <span data-start="1152160">or even just deciding for yourself</span> <span data-start="1154670">which actor needs to be responsible for this part</span> <span data-start="1157020">of the system?</span> </section>

<section><span data-start="1158617"><span class="speaker">Surma</span>: And you get the code splitting.</span> <span data-start="1160200">Because you have actors that can be hooked up to the system</span> <span data-start="1163950">at any point in time, really, it allows</span> <span data-start="1165660">you to split them up and load them lazily.</span> <span data-start="1167860">You can just import them when you need them.</span> </section>

<section><span data-start="1169693"><span class="speaker">Paul Lewis</span>: Yeah.</span> <span data-start="1170430">That's good.</span> <span data-start="1172860">And bring your own framework.</span> <span data-start="1174210">If you want to use a particular library or framework, you can.</span> <span data-start="1180300">There's not a prescriptive way.</span> <span data-start="1181712">If you want to use the [? one ?] thing, use it.</span> <span data-start="1183670">Great.</span> <span data-start="1184730">Now, there are some considerations in this world,</span> <span data-start="1188430">in this setup that we described.</span> <span data-start="1190110">One is actor performance challenges.</span> <span data-start="1192300">If you imagine your UI actor, imagine</span> <span data-start="1194400">it decides to run along and just be not very yieldy.</span> <span data-start="1199170">You still have that problem.</span> <span data-start="1200380">It's no different to a process or an application</span> <span data-start="1202470">in an operating system deciding it's going to hog the CPU.</span> <span data-start="1205800">This is not going to go away.</span> <span data-start="1208840">But we do think that the Scheduler</span> <span data-start="1210360">API that Jason and Shubhie mentioned in the previous talk</span> <span data-start="1213840">is a huge part of this story.</span> <span data-start="1215610">Because it's a great way for individual actors</span> <span data-start="1217800">to start breaking their work up into smaller chunks.</span> <span data-start="1221470">You may also be sitting there going,</span> <span data-start="1222970">I'm not sure I could actorize my blog.</span> <span data-start="1226460">And we would agree.</span> <span data-start="1227810">It's not necessarily for all use cases.</span> <span data-start="1229900">This works really well when you've</span> <span data-start="1231640">got apps and in particular apps where you think, actually,</span> <span data-start="1234460">I can ring fence.</span> <span data-start="1235270">I can mark off particular parts of this application.</span> <span data-start="1238210">And I can have some kind of owner for it.</span> <span data-start="1240070">That's where it works really well.</span> </section>

<section><span data-start="1242200"><span class="speaker">Surma</span>: And there's definitely a different mental model to this.</span> <span data-start="1245190">As I said, it kind of shifts the center</span> <span data-start="1247330">of the universe away from the UI framework</span> <span data-start="1249550">into many center pieces —  all the actors are just</span> <span data-start="1252722">communicating.</span> <span data-start="1253305">So it definitely took us a time to build an intuition</span> <span data-start="1256900">for where do we draw the line?</span> <span data-start="1258220">What becomes an actor?</span> <span data-start="1259210">What is just part of an already existing actor?</span> <span data-start="1261520">What kind of messages should we send?</span> <span data-start="1263140">How granular should this entire set up be?</span> <span data-start="1265690">So if it seems weird at first, if you're</span> <span data-start="1267981">playing around with this, that is kind of to be expected.</span> <span data-start="1270355">It's a very different way of architecting a web app.</span> </section>

<section><span data-start="1274660"><span class="speaker">Paul Lewis</span>: So that was the rush hour bit.</span> <span data-start="1277750">That future-facing stuff like the VR, AR, and so on — </span> <span data-start="1281177">well, we have some thoughts there too.</span> <span data-start="1282760">Watch this.</span> <span data-start="1283554">So you were talking about actors before.</span> <span data-start="1285220">And I want to talk about cameras.</span> <span data-start="1287080">And the reason I want to talk about cameras</span> <span data-start="1288370">is because it all plays into that story, right?</span> <span data-start="1290330">So if can, have one of these lenses before I drop it,</span> <span data-start="1292538">because I don't want to.</span> <span data-start="1294700">Your modern camera has two bits — </span> <span data-start="1297460">the camera body, which is the thing that</span> <span data-start="1300040">holds the state when you're shooting in JPEG or RAW — </span> </section>

<section><span data-start="1302280"><span class="speaker">Surma</span>: Yeah.</span> <span data-start="1302440">It's like the business logic.</span> <span data-start="1303330">It knows how to take the picture and how to store it</span> <span data-start="1305200">and it does all that.</span> </section>

<section><span data-start="1306080"><span class="speaker">Paul Lewis</span>: Yeah.</span> <span data-start="1306580">Whether you're shooting video, or taking photos with it,</span> <span data-start="1308530">or whether you are autofocus or manual</span> <span data-start="1310220">focus —  you get the idea.</span> <span data-start="1311290">Similar to like a web app, that's</span> <span data-start="1313660">the state of what's going on.</span> <span data-start="1314920">But you've got different lenses for different tasks.</span> <span data-start="1318110">So that one would be something like a portrait lens.</span> <span data-start="1321100">This one might be a wide-angle — </span> <span data-start="1323110">take something of a landscape.</span> </section>

<section><span data-start="1324647"><span class="speaker">Surma</span>: As long as we make sure that the mounts are compatible,</span> <span data-start="1327230">which I guess, in actor world, means</span> <span data-start="1328730">that they speak with the same messages to each other.</span> </section>

<section><span data-start="1330994"><span class="speaker">Paul Lewis</span>: Yes.</span> <span data-start="1331660">So the messages that they send are really important.</span> <span data-start="1334120">They're standardized, right?</span> <span data-start="1336700">And everybody kind of plays to that same data contract.</span> <span data-start="1339170">Other than that, you can do what you like.</span> </section>

<section><span data-start="1341080"><span class="speaker">Surma</span>: Plug it in.</span> </section>

<section><span data-start="1342010"><span class="speaker">Paul Lewis</span>: Off you go.</span> </section>

<section><span data-start="1343442"><span class="speaker">Surma</span>: Last video, I promise.</span> </section>

<section><span data-start="1344650"><span class="speaker">Paul Lewis</span>: Yeah.</span> <span data-start="1345358">So camera lenses —  why camera lenses?</span> <span data-start="1347390">How does that apply to this story?</span> <span data-start="1351080">When we talked about this earlier,</span> <span data-start="1352770">I think very naturally, we would have all thought of the DOM.</span> <span data-start="1355667">We would have thought of, in the chess game,</span> <span data-start="1357500">we would have thought of this version.</span> <span data-start="1360350">But there's the freedom that you get from a UI actor</span> <span data-start="1363369">that, as long as it can speak the right messages,</span> <span data-start="1365410">it can be implemented in different technologies.</span> <span data-start="1367760">So you could have a different actor that does 3D.</span> <span data-start="1371770">And now you get that.</span> <span data-start="1372790">It just has to send the same messages as the standard DOM</span> <span data-start="1376090">version.</span> <span data-start="1376960">Or maybe one full XR, similarly, it</span> <span data-start="1380170">needs to be able to do that — </span> <span data-start="1381600">send the right messages.</span> <span data-start="1382840">And perhaps something like Voice as well — </span> <span data-start="1385930">similar kind of story.</span> <span data-start="1387479">So as a byproduct of the actor model,</span> <span data-start="1389020">we've all of a sudden got these different swappable UI</span> <span data-start="1392710">actors that we can take with us wherever we need to go.</span> <span data-start="1395002">And you might say, well, actually,</span> <span data-start="1396418">all I need in this particular app is the XR and Voice.</span> <span data-start="1398830">Or maybe I want DOM and Voice.</span> </section>

<section><span data-start="1401442"><span class="speaker">Surma</span>: And you could even imagine a setup</span> <span data-start="1403150">where you have a DOM actor with lots of effects and visuals</span> <span data-start="1406840">and one DOM actor implements the same app, but with a much</span> <span data-start="1410410">less intense memory consumption version, like a low-end version</span> <span data-start="1414250">of your website.</span> <span data-start="1415150">And once you detect that the device we're running on</span> <span data-start="1417520">is actually kind of struggling to keep up.</span> <span data-start="1419317">You can actually switch it out in the middle</span> <span data-start="1421150">of the app and downgrade to the lower visual version.</span> </section>

<section><span data-start="1424097"><span class="speaker">Paul Lewis</span>: Or one would say reduced motion or something</span> <span data-start="1426430">like that.</span> <span data-start="1427600">And technically, this will be called</span> <span data-start="1429100">multi-view or multi-modal, which is</span> <span data-start="1430750">a very fancy way of saying there are lots of ways</span> <span data-start="1432791">to interact with your web app.</span> <span data-start="1434140">And as a byproduct, within the actor model,</span> <span data-start="1436920">it enables you to do that pretty well.</span> <span data-start="1439311">So if you're interested in looking at the hookup</span> <span data-start="1441310">and lookup of the Actor base class</span> <span data-start="1442799">that we mentioned earlier, this would</span> <span data-start="1444340">be the place to go if you want to take a snap at that.</span> </section>

<section><span data-start="1447170"><span class="speaker">Surma</span>: This is actually, not only the Actor base class,</span> <span data-start="1449530">but it's actually a boiler plate.</span> <span data-start="1450952">So it gets you started.</span> <span data-start="1451910">There's rollup configured where you can just build it,</span> <span data-start="1454160">does the code splitting, the lazy loading.</span> <span data-start="1455952">It should get you started really quickly,</span> <span data-start="1457660">so you can start writing actors and get</span> <span data-start="1459370">a feel for how it feels.</span> </section>

<section><span data-start="1460615"><span class="speaker">Paul Lewis</span>: Let's be clear.</span> <span data-start="1461740">It's experimental.</span> <span data-start="1462400">It's just the stomping ground that we've</span> <span data-start="1464066">been using for the last little while.</span> <span data-start="1465890">And we'd love you to take a look and have a chat with us</span> <span data-start="1468223">and just tell us what you think.</span> <span data-start="1470364">So in summary, we're actually quite excited that something</span> <span data-start="1472780">from 45 years ago has kind of come full circle,</span> <span data-start="1476080">and it seems to be the thing — </span> </section>

<section><span data-start="1479516"><span class="speaker">Surma</span>: It's been hiding in plain sight.</span> </section>

<section><span data-start="1481140"><span class="speaker">Paul Lewis</span>: Yeah.</span> <span data-start="1481848">And from some of the places in computing,</span> <span data-start="1483975">we've kind of brought it over, not in a purist way.</span> <span data-start="1486100">We have our own take on these things.</span> <span data-start="1488154">But it respects that single-threadedness</span> <span data-start="1489820">of JavaScript.</span> <span data-start="1491020">It seems to help with rush hour.</span> <span data-start="1492970">And it also seems to enable us to go multi-modal, which</span> <span data-start="1495460">is really kind of exciting.</span> <span data-start="1497110">And on that note, thanks.</span> </section>

<section><span data-start="1499446"><span class="speaker">Surma</span>: Thank you very much.</span> <span data-start="1500570">[MUSIC PLAYING]</span> </section>

</div>

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="js/main.js"></script>

</body>

</html>
