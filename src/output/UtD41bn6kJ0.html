<!DOCTYPE html>

<! — 
Copyright 2018 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
 — >

<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="//google.com">
<meta name="description" content="Chrome Dev Summit">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>UtD41bn6kJ0</title>
<link rel="stylesheet" href="css/main.css">
</head>

<body>

<div id="container">

<section>
<span data-start="0">[MUSIC PLAYING]</span> </section>

<section><span data-start="5460"><span class="speaker">Gray Norton</span>: Good morning, everyone,</span> <span data-start="6960">and welcome back from the break.</span> <span data-start="8560">It's true.</span> <span data-start="9060">My name is Gray.</span> <span data-start="10374">And I don't think my parents could</span> <span data-start="11790">have known when they named me all those years ago</span> <span data-start="13920">that my hair would prematurely match my name</span> <span data-start="16470">or that I would be a valid CSS color.</span> <span data-start="18580">So I give them a lot of credit.</span> <span data-start="22180">So I'm the engineering manager for the Polymer Project</span> <span data-start="24830">at Chrome.</span> <span data-start="25500">And my team focuses mainly on web components, and libraries,</span> <span data-start="28530">and tools to help you use them.</span> <span data-start="30147">But we're involved in some other stuff, too.</span> <span data-start="31980">And today I'm here to talk about something a little different.</span> <span data-start="39849">Or maybe we'll just stand here, and look at my picture.</span> <span data-start="42140">[CHUCKLES]</span> <span data-start="43710">So shockingly, we're going to be talking about performance.</span> <span data-start="46620">As you may have noticed, we're a wee bit</span> <span data-start="48360">obsessed with that topic.</span> <span data-start="50710">And by now, you've already heard about speed tooling, and best</span> <span data-start="54270">practices for doing everything faster,</span> <span data-start="56430">from loading, to rendering, to responding to user input.</span> <span data-start="60695">But for the next half hour, we're</span> <span data-start="62070">going to drill in on something a little more specific.</span> <span data-start="65280">And that's a proven pattern for improving performance that we'd</span> <span data-start="68220">like to see more of on the web.</span> <span data-start="71010">[INAUDIBLE] mentioned in yesterday's keynote</span> <span data-start="74220">that today's web platform is really</span> <span data-start="76350">a high-performance machine.</span> <span data-start="78180">And it's way faster in almost every way than it</span> <span data-start="80610">was even a few years ago.</span> <span data-start="83260">But there are still some surefire ways to slow it down.</span> <span data-start="86290">And one of those ways is just trying to render too much.</span> <span data-start="90110">Especially on low-end mobile devices,</span> <span data-start="91910">you can bring performance to a crawl</span> <span data-start="93820">by piling on too much DOM.</span> <span data-start="96210">And sadly, there are key parts of the rendering process,</span> <span data-start="99520">like styling and layout, that just take longer the more nodes</span> <span data-start="102669">you have in your page.</span> <span data-start="106530">So for a certain class of performance problems,</span> <span data-start="109070">the best thing you can do to speed things up</span> <span data-start="111530">is to lighten your load, minimize</span> <span data-start="113480">the number of DOM nodes you have on the page at any given time.</span> <span data-start="116670">And there are various ways to do this, of course.</span> <span data-start="118750">But one of the simplest and most effective</span> <span data-start="120500">is to adopt a pattern called virtual scrolling.</span> <span data-start="125340">So for the last several months, a couple of members of my team</span> <span data-start="128280">have teamed up with some of our Chrome colleagues</span> <span data-start="130470">and some other folks inside and outside of Google</span> <span data-start="133380">to explore what it might look like to add</span> <span data-start="135150">first-class virtual scrolling support to the web platform.</span> <span data-start="139650">Today I'd like to share what we've come up with so far.</span> <span data-start="142720">It's early, but we're pretty excited about where</span> <span data-start="144720">the project is headed.</span> <span data-start="147979">We'll start with a quick introduction</span> <span data-start="149520">to what virtual scrolling is and how it's currently</span> <span data-start="151890">being used on and off the web.</span> <span data-start="155114">And then we'll take a closer look at the performance</span> <span data-start="157280">problems we're trying to addressing, seeing firsthand</span> <span data-start="159950">how too much DOM can impact the responsiveness of your pages.</span> <span data-start="164880">Next, we'll talk briefly about the approach we're taking,</span> <span data-start="169160">and we'll show you what we've come up with so far.</span> <span data-start="172729">And then finally, we'll look ahead to what's next</span> <span data-start="174770">and how you can get involved if you're interested.</span> <span data-start="178957">So without further ado, let's see what</span> <span data-start="180540">virtual scrolling is all about.</span> <span data-start="182580">For the sake of comparison, first we'll</span> <span data-start="184530">look at ordinary scrolling.</span> <span data-start="186030">So the blue box here is our viewport.</span> <span data-start="188010">And as you can see, as we scroll,</span> <span data-start="190290">the document moves behind the viewport revealing content</span> <span data-start="192900">further up or down.</span> <span data-start="194160">But notice that all the content was present from the start.</span> <span data-start="197010">The only thing that changes is what we see.</span> <span data-start="200900">Now here's the same page in a virtual scroller.</span> <span data-start="203870">As you'll see, only part of the content exists on the document.</span> <span data-start="207080">As we scroll, nodes are dynamically added and removed</span> <span data-start="210440">keeping just enough to fill the viewport.</span> <span data-start="212920">Nodes is an obvious one at load times,</span> <span data-start="214730">since we only need to render one screenfull.</span> <span data-start="217280">But as we'll see, virtual scrolling actually</span> <span data-start="219410">also improves performance in other ways</span> <span data-start="221150">that might not be as obvious.</span> <span data-start="225340">So when does it make sense to use virtual scrolling?</span> <span data-start="228780">It's clearly a natural fit for anytime</span> <span data-start="230520">you need to display a lot of data</span> <span data-start="232380">in a list or table form —  for example,</span> <span data-start="234480">like this address book.</span> <span data-start="237280">And also, it's an obvious call for content</span> <span data-start="240170">feeds in cases like social media or messaging.</span> <span data-start="246669">But feeds have started showing up in less traditional places,</span> <span data-start="249210">too.</span> <span data-start="249720">So some publishers have started stitching together</span> <span data-start="251940">articles in a way that takes advantage</span> <span data-start="254340">of the low friction of scrolling.</span> <span data-start="256920">And this may not look like your garden-variety infinite list.</span> <span data-start="259576">But nonetheless, it's absolutely a case where</span> <span data-start="261450">virtual scrolling can help.</span> <span data-start="264440">And for that matter, we actually think</span> <span data-start="266210">there's a strong argument to be made</span> <span data-start="267830">for looking at virtual scrolling in cases beyond lists</span> <span data-start="271850">and feeds.</span> <span data-start="273440">A single piece of long-form content,</span> <span data-start="275000">like this Wikipedia article, might easily</span> <span data-start="277040">contain tens of thousands of nodes.</span> <span data-start="279370">And the same techniques that we use for lists</span> <span data-start="281360">can also help us keep the weight of documents</span> <span data-start="283480">like this under control.</span> <span data-start="287810">So virtual scrolling isn't a new idea, of course.</span> <span data-start="290360">It's widely used on native mobile platforms.</span> <span data-start="293150">In fact, both iOS and Android put virtualized views</span> <span data-start="296240">front and center in their SDKs, making</span> <span data-start="298514">this one of the first concepts you</span> <span data-start="299930">learn as a new developer on one of those platforms.</span> <span data-start="303670">And this is a big part of why native mobile apps tend</span> <span data-start="306050">to feel fast.</span> <span data-start="307850">A basic native view is actually heavier than the equivalent</span> <span data-start="310370">chunk of DOM.</span> <span data-start="311360">But the mainstream use of virtual scrolling</span> <span data-start="314030">on platforms like these helps keep performance line.</span> <span data-start="319627">Now you might be thinking, virtual scrolling</span> <span data-start="321460">isn't new to the web, either.</span> <span data-start="322990">And you'd be right.</span> <span data-start="324500">There are popular and effective virtual scrolling solutions</span> <span data-start="327310">for all the top frameworks, including,</span> <span data-start="329720">among others, react-virtualized, and its younger sibling</span> <span data-start="332740">react-window, the virtual-scroll-viewport</span> <span data-start="336280">in the Angular Material CDK, and the view-virtual-scroller</span> <span data-start="340385">library.</span> <span data-start="344266">But these solutions are currently</span> <span data-start="345640">getting by without much help from the web platform.</span> <span data-start="348800">So in the age-old tradition of paving cow paths,</span> <span data-start="351970">we asked ourselves, what might it</span> <span data-start="353560">look like for the web to offer first-class virtual scrolling</span> <span data-start="356680">support?</span> <span data-start="357280">How could we make things better?</span> <span data-start="359600">And we came up with a few ideas.</span> <span data-start="362970">First, virtualization generally means</span> <span data-start="365540">you can't link to locations within the same document</span> <span data-start="368219">since the browser can't scroll to a node that's not currently</span> <span data-start="370760">on the DOM.</span> <span data-start="371780">Now, this may not be an issue for many use cases.</span> <span data-start="374450">You don't see a lot of links between address book entries,</span> <span data-start="377240">for example.</span> <span data-start="378500">But in other cases, it is a big deal,</span> <span data-start="380412">and it breaks a fundamental feature of the web.</span> <span data-start="385340">And there's a similar problem with the browsers Find</span> <span data-start="387585">in Page feature, which only sees text</span> <span data-start="389756">if it's present in the DOM.</span> <span data-start="393420">And then there's search friendliness.</span> <span data-start="395550">Since virtualized content is added on the fly,</span> <span data-start="398500">it's not generally visible to search engine crawlers.</span> <span data-start="401777">And again, this isn't relevant for every use case.</span> <span data-start="403860">But we'd love to get the performance</span> <span data-start="405360">benefits of virtual scrolling without sacrificing</span> <span data-start="407610">indexability.</span> <span data-start="411090">Finally, and maybe most importantly,</span> <span data-start="412890">we'd like to see if we can greatly</span> <span data-start="414420">increase the amount of virtualization that</span> <span data-start="416190">happens on the web by adding platform-level support.</span> <span data-start="419065">While you could do it today, virtual scrolling on the web</span> <span data-start="421440">is basically a fringe feature.</span> <span data-start="423150">You have to discover you need it,</span> <span data-start="424819">and then you have to jump through some hoops to get it.</span> <span data-start="427110">We'd like to put it front and center — </span> <span data-start="428400">the way it is in mobile SDKs — </span> <span data-start="429870">making it easier to discover and easier to use.</span> <span data-start="437780">OK, so we've talked about what virtual scrolling is</span> <span data-start="440780">and why we're interested in adding it to the web platform.</span> <span data-start="443430">But to really understand the nature of the performance</span> <span data-start="445400">problems we're trying to solve, it'll</span> <span data-start="446960">help to look at some examples.</span> <span data-start="451520">Since problems are the worst on low-end devices,</span> <span data-start="453980">we'll use a typical Android Go phone for this exercise.</span> <span data-start="457560">So I actually recorded a bunch of real-world interactions</span> <span data-start="460460">for this talk.</span> <span data-start="461272">But I wasn't super happy with the quality of the recording.</span> <span data-start="463730">So I ended up creating dramatic reenactments in Dev Tools</span> <span data-start="467780">with CPU throttling turned on.</span> <span data-start="470050">But what you'll see here is representative</span> <span data-start="471800">of the performance on a real device.</span> <span data-start="473300">And I'd be happy to show you on the device itself</span> <span data-start="475532">if you come find me after the talk.</span> <span data-start="482050">OK, so first, we'll look at how the size of the document</span> <span data-start="485470">impacts rendering and what that means</span> <span data-start="487390">for responding to user interactions and content</span> <span data-start="490095">updates.</span> <span data-start="493340">So I created a simple example to demonstrate.</span> <span data-start="495480">It's a bit contrived, but it exercises the browser engine</span> <span data-start="498040">in the same way as the real pages do.</span> <span data-start="500650">So this mocked-up content feed has just five items in it.</span> <span data-start="503330">And it performs pretty well.</span> <span data-start="504940">You'll see it has advanced features like a dark mode</span> <span data-start="508300">and a compact layout mode.</span> <span data-start="510700">And these are all made just using standard CSS techniques</span> <span data-start="513340">changing classes.</span> <span data-start="515231">And then lastly, we have this slider here,</span> <span data-start="516980">which lets us increase or decrease the size of the items</span> <span data-start="520600">by changing the base font size in the document, which</span> <span data-start="523000">is a technique that many of you have probably used.</span> <span data-start="525700">And layouts or the items themselves</span> <span data-start="528340">are based on [INAUDIBLE] so that the whole thing scales.</span> <span data-start="532709">As you can see, this performed pretty well.</span> <span data-start="534500">But again, it's only five items.</span> <span data-start="537235">So let's see what happens if we bump up</span> <span data-start="538860">to 50 items on our feed.</span> <span data-start="540366">So I'm scrolling here to show there's more content.</span> <span data-start="542490">But don't focus on the scrolling performance.</span> <span data-start="544480">We'll talk about that in a minute.</span> <span data-start="545896">For now, we want to focus on the other interactions.</span> <span data-start="548250">You'll notice I added a jank indicator.</span> <span data-start="550020">So the screen flashes red when rendering gets slow.</span> <span data-start="554280">And we're not too bad here at 50 items</span> <span data-start="556410">still, although there are noticeable delays for the mode</span> <span data-start="558810">switches.</span> <span data-start="559500">And then you'll see there's some sluggishness</span> <span data-start="561720">as we start moving the slider.</span> <span data-start="571610">But where we really start feeling the pain</span> <span data-start="573620">is when we get up to 500 times or more.</span> <span data-start="576290">So the lagginess in this example is</span> <span data-start="578000">going to be impossible to miss.</span> <span data-start="581570">So you'll notice that, when we go</span> <span data-start="583020">to dark mode or compact mode, there's a very noticeable lag.</span> <span data-start="589790">And the slider is going to be virtually unusable,</span> <span data-start="593540">it's so slow to update.</span> <span data-start="597960">If anything, it actually feels worse</span> <span data-start="599460">on the real phone than this.</span> <span data-start="603530">So again, this example is a bit contrived.</span> <span data-start="605330">You may not do exactly this on your page.</span> <span data-start="607410">But the effects it illustrates are very real.</span> <span data-start="609825">When you're rendering any content on your page,</span> <span data-start="613290">whether it's in response to user interactions or changing data,</span> <span data-start="616340">it gets much slower as your document gets bigger.</span> <span data-start="619220">And on devices like this, it can kill your page.</span> <span data-start="625910">So let's jump ahead of it, and see how much</span> <span data-start="629080">virtual scrolling might help.</span> <span data-start="630860">So this is exactly the same page with</span> <span data-start="632500">our work-in-progress virtual scroller swapped</span> <span data-start="634660">in for the scrolling region.</span> <span data-start="636150">And we've bumped all the way up to 5,000 items.</span> <span data-start="638140">But of course, only a small effect fraction</span> <span data-start="639931">are actually in the document at any given time.</span> <span data-start="642421">And as you can see, we're pretty much back</span> <span data-start="644170">to the same performance we had in our original five-item list.</span> <span data-start="646840">And this is essentially how it feels on the phone, as well.</span> <span data-start="651740">And remember, this is a very low-powered Android Go device.</span> <span data-start="660750">Next, let's see how virtualizing might help us that load time.</span> <span data-start="664170">So a quick caveat about this — </span> <span data-start="666360">load time performance, how quickly we get something</span> <span data-start="668520">on screen, how quickly we make it interactive,</span> <span data-start="670800">depends on a lot of factors.</span> <span data-start="672240">And virtual scrolling doesn't directly impact many of them.</span> <span data-start="675570">But to the extent that styling and layout are slowing things</span> <span data-start="678870">down at load time, virtual scrolling can definitely help.</span> <span data-start="684550">So being the big web nerds that we are,</span> <span data-start="687010">we'll use the single-page HTML spec doc as an example.</span> <span data-start="690530">So this thing is massive, somewhere on the order</span> <span data-start="692530">of a million words, I'm told.</span> <span data-start="694600">And it's notoriously slow to load.</span> <span data-start="696670">So on my Android Go device, with a "good but not great"</span> <span data-start="699730">network connection —  because I'd gone over my data allowance</span> <span data-start="702850">for the month — </span> <span data-start="704650">it took about seven seconds to get something on screen.</span> <span data-start="709620">So for comparison, we've built a virtual scrolling</span> <span data-start="714050">version of this page out of duct tape and baling wire.</span> <span data-start="716810">Basically, it loads the original dock into a hidden iframe.</span> <span data-start="719990">And then it populates the virtual scroller</span> <span data-start="721850">as the nodes stream into the iframe.</span> <span data-start="723706">And you wouldn't build a real thing this way.</span> <span data-start="725580">But it's an interesting test case.</span> <span data-start="726996">And it illustrates the impact.</span> <span data-start="728970">So as this visualization shows, we got something on screen</span> <span data-start="732230">much faster — </span> <span data-start="733160">just over three seconds instead of seven — </span> <span data-start="735470">and it actually gets even better from there.</span> <span data-start="738250">The original version on this Android Go phone</span> <span data-start="741590">was suffering from scroll jank for well over a minute</span> <span data-start="745340">after I started loading it.</span> <span data-start="746690">Whereas, the virtual scrolling version is usable right away.</span> <span data-start="749750">As you scroll, there's occasionally</span> <span data-start="752420">a delay as it updates.</span> <span data-start="754550">But unlike on the original version,</span> <span data-start="757820">you're never sitting and waiting for seconds</span> <span data-start="759721">while the screen is locked up.</span> <span data-start="766430">OK, so before we move on from performance,</span> <span data-start="768380">one quick word about scrolling performance — </span> <span data-start="770450">because it seems a little weird not to talk about that</span> <span data-start="772850">in a talk about scrolling.</span> <span data-start="775640">So because scrolling is driven by the GPU,</span> <span data-start="778430">even on our low-end Android Go device,</span> <span data-start="780862">you actually get pretty decent scrolling.</span> <span data-start="782570">It scrolls at a reliably high frame</span> <span data-start="784220">rate that actually looks really good at normal scrolling</span> <span data-start="786560">speeds.</span> <span data-start="787670">But when you scroll quickly, something funny happens.</span> <span data-start="790840">The screen blanks out, goes completely white</span> <span data-start="793070">for long periods of time while the rendering pipeline</span> <span data-start="796010">catches up.</span> <span data-start="796610">And this actually gets worse as the size of the document</span> <span data-start="799040">increases, just like the other performance</span> <span data-start="800600">problems we've been looking at.</span> <span data-start="804330">So I did salvage one of my original on-device recordings.</span> <span data-start="808100">And we'll look at it here.</span> <span data-start="810212">Our virtual scroller, it turns out,</span> <span data-start="811670">significantly reduced the blanking problem.</span> <span data-start="814190">It happens much less frequently.</span> <span data-start="815719">And when it does happen, the renderer</span> <span data-start="817260">catches up much more quickly.</span> <span data-start="819980">The trade off is that scrolling is mildly but noticeably less</span> <span data-start="822770">smooth overall.</span> <span data-start="823880">As you would expect, doing JavaScript layout</span> <span data-start="827030">on a CPU-challenged device like this</span> <span data-start="829520">does impact the frame rate.</span> <span data-start="831510">But as you can see from the video,</span> <span data-start="833510">it's a very good experience nonetheless, even</span> <span data-start="836646">on this low-powered device.</span> <span data-start="842040">OK.</span> <span data-start="843190">So we know what virtual scrolling is.</span> <span data-start="844960">We know why we want to add it to the platform.</span> <span data-start="846970">And we've seen firsthand why we need it.</span> <span data-start="850780">We see the performance issues we're trying to overcome.</span> <span data-start="855560">So I want to talk for a moment about the process</span> <span data-start="859120">that we're going through.</span> <span data-start="861100">Because it's actually not that common in recent years</span> <span data-start="864730">for the web to add new high-level features.</span> <span data-start="866950">And so we had a bunch of things that we really want to do — </span> <span data-start="873070">and treat this sort of as a Guinea</span> <span data-start="874750">pig for how we might add to higher-level features.</span> <span data-start="879040">We'll start with some basic principles.</span> <span data-start="883345">Anytime you're building something</span> <span data-start="884720">in the web platform itself, as opposed to in user space,</span> <span data-start="888620">it's important to get the very basic use cases right.</span> <span data-start="891140">Because web APIs live forever.</span> <span data-start="894350">And it's much more important that we do the simple stuff</span> <span data-start="897890">right.</span> <span data-start="899600">So with that in mind, we wanted to make sure</span> <span data-start="901520">that we learned from prior art.</span> <span data-start="902930">There's obviously virtual scrollers on other platforms</span> <span data-start="905300">and plenty of good work in the framework space.</span> <span data-start="908480">As I said, we want to make it simple.</span> <span data-start="911370">We want the feature to be easy to use.</span> <span data-start="913047">As much as possible, we want you to be</span> <span data-start="914630">able to create web content that you just</span> <span data-start="916947">happened to put in a virtual stroller,</span> <span data-start="918530">as opposed to picking up a brand new API</span> <span data-start="921170">and thinking fundamentally differently</span> <span data-start="922850">about the way you build stuff.</span> <span data-start="926650">Make it work —  it sounds trite, and it is.</span> <span data-start="928840">But what I mean by this is everything needs to work.</span> <span data-start="931720">We talked about links.</span> <span data-start="932650">We talked about finding page.</span> <span data-start="934000">It's critical that accessibility works.</span> <span data-start="935770">We want tapping from item to item to work.</span> <span data-start="941172">And of course, it needs to be fast.</span> <span data-start="942630">After all, this is a performance problem we're trying to solve.</span> <span data-start="948321">OK.</span> <span data-start="948820">The next thing we want to do is we want to embrace layering.</span> <span data-start="952350">And we'll talk a little bit more about what we mean by that.</span> <span data-start="956580">Nicole actually mentioned this in the keynote.</span> <span data-start="960930">One of the important things we want to do out of this process</span> <span data-start="963660">is identify and implement any lower-level primitives</span> <span data-start="966780">that the browser may be missing in order</span> <span data-start="968730">to support this high-level use case.</span> <span data-start="972270">We also want to enable this thing</span> <span data-start="973710">to be used right out of the box, much like you use</span> <span data-start="975990">a vanilla HTML and JavaScript.</span> <span data-start="977880">We don't want you to have to pick up a framework</span> <span data-start="980460">to do a virtual scrolling.</span> <span data-start="981570">We'd like you to be able to use it on the web platform simply.</span> <span data-start="984990">But with that said, we also want to give</span> <span data-start="987420">frameworks and libraries a solid base to build on.</span> <span data-start="990175">And certainly, the low-level primitives</span> <span data-start="991800">are things they can use.</span> <span data-start="992800">But ideally, we'd like the virtual stroller</span> <span data-start="995040">itself to be something that they can take, in whole or in part,</span> <span data-start="997920">and layer features on top of for their own virtual scrolling</span> <span data-start="1001370">solutions.</span> <span data-start="1004340">And as I mentioned, this is all really — </span> <span data-start="1006850">with the idea of blazing a trail.</span> <span data-start="1008560">We think that there's a lot of room to improve the developer</span> <span data-start="1011500">experience and the user experience of the web platform</span> <span data-start="1013990">by adding some high-level features in coming years.</span> <span data-start="1017750">And with that in mind, we want to use virtual scroller</span> <span data-start="1020260">as sort of a lens or a testing ground</span> <span data-start="1022960">for us to examine what it means to add new high-level features.</span> <span data-start="1027294">And so we'll talk about some of these things</span> <span data-start="1029829">as we look at the virtual stroller.</span> <span data-start="1033244">So with those principles in mind,</span> <span data-start="1034619">we sat down to do our homework.</span> <span data-start="1036710">And the first thing we did was we set up</span> <span data-start="1038910">what we called at that time the infinite list study group.</span> <span data-start="1041819">And we basically had a bunch of people</span> <span data-start="1043829">from across Chrome who would get together</span> <span data-start="1045900">once every couple of weeks.</span> <span data-start="1047130">And each time, someone would take the homework</span> <span data-start="1049046">of looking at a particular virtual scrolling solution</span> <span data-start="1051460">and reporting back.</span> <span data-start="1052530">And we would discuss it.</span> <span data-start="1053920">And we'd learn about what was working and what wasn't.</span> <span data-start="1056620">And we documented all this here on GitHub.</span> <span data-start="1060262">Once we'd done that for a while, we</span> <span data-start="1061720">came up with a set of requirements,</span> <span data-start="1064330">and it was time to start building.</span> <span data-start="1067340">Now I don't know what this is.</span> <span data-start="1069034">I think it's molding or something.</span> <span data-start="1070450">But it looks like something I'd really like to build.</span> <span data-start="1072658">So I put it on the slide.</span> <span data-start="1075100">And we have the same sort of love for virtual scroller.</span> <span data-start="1078340">So once we started implementation,</span> <span data-start="1080440">we did that on GitHub, as well.</span> <span data-start="1082010">And one of the things you'll notice here</span> <span data-start="1083676">is that virtual scroller is being</span> <span data-start="1085210">implemented in JavaScript.</span> <span data-start="1087610">And this obviously is sort of unusual for something</span> <span data-start="1090670">that's under consideration for a web platform API.</span> <span data-start="1093910">It's not typically how we build platform APIs.</span> <span data-start="1098410">But this gets to the layering concept.</span> <span data-start="1100360">We wanted to make sure that we didn't</span> <span data-start="1101901">reserve any special powers in adding these features.</span> <span data-start="1105502">And one of the best ways to do that</span> <span data-start="1106960">is to develop things on the same environment</span> <span data-start="1110290">that framework and app developers develop in.</span> <span data-start="1117866">So the next important thing about the process</span> <span data-start="1119740">is we wanted to be in constant dialogue.</span> <span data-start="1121750">We talked about the fact that we're doing these things</span> <span data-start="1123370">out in the open and GitHub.</span> <span data-start="1124660">But also, we've been talking to people all along.</span> <span data-start="1126877">So we've been talking to other browser vendors about the ideas</span> <span data-start="1129460">behind virtual stroller and the principles</span> <span data-start="1131830">that we're trying to look at for adding new high-level features.</span> <span data-start="1134560">We've been talking to framework and library authors.</span> <span data-start="1137300">So along the way, we've talked to members of the Angular team</span> <span data-start="1142510">who were working on the Angular Material stroller.</span> <span data-start="1146500">We talked to the AMP team.</span> <span data-start="1149110">We've talked to members of the Ionic team who are working</span> <span data-start="1152860">on their own virtual stroller.</span> <span data-start="1155110">And we've talked with Brian Vaughn,</span> <span data-start="1156880">who's the author of react-virtualized</span> <span data-start="1158770">and react-window, as well.</span> <span data-start="1162440">And we also have very active discussions going on in GitHub.</span> <span data-start="1165160">So it's important to us that this process be carried out</span> <span data-start="1170020">in the open and with the input of the community,</span> <span data-start="1172700">including frameworks.</span> <span data-start="1179470">OK.</span> <span data-start="1180124">With that process as backdrop, let's go ahead,</span> <span data-start="1182040">and look at what we've built.</span> <span data-start="1186140">So this is that example we were looking at before.</span> <span data-start="1188810">And I show it here in Dev Tools just</span> <span data-start="1190670">so you can see, as we scroll, there</span> <span data-start="1193340">are just a few items in the DOM at any given time.</span> <span data-start="1198030">And when we scroll, you'll see them cycle in and out.</span> <span data-start="1203760">And so, even though we have a list of 5,000 items</span> <span data-start="1207180">here, at any given time, we're only</span> <span data-start="1209430">laying out, styling, rendering a very small number of them.</span> <span data-start="1215840">And as you can see, the virtual scroller</span> <span data-start="1217570">itself is a custom element.</span> <span data-start="1221080">And let's see how you would actually</span> <span data-start="1222580">use that in vanilla style.</span> <span data-start="1227880">So starting from a blank slate here,</span> <span data-start="1229807">the first thing that we're going to do</span> <span data-start="1231390">is we're going to use the browser's native module</span> <span data-start="1234690">loader to import this.</span> <span data-start="1236430">Now this is also a new concept that we're</span> <span data-start="1239250">trying out as part of the way we're</span> <span data-start="1241770">thinking about higher-level APIs.</span> <span data-start="1243930">Typically, browser APIs are sort of baked into every page.</span> <span data-start="1247710">You may use them.</span> <span data-start="1248460">You may not.</span> <span data-start="1249060">But there is a memory impact, and the size of the browser</span> <span data-start="1252600">is impacted.</span> <span data-start="1254730">We'd like to explore a pay-as-you-go model.</span> <span data-start="1257060">And so we already have, in the form of the module loader,</span> <span data-start="1259750">a way to dynamically load libraries and code at runtime.</span> <span data-start="1266250">And so we're using that here.</span> <span data-start="1267790">And you can see we have a proposed syntax for requesting</span> <span data-start="1273632">something that would be part of a standard library provided</span> <span data-start="1276090">by the browser.</span> <span data-start="1276869">And I won't go into the details here.</span> <span data-start="1278410">But you can read about it.</span> <span data-start="1281170">So once we've imported it, we just</span> <span data-start="1284500">put the virtual scroller tag in our HTML document.</span> <span data-start="1289250">And this is what you get without doing anything more.</span> <span data-start="1292164">You can see the virtual scroller has a default</span> <span data-start="1294080">size, much like for an iframe.</span> <span data-start="1300350">And so it's not doing anything yet.</span> <span data-start="1302390">Let's make it do something.</span> <span data-start="1305520">So first, ordinary querySelector to find the virtual stroller.</span> <span data-start="1311080">We're just going to fetch some data.</span> <span data-start="1313490">And then here's the first bit of virtual scroller API.</span> <span data-start="1315740">It's an item source.</span> <span data-start="1316970">You can assign this in an ordinary array,</span> <span data-start="1322910">as we've done here.</span> <span data-start="1324210">And then we'll call our async function.</span> <span data-start="1326790">And we get that, which probably isn't exactly what we want,</span> <span data-start="1329600">either.</span> <span data-start="1330110">So we wanted the virtual scrolling</span> <span data-start="1332630">to do something by default. And so what it does</span> <span data-start="1335090">is it just takes the item, and it tries</span> <span data-start="1339020">to render it into the item.</span> <span data-start="1341450">And in this case, it's a string.</span> <span data-start="1343640">And it doesn't look very good.</span> <span data-start="1345570">So let's fix that.</span> <span data-start="1348620">So the next bit of API is this update element hook.</span> <span data-start="1352990">So here we're basically just going to take the contact name</span> <span data-start="1356260">and put that in the text content.</span> <span data-start="1359170">And there we have something that looks much more useful.</span> <span data-start="1363020">So just a few lines of code, vanilla HTML, and JavaScript,</span> <span data-start="1366160">and we have a virtual scroller.</span> <span data-start="1370107">So let's take a look at one more example.</span> <span data-start="1375170">You notice the virtual scroller initially was empty.</span> <span data-start="1378010">And by default, it will just create a div for each item.</span> <span data-start="1380710">You can actually override that.</span> <span data-start="1382060">In addition to the update element,</span> <span data-start="1383476">there's a create element hook, and you can give it</span> <span data-start="1386350">any kind of DOM you want.</span> <span data-start="1388840">But you can also put a template inside the virtual stroller.</span> <span data-start="1391450">And whatever is there will be what's</span> <span data-start="1392950">instantiated for each item.</span> <span data-start="1396080">So I'm going to go ahead.</span> <span data-start="1397210">And in my update element function,</span> <span data-start="1399495">I'm going to assign the image.</span> <span data-start="1401947">And then lastly, I'm going to specify that I</span> <span data-start="1403780">want a vertical grid layout.</span> <span data-start="1405130">So out of the box, it supports vertical, and horizontal,</span> <span data-start="1408760">normal, and grid layouts.</span> <span data-start="1411880">Layouts are actually pluggable under the hood.</span> <span data-start="1413980">It's TBD whether that gets exposed in the API</span> <span data-start="1417190">as it eventually ships.</span> <span data-start="1420240">OK.</span> <span data-start="1420950">So as I mentioned, we're taking a layered approach.</span> <span data-start="1423410">We're not building fancy features like custom headers</span> <span data-start="1426080">and things in.</span> <span data-start="1426970">But it is important to us that these things work.</span> <span data-start="1429170">Because again, we want layering.</span> <span data-start="1431430">So here's a case where we have headers</span> <span data-start="1434300">interspersed with list items.</span> <span data-start="1436980">These are all examples that you'll find in our GitHub repo.</span> <span data-start="1439684">So the other thing is, it's important —  we want to support</span> <span data-start="1442100">various loading patterns.</span> <span data-start="1444210">So this is a common one, where it's</span> <span data-start="1445850">sort of an infinite scroll, and as you go,</span> <span data-start="1449180">each item gets loaded, and you just keeps scrolling.</span> <span data-start="1451730">We also support the other common pattern,</span> <span data-start="1453950">where you scroll to the bottom, you explicitly ask for more.</span> <span data-start="1458130">So again, we're validating that our basic constructs are</span> <span data-start="1460670">working for these use cases.</span> <span data-start="1464480">Fancier features —  if you've ever built stuff</span> <span data-start="1466970">like this, worked with the UX team,</span> <span data-start="1468570">inevitably they're going to want fancy stuff.</span> <span data-start="1470870">So here's a proof of concept that</span> <span data-start="1472550">shows that things like swipe to dismiss</span> <span data-start="1475160">can work with this virtual scroller, as well.</span> <span data-start="1487210">OK.</span> <span data-start="1487790">So we mentioned that we thought there</span> <span data-start="1490490">would be some missing primitives that we might discover.</span> <span data-start="1494830">And we think we found one.</span> <span data-start="1496400">Specifically, it's called invisible DOM.</span> <span data-start="1499460">So you remember our earlier examples.</span> <span data-start="1501749">In this one, you'll see it's a lot like the virtual scroller,</span> <span data-start="1504290">except instead of actually getting rid of</span> <span data-start="1506300">and adding nodes, it's basically just making nodes invisible.</span> <span data-start="1510080">Invisible DOM is in the document,</span> <span data-start="1512630">much like a display none element But it's</span> <span data-start="1515390">different from display none, in that it can be linked to</span> <span data-start="1518855">and it can be found by the browser's Find In page.</span> <span data-start="1522880">And so here's an example, where we</span> <span data-start="1524630">have non-traditional virtual scroll type of content.</span> <span data-start="1529550">This is a document, much like you</span> <span data-start="1531080">might find in Wikipedia or a long-form news article.</span> <span data-start="1534280">And you can see — </span> <span data-start="1536750">here it is.</span> <span data-start="1537260">We get a certain way down the list.</span> <span data-start="1538767">And all of the sudden, there's nothing highlighting over</span> <span data-start="1541100">in the window.</span> <span data-start="1541683">Because some of these DOM nodes are invisible.</span> <span data-start="1544710">They're just not there.</span> <span data-start="1545790">And as we scroll, we'll see that they're basically</span> <span data-start="1549500">being flipped to visible.</span> <span data-start="1552300">And so when the virtual scroller is working with invisible DOM,</span> <span data-start="1556430">this is how it works.</span> <span data-start="1560530">So you'll see here, we'll do some resizing,</span> <span data-start="1565690">changing orientation.</span> <span data-start="1566707">And you'll see that the layout is preserved.</span> <span data-start="1568540">Again, this is just ordinary styling and layout</span> <span data-start="1572260">on these items.</span> <span data-start="1572920">And virtual scroller works with them out of the box.</span> <span data-start="1574780">This is what we were talking about when we said</span> <span data-start="1576220">we wanted to make it simple.</span> <span data-start="1577400">We don't want you have to think hard</span> <span data-start="1578900">about using a virtual scroller.</span> <span data-start="1580510">So what we're looking at here, though —  is the cool thing — </span> <span data-start="1583530">its links.</span> <span data-start="1584290">And this is what invisible DOM is making possible for us.</span> <span data-start="1587150">So when I click on one of those links,</span> <span data-start="1589080">the DOM nodes that it's linking to are not</span> <span data-start="1590830">even in the document yet — </span> <span data-start="1593217">well, they're in the document, but they're not rendered.</span> <span data-start="1595550">And so you get an event on them.</span> <span data-start="1597220">And by default, the browser will actually</span> <span data-start="1599080">flip visible and scroll to it.</span> <span data-start="1600747">But in the case of a virtual stroller,</span> <span data-start="1602330">we're capturing that event.</span> <span data-start="1604960">We're scrolling to it.</span> <span data-start="1607586">But in the process of doing that,</span> <span data-start="1608960">we're rendering all the context around it.</span> <span data-start="1610640">So it's perfectly seamless.</span> <span data-start="1611764">To the end user who's using invisible DOM</span> <span data-start="1613480">with a virtual scroller, it's exactly</span> <span data-start="1615100">as if the entire document had been rendered the whole time.</span> <span data-start="1620610">And I am just about out of time.</span> <span data-start="1623070">But I wanted to show you one of the exciting things about using</span> <span data-start="1626690">invisible DOM with virtual stroller</span> <span data-start="1628850">is that it means you can actually put invisible content</span> <span data-start="1631790">directly in a document.</span> <span data-start="1633170">And we're talking with our friends over in Search.</span> <span data-start="1635780">And the idea is that you'd be able to effectively</span> <span data-start="1639410">have your content be entirely indexable</span> <span data-start="1641510">but to benefit from the performance</span> <span data-start="1644750">wins of virtual scrolling by not having a render it</span> <span data-start="1647210">all on first load.</span> <span data-start="1650240">So very quickly, I'll talk about the path forward.</span> <span data-start="1653750">Again, very early days —  but very encouraging results.</span> <span data-start="1657680">What's next?</span> <span data-start="1658959">More invisible DOM integration.</span> <span data-start="1660250">We've really just started exploring</span> <span data-start="1661967">how the two play together.</span> <span data-start="1663050">Because thanks to some great work</span> <span data-start="1665600">from [? Raquina ?] on our DOM team,</span> <span data-start="1667670">we've just had a working version of it become available</span> <span data-start="1671060">very recently.</span> <span data-start="1671690">In fact, it's available behind the flag in Chrome Canary.</span> <span data-start="1677210">We think there may be additional primitives, as well.</span> <span data-start="1681090">We've talked about some.</span> <span data-start="1682430">I won't go into detail here.</span> <span data-start="1683710">But invisible DOM is just the first.</span> <span data-start="1686900">Framework collaborations —  so from the start,</span> <span data-start="1689000">we've actually in the repo had proof of concept integrations</span> <span data-start="1693590">with lit-HTML and with Preact.</span> <span data-start="1696590">And for this talk — </span> <span data-start="1698094">but I'd end up getting cut — </span> <span data-start="1699260">I did a basic react integration, as well.</span> <span data-start="1702480">But it's very early there, and we</span> <span data-start="1704090">haven't worked closely with the frameworks on that specifically</span> <span data-start="1706340">yet.</span> <span data-start="1710870">More advanced use cases —  so we saw some of those examples.</span> <span data-start="1714570">But there are others that we have not gotten to yet.</span> <span data-start="1718250">Performance optimization —  it's pretty darn fast right now.</span> <span data-start="1720940">But there actually hasn't been intensive optimization</span> <span data-start="1723650">done on it yet.</span> <span data-start="1725580">And then importantly, down-the-stack explorations — </span> <span data-start="1727960">so one of the first questions we get when we talk about this</span> <span data-start="1730460">is, why doesn't the browser just do this stuff better</span> <span data-start="1732849">in the first place?</span> <span data-start="1733640">Why do you need a virtual scroller?</span> <span data-start="1735380">Can't the browser just do this?</span> <span data-start="1736820">And these are discussions that we're</span> <span data-start="1738830">having not only externally, but also internally.</span> <span data-start="1741900">And it's a long, complicated story.</span> <span data-start="1744440">Browser layout is complicated.</span> <span data-start="1746420">And in much</span> <span data-start="1747170">The way that AMP simplifies building pages,</span> <span data-start="1749750">virtual scroller can simplify layout</span> <span data-start="1751700">by locking you into a much simpler model.</span> <span data-start="1753540">And there are some wins there.</span> <span data-start="1754830">But that being said, it's very possible</span> <span data-start="1756920">that we can also pursue other types of optimizations</span> <span data-start="1762094">further down the stack that get you some</span> <span data-start="1763760">of the same types of benefits without even having</span> <span data-start="1765470">to go to a virtual stroller.</span> <span data-start="1766460">And those are certainly things that we're discussing.</span> <span data-start="1772300">The standards process —  so again,</span> <span data-start="1773860">we've been talking to other browser vendors all along.</span> <span data-start="1776226">But it's very early for this and other similar high-level</span> <span data-start="1778600">features.</span> <span data-start="1779680">And the list could go on.</span> <span data-start="1781300">So if you're interested, I invite you</span> <span data-start="1783820">to engage with us on GitHub.</span> <span data-start="1786580">We have a very active set of discussions going on</span> <span data-start="1789640">in the issues here.</span> <span data-start="1792810">And here is the GitHub repo where you'll find us.</span> <span data-start="1797550">And with that, I've been excited to show you virtual scroller.</span> <span data-start="1800305">I hope you're as excited as I am to see</span> <span data-start="1801930">it come into the web platform.</span> </section>

</div>

</body>

</html>
