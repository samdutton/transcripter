<!DOCTYPE html>

<! — 
Copyright 2018 Google LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
 — >

<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="//google.com">
<meta name="description" content="Chrome Dev Summit">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AB9qSUhlxh8</title>
<link rel="stylesheet" href="css/main.css">
</head>

<body>

<iframe id="youtube" src="https://www.youtube.com/embed/AB9qSUhlxh8?enablejsapi=1"></iframe>

<div id="container">

<div id="google-translate"></div>

<section>
<span data-start="0" data-end="6.748">[MUSIC PLAYING]</span> </section>

<section><span data-start="6.748" data-end="8.225"><span class="speaker">Adam Argyle</span>: I'm Adam Argyle.</span> </section>

<section><span data-start="8.225" data-end="9.91"><span class="speaker">Jason Miller</span>: I'm Jason Miller.</span> <span data-start="9.91" data-end="12.28">We're here to talk to you about Smooth Moves.</span> <span data-start="12.28" data-end="16.12">When we were thinking of what to talk about at CDS this year,</span> <span data-start="16.12" data-end="18.64">we wanted to demonstrate some techniques</span> <span data-start="18.64" data-end="22.135">for optimizing performance of existing applications.</span> <span data-start="22.135" data-end="23.83">So we were trying to think of what's</span> <span data-start="23.83" data-end="27.355">an app that Google doesn't have, something not in our portfolio.</span> <span data-start="27.355" data-end="29.23">It took us a while to come up with something,</span> <span data-start="29.23" data-end="31.42">but I think we kind of hit the nail on the head.</span> </section>

<section><span data-start="31.42" data-end="33.586"><span class="speaker">Adam Argyle</span>: A chat app, they don't have a chat app.</span> </section>

<section><span data-start="33.586" data-end="36.22"><span class="speaker">Jason Miller</span>: No, it's French.</span> <span data-start="36.22" data-end="39.31">This is an app for cats.</span> <span data-start="39.31" data-end="42.59">Sorry, I knew this slide would be really confusing.</span> <span data-start="42.59" data-end="45.82">So it's a chat app.</span> <span data-start="45.82" data-end="48.58">We've been working on an app that actually facilitates</span> <span data-start="48.58" data-end="49.75">communication between cats.</span> </section>

<section><span data-start="49.75" data-end="50.5"><span class="speaker">Adam Argyle</span>: Meow.</span> </section>

<section><span data-start="50.5" data-end="52.78"><span class="speaker">Jason Miller</span>: We know cats are working</span> <span data-start="52.78" data-end="55.81">on this uprising against humans of sorts,</span> <span data-start="55.81" data-end="58.36">and we figured that's sort like an opportunity</span> <span data-start="58.36" data-end="59.89">for an app that helps out with this,</span> <span data-start="59.89" data-end="61.19">with the planning and whatnot.</span> </section>

<section><span data-start="61.19" data-end="63.85"><span class="speaker">Adam Argyle</span>: Yeah, so this is what our app looks like.</span> <span data-start="63.85" data-end="67.09">The design is sort of a mix a typical material stuff and take</span> <span data-start="67.09" data-end="69.68">some inspiration from Android messages, among others.</span> <span data-start="69.68" data-end="72.62">And we wanted the UI to be realistically complex and well</span> <span data-start="72.62" data-end="74.62">designed, so that it would be challenging enough</span> <span data-start="74.62" data-end="77.5">for the browser and we could measure our optimizations.</span> <span data-start="77.5" data-end="81.34">And obviously, the text that's in there, that's cat ipsom.</span> <span data-start="81.34" data-end="82.232">I don't speak feline.</span> <span data-start="82.232" data-end="83.44">I don't know what's going on.</span> </section>

<section><span data-start="83.44" data-end="85.12"><span class="speaker">Jason Miller</span>: I do, but I refuse to make a demo.</span> </section>

<section><span data-start="85.12" data-end="87.33"><span class="speaker">Adam Argyle</span>: So next, we turned on the performance monitor,</span> <span data-start="87.33" data-end="88.69">because it looked good on my machine.</span> <span data-start="88.69" data-end="90.03">We're like, let's measure it.</span> <span data-start="90.03" data-end="92.31">It seems to look like everything's decent enough.</span> </section>

<section><span data-start="92.31" data-end="93.101"><span class="speaker">Jason Miller</span>: Yeah.</span> <span data-start="93.101" data-end="96.22">So, we saw a bit of jank and some</span> <span data-start="96.22" data-end="100.99">of the early user feedback we got was that the app felt slow.</span> <span data-start="100.99" data-end="102.91">We applied a bunch of the techniques</span> <span data-start="102.91" data-end="105.85">that Katie and Hussein talked about in their talk</span> <span data-start="105.85" data-end="107.94">earlier today.</span> <span data-start="107.94" data-end="110.24">But it wasn't cutting it.</span> <span data-start="110.24" data-end="111.7">And there was something else wrong.</span> <span data-start="111.7" data-end="114.19">So we decided to load the video up on a Nexus 5.</span> <span data-start="114.19" data-end="116.89">It's really useful to have a device like this sitting around</span> <span data-start="116.89" data-end="118.26">as you develop for the web.</span> <span data-start="118.26" data-end="120.13">As developers, we often have the privilege</span> <span data-start="120.13" data-end="122.46">of fast devices on fast connections.</span> <span data-start="122.46" data-end="124.75">And that can kind of trick us into thinking</span> <span data-start="124.75" data-end="127.06">that we're meeting our performance goals,</span> <span data-start="127.06" data-end="129.259">when we're actually not out in the real world.</span> <span data-start="129.259" data-end="133.36">So watching the video, you can see it's far from smooth.</span> </section>

<section><span data-start="133.36" data-end="135.82"><span class="speaker">Adam Argyle</span>: Many types of jank are present.</span> </section>

<section><span data-start="135.82" data-end="138.07"><span class="speaker">Jason Miller</span>: So smooth, it's a word</span> <span data-start="138.07" data-end="141.08">we hear a lot when we're talking about user interface.</span> </section>

<section><span data-start="141.08" data-end="141.67"><span class="speaker">Adam Argyle</span>: It's true, and it can</span> <span data-start="141.67" data-end="143.14">be difficult to describe since it's</span> <span data-start="143.14" data-end="144.91">sort of an invisible metric.</span> <span data-start="144.91" data-end="147.37">If your app is smooth, no one really notices anything</span> <span data-start="147.37" data-end="147.95">is wrong.</span> </section>

<section><span data-start="147.95" data-end="148.783"><span class="speaker">Jason Miller</span>: Right.</span> </section>

<section><span data-start="148.783" data-end="150.67"><span class="speaker">Adam Argyle</span>: So then, what does that really</span> <span data-start="150.67" data-end="151.882">mean that smooth is.</span> <span data-start="151.882" data-end="153.34">We thought smooth could destructure</span> <span data-start="153.34" data-end="154.81">into these attributes really well.</span> <span data-start="154.81" data-end="155.946">So let's break them down.</span> </section>

<section><span data-start="155.946" data-end="157.541"><span class="speaker">Jason Miller</span>: Cool.</span> </section>

<section><span data-start="157.541" data-end="159.04"><span class="speaker">Adam Argyle</span>: Smoothness is something</span> <span data-start="159.04" data-end="162.01">we believe happens when the user feels connected</span> <span data-start="162.01" data-end="164.32">to the app that they're using, like they're directly</span> <span data-start="164.32" data-end="166.81">controlling it, a sort of physical connection</span> <span data-start="166.81" data-end="167.711">to the interface.</span> <span data-start="167.711" data-end="169.96">When the application doesn't respond quickly to input,</span> <span data-start="169.96" data-end="173.23">it breaks this connection, and we feel distanced from the task</span> <span data-start="173.23" data-end="173.89">at hand.</span> <span data-start="173.89" data-end="176.97">It's best when it feels like magic paper.</span> </section>

<section><span data-start="176.97" data-end="178.51"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="178.51" data-end="182.23">Yeah, so when an application animates irregularly,</span> <span data-start="182.23" data-end="184.3">it actually distracts us, by breaking something</span> <span data-start="184.3" data-end="185.825">called the illusion of motion.</span> <span data-start="185.825" data-end="188.2">You can see the illustration of what I'm talking about up</span> <span data-start="188.2" data-end="190.36">here on the right.</span> <span data-start="190.36" data-end="194.57">The eye responds to light changes at 10 times per second.</span> <span data-start="194.57" data-end="198.25">So if we show the eye a sequence of 10 images per second,</span> <span data-start="198.25" data-end="201.34">we can actually still see each individual frame.</span> </section>

<section><span data-start="201.34" data-end="202.39"><span class="speaker">Adam Argyle</span>: Yeah.</span> </section>

<section><span data-start="202.39" data-end="204.306"><span class="speaker">Jason Miller</span>: So the brain doesn't necessarily</span> <span data-start="204.306" data-end="206.15">interpret that as motion.</span> <span data-start="206.15" data-end="208.54">If we increase this to 20 frames per second,</span> <span data-start="208.54" data-end="212.009">somewhere in and around the red orb there,</span> <span data-start="212.009" data-end="213.55">we start to interpret this as motion,</span> <span data-start="213.55" data-end="216.1">because we've exceeded two times the number of light changes</span> <span data-start="216.1" data-end="217.12">we can detect.</span> <span data-start="217.12" data-end="219.061">And this effect increases as we approach</span> <span data-start="219.061" data-end="221.56">60 frames per second, where we start to see some diminishing</span> <span data-start="221.56" data-end="222.44">returns.</span> </section>

<section><span data-start="222.44" data-end="223.24"><span class="speaker">Adam Argyle</span>: Yep.</span> </section>

<section><span data-start="223.24" data-end="224.83"><span class="speaker">Jason Miller</span>: Basically, smoothness</span> <span data-start="224.83" data-end="228.85">relates to the human perception of performance.</span> <span data-start="228.85" data-end="232.12">It's a measure of the question, is this application</span> <span data-start="232.12" data-end="233.68">keeping up with me?</span> </section>

<section><span data-start="233.68" data-end="235.12"><span class="speaker">Adam Argyle</span>: Or does this app feel</span> <span data-start="235.12" data-end="236.8">like it's helping me get something done,</span> <span data-start="236.8" data-end="239.062">or is it getting in my way?</span> <span data-start="239.062" data-end="241.27">The way the user feels when interacting with software</span> <span data-start="241.27" data-end="243.01">is really important.</span> <span data-start="243.01" data-end="245.69">Because we've all been in situations like this.</span> <span data-start="245.69" data-end="249.069">I mean, he was obviously trying to send a tweet.</span> <span data-start="249.069" data-end="250.36">And it just wasn't working out.</span> </section>

<section><span data-start="250.36" data-end="252.485"><span class="speaker">Jason Miller</span>: He probably should have used some newer hardware.</span> </section>

<section><span data-start="252.485" data-end="254.612"><span class="speaker">Adam Argyle</span>: Yeah, well, he's breaking it now.</span> </section>

<section><span data-start="254.612" data-end="256.82"><span class="speaker">Jason Miller</span>: So this is backed up by statistics too.</span> <span data-start="256.82" data-end="260.47">In a 2017 study, 46% of people who</span> <span data-start="260.47" data-end="262.66">had an interruptive mobile experience</span> <span data-start="262.66" data-end="265.94">said they wouldn't purchase from that brand again in the future.</span> <span data-start="265.94" data-end="269.14">And in that same study, they found that 79% of people</span> <span data-start="269.14" data-end="271.72">said they're more likely to revisit or share</span> <span data-start="271.72" data-end="274.015">a mobile site that was easy to use.</span> </section>

<section><span data-start="274.015" data-end="276.435"><span class="speaker">Adam Argyle</span>: And another metric, and it's a good one,</span> <span data-start="276.435" data-end="279.51">100% of Adams say they doubt a thing's reliability</span> <span data-start="279.51" data-end="281.65">if it hiccups while performing its task.</span> <span data-start="281.65" data-end="282.89">Maybe you agree.</span> </section>

<section><span data-start="282.89" data-end="284.56"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="284.56" data-end="287.32">So anytime we talk about the perception of performance,</span> <span data-start="287.32" data-end="290.81">it's useful to frame things using the RAIL model.</span> <span data-start="290.81" data-end="292.66">RAIL provides a set of goals that</span> <span data-start="292.66" data-end="295">cover the four ways we all perceive performance</span> <span data-start="295" data-end="297.32">and speed when using software.</span> <span data-start="297.32" data-end="299.44">Those are Response, which is reacting</span> <span data-start="299.44" data-end="302.23">to events in 100 milliseconds, Animation, which is producing</span> <span data-start="302.23" data-end="306.28">frames in 16 milliseconds, Idol, which is maximizing idle time,</span> <span data-start="306.28" data-end="309.26">and Load, which is loading in under one second.</span> <span data-start="309.26" data-end="312.55">And these are based off of like a few years, a few decades,</span> <span data-start="312.55" data-end="313.81">actually, worth of research.</span> <span data-start="313.81" data-end="315.08">So they're very unlikely to change.</span> </section>

<section><span data-start="315.08" data-end="317.496"><span class="speaker">Adam Argyle</span>: And you know what this slide looks like to me</span> <span data-start="317.496" data-end="319.314">is click, run, swipe, and load.</span> </section>

<section><span data-start="319.314" data-end="321.73"><span class="speaker">Jason Miller</span>: Yeah, we could have used a different acronym</span> <span data-start="321.73" data-end="322.522">there, I guess.</span> </section>

<section><span data-start="322.522" data-end="323.73"><span class="speaker">Adam Argyle</span>: We'll get there.</span> </section>

<section><span data-start="323.73" data-end="326.51"><span class="speaker">Jason Miller</span>: Cool, so there's times</span> <span data-start="326.51" data-end="329.54">that we have to hit for all these.</span> </section>

<section><span data-start="329.54" data-end="332.24"><span class="speaker">Adam Argyle</span>: And we believe responding to user input</span> <span data-start="332.24" data-end="335.15">quickly is the first and arguably most important thing</span> <span data-start="335.15" data-end="338.78">to do in your app for it to feel or appear smooth and snappy.</span> </section>

<section><span data-start="338.78" data-end="340.97"><span class="speaker">Jason Miller</span>: Right, even sticking to RAIL's goals</span> <span data-start="340.97" data-end="343.649">though, idle work can potentially delay input</span> <span data-start="343.649" data-end="345.44">by up to 50 milliseconds, which we're going</span> <span data-start="345.44" data-end="346.523">to hear about in a second.</span> <span data-start="346.523" data-end="350.6">But we recommend responding to input in 50 milliseconds</span> <span data-start="350.6" data-end="353.06">in order to have the combined time never exceed 100.</span> <span data-start="353.06" data-end="355.268">That's why you'll see the difference between the goal</span> <span data-start="355.268" data-end="356.9">and the guideline.</span> <span data-start="356.9" data-end="358.25">Animation has a similar story.</span> <span data-start="358.25" data-end="359.666">So there's more than just our code</span> <span data-start="359.666" data-end="362.559">that has to run in order to get a frame on the screen.</span> <span data-start="362.559" data-end="364.85">To account for a reasonable amount of browser rendering</span> <span data-start="364.85" data-end="367.22">overhead, we recommend shooting for 10 milliseconds</span> <span data-start="367.22" data-end="369.532">of your JavaScript time to produce that frame,</span> <span data-start="369.532" data-end="371.115">leaving six left over for the browser.</span> </section>

<section><span data-start="371.115" data-end="372.49"><span class="speaker">Adam Argyle</span>: Browser are so cool.</span> <span data-start="372.49" data-end="374.75">We're talking about six milliseconds, 10 milliseconds,</span> <span data-start="374.75" data-end="376.625">who could do anything in that amount of time?</span> <span data-start="376.625" data-end="378.22">And the browser's doing crazy stuff.</span> </section>

<section><span data-start="378.22" data-end="379.053"><span class="speaker">Jason Miller</span>: Right.</span> </section>

<section><span data-start="379.053" data-end="380.43"><span class="speaker">Adam Argyle</span>: It's so rad.</span> </section>

<section><span data-start="380.43" data-end="381.68"><span class="speaker">Jason Miller</span>: So in order to — </span> <span data-start="381.68" data-end="384.75">in addition to deferring as much work as possible,</span> <span data-start="384.75" data-end="387.47">it's also good to defer your working 50 millisecond chunks.</span> <span data-start="387.47" data-end="391.27">This is where that response metric gets its differentiation</span> <span data-start="391.27" data-end="391.77">from.</span> <span data-start="391.77" data-end="395.3">So if you have 50 millisecond blocking idle tasks,</span> <span data-start="395.3" data-end="396.98">there's a chance that any one of those</span> <span data-start="396.98" data-end="399.98">could cause input to be queued for 50 milliseconds, which</span> <span data-start="399.98" data-end="401.75">means if you need to respond in 100,</span> <span data-start="401.75" data-end="403.46">you only have 50 milliseconds left.</span> <span data-start="403.46" data-end="405.16">So that's where that metric comes from.</span> </section>

<section><span data-start="405.16" data-end="407.285"><span class="speaker">Adam Argyle</span>: And the load goals, based on research,</span> <span data-start="407.285" data-end="410.33">is showing that we generally lose focus</span> <span data-start="410.33" data-end="411.8">after about one second.</span> <span data-start="411.8" data-end="413.42">We start to feel a bit disconnected</span> <span data-start="413.42" data-end="414.84">from the activity we're doing.</span> <span data-start="414.84" data-end="417.53">And then at 10 seconds, we become frustrated,</span> <span data-start="417.53" data-end="419.54">we go grab a sledgehammer, and probably</span> <span data-start="419.54" data-end="420.652">light something on fire.</span> </section>

<section><span data-start="420.652" data-end="422.61"><span class="speaker">Jason Miller</span>: That's how that picture happened.</span> <span data-start="422.61" data-end="425.42">So RAIL's guideline for load is kind</span> <span data-start="425.42" data-end="427.46">of right in the middle of those two numbers.</span> <span data-start="427.46" data-end="428.926">We set it up five seconds.</span> <span data-start="428.926" data-end="430.55">And this is a good metric for something</span> <span data-start="430.55" data-end="432.133">like a page load, where you're waiting</span> <span data-start="432.133" data-end="435.83">for a decent amount of new content to come in,</span> <span data-start="435.83" data-end="438.08">even a whole screen's worth of content.</span> <span data-start="438.08" data-end="440.54">For little interactions, though, like the sending button</span> <span data-start="440.54" data-end="442.25">in our chat app, it's actually best</span> <span data-start="442.25" data-end="443.937">to shoot for that one second goal.</span> <span data-start="443.937" data-end="445.52">There's only a small amount of content</span> <span data-start="445.52" data-end="446.76">being changed on screen.</span> <span data-start="446.76" data-end="449.162">So it's not as perceivable to the user.</span> </section>

<section><span data-start="449.162" data-end="452.452"><span class="speaker">Adam Argyle</span>: Yep, and with RAIL we</span> <span data-start="452.452" data-end="454.16">have a nice mental model for figuring out</span> <span data-start="454.16" data-end="455.61">why the app feels slow.</span> <span data-start="455.61" data-end="457.97">And it helps us set a useful challenge.</span> <span data-start="457.97" data-end="460.277">And you'll notice on each slide, as we continue here,</span> <span data-start="460.277" data-end="462.11">there'll be a little badge in the top right.</span> <span data-start="462.11" data-end="463.82">It's have an R, an A, an I, and an L,</span> <span data-start="463.82" data-end="465.32">add it'll pertain to the RAIL model.</span> </section>

<section><span data-start="465.32" data-end="466.153"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="466.153" data-end="468.62">So, we're pretty confident that we can meet RAIL guidelines</span> <span data-start="468.62" data-end="474.564">on a $1,500 laptop, or maybe some other very popular laptop.</span> </section>

<section><span data-start="474.564" data-end="476.48"><span class="speaker">Adam Argyle</span>: Yeah, that's a cush laptop there.</span> <span data-start="476.48" data-end="478.771">Kind of looks like it's on John Snow's bed or something</span> <span data-start="478.771" data-end="479.426">like that.</span> </section>

<section><span data-start="479.426" data-end="481.676"><span class="speaker">Jason Miller</span>: Yeah, I've never seen "Game of Thrones."</span> <span data-start="481.676" data-end="484.057">I assume that's a reference to "Game of Thrones."</span> <span data-start="484.057" data-end="485.39">So we could do it on the laptop.</span> <span data-start="485.39" data-end="489.66">But can we meet our guidelines on a sub $100 phone?</span> </section>

<section><span data-start="489.66" data-end="492.02"><span class="speaker">Adam Argyle</span>: Uh, duh, the web is awesome.</span> </section>

<section><span data-start="492.02" data-end="494.99"><span class="speaker">Jason Miller</span>: Yes, so we want our apps</span> <span data-start="494.99" data-end="496.37">to be smooth everywhere.</span> <span data-start="496.37" data-end="498.114">And what we need to do to ensure that is</span> <span data-start="498.114" data-end="500.03">to optimize for the lowest common denominator.</span> <span data-start="500.03" data-end="503.894">We need to be 60 frames per second on low-end hardware.</span> </section>

<section><span data-start="503.894" data-end="506.31"><span class="speaker">Adam Argyle</span>: So before we embark on a challenge like this,</span> <span data-start="506.31" data-end="508.88">though, we need to be able to measure whether we're meeting</span> <span data-start="508.88" data-end="509.98">those guidelines or not.</span> </section>

<section><span data-start="509.98" data-end="510.95"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="510.95" data-end="513.62">So all the tools that we have available to measure</span> <span data-start="513.62" data-end="515.24">these things, live in Chrome DevTools.</span> </section>

<section><span data-start="515.24" data-end="516.11"><span class="speaker">Adam Argyle</span>: DevTools.</span> </section>

<section><span data-start="516.11" data-end="516.943"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="516.943" data-end="518.929">We have seen a bunch of them earlier today.</span> <span data-start="518.929" data-end="521.12">In Paul, Elizabeth's TALK they talked specifically</span> <span data-start="521.12" data-end="522.539">about DevTools.</span> <span data-start="522.539" data-end="525.08">We're actually going to show a couple of features in DevTools</span> <span data-start="525.08" data-end="526.788">that are maybe a little bit less commonly</span> <span data-start="526.788" data-end="531.41">used, some of them potentially even lost to the sands of time.</span> <span data-start="531.41" data-end="532.369">So let's get into them.</span> </section>

<section><span data-start="532.369" data-end="533.826"><span class="speaker">Adam Argyle</span>: The first tool is down</span> <span data-start="533.826" data-end="536.37">in the drawer, which you can pull up using the Escape key.</span> <span data-start="536.37" data-end="538.037">It's the rendering panel.</span> <span data-start="538.037" data-end="539.62">It lets you visualize important things</span> <span data-start="539.62" data-end="541.911">that we're going to get into today, like painting layer</span> <span data-start="541.911" data-end="543.89">borders and live SPF meter.</span> </section>

<section><span data-start="543.89" data-end="545.55"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="545.55" data-end="547.22">The second useful tool is up in three</span> <span data-start="547.22" data-end="548.63">dot menu in the upper right.</span> <span data-start="548.63" data-end="549.83">It's called Layers.</span> <span data-start="549.83" data-end="552.735">It shows a real time view of the layers that make up your page.</span> <span data-start="552.735" data-end="554.86">We're going to deep dive into this in a little bit.</span> </section>

<section><span data-start="554.86" data-end="555.65"><span class="speaker">Adam Argyle</span>: [INAUDIBLE]</span> </section>

<section><span data-start="555.65" data-end="557.941"><span class="speaker">Jason Miller</span>: But it's useful to remember that DevTools</span> <span data-start="557.941" data-end="559.01">has you covered here.</span> </section>

<section><span data-start="559.01" data-end="561.14"><span class="speaker">Adam Argyle</span>: The next tool's back down in the drawer again.</span> <span data-start="561.14" data-end="562.556">It's the graphs we showed earlier,</span> <span data-start="562.556" data-end="564.02">called the Performance Monitor.</span> <span data-start="564.02" data-end="566.03">And here you can monitor various aspects</span> <span data-start="566.03" data-end="568.55">of your app's performance, chart it over time.</span> <span data-start="568.55" data-end="571.28">Plus, it looks so good on a dark theme.</span> <span data-start="571.28" data-end="572.572">I just love that.</span> <span data-start="572.572" data-end="574.03">It's pretty useful to find hiccups.</span> </section>

<section><span data-start="574.03" data-end="575.184"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="575.184" data-end="576.35">Finally, there's Lighthouse.</span> <span data-start="576.35" data-end="578.4">And we've seen a couple of times today</span> <span data-start="578.4" data-end="580.66">this used for tracking load performance metrics.</span> <span data-start="580.66" data-end="582.86">But you could actually find it slightly useful</span> <span data-start="582.86" data-end="586.58">to find runtime metrics in Lighthouse, particularly</span> <span data-start="586.58" data-end="587.77">for input response delays.</span> <span data-start="587.77" data-end="591.432">So Lighthouse doesn't track for very long after page load.</span> <span data-start="591.432" data-end="592.64">But it does for a little bit.</span> <span data-start="592.64" data-end="594.8">And this might be exactly the kind of heads-up</span> <span data-start="594.8" data-end="596.39">you need to figure out that there</span> <span data-start="596.39" data-end="599.01">are some optimizations left for you to do on your website.</span> </section>

<section><span data-start="599.01" data-end="602.48"><span class="speaker">Adam Argyle</span>: Cool, all right, it's business time.</span> <span data-start="602.48" data-end="604.85">We're equipped with some tools and strategies on how</span> <span data-start="604.85" data-end="606.68">to investigate performance.</span> <span data-start="606.68" data-end="607.73">Let's dive in.</span> </section>

<section><span data-start="607.73" data-end="609.03"><span class="speaker">Jason Miller</span>: Let's dive in.</span> <span data-start="609.03" data-end="611.9">So we came up with three types of optimizations</span> <span data-start="611.9" data-end="615.23">that we hope will help address common performance issues.</span> <span data-start="615.23" data-end="618.23">We have efficient animations, reading and then writing,</span> <span data-start="618.23" data-end="620.48">and then sort of a grab bag of things</span> <span data-start="620.48" data-end="622.73">that we're calling lazy winds.</span> <span data-start="622.73" data-end="624.76">So that's sort of a mix.</span> <span data-start="624.76" data-end="627.11">So we'll start off with efficient animations.</span> <span data-start="627.11" data-end="629.06">Animating things effectively in the browser</span> <span data-start="629.06" data-end="632.27">really requires a somewhat deep understanding</span> <span data-start="632.27" data-end="634.19">of how browsers render.</span> <span data-start="634.19" data-end="637.1">Let's say we want to build like the chat UI</span> <span data-start="637.1" data-end="638.425">that we showed in the intro.</span> </section>

<section><span data-start="638.425" data-end="639.3"><span class="speaker">Adam Argyle</span>: Chat UI.</span> </section>

<section><span data-start="639.3" data-end="641.27"><span class="speaker">Jason Miller</span>: Right, chat, sorry.</span> <span data-start="641.27" data-end="644.3">We want to write some HTML, give it a bunch of fancy styling,</span> <span data-start="644.3" data-end="646.49">and then arbitrary magic happens and you</span> <span data-start="646.49" data-end="647.992">have pixels on a screen.</span> <span data-start="647.992" data-end="649.7">That level of understanding is not enough</span> <span data-start="649.7" data-end="651.56">for us to be able to optimize here.</span> <span data-start="651.56" data-end="652.64">So let's dig into it.</span> <span data-start="652.64" data-end="654.8">We start off with some HTML.</span> <span data-start="654.8" data-end="657.765">This all gets passed and turned into a tree structure</span> <span data-start="657.765" data-end="658.64">that we call the Dom.</span> <span data-start="658.64" data-end="661.01">You're familiar with the Dom.</span> <span data-start="661.01" data-end="662.63">And this sort of preps us to the point</span> <span data-start="662.63" data-end="666.36">where we're ready to render, which is a four-step process.</span> <span data-start="666.36" data-end="668.315">The first step is style calculation.</span> <span data-start="668.315" data-end="670.94">So the browser needs to compute all the styles for the elements</span> <span data-start="670.94" data-end="674.57">that you see, which is resolving things to their final values,</span> <span data-start="674.57" data-end="677.257">resolving CSS custom properties, inherited values, et cetera.</span> <span data-start="677.257" data-end="679.34">And it does this by going through all the elements</span> <span data-start="679.34" data-end="683.09">and figuring out which CSS properties apply to them.</span> <span data-start="683.09" data-end="685.4">With those values calculated, we can figure out</span> <span data-start="685.4" data-end="688.475">the positions of where all those elements are on the screen.</span> <span data-start="688.475" data-end="691.1">So you see those are represented as boxes up here on the right.</span> <span data-start="691.1" data-end="694.41">The cost of this calculation step varies quite a bit.</span> <span data-start="694.41" data-end="696.142">Some types of layouts are multi-packs,</span> <span data-start="696.142" data-end="697.85">which means that they need to be laid out</span> <span data-start="697.85" data-end="700.55">multiple times before they're in their final resting state.</span> <span data-start="700.55" data-end="704.09">And other types, like position absolute, are just static.</span> <span data-start="704.09" data-end="706.52">So they only need to be one pass.</span> <span data-start="706.52" data-end="708.89">So that computed layout has enough information</span> <span data-start="708.89" data-end="712.26">to break things up into pieces that we call paint layers.</span> <span data-start="712.26" data-end="715.19">Here in the painting process, we walk through all the paint</span> <span data-start="715.19" data-end="717.17">layers and we convert the layered information</span> <span data-start="717.17" data-end="719.73">that we had into Draw commands.</span> <span data-start="719.73" data-end="722.09">And these sort of look like the 2D canvas API,</span> <span data-start="722.09" data-end="724.18">if you've used that.</span> <span data-start="724.18" data-end="726.38">So Chrome takes these and it sends them over</span> <span data-start="726.38" data-end="728.93">to its graphics layer, which is called Skia.</span> <span data-start="728.93" data-end="731.09">And those get rasterized and sent back</span> <span data-start="731.09" data-end="732.35">as image representations.</span> </section>

<section><span data-start="732.35" data-end="735.14"><span class="speaker">Adam Argyle</span>: Wait a second, Chrome, they're skias?</span> <span data-start="735.14" data-end="737.36">I thought they were snowboarders.</span> </section>

<section><span data-start="737.36" data-end="738.82"><span class="speaker">Jason Miller</span>: No, all skias.</span> <span data-start="738.82" data-end="741.95">OK so, with the paint layers rasterized,</span> <span data-start="741.95" data-end="743.81">the last step is to composite them.</span> <span data-start="743.81" data-end="746.48">So this step takes all the rasterized essentially images</span> <span data-start="746.48" data-end="748.94">at this point and lays them out on top of each other</span> <span data-start="748.94" data-end="751.709">in order to make things look like the final page.</span> <span data-start="751.709" data-end="753.5">So what you get is the result on the right,</span> <span data-start="753.5" data-end="755.63">which is what we wanted.</span> <span data-start="755.63" data-end="757.4">This whole process applies anytime</span> <span data-start="757.4" data-end="760.22">you have page updates that are triggered by JavaScript</span> <span data-start="760.22" data-end="762.08">manipulating the Dom.</span> <span data-start="762.08" data-end="764.72">So let's say we want to update the left property</span> <span data-start="764.72" data-end="767.54">of a div, left position of a div.</span> <span data-start="767.54" data-end="770.63">The browser is going to have to recalculate styles.</span> <span data-start="770.63" data-end="773.24">It's going to have to redo the layout, because they have</span> <span data-start="773.24" data-end="778.19">changed, paint all the paint layers that changed,</span> <span data-start="778.19" data-end="781.28">and then composite them together to form the resulting page.</span> <span data-start="781.28" data-end="782.24">Yeah, lot of work.</span> </section>

<section><span data-start="782.24" data-end="783.86"><span class="speaker">Adam Argyle</span>: A lot of work.</span> </section>

<section><span data-start="783.86" data-end="786.17"><span class="speaker">Jason Miller</span>: And then if we set the transform property</span> <span data-start="786.17" data-end="789.17">for some contrast, transform opacity</span> <span data-start="789.17" data-end="792.87">and filter are all what's called compositable properties.</span> <span data-start="792.87" data-end="795.23">So modifying these doesn't actually trigger layout</span> <span data-start="795.23" data-end="797.28">and can often bypass paint.</span> <span data-start="797.28" data-end="799.99">So you go straight from style recalculation to compositing.</span> </section>

<section><span data-start="799.99" data-end="800.99"><span class="speaker">Adam Argyle</span>: [INAUDIBLE]</span> </section>

<section><span data-start="800.99" data-end="803.06"><span class="speaker">Jason Miller</span>: Yeah, so a lot less work.</span> <span data-start="803.06" data-end="805.88">These things, they get really important when</span> <span data-start="805.88" data-end="807.08">you're animating.</span> <span data-start="807.08" data-end="810.89">On every frame we are now potentially computing layout,</span> <span data-start="810.89" data-end="814.35">if you set something like width or left.</span> <span data-start="814.35" data-end="816.62">And this is a lot of work for the browser to do.</span> <span data-start="816.62" data-end="819.38">This is going to be a low frame rate.</span> <span data-start="819.38" data-end="821.09">Animating something like color, layout</span> <span data-start="821.09" data-end="822.11">isn't required because you're not</span> <span data-start="822.11" data-end="824.43">changing the bounds of the position of the element.</span> <span data-start="824.43" data-end="826.97">So on each frame, you're recalculating styles, painting,</span> <span data-start="826.97" data-end="827.69">and compositing.</span> <span data-start="827.69" data-end="829.02">You skip the layout step.</span> <span data-start="829.02" data-end="830">A little better.</span> <span data-start="830" data-end="831.75">This used to be a performance concern.</span> <span data-start="831.75" data-end="833.48">But in modern graphics pipelines,</span> <span data-start="833.48" data-end="835.73">it's actually pretty fast.</span> <span data-start="835.73" data-end="837.95">Finally, animating compositable properties,</span> <span data-start="837.95" data-end="840.792">like transform opacity, all that work</span> <span data-start="840.792" data-end="842">is handled by the compositor.</span> <span data-start="842" data-end="844.64">So this is really good for things like responding</span> <span data-start="844.64" data-end="845.562">to pan gestures.</span> <span data-start="845.562" data-end="847.52">Because it's important to keep that pipeline as</span> <span data-start="847.52" data-end="848.557">short as possible.</span> <span data-start="848.557" data-end="850.14">The one thing to keep in mind, though,</span> <span data-start="850.14" data-end="853.131">is that compositing is not free.</span> <span data-start="853.131" data-end="854.88">If you're on resource constrained devices,</span> <span data-start="854.88" data-end="857.552">you really need to watch your composited layer count.</span> <span data-start="857.552" data-end="859.76">If it gets too high, you can hit memory [INAUDIBLE]..</span> </section>

<section><span data-start="859.76" data-end="863.505"><span class="speaker">Adam Argyle</span>: You pretty much have jank permanently.</span> </section>

<section><span data-start="863.505" data-end="865.88"><span class="speaker">Jason Miller</span>: So we had a send button in our application,</span> <span data-start="865.88" data-end="867.505">and depending on whether it was enabled</span> <span data-start="867.505" data-end="869.96">or disabled, whether there was text in the text field</span> <span data-start="869.96" data-end="873.08">beside it, it would have a large or a small box shadow</span> <span data-start="873.08" data-end="874.56">and change its color.</span> <span data-start="874.56" data-end="878.446">So originally, we just did a CSS transition on the box shadow.</span> <span data-start="878.446" data-end="880.07">Box shadows are paint-based animations,</span> <span data-start="880.07" data-end="882.962">because they physically cannot affect layout.</span> <span data-start="882.962" data-end="885.17">And that meant that on every frame, what we had to do</span> <span data-start="885.17" data-end="887.9">was send a bunch of new commands over to Skia,</span> <span data-start="887.9" data-end="889.285">like we saw in those demos.</span> <span data-start="889.285" data-end="890.66">So here's an example of what that</span> <span data-start="890.66" data-end="892.58">might look like in a three-frame animation.</span> <span data-start="892.58" data-end="894.871">And you see it's pretty much repeating the same process</span> <span data-start="894.871" data-end="896.97">each time with new variables.</span> <span data-start="896.97" data-end="899.27">We tried switching this to a composite animation.</span> <span data-start="899.27" data-end="901.82">And the way we did that was we duplicated the button</span> <span data-start="901.82" data-end="904.05">using a pseudo element.</span> <span data-start="904.05" data-end="906.07">And then the foreground was the element</span> <span data-start="906.07" data-end="908.57">and the background was a pseudo element with the same shape,</span> <span data-start="908.57" data-end="910.68">but a box shadow applied to it.</span> <span data-start="910.68" data-end="913.64">And then all we have to do is change the opacity of the box</span> <span data-start="913.64" data-end="916.55">shadow pseudo element behind the button,</span> <span data-start="916.55" data-end="919.13">and we can get any of the frames of the animation we</span> <span data-start="919.13" data-end="924.782">want between 0 and 100 using just composited animations.</span> <span data-start="924.782" data-end="927.24">So any frame can be constructed from just those two paints.</span> <span data-start="927.24" data-end="928.489">We do not need to repaint.</span> <span data-start="928.489" data-end="929.78">You can see this in action too.</span> <span data-start="929.78" data-end="930.55">So looking at DevTools — </span> </section>

<section><span data-start="930.55" data-end="931.11"><span class="speaker">Adam Argyle</span>: I love this GIF.</span> <span data-start="931.11" data-end="931.75">It's so cool.</span> </section>

<section><span data-start="931.75" data-end="933.09"><span class="speaker">Jason Miller</span>: Yeah, we've got a paint-based animation</span> <span data-start="933.09" data-end="933.59">on the top.</span> <span data-start="933.59" data-end="934.77">That's just box shadow.</span> <span data-start="934.77" data-end="937.865">The center one is animating the opacity of a shadow element.</span> <span data-start="937.865" data-end="939.99">And then the bottom one is sort of the penultimate,</span> <span data-start="939.99" data-end="943.29">this is animating the transform's scale</span> <span data-start="943.29" data-end="944.28">of the shadow.</span> </section>

<section><span data-start="944.28" data-end="945.75"><span class="speaker">Adam Argyle</span>: Hey, why the middle one paint at the end</span> <span data-start="945.75" data-end="946.56">and at the end.</span> </section>

<section><span data-start="946.56" data-end="947.61"><span class="speaker">Jason Miller</span>: Yeah, so paints at the beginning,</span> <span data-start="947.61" data-end="948.46">paints at the end.</span> <span data-start="948.46" data-end="951.464">This is when it's being promoted and then demoted</span> <span data-start="951.464" data-end="952.38">to a composited layer.</span> </section>

<section><span data-start="952.38" data-end="953.11"><span class="speaker">Adam Argyle</span>: That was so quick.</span> <span data-start="953.11" data-end="954.35">It was barely promoted.</span> </section>

<section><span data-start="954.35" data-end="954.78"><span class="speaker">Jason Miller</span>: Right.</span> </section>

<section><span data-start="954.78" data-end="955.5"><span class="speaker">Adam Argyle</span>: That's a bummer.</span> </section>

<section><span data-start="955.5" data-end="957.27"><span class="speaker">Jason Miller</span>: So we did this experiment.</span> <span data-start="957.27" data-end="959.989">The profiler told us that this was a good idea.</span> <span data-start="959.989" data-end="962.28">Obviously, there's a lot less main thread work going on</span> <span data-start="962.28" data-end="963.488">in the second two animations.</span> <span data-start="963.488" data-end="965.13">These are in order.</span> <span data-start="965.13" data-end="967.5">And so this might be something we would want to do.</span> <span data-start="967.5" data-end="970.5">Except if we're targeting really low-end mobile devices,</span> <span data-start="970.5" data-end="973.38">where they might not have the best GPUs.</span> <span data-start="973.38" data-end="975.87">The reason why this is good is because GPUs</span> <span data-start="975.87" data-end="979.86">are really good at transforming composited layers.</span> <span data-start="979.86" data-end="982.57">It's important to remember that this is not a silver bullet,</span> <span data-start="982.57" data-end="983.1">though.</span> <span data-start="983.1" data-end="985.41">You always want to make sure that you profile,</span> <span data-start="985.41" data-end="988.68">and that your performance improvements on desktop</span> <span data-start="988.68" data-end="990.84">don't become problems on mobile.</span> </section>

<section><span data-start="990.84" data-end="992.23"><span class="speaker">Adam Argyle</span>: Measure.</span> </section>

<section><span data-start="992.23" data-end="993.06"><span class="speaker">Jason Miller</span>: And please, we don't</span> <span data-start="993.06" data-end="994.684">have context for this particular slide,</span> <span data-start="994.684" data-end="997.057">but please don't animate max height.</span> <span data-start="997.057" data-end="999.39">This is something that feels really easy and really good</span> <span data-start="999.39" data-end="1002.51">when you do it, but it can be really, really brutal</span> <span data-start="1002.51" data-end="1004.03">down the line for performance.</span> </section>

<section><span data-start="1004.03" data-end="1005.9"><span class="speaker">Adam Argyle</span>: I also don't think that's what people even</span> <span data-start="1005.9" data-end="1006.47">wanted to do.</span> <span data-start="1006.47" data-end="1007.28">It's like you didn't want to take</span> <span data-start="1007.28" data-end="1009.05">something that was squishy and all warped</span> <span data-start="1009.05" data-end="1010.1">and make it unwarped.</span> <span data-start="1010.1" data-end="1012.392">I think you really wanted to reveal the element, right?</span> </section>

<section><span data-start="1012.392" data-end="1014.891"><span class="speaker">Jason Miller</span>: And I think when we were doing our performance</span> <span data-start="1014.891" data-end="1017.63">optimizations, we just switched our max height</span> <span data-start="1017.63" data-end="1019.234">animation to be slide in.</span> </section>

<section><span data-start="1019.234" data-end="1020.15"><span class="speaker">Adam Argyle</span>: Slide in.</span> </section>

<section><span data-start="1020.15" data-end="1020.71"><span class="speaker">Jason Miller</span>: We just used [INAUDIBLE]..</span> </section>

<section><span data-start="1020.71" data-end="1022.76"><span class="speaker">Adam Argyle</span>: Better anyway.</span> </section>

<section><span data-start="1022.76" data-end="1025.605"><span class="speaker">Jason Miller</span>: OK, so we talked about efficient animations.</span> <span data-start="1025.605" data-end="1027.48">But there's another whole aspect of rendering</span> <span data-start="1027.48" data-end="1029.438">that's really important if you want to hit that</span> <span data-start="1029.438" data-end="1031.01">60 frames per second target.</span> <span data-start="1031.01" data-end="1034.31">And that's this idea of reading and then writing.</span> <span data-start="1034.31" data-end="1036.71">To understand this, we need to take a trip down</span> <span data-start="1036.71" data-end="1039.412">to the rendering assembly line.</span> </section>

<section><span data-start="1039.412" data-end="1040.376"><span class="speaker">Adam Argyle</span>: Yeah.</span> </section>

<section><span data-start="1040.376" data-end="1041.75"><span class="speaker">Jason Miller</span>: So ideally, when we</span> <span data-start="1041.75" data-end="1044.25">look at an app in the performance tab of DevTools,</span> <span data-start="1044.25" data-end="1046.19">we see little chunks of this sequence.</span> <span data-start="1046.19" data-end="1048.2">And these are the frames.</span> <span data-start="1048.2" data-end="1051.077">In an ideal situation, there's a lot of whitespace</span> <span data-start="1051.077" data-end="1052.91">in between these, which means that you don't</span> <span data-start="1052.91" data-end="1054.118">have a lot of idle time work.</span> <span data-start="1054.118" data-end="1056.3">Your app is sort of main thread jank free.</span> </section>

<section><span data-start="1056.3" data-end="1058.88"><span class="speaker">Adam Argyle</span>: This looks like Jake Archibald's socks.</span> </section>

<section><span data-start="1058.88" data-end="1062.28"><span class="speaker">Jason Miller</span>: I think those are the color profile we went with.</span> <span data-start="1062.28" data-end="1065.21">Yeah, so we peeked at the anatomy of a frame earlier.</span> <span data-start="1065.21" data-end="1069.051">We have style recalculation, layout, paint, compositing.</span> <span data-start="1069.051" data-end="1070.55">We didn't really dig into the script</span> <span data-start="1070.55" data-end="1072.32">portion, that initial portion that</span> <span data-start="1072.32" data-end="1073.55">leads off this whole thing.</span> <span data-start="1073.55" data-end="1075.8">And as it turns out, it's really important.</span> <span data-start="1075.8" data-end="1079.02">Not all scripts are created equal.</span> <span data-start="1079.02" data-end="1081.47">So our interaction with the Dom affects every other step</span> <span data-start="1081.47" data-end="1083.09">in the rendering process.</span> <span data-start="1083.09" data-end="1085.1">And we can split out the two types</span> <span data-start="1085.1" data-end="1087.27">of scripting into two groups.</span> <span data-start="1087.27" data-end="1089.024">We have read and then write.</span> <span data-start="1089.024" data-end="1091.19">On the left, you can see some examples of properties</span> <span data-start="1091.19" data-end="1092.926">that are Dom layout reads.</span> <span data-start="1092.926" data-end="1094.8">Some of these are pretty obvious, offset top,</span> <span data-start="1094.8" data-end="1096.925">obviously if you want to know where the element is,</span> <span data-start="1096.925" data-end="1098.26">you need to lay it out.</span> <span data-start="1098.26" data-end="1100.35">Some of these are not so obvious though.</span> <span data-start="1100.35" data-end="1102.589">Inner text inserts, it's a string.</span> <span data-start="1102.589" data-end="1103.88">It's kind of like text content.</span> <span data-start="1103.88" data-end="1106.52">But there's new lines in it based on layout.</span> <span data-start="1106.52" data-end="1109.58">If you have paragraphs or elements with display block,</span> <span data-start="1109.58" data-end="1111.07">the string has new lines in it.</span> <span data-start="1111.07" data-end="1113.78">And it's impossible to return that string without calculating</span> <span data-start="1113.78" data-end="1115.16">layout first.</span> <span data-start="1115.16" data-end="1116.93">If you're using inner text in your app,</span> <span data-start="1116.93" data-end="1119.18">and you're not using it specifically for that feature,</span> <span data-start="1119.18" data-end="1122.311">I would strongly recommend going with text content.</span> <span data-start="1122.311" data-end="1124.31">On the right is maybe a little bit more obvious.</span> <span data-start="1124.31" data-end="1127.58">If you change CSS layout, add elements, mutate the Dom tree</span> <span data-start="1127.58" data-end="1129.33">structure, you're going to trigger layout.</span> </section>

<section><span data-start="1129.33" data-end="1131.496"><span class="speaker">Adam Argyle</span>: I wish it was as simple as like getters</span> <span data-start="1131.496" data-end="1133.038">on the left and setters on the right.</span> </section>

<section><span data-start="1133.038" data-end="1133.829"><span class="speaker">Jason Miller</span>: Yeah.</span> </section>

<section><span data-start="1133.829" data-end="1134.63"><span class="speaker">Adam Argyle</span>: Yeah.</span> </section>

<section><span data-start="1134.63" data-end="1136.98"><span class="speaker">Jason Miller</span>: So let's say we have a timeline like before,</span> <span data-start="1136.98" data-end="1138.47">but this time there's two bits of script that</span> <span data-start="1138.47" data-end="1139.28">are going to run.</span> <span data-start="1139.28" data-end="1142.73">The first sets the width of an element to 10 pixels.</span> <span data-start="1142.73" data-end="1144.8">The second script, maybe it's a different script,</span> <span data-start="1144.8" data-end="1148.01">asks how much space is left aside beside fu — </span> <span data-start="1148.01" data-end="1150.152">how much space is left beside that div?</span> <span data-start="1150.152" data-end="1151.61">And in order to do this, it's going</span> <span data-start="1151.61" data-end="1153.35">use the offset width property.</span> <span data-start="1153.35" data-end="1155.12">This is where things fall apart.</span> <span data-start="1155.12" data-end="1158.97">We hadn't had a chance to calculate style and layout.</span> <span data-start="1158.97" data-end="1162.264">So we have to do that synchronicity now,</span> <span data-start="1162.264" data-end="1163.43">which is going to be forced.</span> <span data-start="1163.43" data-end="1166.22">So we have to block the main thread, do all that work,</span> <span data-start="1166.22" data-end="1168.839">and then come back to the script that asked for that width.</span> <span data-start="1168.839" data-end="1170.63">And the worst part is, that script actually</span> <span data-start="1170.63" data-end="1172.73">did this to conditionally then set</span> <span data-start="1172.73" data-end="1174.86">the width of fu, which invalidates</span> <span data-start="1174.86" data-end="1177.14">the layout and the style calculations we did,</span> <span data-start="1177.14" data-end="1179.707">which means that they have to happen again.</span> </section>

<section><span data-start="1179.707" data-end="1181.04"><span class="speaker">Adam Argyle</span>: I smell code smell.</span> </section>

<section><span data-start="1181.04" data-end="1182.54"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="1182.54" data-end="1184.17">So this is a problem.</span> <span data-start="1184.17" data-end="1185.525">And this is really common.</span> <span data-start="1185.525" data-end="1187.4">You might be tempted to use request animation</span> <span data-start="1187.4" data-end="1188.3">frame to fix this.</span> <span data-start="1188.3" data-end="1190.54">That's actually often a good strategy.</span> <span data-start="1190.54" data-end="1191.79">Let's see how that would work.</span> <span data-start="1191.79" data-end="1193.97">So request animation frame callbacks fire</span> <span data-start="1193.97" data-end="1197.29">just before the browser does all of its rendering work.</span> <span data-start="1197.29" data-end="1199.61">And let's say we might read some values synchronously</span> <span data-start="1199.61" data-end="1201.12">in the script block on the left.</span> <span data-start="1201.12" data-end="1203.12">And then cue an animation frame callback</span> <span data-start="1203.12" data-end="1205.76">where we do our Dom right, [INAUDIBLE] read and then</span> <span data-start="1205.76" data-end="1207.569">write, using this raf callback.</span> <span data-start="1207.569" data-end="1210.11">For really well-behaved code, this is actually an awesome way</span> <span data-start="1210.11" data-end="1213.26">to give the browser more control over and insight</span> <span data-start="1213.26" data-end="1215.27">into your rendering code.</span> </section>

<section><span data-start="1215.27" data-end="1216.59"><span class="speaker">Adam Argyle</span>: It's like polite.</span> <span data-start="1216.59" data-end="1217.756">You're like hey, [INAUDIBLE]</span> </section>

<section><span data-start="1217.756" data-end="1218.84"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="1218.84" data-end="1223.35">So if you pop open the profiler on an arbitrary website,</span> <span data-start="1223.35" data-end="1225.87">you might find this technique in play, where</span> <span data-start="1225.87" data-end="1227.94">it's not actually panning out.</span> <span data-start="1227.94" data-end="1229.89">And the reason for that is deferring</span> <span data-start="1229.89" data-end="1232.65">reads using request animation frame doesn't really</span> <span data-start="1232.65" data-end="1234.13">fix this problem.</span> <span data-start="1234.13" data-end="1237.63">It's still going to trigger forced synchronous layout</span> <span data-start="1237.63" data-end="1240.315">inside of the raf callback, which can sometimes be worse.</span> </section>

<section><span data-start="1240.315" data-end="1241.44"><span class="speaker">Adam Argyle</span>: That's tricky.</span> </section>

<section><span data-start="1241.44" data-end="1242.856"><span class="speaker">Jason Miller</span>: Yeah, so we're going</span> <span data-start="1242.856" data-end="1245.592">to end up in the same situation we had before.</span> <span data-start="1245.592" data-end="1247.8">So reading properties that require layout information</span> <span data-start="1247.8" data-end="1249.84">before modifying layout is an important thing</span> <span data-start="1249.84" data-end="1253.87">to keep in mind when interacting with the Dom.</span> <span data-start="1253.87" data-end="1257.62">This brings us to our variety portion of the show, which</span> <span data-start="1257.62" data-end="1259.902">we have called lazy wins.</span> </section>

<section><span data-start="1259.902" data-end="1261.61"><span class="speaker">Adam Argyle</span>: All right, and so earlier we</span> <span data-start="1261.61" data-end="1264.37">were talking about smooth, and it was described as connected,</span> <span data-start="1264.37" data-end="1266.16">silky, and asynchronous.</span> <span data-start="1266.16" data-end="1268.69">I feel like this crowd is savvy about the topic of synch</span> <span data-start="1268.69" data-end="1272.92">versus asynch and how to be polite to threads or a thread.</span> <span data-start="1272.92" data-end="1275.86">But it's not often enough that we are considerate of our users</span> <span data-start="1275.86" data-end="1276.79">thread.</span> <span data-start="1276.79" data-end="1279.56">They're often pressed for time and resources as well.</span> <span data-start="1279.56" data-end="1282.25">So we should do our best to keep their thread free of locking.</span> <span data-start="1282.25" data-end="1285.28">Our first version had synchronous interactions,</span> <span data-start="1285.28" data-end="1286.6">just like the animation here.</span> <span data-start="1286.6" data-end="1288.76">It's kind of painful to watch, right.</span> <span data-start="1288.76" data-end="1289.749">You're like, hey — </span> </section>

<section><span data-start="1289.749" data-end="1291.04"><span class="speaker">Jason Miller</span>: I hope it's done.</span> </section>

<section><span data-start="1294.697" data-end="1296.53"><span class="speaker">Adam Argyle</span>: So here's a demo of us sending.</span> <span data-start="1296.53" data-end="1297.46">It's called rough moves.</span> <span data-start="1297.46" data-end="1298.18">You'll like that.</span> <span data-start="1298.18" data-end="1301.72">Notice how this one, we have a new message or thought,</span> <span data-start="1301.72" data-end="1304.46">can't be started until the previous one is finished.</span> <span data-start="1304.46" data-end="1306.43">And it's not too bad when you send one message,</span> <span data-start="1306.43" data-end="1307.929">but when you're sending many, you're</span> <span data-start="1307.929" data-end="1309.4">going to be super disruptive.</span> <span data-start="1309.4" data-end="1310.99">The user interaction implementation</span> <span data-start="1310.99" data-end="1312.7">was easier for the engineers because they</span> <span data-start="1312.7" data-end="1314.741">could handle the flow being synchronous about it.</span> <span data-start="1314.741" data-end="1318.14">It's sort of like less work for me.</span> <span data-start="1318.14" data-end="1320.23">But we redid it.</span> <span data-start="1320.23" data-end="1323.126">And so here's the same thought process being typed out.</span> <span data-start="1323.126" data-end="1324.5">And these messages are being sent</span> <span data-start="1324.5" data-end="1327.41">using asynchronous, almost sort of known as optimistic</span> <span data-start="1327.41" data-end="1328.29">interactions.</span> <span data-start="1328.29" data-end="1329.54">And the user is never blocked.</span> <span data-start="1329.54" data-end="1330.956">They're free to express themselves</span> <span data-start="1330.956" data-end="1333.102">at the rate at which they desire and are capable.</span> <span data-start="1333.102" data-end="1335.06">And this can increase the perceived performance</span> <span data-start="1335.06" data-end="1336.643">of your application because it doesn't</span> <span data-start="1336.643" data-end="1340.7">appear to stall or think too hard about certain tasks.</span> <span data-start="1340.7" data-end="1342.29">Measuring smoothness as a UX metric</span> <span data-start="1342.29" data-end="1344.81">can be a difficult thing to quantify or qualify,</span> <span data-start="1344.81" data-end="1348.11">but luckily the experts at Google have devised a fantastic</span> <span data-start="1348.11" data-end="1350.092">framework for evaluating the quality a UX,</span> <span data-start="1350.092" data-end="1351.8">and therefore, its perceived performance.</span> <span data-start="1351.8" data-end="1353.01">It is called Heart.</span> <span data-start="1353.01" data-end="1354.05">And I wanted to throw this in there,</span> <span data-start="1354.05" data-end="1355.8">because it's the sort of mix of lazy wins,</span> <span data-start="1355.8" data-end="1358.4">because it can help you measure the impact of your UI</span> <span data-start="1358.4" data-end="1359.722">interaction paradigms.</span> </section>

<section><span data-start="1359.722" data-end="1360.99"><span class="speaker">Jason Miller</span>: Cool.</span> <span data-start="1360.99" data-end="1363.59">So one quick way to improve your application's performance,</span> <span data-start="1363.59" data-end="1365.72">is to just find a browser primitive</span> <span data-start="1365.72" data-end="1367.28">that is more efficient than something</span> <span data-start="1367.28" data-end="1369.289">manual you're doing today.</span> <span data-start="1369.289" data-end="1371.33">A great example of this would be position sticky.</span> <span data-start="1371.33" data-end="1373.88">The manual implementation of position sticky</span> <span data-start="1373.88" data-end="1375.98">requires querying for layout information</span> <span data-start="1375.98" data-end="1378.92">while you're scrolling, in the scroll handler.</span> <span data-start="1378.92" data-end="1380.21">This is really expensive.</span> <span data-start="1380.21" data-end="1382.126">This triggers all the bad performance problems</span> <span data-start="1382.126" data-end="1383.78">we saw before.</span> <span data-start="1383.78" data-end="1386.6">Another one would be to leverage native scrolling,</span> <span data-start="1386.6" data-end="1388.74">by swapping out your custom scroll implementation,</span> <span data-start="1388.74" data-end="1391.43">scroll smoothing implementation, for scroll interview</span> <span data-start="1391.43" data-end="1392.45">with behavior smooth.</span> <span data-start="1392.45" data-end="1394.061">This is relatively new.</span> <span data-start="1394.061" data-end="1395.06">This feature is awesome.</span> <span data-start="1395.06" data-end="1397.44">It made building our chat UI really easy.</span> <span data-start="1397.44" data-end="1399.86">The only thing that we had to do, we were firing at a lot,</span> <span data-start="1399.86" data-end="1402.575">so we actually de-balanced it, using request idle callback.</span> <span data-start="1402.575" data-end="1405.2">So we only scroll into view once the main thread's settled down</span> <span data-start="1405.2" data-end="1406.46">and messages have stopped being fetched.</span> </section>

<section><span data-start="1406.46" data-end="1407.69"><span class="speaker">Adam Argyle</span>: That was a really slick one too.</span> <span data-start="1407.69" data-end="1408.95">Because on an old device — </span> <span data-start="1408.95" data-end="1411.53">we had a test where we hammered messages in there.</span> <span data-start="1411.53" data-end="1413.83">We sent like 30 of them over the span of three seconds.</span> <span data-start="1413.83" data-end="1416.24">And an older device was able to not be</span> <span data-start="1416.24" data-end="1419.014">overwhelmed because we were nice about asking</span> <span data-start="1419.014" data-end="1419.93">when to smooth scroll.</span> </section>

<section><span data-start="1419.93" data-end="1420.32"><span class="speaker">Jason Miller</span>: Right.</span> </section>

<section><span data-start="1420.32" data-end="1422.58"><span class="speaker">Adam Argyle</span>: So the messages would pour in it</span> <span data-start="1422.58" data-end="1424.07">and then smooth down to the bottom.</span> </section>

<section><span data-start="1424.07" data-end="1424.86"><span class="speaker">Jason Miller</span>: It'll wait.</span> </section>

<section><span data-start="1424.86" data-end="1426.23"><span class="speaker">Adam Argyle</span>: It'll wait, and on a nice machine,</span> <span data-start="1426.23" data-end="1428.646">they just poured right in, because it was powerful enough.</span> <span data-start="1428.646" data-end="1429.35">It was easy.</span> </section>

<section><span data-start="1429.35" data-end="1431.3"><span class="speaker">Jason Miller</span>: OK, so just like scrolling,</span> <span data-start="1431.3" data-end="1433.01">panning is a gesture where we expect</span> <span data-start="1433.01" data-end="1435.847">to feel like we're physically pushing content around</span> <span data-start="1435.847" data-end="1436.43">on the screen.</span> <span data-start="1436.43" data-end="1438.471">We want to have that connection between our thumb</span> <span data-start="1438.471" data-end="1439.19">and the pixels.</span> <span data-start="1439.19" data-end="1442.07">In a well-built custom panning implementation,</span> <span data-start="1442.07" data-end="1445.34">touch input received by the browser is sent to the page,</span> <span data-start="1445.34" data-end="1447.14">and then the JavaScript input handling code</span> <span data-start="1447.14" data-end="1449.66">responds by updating probably the transform property</span> <span data-start="1449.66" data-end="1452.45">on an element, and then that is rendered by sending that back</span> <span data-start="1452.45" data-end="1456.012">to the compositor, which results in pixels on the screen.</span> <span data-start="1456.012" data-end="1457.47">So this actually works pretty well.</span> <span data-start="1457.47" data-end="1458.96">But we can do better.</span> <span data-start="1458.96" data-end="1462.265">In browser scrolling, optimal browser scrolling,</span> <span data-start="1462.265" data-end="1464.39">we don't have to wait for JavaScript event handlers</span> <span data-start="1464.39" data-end="1465.11">to complete.</span> <span data-start="1465.11" data-end="1468.17">We could just directly translate that layer on the compositor.</span> <span data-start="1468.17" data-end="1470.859">Events will eventually get sent over to the page,</span> <span data-start="1470.859" data-end="1473.15">but in an ideal setup where passive event listeners are</span> <span data-start="1473.15" data-end="1475.131">being used, they could be fire and forget.</span> <span data-start="1475.131" data-end="1477.38">And this is going to get your shortest time to pixels.</span> <span data-start="1477.38" data-end="1479.12">So here's an example of that manual kind</span> <span data-start="1479.12" data-end="1481.05">of panning, the first kind.</span> <span data-start="1481.05" data-end="1482.202">It's a simple carousel.</span> <span data-start="1482.202" data-end="1483.41">These are my pets by the way.</span> <span data-start="1483.41" data-end="1486.02">My wife required that I said that.</span> <span data-start="1486.02" data-end="1487.5">So it's using pointer events.</span> <span data-start="1487.5" data-end="1490.054">And it sets a transform property on the layer.</span> <span data-start="1490.054" data-end="1491.72">There's some problems with this, though.</span> <span data-start="1491.72" data-end="1494.78">So we're getting composited animation, which is good,</span> <span data-start="1494.78" data-end="1496.871">but the implementation is non-trivial.</span> <span data-start="1496.871" data-end="1498.62">Especially if you want to integrate really</span> <span data-start="1498.62" data-end="1501.86">well with the browsers own page scrolling, if you're panning,</span> <span data-start="1501.86" data-end="1504.685">and the person's thumb starts to move more up than left</span> <span data-start="1504.685" data-end="1506.81">or right, you really need to cancel that animation.</span> </section>

<section><span data-start="1506.81" data-end="1508.787"><span class="speaker">Adam Argyle</span>: Get that uncanny scrolly valley.</span> </section>

<section><span data-start="1508.787" data-end="1509.87"><span class="speaker">Jason Miller</span>: Yeah, right.</span> <span data-start="1509.87" data-end="1511.97">So another option here would be to use</span> <span data-start="1511.97" data-end="1513.86">something called scroll snaps.</span> <span data-start="1513.86" data-end="1515.66">So this is really elegant.</span> <span data-start="1515.66" data-end="1518.82">Basically, instead of all the manual implementation,</span> <span data-start="1518.82" data-end="1521.09">you just put two CSS properties on that carousel.</span> <span data-start="1521.09" data-end="1522.77">The first is scroll snap type.</span> <span data-start="1522.77" data-end="1526.16">We just said we want to do it in the x-axis and always snap.</span> <span data-start="1526.16" data-end="1527.792">And the second is scroll snap align,</span> <span data-start="1527.792" data-end="1530.25">which just tells it to snap to the beginning of each image.</span> </section>

<section><span data-start="1530.25" data-end="1531.124"><span class="speaker">Adam Argyle</span>: So cool.</span> </section>

<section><span data-start="1531.124" data-end="1533.15"><span class="speaker">Jason Miller</span>: And what this looks like is this.</span> <span data-start="1533.15" data-end="1536.7">So this requires a lot less code to implement.</span> <span data-start="1536.7" data-end="1538.34">It's still composited, but this one</span> <span data-start="1538.34" data-end="1540.38">doesn't rely on the main thread at all,</span> <span data-start="1540.38" data-end="1542.15">and it feels natural on each platform.</span> <span data-start="1542.15" data-end="1545">Because the easing, rather than being manually implemented,</span> <span data-start="1545" data-end="1546.36">is just the platform's native scroll easing.</span> </section>

<section><span data-start="1546.36" data-end="1548.06"><span class="speaker">Adam Argyle</span>: Yeah, you get the bounce at the end for free.</span> <span data-start="1548.06" data-end="1549.12">You get to throw it.</span> <span data-start="1549.12" data-end="1551.09">I mean, the whole nine.</span> </section>

<section><span data-start="1551.09" data-end="1553.55"><span class="speaker">Jason Miller</span>: So to sum things up, make</span> <span data-start="1553.55" data-end="1555.53">sure you're keeping the browser's rendering</span> <span data-start="1555.53" data-end="1557.98">pipeline in mind when you're animating</span> <span data-start="1557.98" data-end="1561.71">and always try to avoid animating layout.</span> <span data-start="1561.71" data-end="1564.08">Sync up your Dom access so you read</span> <span data-start="1564.08" data-end="1567.26">properties that require layout information before mutating</span> <span data-start="1567.26" data-end="1569.79">the Dom and causing layout.</span> </section>

<section><span data-start="1569.79" data-end="1572.15"><span class="speaker">Adam Argyle</span>: And consider using optimistic interactions,</span> <span data-start="1572.15" data-end="1573.65">because they can sometimes be better</span> <span data-start="1573.65" data-end="1575.899">than optimizing rendering, especially</span> <span data-start="1575.899" data-end="1577.19">if you're just getting started.</span> </section>

<section><span data-start="1577.19" data-end="1578.023"><span class="speaker">Jason Miller</span>: Right.</span> <span data-start="1578.023" data-end="1580.34">And finally, take advantage of places</span> <span data-start="1580.34" data-end="1583.52">where you can offload the most performance critical work,</span> <span data-start="1583.52" data-end="1585.23">and rendering to the browser.</span> <span data-start="1585.23" data-end="1587.99">If you can leverage something like scroll snapping</span> <span data-start="1587.99" data-end="1590.57">or position sticky to implement your designs,</span> <span data-start="1590.57" data-end="1593.162">that might be the biggest performance win of all.</span> </section>

<section><span data-start="1593.162" data-end="1594.37"><span class="speaker">Adam Argyle</span>: It's a lazy win.</span> </section>

<section><span data-start="1594.37" data-end="1595.58"><span class="speaker">Jason Miller</span>: Right, cool.</span> <span data-start="1595.58" data-end="1596.6">So thanks everybody.</span> <span data-start="1596.6" data-end="1597.35">Thank you.</span> <span data-start="1597.35" data-end="1599.5">[MUSIC PLAYING]</span> </section>

</div>

<img alt="The End" id="fin" src="images/fin.jpg">

<script>
/*eslint-disable */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google-translate');
}
/* eslint-enable */
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="js/main.js"></script>

</body>

</html>
